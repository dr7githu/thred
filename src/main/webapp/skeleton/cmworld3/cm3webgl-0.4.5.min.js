var CMWORLD,FPS,cmBlendMode,cm_color,cm_edge,cm_rect,cm_canvas,Module,__extends,CmAxis3D,CmCMVStyle,cm_cmvGeometry,cm_Line2D,cm_Line3D,cm_Surface2D,cm_Surface3D,vw_Object;(function(V){var L;L=function(){function E(){}return E;}();L["PI"]=3.1415926535897932384626433832795;L["PIHalf"]=1.5707963267948966192313216916398;L["Rad2Deg"]=57.295779513082320876798154814105;L["Deg2Rad"]=0.01745329251994329576923690768489;L["Tan30"]=0.57735026918962576450914878050196;L["Tan60"]=1.7320508075688772935274463415059;L["EarthRadius"]=6378137.0;V["cm_const"]=L;}(CMWORLD||(CMWORLD={})));(function(F){var Q,G,M,R,T,O,o,W,Z,S,I,u,K,N,P,U,H7,k7,L7,V7,E7,y7,s7,Y7,l7,r7,F7,W7,U7,G7,M7,J;(function(C7){C7[C7["CMWORLD"]=0]="CMWORLD";C7[C7["VWORLD"]=1]="VWORLD";C7[C7["WMS"]=3]="WMS";}(Q=F["MapServiceType"]||(F["MapServiceType"]={})));(function(D7){D7[D7["SCENE_P2D"]=0]="SCENE_P2D";D7[D7["SCENE_S3D"]=1]="SCENE_S3D";D7[D7["SCENE_P3D"]=2]="SCENE_P3D";}(G=F["SceneModeType"]||(F["SceneModeType"]={})));(function(A7){A7[A7["NW"]=0]="NW";A7[A7["NE"]=1]="NE";A7[A7["SW"]=2]="SW";A7[A7["SE"]=3]="SE";A7[A7["Top"]=4]="Top";A7[A7["None"]=5]="None";A7[A7["WATER"]=6]="WATER";}(M=F["TilePositionType"]||(F["TilePositionType"]={})));(function(z7){z7[z7["LBF"]=0]="LBF";z7[z7["LBB"]=1]="LBB";z7[z7["RBF"]=2]="RBF";z7[z7["RBB"]=3]="RBB";z7[z7["LTF"]=4]="LTF";z7[z7["LTB"]=5]="LTB";z7[z7["RTF"]=6]="RTF";z7[z7["RTB"]=7]="RTB";z7[z7["Top"]=8]="Top";z7[z7["None"]=9]="None";}(R=F["Cube3DPositionType"]||(F["Cube3DPositionType"]={})));(function(n7){n7[n7["Camera"]=0]="Camera";n7[n7["Object"]=1]="Object";}(T=F["Cube3DUpdateAgent"]||(F["Cube3DUpdateAgent"]={})));(function(R7){R7[R7["TRUE"]=0]="TRUE";R7[R7["FALSE"]=1]="FALSE";R7[R7["NOVISIBLE"]=2]="NOVISIBLE";}(O=F["DrawResult"]||(F["DrawResult"]={})));(function(g7){g7[g7["TRUE"]=0]="TRUE";g7[g7["FALSE"]=1]="FALSE";g7[g7["DATALOADING"]=2]="DATALOADING";}(o=F["VisibleState"]||(F["VisibleState"]={})));(function(X7){X7[X7["GEOMETRY"]=0]="GEOMETRY";X7[X7["SHAPE"]=1]="SHAPE";X7[X7["MODEL"]=2]="MODEL";X7[X7["BILLBOARD"]=3]="BILLBOARD";}(W=F["VectorObjectType"]||(F["VectorObjectType"]={})));(function(T7){T7[T7["POSITION"]=0]="POSITION";T7[T7["ROTATE"]=1]="ROTATE";T7[T7["SCALE"]=2]="SCALE";T7[T7["LOOKAT"]=3]="LOOKAT";}(Z=F["ActionType"]||(F["ActionType"]={})));(function(a7){a7[a7["Geodetic"]=0]="Geodetic";a7[a7["Geocentric"]=1]="Geocentric";}(S=F["GlobeCoordinateSystem"]||(F["GlobeCoordinateSystem"]={})));(function(t7){t7[t7["_dae"]=0]="_dae";t7[t7["_obj"]=1]="_obj";t7[t7["_3ds"]=2]="_3ds";t7[t7["_jpg"]=3]="_jpg";t7[t7["_png"]=4]="_png";t7[t7["_json"]=5]="_json";t7[t7["_cmv"]=6]="_cmv";t7[t7["_cbt"]=7]="_cbt";t7[t7["_dat"]=8]="_dat";t7[t7["_xdo"]=9]="_xdo";t7[t7["_spi"]=10]="_spi";t7[t7["_spo"]=11]="_spo";t7[t7["_pbuf"]=12]="_pbuf";t7[t7["_avro"]=13]="_avro";t7[t7["_zip"]=14]="_zip";t7[t7["_cbr"]=15]="_cbr";}(I=F["FileFormat"]||(F["FileFormat"]={})));(function(O7){O7[O7["_raster"]=0]="_raster";O7[O7["_vector"]=1]="_vector";O7[O7["_undergroundclip"]=2]="_undergroundclip";O7[O7["_virtual"]=3]="_virtual";}(u=F["Cube3DType"]||(F["Cube3DType"]={})));(function(o7){o7[o7["none"]=0]="none";o7[o7["start"]=1]="start";o7[o7["finish"]=2]="finish";o7[o7["response"]=4]="response";o7[o7["loadModel"]=16]="loadModel";o7[o7["loadTerrain"]=32]="loadTerrain";}(K=F["WorkerCommand"]||(F["WorkerCommand"]={})));(function(J7){J7[J7["None"]=0]="None";J7[J7["WMS"]=1]="WMS";J7[J7["WFS"]=2]="WFS";}(N=F["OGC_ProtocolType"]||(F["OGC_ProtocolType"]={})));(function(Z7){Z7[Z7["Unknown"]=-1]="Unknown";Z7[Z7["PointMesh"]=0]="PointMesh";Z7[Z7["Text"]=1]="Text";Z7[Z7["Line"]=2]="Line";Z7[Z7["Surface"]=3]="Surface";Z7[Z7["Solid"]=4]="Solid";Z7[Z7["ShpBuilding"]=5]="ShpBuilding";Z7[Z7["Mesh"]=6]="Mesh";Z7[Z7["Tree"]=7]="Tree";Z7[Z7["AdBoard"]=8]="AdBoard";Z7[Z7["Pipe"]=9]="Pipe";Z7[Z7["Road"]=10]="Road";Z7[Z7["Point"]=11]="Point";Z7[Z7["IconPoint"]=12]="IconPoint";Z7[Z7["ElectricPole"]=13]="ElectricPole";Z7[Z7["Chart3D"]=14]="Chart3D";Z7[Z7["Line2D"]=22]="Line2D";Z7[Z7["Arrow3D"]=23]="Arrow3D";Z7[Z7["Custom"]=99]="Custom";}(W=F["VectorObjectType"]||(F["VectorObjectType"]={})));(function(x7){x7[x7["First"]=0]="First";x7[x7["Third"]=1]="Third";}(P=F["CameraPerson"]||(F["CameraPerson"]={})));(function(i7){i7[i7["vector"]=0]="vector";i7[i7["image"]=1]="image";}(U=F["VectorRenderMode"]||(F["VectorRenderMode"]={})));(function(p7){p7[p7["normal"]=0]="normal";p7[p7["pickObject"]=1]="pickObject";p7[p7["drawPoint"]=2]="drawPoint";p7[p7["drawSimpleline"]=3]="drawSimpleline";p7[p7["drawPolyline"]=4]="drawPolyline";p7[p7["drawPolygon"]=5]="drawPolygon";p7[p7["drawRectangle"]=6]="drawRectangle";p7[p7["drawCircle"]=7]="drawCircle";p7[p7["drawSphere"]=8]="drawSphere";p7[p7["drawVolumePolygon"]=9]="drawVolumePolygon";}(H7=F["MouseMode"]||(F["MouseMode"]={})));(function(S7){S7[S7["LButton"]=0]="LButton";S7[S7["MButton"]=1]="MButton";S7[S7["RButton"]=2]="RButton";S7[S7["Unknown"]=9]="Unknown";}(k7=F["MouseButton"]||(F["MouseButton"]={})));(function(I7){I7[I7["click"]=0]="click";I7[I7["dbclick"]=1]="dbclick";I7[I7["lclick"]=2]="lclick";I7[I7["mclick"]=3]="mclick";I7[I7["rclick"]=4]="rclick";}(L7=F["MouseClick"]||(F["MouseClick"]={})));(function(w7){w7[w7["down"]=1]="down";w7[w7["up"]=2]="up";w7[w7["click"]=3]="click";w7[w7["move"]=4]="move";w7[w7["dblclick"]=5]="dblclick";w7[w7["wheel"]=6]="wheel";}(V7=F["MouseEventType"]||(F["MouseEventType"]={})));(function(e7){e7[e7["none"]=0]="none";e7[e7["point"]=1]="point";e7[e7["linestring"]=2]="linestring";e7[e7["polygon"]=3]="polygon";e7[e7["circle"]=4]="circle";e7[e7["sphere"]=5]="sphere";e7[e7["volumepolygon"]=6]="volumepolygon";}(E7=F["GisObjectType"]||(F["GisObjectType"]={})));(function(v7){v7[v7["point"]=0]="point";v7[v7["linestring"]=1]="linestring";v7[v7["polygon"]=2]="polygon";v7[v7["multipoint"]=3]="multipoint";v7[v7["multilinestring"]=4]="multilinestring";v7[v7["multipolygon"]=5]="multipolygon";v7[v7["geometrycollection"]=6]="geometrycollection";v7[v7["circle"]=7]="circle";}(y7=F["GeometryType"]||(F["GeometryType"]={})));(function(h7){h7[h7["baseMap"]=0]="baseMap";h7[h7["overlayMap"]=1]="overlayMap";h7[h7["dynamicMap"]=2]="dynamicMap";}(s7=F["MapLayerType"]||(F["MapLayerType"]={})));(function(j7){j7[j7["rectangle"]=0]="rectangle";j7[j7["circle"]=1]="circle";}(Y7=F["BoundaryType"]||(F["BoundaryType"]={})));(function(u7){u7[u7["none"]=0]="none";u7[u7["vector"]=1]="vector";u7[u7["image"]=2]="image";u7[u7["terrain"]=3]="terrain";}(l7=F["LayerType"]||(F["LayerType"]={})));(function(c7){c7[c7["notOpen"]=0]="notOpen";c7[c7["notSend"]=1]="notSend";c7[c7["notReceive"]=2]="notReceive";c7[c7["processing"]=3]="processing";c7[c7["finished"]=4]="finished";}(r7=F["xHttp_readyState"]||(F["xHttp_readyState"]={})));(function(d7){d7[d7["none"]=0]="none";d7[d7["OK"]=200]="OK";d7[d7["NoContent"]=204]="NoContent";d7[d7["BAD_REQUEST"]=400]="BAD_REQUEST";d7[d7["NOT_FOUND"]=404]="NOT_FOUND";d7[d7["REQUEST_TIMEOUT"]=408]="REQUEST_TIMEOUT";d7[d7["closedError"]=499]="closedError";}(F7=F["HttpStatusCode"]||(F["HttpStatusCode"]={})));(function(K7){K7[K7["PolarRotation"]=0]="PolarRotation";K7[K7["AnyRotation"]=1]="AnyRotation";}(W7=F["GlobePanningMode"]||(F["GlobePanningMode"]={})));(function(b7){b7[b7["none"]=0]="none";b7[b7["downloadrequested"]=1]="downloadrequested";b7[b7["downloaded"]=2]="downloaded";b7[b7["notfound"]=3]="notfound";}(U7=F["FileState"]||(F["FileState"]={})));(function(N7){N7[N7["Reset"]=0]="Reset";N7[N7["Append"]=1]="Append";}(G7=F["RotateOp"]||(F["RotateOp"]={})));(function(P7){P7[P7["default"]=0]="default";P7[P7["left"]=1]="left";P7[P7["right"]=2]="right";P7[P7["top"]=3]="top";P7[P7["bottom"]=4]="bottom";}(M7=F["POITextPosition"]||(F["POITextPosition"]={})));(function(B7){B7[B7["none"]=0]="none";B7[B7["uprightModel"]=1]="uprightModel";B7[B7["legacyVWorldXdoModel"]=2]="legacyVWorldXdoModel";}(J=F["BBoxType"]||(F["BBoxType"]={})));}(CMWORLD||(CMWORLD={})));(function(q7){var Q7;Q7=function(){Object["defineProperty"](f7["prototype"],"numberOfListeners",{get:function(){return this["listeners"]["length"];},enumerable:true,configurable:true});function f7(H3){this["listeners"]=[];this["owners"]=[];this["viewer3"]=null;this["viewer3"]=H3;}f7["prototype"]["addEventListener"]=function(k3,L3){if(q7["Util"]["isDefined"](k3)==false){return false;}if(q7["Util"]["findIndexFromArray"](this["listeners"],k3)<0){this["listeners"]["push"](k3);this["owners"]["push"](L3);}};f7["prototype"]["removeEventListener"]=function(E3){var V3;V3=q7["Util"]["removeFromArray"](this["listeners"],E3);if(V3>-1){this["owners"]["splice"](V3,1);}};f7["prototype"]["raiseEvent"]=function(Y3){if(Y3===void 0){Y3={};}if(this["listeners"]["length"]<1){return;}Y3['viewer3']=this["viewer3"];for(var s3=0;s3<this["listeners"]["length"];s3++){if(q7["Util"]["isDefined"](this["listeners"][s3])){this["listeners"][s3](Y3,this["owners"][s3]);}}};f7["prototype"]["clear"]=function(){this["listeners"]["length"]=0;this["owners"]["length"]=0;};return f7;}();q7["Event"]=Q7;}(CMWORLD||(CMWORLD={})));(function(l3){var F3;F3=function(){M3["byteToFloat"]=function(n3){return n3/255.0;};;M3["floatToByte"]=function(R3){return R3===1.0?255.0:R3*256.0|0;};;M3["fromBytes"]=function(X3,T3,a3,O3,g3){X3=M3["byteToFloat"](l3["Util"]["defaultValue"](X3,255.0));T3=M3["byteToFloat"](l3["Util"]["defaultValue"](T3,255.0));a3=M3["byteToFloat"](l3["Util"]["defaultValue"](a3,255.0));O3=M3["byteToFloat"](l3["Util"]["defaultValue"](O3,255.0));if(!l3["Util"]["isDefined"](g3)){return new M3(X3,T3,a3,O3);}g3["red"]=X3;g3["green"]=T3;g3["blue"]=a3;g3["alpha"]=O3;return g3;};function M3(C3,D3,A3,z3){this["r"]=1.0;this["g"]=1.0;this["b"]=1.0;this["a"]=1.0;this["r"]=l3["Util"]["defaultValue"](C3,1.0);this["g"]=l3["Util"]["defaultValue"](D3,1.0);this["b"]=l3["Util"]["defaultValue"](A3,1.0);this["a"]=l3["Util"]["defaultValue"](z3,1.0);};M3["fromHsl"]=function(I3,Z3,o3,u3,J3){var e3,h3,j3,S3,w3;I3=l3["Util"]["defaultValue"](I3,0.0)%1.0;Z3=l3["Util"]["defaultValue"](Z3,0.0);o3=l3["Util"]["defaultValue"](o3,0.0);u3=l3["Util"]["defaultValue"](u3,1.0);e3=o3;h3=o3;j3=o3;if(Z3!==0){if(o3<0.5){S3=o3*(1+Z3);}else{S3=o3+Z3-o3*Z3;}w3=2.0*o3-S3;e3=r3(w3,S3,I3+1/3);h3=r3(w3,S3,I3);j3=r3(w3,S3,I3-1/3);}if(!l3["Util"]["isDefined"](J3)){return new M3(e3,h3,j3,u3);}J3["red"]=e3;J3["green"]=h3;J3["blue"]=j3;J3["alpha"]=u3;return J3;};;M3["prototype"]["toBytes"]=function(c3){var d3,K3,b3,N3;d3=M3["floatToByte"](this["r"]);K3=M3["floatToByte"](this["g"]);b3=M3["floatToByte"](this["b"]);N3=M3["floatToByte"](this["a"]);if(!l3["Util"]["isDefined"](c3)){return[d3,K3,b3,N3];}c3[0]=d3;c3[1]=K3;c3[2]=b3;c3[3]=N3;return c3;};;return M3;}();l3["Color"]=F3;function r3(U3,G3,W3){if(W3<0){W3+=1;}if(W3>1){W3-=1;}if(W3*6<1){return U3+(G3-U3)*6*W3;}if(W3*2<1){return G3;}if(W3*3<2){return U3+(G3-U3)*(2/3-W3)*6;}return U3;}}(CMWORLD||(CMWORLD={})));(function(P3){var B3;B3=function(){q3["prototype"]["dispose"]=function(){this["points"]=null;};q3["prototype"]["updateBoundary"]=function(){var f3,H8,k8,L8,Q3;if(P3["Util"]["isDefined"](this["points"])==false)return;if(this["points"]["length"]<1)return;f3=Number["MAX_VALUE"];H8=Number["MIN_VALUE"];k8=Number["MAX_VALUE"];L8=Number["MIN_VALUE"];for(var V8=0;V8<this["points"]["length"];V8++){Q3=this["points"][V8];f3=Q3["x"]<f3?Q3["x"]:f3;H8=Q3["x"]>H8?Q3["x"]:H8;k8=Q3["y"]<k8?Q3["y"]:k8;L8=Q3["y"]>L8?Q3["y"]:L8;}if(P3["Util"]["isDefined"](this["boundary"])==false){this["boundary"]=new P3["Rectangle"]();}this["boundary"]["setRectangle"](f3,k8,H8,L8);};q3["calcMinMaxHeight"]=function(y8){var s8,Y8;s8=Number["MAX_VALUE"];Y8=Number["MIN_VALUE"];for(var E8=0;E8<y8["length"];E8++){s8=y8[E8]["z"]<s8?y8[E8]["z"]:s8;Y8=y8[E8]["z"]>Y8?y8[E8]["z"]:Y8;}return new THREE["Vector2"](s8,Y8);};q3["signedVolumeOfTriangle"]=function(l8,r8,F8){var W8,U8,G8,M8,C8,D8;W8=F8["x"]*r8["y"]*l8["z"];U8=r8["x"]*F8["y"]*l8["z"];G8=F8["x"]*l8["y"]*r8["z"];M8=l8["x"]*F8["y"]*r8["z"];C8=r8["x"]*l8["y"]*F8["z"];D8=l8["x"]*r8["y"]*F8["z"];return 1.0/6.0*(-W8+U8+G8-M8-C8+D8);};q3["volumeOfGeometry"]=function(n8){var R8,g8,A8,z8;R8=0;if(P3["Util"]["isDefined"](n8)){g8=n8["faces"];A8=n8["vertices"];for(var X8 in g8){z8=g8[X8];R8+=q3["signedVolumeOfTriangle"](A8[z8["a"]],A8[z8["b"]],A8[z8["c"]]);}}return Math["abs"](R8);};function q3(){this["type"]=P3["GeometryType"]["point"];this["points"]=[];this["boundary"]=null;}return q3;}();P3["Geometry"]=B3;}(CMWORLD||(CMWORLD={})));(function(T8){var a8;a8=function(){Object["defineProperty"](t8["prototype"],"length",{get:function(){return this["_array"]["length"];},enumerable:true,configurable:true});Object["defineProperty"](t8["prototype"],"values",{get:function(){return this["_array"];},enumerable:true,configurable:true});t8["prototype"]["contains"]=function(O8){if(typeof O8!=='string'&&typeof O8!=='number'){console["error"]('key is required to be a string or number.');}return T8["Util"]["isDefined"](this["_hash"][O8]);};function t8(){this["_array"]=[];this["_hash"]={};};t8["prototype"]["set"]=function(o8,J8){var Z8;if(typeof o8!=='string'&&typeof o8!=='number'){console["error"]('key is required to be a string or number.');}Z8=this["_hash"][o8];if(J8!==Z8){this["remove"](o8);this["_hash"][o8]=J8;this["_array"]["push"](J8);}};;t8["prototype"]["get"]=function(x8){if(typeof x8!=='string'&&typeof x8!=='number'){console["error"]('key is required to be a string or number.');}return this["_hash"][x8];};;t8["prototype"]["remove"]=function(i8){var p8,S8,I8;if(T8["Util"]["isDefined"](i8)&&typeof i8!=='string'&&typeof i8!=='number'){console["error"]('key is required to be a string or number.');}p8=this["_hash"][i8];S8=T8["Util"]["isDefined"](p8);if(S8){I8=this["_array"];I8["splice"](I8["indexOf"](p8),1);delete this["_hash"][i8];}return S8;};;t8["prototype"]["removeAll"]=function(){var w8;w8=this["_array"];if(w8["length"]>0){this["_hash"]={};w8["length"]=0;}};;return t8;}();T8["AssociativeArray"]=a8;}(CMWORLD||(CMWORLD={})));(function(v8){var e8;e8=function(){h8["prototype"]["endFrame"]=function(j8,u8){};function h8(){this["overlayMapMinFrameID"]=0;this["dynamicMapFrameID"]=0;}return h8;}();v8["FrameState"]=e8;}(CMWORLD||(CMWORLD={})));(function(d8){var c8;c8=function(){K8["prototype"]["dispose"]=function(){this["view"]=null;};K8["prototype"]["getLength"]=function(){return this["view"]["byteLength"];};K8["prototype"]["readBoolean"]=function(){var P8;P8=this["view"]["getInt8"](this["offset"]);this["offset"]+=1;if(P8>0)return true;return false;};K8["prototype"]["readBytes"]=function(f8){var B8,Q8;B8=[];for(var q8=0;q8<f8;q8++){Q8=this["readUInt8"]();B8["push"](Q8);}return B8;};K8["prototype"]["readByte"]=function(){var H4;H4=this["view"]["getInt8"](this["offset"]);this["offset"]+=1;return H4;};K8["prototype"]["readDouble"]=function(){var k4;k4=this["view"]["getFloat64"](this["offset"],this["littleendian"]);this["offset"]+=8;return k4;};K8["prototype"]["readInt16"]=function(){var L4;L4=this["view"]["getInt16"](this["offset"],this["littleendian"]);this["offset"]+=2;return L4;};K8["prototype"]["readInt32"]=function(){var V4;V4=this["view"]["getInt32"](this["offset"],this["littleendian"]);this["offset"]+=4;return V4;};K8["prototype"]["readSingle"]=function(){var E4;E4=this["view"]["getFloat32"](this["offset"],this["littleendian"]);this["offset"]+=4;return E4;};K8["prototype"]["readString"]=function(){var r4,l4;r4='';l4=this["readByte"]();for(var s4=0,Y4;s4<l4;){Y4=this["view"]["getUint8"](this["offset"]+s4++);r4+=String["fromCharCode"](Y4>0xdf&&Y4<0xf0&&s4<l4-1?(Y4&0xf)<<12|(this["view"]["getUint8"](this["offset"]+s4++)&0x3f)<<6|this["view"]["getUint8"](this["offset"]+s4++)&0x3f:Y4>0x7f&&s4<l4?(Y4&0x1f)<<6|this["view"]["getUint8"](this["offset"]+s4++)&0x3f:Y4);}this["offset"]+=l4;return r4;};function K8(N8,b8){if(b8===void 0){b8=true;}this["view"]=null;this["offset"]=0;this["littleendian"]=true;this["view"]=new DataView(N8);this["offset"]=0;this["littleendian"]=b8;}K8["prototype"]["readLongString"]=function(){var G4,U4;G4='';U4=this["readInt16"]();for(var F4=0,W4;F4<U4;){W4=this["view"]["getUint8"](this["offset"]+F4++);G4+=String["fromCharCode"](W4>0xdf&&W4<0xf0&&F4<U4-1?(W4&0xf)<<12|(this["view"]["getUint8"](this["offset"]+F4++)&0x3f)<<6|this["view"]["getUint8"](this["offset"]+F4++)&0x3f:W4>0x7f&&F4<U4?(W4&0x1f)<<6|this["view"]["getUint8"](this["offset"]+F4++)&0x3f:W4);}this["offset"]+=U4;return G4;};K8["prototype"]["readJSON"]=function(D4){var A4;A4='';for(var M4=0,C4;M4<D4;){C4=this["view"]["getUint8"](this["offset"]+M4++);A4+=String["fromCharCode"](C4>0xdf&&C4<0xf0&&M4<D4-1?(C4&0xf)<<12|(this["view"]["getUint8"](this["offset"]+M4++)&0x3f)<<6|this["view"]["getUint8"](this["offset"]+M4++)&0x3f:C4>0x7f&&M4<D4?(C4&0x1f)<<6|this["view"]["getUint8"](this["offset"]+M4++)&0x3f:C4);}this["offset"]+=D4;return A4;};K8["prototype"]["readUInt8"]=function(){var z4;z4=this["view"]["getUint8"](this["offset"]);this["offset"]+=1;return z4;};K8["prototype"]["readUInt16"]=function(){var n4;n4=this["view"]["getUint16"](this["offset"],this["littleendian"]);this["offset"]+=2;return n4;};K8["prototype"]["readUInt32"]=function(){var R4;R4=this["view"]["getUint32"](this["offset"],this["littleendian"]);this["offset"]+=4;return R4;};K8["prototype"]["moveFirst"]=function(){this["offset"]=0;};K8["prototype"]["bin2String"]=function(g4){return String["fromCharCode"]["apply"](String,g4);};K8["prototype"]["toUTF8Array"]=function(O4){var T4,X4;T4=[];for(var a4=0;a4<O4["length"];a4++){X4=O4["charCodeAt"](a4);if(X4<0x80)T4["push"](X4);else if(X4<0x800){T4["push"](0xc0|X4>>6,0x80|X4&0x3f);}else if(X4<0xd800||X4>=0xe000){T4["push"](0xe0|X4>>12,0x80|X4>>6&0x3f,0x80|X4&0x3f);}else{a4++;X4=0x10000+((X4&0x3ff)<<10|O4["charCodeAt"](a4)&0x3ff);T4["push"](0xf0|X4>>18,0x80|X4>>12&0x3f,0x80|X4>>6&0x3f,0x80|X4&0x3f);}}return T4;};K8["prototype"]["fromUTF8Array"]=function(Z4){var i4,o4,J4,p4;i4='';for(o4=0;o4<Z4["length"];o4++){J4=Z4[o4];if(J4<0x80){i4+=String["fromCharCode"](J4);}else if(J4>0xBF&&J4<0xE0){i4+=String["fromCharCode"]((J4&0x1F)<<6|Z4[o4+1]&0x3F);o4+=1;}else if(J4>0xDF&&J4<0xF0){i4+=String["fromCharCode"]((J4&0x0F)<<12|(Z4[o4+1]&0x3F)<<6|Z4[o4+2]&0x3F);o4+=2;}else{p4=((J4&0x07)<<18|(Z4[o4+1]&0x3F)<<12|(Z4[o4+2]&0x3F)<<6|Z4[o4+3]&0x3F)-0x010000;i4+=String["fromCharCode"](p4>>10|0xD800,p4&0x03FF|0xDC00);o4+=3;}}return i4;};K8["prototype"]["tell"]=function(){return this["offset"];};K8["prototype"]["seek"]=function(S4){if(S4<0||S4>=this["view"]["byteLength"])return false;this["offset"]=S4;return true;};K8["prototype"]["reset"]=function(){this["offset"]=0;};K8["prototype"]["skip"]=function(I4){if(this["offset"]+I4>this["view"]["byteLength"])this["offset"]=this["view"]["byteLength"];else this["offset"]+=I4;};K8["prototype"]["available"]=function(){return this["view"]["byteLength"]-this["offset"];};K8["prototype"]["eof"]=function(){return!(this["offset"]<this["view"]["byteLength"]);};return K8;}();d8["BinaryReader"]=c8;}(CMWORLD||(CMWORLD={})));(function(v4){var e4,w4;e4=function(){function h4(j4){this["item"]=null;this["deadtime"]=0;this["item"]=j4;}return h4;}();w4=function(){u4["prototype"]["isDeadUrl"]=function(c4){if(this["deadUrlArray"][c4]){return true;}return false;};u4["prototype"]["addDeadUrl"]=function(d4){if(this["enabled"]==false)return;this["deadUrlArray"][d4]=true;};function u4(){this["enabled"]=false;this["files"]={};this["deadUrlArray"]=[];this["refTime"]=Date["now"]();}u4["prototype"]["add"]=function(K4,N4){var b4;if(this["enabled"]===false)return;if(this["files"][K4]){delete this["files"][K4];}b4=new e4(N4);b4["deadtime"]=this["refTime"]+u4["aliveTime"];this["files"][K4]=b4;};u4["prototype"]["get"]=function(P4){if(this["enabled"]===false)return;if(this["files"][P4]){if(this["files"][P4]["item"]["byteLength"]>0){this["files"][P4]["deadtime"]=this["refTime"]+u4["aliveTime"];return this["files"][P4]["item"];}this["remove"](P4);}return null;};u4["prototype"]["remove"]=function(B4){delete this["files"][B4];};u4["prototype"]["clear"]=function(){this["files"]={};};u4["prototype"]["update"]=function(f4){var q4;this["refTime"]=Date["now"]();q4=50;for(var Q4 in this["files"]){if(this["files"][Q4]["deadtime"]<f4){delete this["files"][Q4];--q4;}if(q4<0)break;}};return u4;}();w4["aliveTime"]=30*1000;v4["Cache"]=w4;}(CMWORLD||(CMWORLD={})));(function(k2){var H2;H2=function(){L2["getTime"]=function(){var V2;V2=+new Date();return V2;};function L2(){}L2["getElapsed"]=function(Y2){var E2,s2;E2=+new Date();s2=E2-Y2;return s2;};return L2;}();k2["Time"]=H2;}(CMWORLD||(CMWORLD={})));(function(r2){var l2;l2=function(){F2["prototype"]["ClearAll"]=function(){this["m_Vec2Buffer"]=[];this["m_Vec3Buffer"]=[];this["m_FaceBuffer"]=[];this["m_UVBuffer"]=[];this["m_Float32Buffer"]=[];this["m_Uint16Buffer"]=[];this["m_Uint16Buffer"]=[];this["m_BaseObjectBuffer"]=[];};F2["prototype"]["ClearUint8Array"]=function(){this["m_Uint8Buffer"]=[];};F2["prototype"]["GetUint8Array"]=function(U2){var W2,G2;W2=this["m_Uint8Buffer"][U2];if(W2){if(W2["length"]>0){return W2["shift"]();}}G2=new Uint8Array(U2);return G2;};F2["prototype"]["RemoveUint8Array"]=function(M2){var C2;if(M2){if(M2["length"]>0){C2=this["m_Uint8Buffer"][M2["length"]];if(C2){C2["push"](M2);}else{C2=new Array();C2["push"](M2);this["m_Uint8Buffer"][M2["length"]]=C2;}}}};F2["prototype"]["ClearUint16Array"]=function(){this["m_Uint16Buffer"]=[];};F2["prototype"]["GetUint16Array"]=function(A2){var D2,z2;D2=this["m_Uint16Buffer"][A2];if(D2){if(D2["length"]>0){return D2["shift"]();}}z2=new Uint16Array(A2);return z2;};function F2(){this["m_Vec2Buffer"]=[];this["m_Vec3Buffer"]=[];this["m_FaceBuffer"]=[];this["m_UVBuffer"]=[];this["m_Float32Buffer"]=[];this["m_Uint16Buffer"]=[];this["m_Uint8Buffer"]=[];this["m_BaseObjectBuffer"]=[];}F2["prototype"]["RemoveUint16Array"]=function(n2){var R2;if(n2){if(n2["length"]>0){R2=this["m_Uint16Buffer"][n2["length"]];if(R2){R2["push"](n2);}else{R2=new Array();R2["push"](n2);this["m_Uint16Buffer"][n2["length"]]=R2;}}}};F2["prototype"]["ClearFloat32Array"]=function(){this["m_Float32Buffer"]=[];};F2["prototype"]["GetFloat32Array"]=function(T2){var X2,a2;X2=this["m_Float32Buffer"][T2];if(X2){if(X2["length"]>0){return X2["shift"]();}}a2=new Float32Array(T2);return a2;};F2["prototype"]["RemoveFloat32Array"]=function(O2){var o2;if(O2){if(O2["length"]>0){o2=this["m_Float32Buffer"][O2["length"]];if(o2){o2["push"](O2);}else{o2=new Array();o2["push"](O2);this["m_Float32Buffer"][O2["length"]]=o2;}}}};F2["prototype"]["ClearBaseObjectArray"]=function(){this["m_Float32Buffer"]=[];};F2["prototype"]["GetBaseObjectArray"]=function(Z2){var J2,S2;J2=this["m_BaseObjectBuffer"][Z2];if(J2){if(J2["length"]>0){return J2["shift"]();}}S2=new Array(Z2);return S2;};F2["prototype"]["RemoveBaseObjectArray"]=function(I2){var w2;if(I2){if(I2["length"]>0){w2=this["m_BaseObjectBuffer"][I2["length"]];if(w2){w2["push"](I2);}else{w2=new Array();w2["push"](I2);this["m_BaseObjectBuffer"][I2["length"]]=w2;}}}};F2["prototype"]["ClearUVArray"]=function(){this["m_UVBuffer"]=[];};F2["prototype"]["GetUVArray"]=function(u2){var e2,h2;e2=this["m_UVBuffer"][u2];if(e2){if(e2["length"]>0){return e2["shift"]();}}h2=[[]];for(var j2=0;j2<u2;j2++){h2[0]["push"]([new THREE["Vector2"](),new THREE["Vector2"](),new THREE["Vector2"]()]);}return h2;};F2["prototype"]["RemoveUVArray"]=function(c2){var d2;if(c2){if(c2["length"]>0){d2=this["m_UVBuffer"][c2["length"]];if(d2){d2["push"](c2);}else{d2=new Array();d2["push"](c2);this["m_UVBuffer"][c2["length"]]=d2;}}}};F2["prototype"]["ClearFaceArray"]=function(){this["m_FaceBuffer"]=[];};F2["prototype"]["GetFaceArray"]=function(B2){var b2,N2,K2;b2=this["m_FaceBuffer"][B2];if(b2){if(b2["length"]>0){return b2["shift"]();}}N2=new Array();for(var P2=0;P2<B2;P2++){K2=new THREE["Face3"](0,0,0);K2["vertexNormals"]["push"](new THREE["Vector3"]());K2["vertexNormals"]["push"](new THREE["Vector3"]());K2["vertexNormals"]["push"](new THREE["Vector3"]());N2["push"](K2);}return N2;};F2["prototype"]["RemoveFaceArray"]=function(q2){var Q2;if(q2){if(q2["length"]>0){Q2=this["m_FaceBuffer"][q2["length"]];if(Q2){Q2["push"](q2);}else{Q2=new Array();Q2["push"](q2);this["m_FaceBuffer"][q2["length"]]=Q2;}}}};F2["prototype"]["ClearVector2Array"]=function(){this["m_Vec2Buffer"]=[];};F2["prototype"]["GetVector2Array"]=function(L1){var f2,H1;f2=this["m_Vec2Buffer"][L1];if(f2){if(f2["length"]>0){return f2["shift"]();}}H1=new Array();for(var k1=0;k1<L1;k1++){H1["push"](new THREE["Vector2"]());}return H1;};F2["prototype"]["RemoveVector2Array"]=function(V1){var E1;if(V1){if(V1["length"]>0){E1=this["m_Vec2Buffer"][V1["length"]];if(E1){E1["push"](V1);}else{E1=new Array();E1["push"](V1);this["m_Vec2Buffer"][V1["length"]]=E1;}}}};F2["prototype"]["ClearVector3Array"]=function(){this["m_Vec3Buffer"]=[];};F2["prototype"]["GetVector3Array"]=function(r1){var s1,Y1;s1=this["m_Vec3Buffer"][r1];if(s1){if(s1["length"]>0){return s1["shift"]();}}Y1=new Array();for(var l1=0;l1<r1;l1++){Y1["push"](new THREE["Vector3"]());}return Y1;};F2["prototype"]["RemoveVector3Array"]=function(F1){var W1;if(F1){if(F1["length"]>0){W1=this["m_Vec3Buffer"][F1["length"]];if(W1){W1["push"](F1);}else{W1=new Array();W1["push"](F1);this["m_Vec3Buffer"][F1["length"]]=W1;}}}};return F2;}();r2["MemManager"]=l2;}(CMWORLD||(CMWORLD={})));FPS=function(){;U1["prototype"]["start"]=function(){var G1;this["isstarted"]=true;this["fpscount"]=0;this["fps"]=0;this["fpsStr"]='0';G1=this;this["calcFpsID"]=setInterval(function(){G1["fps"]=G1["fpscount"];G1["fpsStr"]=G1["fps"]["toString"]();G1["fpscount"]=0;},1000);};U1["prototype"]["stop"]=function(){this["isstarted"]=false;clearInterval(this["calcFpsID"]);};function U1(){this["fpscount"]=0;this["fps"]=0;this["fpsStr"]='';this["calcFpsID"]=-1;this["isstarted"]=false;this["fpscount"]=0;this["fps"]=0;this["fpsStr"]='';;this["calcFpsID"]=-1;this["isstarted"]=false;}U1["prototype"]["update"]=function(){this["fpscount"]++;};return U1;}();TextureBlender=function(C1,D1,R1){var M1,A1,z1,n1;M1=CMWORLD["CmWorld3"]["getInstance"]();this["cameraRTT"]=new THREE["OrthographicCamera"](C1/-2,C1/2,D1/2,D1/-2,1,1000);this["cameraRTT"]["position"]["z"]=100;this["sceneRTT"]=new THREE["Scene"]();A1=new THREE["DirectionalLight"](0xffffff);A1["position"]["set"](0,0,1)["normalize"]();this["sceneRTT"]["add"](A1);this["rtTexture"]=new THREE["WebGLRenderTarget"](C1,D1,{minFilter:THREE["LinearFilter"],magFilter:THREE["NearestFilter"],format:THREE["RGBAFormat"]});z1=new THREE["ShaderMaterial"]({uniforms:{drawmain:{type:"i",value:1},mainTex:{type:"t",value:M1["option"]["emptyTex"]},subTex:{type:"t",value:M1["option"]["emptyTex"]}},vertexShader:M1["option"]["Shader"]['imageoverlayvb'],fragmentShader:M1["option"]["Shader"]['imageoverlayps']});n1=new THREE["PlaneBufferGeometry"](C1,D1);this["quad"]=new THREE["Mesh"](n1,z1);this["quad"]["position"]["z"]=-100;this["sceneRTT"]["add"](this["quad"]);};TextureBlender["prototype"]={renderMain:function(g1){this["quad"]["material"]["needsUpdate"]=true;this["quad"]["material"]["uniforms"]["drawmain"]["value"]=1;this["quad"]["material"]["uniforms"]["drawmain"]["needsUpdate"]=true;this["quad"]["material"]["uniforms"]["mainTex"]["value"]=g1;this["quad"]["material"]["uniforms"]["mainTex"]["needsUpdate"]=true;cmworld["renderer"]["render"](this["sceneRTT"],this["cameraRTT"],this["rtTexture"],true);},renderSub:function(X1){this["quad"]["material"]["needsUpdate"]=true;this["quad"]["material"]["uniforms"]["drawmain"]["value"]=0;this["quad"]["material"]["uniforms"]["drawmain"]["needsUpdate"]=true;this["quad"]["material"]["uniforms"]["subTex"]=X1;this["quad"]["material"]["uniforms"]["subTex"]["needsUpdate"]=true;cmworld["renderer"]["render"](this["sceneRTT"],this["cameraRTT"],this["rtTexture"],true);},getImageData:function(T1){var a1,O1;a1=document["createElement"]('canvas');a1["width"]=T1["width"];a1["height"]=T1["height"];O1=a1["getContext"]('2d');O1["drawImage"](T1,0,0);return O1["getImageData"](0,0,T1["width"],T1["height"]);}};(function(o1){var J1;J1=function(){Z1["prototype"]["add"]=function(S1){S1["delete_time"]=this["mapViewer"]["option"]["renderFrameTime"];this["_disposeBuffer"]["push"](S1);};Z1["prototype"]["update"]=function(){var e1,h1,I1;if(this["_disposeBuffer"]["length"]<1)return;e1=6;h1=this["mapViewer"];for(var w1=0;w1<this["_disposeBuffer"]["length"];w1++){I1=this["_disposeBuffer"][w1];if(I1!=null){if(h1["option"]["renderFrameTime"]-I1["delete_time"]>2000){I1=this["_disposeBuffer"]["shift"]();if(I1 instanceof THREE["Mesh"]){e1-=2;Z1["disposeMesh"](I1);}else if(I1 instanceof THREE["Texture"]){I1["dispose"]();}else if(I1 instanceof THREE["Material"]){Z1["disposeMaterial"](I1);}else if(I1 instanceof THREE["InstancedBufferGeometry"]){Z1["disposeInstancedBufferGeometry"](I1);}if(--e1<1)break;}break;}else{this["_disposeBuffer"]["shift"]();break;}}};function Z1(){this["_disposeBuffer"]=new Array();this["mapViewer"]=null;this["mapViewer"]=o1["CmWorld3"]["getInstance"]();}Z1["cast"]=function(j1,u1){j1["__proto__"]=u1["prototype"];return j1;};Z1["disposeMaterial"]=function(c1){if(o1["Util"]["isDefined"](c1)){c1["dispose"]();}};Z1["disposeInstancedBufferGeometry"]=function(d1){if(o1["Util"]["isDefined"](d1)){d1["dispose"]();d1=null;}};Z1["disposeMesh"]=function(K1){var B1,N1,P1;if(o1["Util"]["isDefined"](K1)==false)return;K1["visible"]=false;for(var b1=0;b1<K1["children"]["length"];b1++){B1=Z1["cast"](K1["children"][b1],THREE["Mesh"]);this["disposeMesh"](B1);}if(K1["material"]!=null){N1=K1["material"];if(N1["type"]=='MultiMaterial'){P1=N1;for(var q1 in P1["materials"]){P1["materials"][q1]["dispose"]();}}else{N1["dispose"]();}K1["material"]=null;}if(K1["geometry"]!=null){K1["geometry"]["dispose"]();K1["geometry"]=null;}};return Z1;}();o1["DisposeManager"]=J1;}(CMWORLD||(CMWORLD={})));(function(Q1){Q1[Q1["Alpha"]=0]="Alpha";Q1[Q1["Additive"]=1]="Additive";Q1[Q1["Subtractive"]=2]="Subtractive";Q1[Q1["Mask"]=3]="Mask";Q1[Q1["Multiply"]=4]="Multiply";Q1[Q1["ColorKeying"]=5]="ColorKeying";Q1[Q1["None"]=6]="None";}(cmBlendMode||(cmBlendMode={})));cm_color=function(){f1["prototype"]["fromString"]=function(k5){var L5,V5,E5,y5,s5,Y5,r5,l5;if(k5["startsWith"]('#')){this["r"]=parseInt(k5["slice"](1,3),16);this["g"]=parseInt(k5["slice"](3,5),16);this["b"]=parseInt(k5["slice"](5,7),16);this["a"]=255;}else if(k5["startsWith"]('rgba')){L5=k5["indexOf"]('(')+1;V5=k5["indexOf"](')');E5=k5["slice"](L5,V5)["split"](',')["map"](parseFloat),y5=E5[0],s5=E5[1],Y5=E5[2],r5=E5[3];this["r"]=y5;this["g"]=s5;this["b"]=Y5;this["a"]=r5;}else if(k5["startsWith"]('rgb')){L5=k5["indexOf"]('(')+1;V5=k5["indexOf"](')');l5=k5["slice"](L5,V5)["split"](',')["map"](parseFloat),y5=l5[0],s5=l5[1],Y5=l5[2];this["r"]=y5;this["g"]=s5;this["b"]=Y5;this["a"]=255;}else{}};f1["fromrgba"]=function(W5,U5,G5,M5){var F5;F5=new f1();F5["a"]=M5;F5["r"]=W5;F5["g"]=U5;F5["b"]=G5;return F5;};f1["prototype"]["copy"]=function(C5,D5,A5,z5){return f1["fromrgba"](C5,D5,A5,z5);};function f1(H5){if(H5===void 0){H5=null;}this["a"]=255;this["r"]=0;this["g"]=0;this["b"]=0;if(H5){this["fromString"](H5);}}return f1;}();cm_edge=function(){n5["prototype"]["CompareTo"]=function(a5){return this["StartY"]==a5["StartY"]?this["StartX"]-a5["StartX"]:this["StartY"]-a5["StartY"];};function n5(X5,R5,T5,g5){this["StartX"]=-1;this["StartY"]=-1;this["EndX"]=-1;this["EndY"]=-1;this["Sloap"]=0.0;if(R5>g5){this["StartX"]=T5;this["StartY"]=g5;this["EndX"]=X5;this["EndY"]=R5;}else{this["StartX"]=X5;this["StartY"]=R5;this["EndX"]=T5;this["EndY"]=g5;}this["Sloap"]=(this["EndX"]-this["StartX"])/(this["EndY"]-this["StartY"]);}return n5;}();cm_rect=function(){t5["prototype"]["isEmpty"]=function(){if(this["width"]<=0||this["height"]<=0)return true;return false;};function t5(O5,o5,J5,Z5){this["x"]=0;this["y"]=0;this["width"]=0;this["height"]=0;this["left"]=0;this["right"]=0;this["top"]=0;this["bottom"]=0;this["x"]=O5;this["y"]=o5;this["width"]=J5;this["height"]=Z5;this["left"]=O5;this["right"]=O5+J5;this["top"]=o5;this["bottom"]=o5+Z5;}t5["prototype"]["Intersects"]=function(x5){var i5,p5,S5,I5;i5=x5["left"];p5=x5["right"];S5=this["left"];I5=this["right"];if(this["left"]>x5["right"])return false;if(this["right"]<x5["left"])return false;if(this["top"]<x5["bottom"])return false;if(this["bottom"]>x5["top"])return false;return true;};t5["prototype"]["Intersection"]=function(w5){if(!w5)return new t5(0,0,0,0);return new t5(Math["max"](this["left"],w5["left"]),Math["max"](this["top"],w5["top"]),Math["min"](this["right"],w5["right"]),Math["min"](this["bottom"],w5["bottom"]));};return t5;}();cm_canvas=function(){e5["preRun"]=function(){FS["createPreloadedFile"]("/","NanumGothic.otf","NanumGothic.otf",true,false);e5["monochrome"]=Module["cwrap"]("monochrome",'number',['number']);e5["load_font"]=Module["cwrap"]("load_font",'number',['string','string','number']);e5["find_font"]=Module["cwrap"]("find_font",'number',['string']);e5["get_bitmap"]=Module["cwrap"]("get_bitmap",'number',['number','number','number','number']);e5["get_width"]=Module["cwrap"]("get_width",'number',[]);e5["get_height"]=Module["cwrap"]("get_height",'number',[]);e5["get_left"]=Module["cwrap"]("get_left",'number',[]);e5["get_top"]=Module["cwrap"]("get_top",'number',[]);e5["get_advance"]=Module["cwrap"]("get_advance",'number',[]);};e5["loadFont"]=function(){this["load_font"]("NanumGothic.otf","NANUMGOTHIC",100);};e5["prototype"]["clear"]=function(j5){if(j5===void 0){j5=null;}if(j5==null){j5=this["fillcolor"];}for(var u5=0;u5<this["pixelWidth"];u5++){for(var c5=0;c5<this["pixelHeight"];c5++){this["setPixelrgba"](u5,c5,j5["r"],j5["g"],j5["b"],j5["a"]);}}};e5["prototype"]["clearrgba"]=function(b5,N5,P5,B5){for(var d5=0;d5<this["pixelWidth"];d5++){for(var K5=0;K5<this["pixelHeight"];K5++){this["setPixelrgba"](d5,K5,b5,N5,P5,B5);}}};e5["prototype"]["setPixelrgba"]=function(Q5,f5,k6,L6,V6,H6){var q5;if(H6===void 0){H6=255;}if(Q5<0||Q5>=this["pixelWidth"])return;if(f5<0||f5>=this["pixelHeight"])return;q5=(Q5+f5*this["pixelWidth"])*4;this["data"][q5+0]=k6;this["data"][q5+1]=L6;this["data"][q5+2]=V6;this["data"][q5+3]=H6;};e5["prototype"]["setPixel"]=function(y6,s6,E6){if(y6<0||y6>=this["pixelWidth"])return;if(s6<0||s6>=this["pixelHeight"])return;this["setPixelrgba"](y6,s6,E6["r"],E6["g"],E6["b"],E6["a"]);};e5["prototype"]["setPixelIndex"]=function(Y6,l6){if(Y6<0)return;Y6=Y6*4;this["data"][Y6+0]=l6["r"];this["data"][Y6+1]=l6["g"];this["data"][Y6+2]=l6["b"];this["data"][Y6+3]=l6["a"];};e5["prototype"]["getPixel"]=function(F6,W6){var r6;if(F6<0||F6>=this["pixelWidth"])return null;if(W6<0||W6>=this["pixelHeight"])return null;r6=(F6+W6*this["pixelWidth"])*4;return cm_color["fromrgba"](this["data"][r6+0],this["data"][r6+1],this["data"][r6+2],this["data"][r6+3]);};e5["prototype"]["getPixelIndex"]=function(U6){if(U6<0)return null;U6=U6*4;return cm_color["fromrgba"](this["data"][U6+0],this["data"][U6+1],this["data"][U6+2],this["data"][U6+3]);};e5["prototype"]["length"]=function(){return this["pixelWidth"]*this["pixelHeight"];};e5["prototype"]["putImageData"]=function(G6){var M6;if(!G6){return;}M6=0;for(var C6=0;C6<G6["width"];C6++){for(var D6=0;D6<G6["height"];D6++){M6=(C6+D6*G6["width"])*4;this["setPixelrgba"](C6,D6,G6["data"][M6+0],G6["data"][M6+1],G6["data"][M6+2],G6["data"][M6+3]);}}};e5["prototype"]["getImageData"]=function(){var z6;z6=new Uint8ClampedArray(this["pixelWidth"]*this["pixelHeight"]*4);for(var A6=0;A6<z6["length"];A6++){z6[A6]=this["data"][A6];}return{width:this["pixelWidth"],height:this["pixelHeight"],data:z6};};e5["prototype"]["Blit"]=function(v6,I6,H9,g6,N6,O6,y9){var s9,L9,V9,x6,k9,Z6,S6,E9,J6,a6,T6,t6,o6,h6,j6,u6,c6,d6,K6,R6,X6,i6,Y9,B6,q6,Q6,f6,P6,b6,n6,p6;s9=cmBlendMode["Alpha"];L9=g6["width"];V9=g6["height"];x6=new cm_rect(0,0,I6,H9);x6=x6["Intersection"](g6);if(x6["isEmpty"]()){return;}k9=N6["length"]();Z6=-1;S6=g6["x"];E9=g6["y"];J6=0;a6=0;T6=0;t6=0.0;o6=0.0;h6=0;j6=0;u6=0;c6=0,d6=0,K6=0;X6=0;i6=0;Y9=O6["width"];B6=Math["floor"](O6["width"]/g6["width"]);q6=Math["floor"](O6["height"]/g6["height"]);Q6=O6["x"];f6=O6["y"];P6=0,b6=0;P6=-1;b6=-1;o6=f6;a6=E9;for(var e6=0;e6<V9;e6++){if(a6>=0&&a6<H9){t6=Q6;T6=S6+a6*I6;J6=S6;R6=N6["getPixelIndex"](0);for(var w6=0;w6<L9;w6++){if(J6>=0&&J6<I6){if(t6!=P6||o6!=b6){Z6=t6+o6*y9;if(Z6>=0&&Z6<k9){R6=N6["getPixelIndex"](Z6);X6=R6["a"];h6=R6["r"];j6=R6["g"];u6=R6["b"];}else{X6=0;}}if(X6>0){n6=v6["getPixelIndex"](T6);i6=n6["a"];if(X6==255||i6==0){v6["setPixelIndex"](T6,R6);}else{c6=n6["r"];d6=n6["g"];K6=n6["b"];p6=255-X6;n6["a"]=i6;n6["r"]=(h6<<8)+p6*c6>>8&0xff;n6["g"]=(j6<<8)+p6*d6>>8&0xff;n6["b"]=(u6<<8)+p6*K6>>8&0xff;v6["setPixelIndex"](T6,n6);}}}J6++;T6++;t6+=B6;}}o6+=q6;a6++;}};e5["prototype"]["drawImage"]=function(D9,r9,l9){var C9,M9,U9,G9,X9,g9,A9,z9,n9,R9,r9,l9,F9,W9;C9=D9["pixelWidth"];M9=D9["pixelHeight"];U9=r9;G9=l9;X9=r9+C9;g9=l9+M9;A9=0;z9=0;n9=C9;R9=M9;for(r9=A9;r9<n9;r9++){for(l9=z9;l9<R9;l9++){F9=D9["getPixel"](r9,l9);if(F9["a"]>0){if(F9["a"]==255){this["setPixel"](U9+r9,G9+l9,F9);}else{W9=this["getPixel"](U9+r9,G9+l9);this["setPixel"](U9+r9,G9+l9,this["AlphaBlend"](W9["a"],W9["r"],W9["g"],W9["b"],F9["a"],F9["r"],F9["g"],F9["b"]));}}}}};e5["prototype"]["drawLineBresenham"]=function(u9,c9,K9,d9){var p9,S9,I9,t9,O9,J9,o9,w9,e9,v9,h9,j9,Z9,a9,T9,x9;p9=this["pixelWidth"];S9=this["pixelHeight"];I9=this["linecolor"];t9=K9-u9;O9=d9-c9;J9=0;if(t9<0){t9=-t9;J9=-1;}else if(t9>0){J9=1;}o9=0;if(O9<0){O9=-O9;o9=-1;}else if(O9>0){o9=1;}if(t9>O9){w9=J9;e9=0;v9=J9;h9=o9;j9=O9;Z9=t9;}else{w9=0;e9=o9;v9=J9;h9=o9;j9=t9;Z9=O9;}a9=u9;T9=c9;x9=Z9>>1;if(T9<S9&&T9>=0&&a9<p9&&a9>=0){this["setPixel"](a9,T9,I9);}for(var i9=0;i9<Z9;i9++){x9-=j9;if(x9<0){x9+=Z9;a9+=v9;T9+=h9;}else{a9+=w9;T9+=e9;}if(T9<S9&&T9>=0&&a9<p9&&a9>=0){this["setPixel"](a9,T9,I9);}}};e5["prototype"]["drawLineDDA"]=function(k0,Y0,r0,l0){var V0,L0,H0,N9,P9,b9,f9,E0,s0,q9,B9;V0=this["pixelWidth"];L0=this["pixelHeight"];H0=this["linecolor"];N9=r0-k0;P9=l0-Y0;b9=P9>=0?P9:-P9;f9=N9>=0?N9:-N9;if(f9>b9){b9=f9;}if(b9!=0){N9=parseFloat(N9["toFixed"](6));P9=parseFloat(P9["toFixed"](6));b9=parseFloat(b9["toFixed"](6));E0=N9/b9;s0=P9/b9;q9=parseFloat(k0["toFixed"](6));B9=parseFloat(Y0["toFixed"](6));for(var Q9=0;Q9<b9;Q9++){if(B9<L0&&B9>=0&&q9<V0&&q9>=0){this["setPixel"](Math["round"](q9),Math["round"](B9),H0);}q9+=E0;B9+=s0;}}};e5["prototype"]["ComputeOutCode"]=function(W0,U0,G0){var F0;F0=this["INSIDE"];if(U0<W0["left"])F0|=this["LEFT"];else if(U0>W0["right"])F0|=this["RIGHT"];if(G0>W0["bottom"])F0|=this["BOTTOM"];else if(G0<W0["top"])F0|=this["TOP"];return F0;};e5["prototype"]["CohenSutherlandLineClip"]=function(D0,Z0,J0,o0,O0){var C0,n0,M0,R0,g0,X0,a0,z0,A0,T0;C0=parseFloat(Z0["toFixed"](6));n0=parseFloat(o0["toFixed"](6));M0=parseFloat(J0["toFixed"](6));R0=parseFloat(O0["toFixed"](6));this["internal_x1"]=C0;this["internal_y1"]=M0;this["internal_x2"]=n0;this["internal_y2"]=R0;g0=this["ComputeOutCode"](D0,C0,M0);X0=this["ComputeOutCode"](D0,n0,R0);if(g0==this["INSIDE"]&&X0==this["INSIDE"])return true;a0=false;while(true){if((g0|X0)==0){a0=true;break;}else if((g0&X0)!=0){break;}else{T0=g0!=0?g0:X0;if((T0&this["TOP"])!=0){z0=C0+(n0-C0)*(D0["top"]-M0)/(R0-M0);A0=D0["top"];}else if((T0&this["BOTTOM"])!=0){z0=C0+(n0-C0)*(D0["bottom"]-M0)/(R0-M0);A0=D0["bottom"];}else if((T0&this["RIGHT"])!=0){A0=M0+(R0-M0)*(D0["right"]-C0)/(n0-C0);z0=D0["right"];}else if((T0&this["LEFT"])!=0){A0=M0+(R0-M0)*(D0["left"]-C0)/(n0-C0);z0=D0["left"];}else{z0=Number["NaN"];A0=Number["NaN"];}if(T0==g0){C0=z0;M0=A0;this["internal_x1"]=z0;this["internal_y1"]=A0;g0=this["ComputeOutCode"](D0,C0,M0);}else{n0=z0;R0=A0;this["internal_x2"]=z0;this["internal_y2"]=A0;X0=this["ComputeOutCode"](D0,n0,R0);}}}return a0;};e5["prototype"]["drawLineNormal"]=function(p0,S0,j0,e0){var b0,d0,u0,E7X,m7X,c0,I0,v0,B0,K0,q0,k7X,Q0,V7X,H7X,Y7X,h0,P0,N0,w0,f0,y7X,l7X,r7X;if(!this["CohenSutherlandLineClip"](new cm_rect(0,0,this["pixelWidth"],this["pixelHeight"]),p0,S0,j0,e0))return;p0=this["internal_x1"];S0=this["internal_y1"];j0=this["internal_x2"];e0=this["internal_y2"];b0=j0-p0;d0=e0-S0;u0=8;if(d0>=0){m7X=d0;}else{m7X=-d0;}if(b0>=0){E7X=b0;}else{E7X=-b0;}if(E7X>m7X){if(b0<0){c0=p0;p0=j0;j0=c0;c0=S0;S0=e0;e0=c0;}I0=(d0<<u0)/b0;v0=S0<<u0;B0=e0<<u0;K0=this["pixelHeight"]<<u0;if(S0<e0){if(S0>=this["pixelHeight"]||e0<0){return;}if(v0<0){if(I0==0){return;}q0=v0;v0=I0-1+(v0+1)%I0;p0+=(v0-q0)/I0;}if(B0>=K0){if(I0!=0){B0=K0-1-(K0-1-v0)%I0;j0=p0+(B0-v0)/I0;}}}else{if(e0>=this["pixelHeight"]||S0<0){return;}if(v0>=K0){if(I0==0){return;}q0=v0;v0=K0-1+(I0-(K0-1-q0)%I0);p0+=(v0-q0)/I0;}if(B0<0){if(I0!=0){B0=v0%I0;j0=p0+(B0-v0)/I0;}}}if(p0<0){v0-=I0*p0;p0=0;}if(j0>=this["pixelWidth"]){j0=this["pixelWidth"]-1;}k7X=v0;Q0=k7X>>u0;V7X=Q0;H7X=p0+Q0*this["pixelWidth"];Y7X=I0<0?1-this["pixelWidth"]:1+this["pixelWidth"];for(var s7X=p0;s7X<=j0;++s7X){this["setPixelIndex"](H7X,this["linecolor"]);k7X+=I0;Q0=k7X>>u0;if(Q0!=V7X){V7X=Q0;H7X+=Y7X;}else{++H7X;}}}else{if(m7X==0){return;}if(d0<0){c0=p0;p0=j0;j0=c0;c0=S0;S0=e0;e0=c0;}h0=p0<<u0;P0=j0<<u0;N0=this["pixelWidth"]<<u0;w0=(b0<<u0)/d0;if(p0<j0){if(p0>=this["pixelWidth"]||j0<0){return;}if(h0<0){if(w0==0){return;}f0=h0;h0=w0-1+(h0+1)%w0;S0+=(h0-f0)/w0;}if(P0>=N0){if(w0!=0){P0=N0-1-(N0-1-h0)%w0;e0=S0+(P0-h0)/w0;}}}else{if(j0>=this["pixelWidth"]||p0<0){return;}if(h0>=N0){if(w0==0){return;}f0=h0;h0=N0-1+(w0-(N0-1-f0)%w0);S0+=(h0-f0)/w0;}if(P0<0){if(w0!=0){P0=h0%w0;e0=S0+(P0-h0)/w0;}}}if(S0<0){h0-=w0*S0;S0=0;}if(e0>=this["pixelHeight"]){e0=this["pixelHeight"]-1;}y7X=h0;l7X=S0*this["pixelWidth"];r7X=(this["pixelWidth"]<<u0)+w0;for(var L7X=S0;L7X<=e0;++L7X){this["setPixelIndex"](l7X+(y7X>>u0),this["linecolor"]);y7X+=r7X;}}};e5["prototype"]["drawLinePenned"]=function(X7X,D7X,T7X,n7X,x7X){var G7X,z7X,M7X,p7X,S7X,U7X,C7X,A7X,R7X,t7X,O7X,o7X,J7X,Z7X,g7X,W7X,F7X,a7X,I7X;G7X=this["pixelHeight"];z7X=this["pixelWidth"];if(D7X<0&&n7X<0||D7X>G7X&&n7X>G7X)return;if(X7X==T7X&&D7X==n7X)return;if(!this["CohenSutherlandLineClip"](new cm_rect(0,0,z7X,G7X),X7X,D7X,T7X,n7X))return;X7X=this["internal_x1"];D7X=this["internal_y1"];T7X=this["internal_x2"];n7X=this["internal_y2"];M7X=x7X["pixelWidth"];p7X=M7X;S7X=new cm_rect(0,0,M7X,M7X);U7X=T7X-X7X;C7X=n7X-D7X;A7X=0;if(U7X<0){U7X=-U7X;A7X=-1;}else if(U7X>0){A7X=1;}R7X=0;if(C7X<0){C7X=-C7X;R7X=-1;}else if(C7X>0){R7X=1;}if(U7X>C7X){t7X=A7X;O7X=0;o7X=A7X;J7X=R7X;Z7X=C7X;g7X=U7X;}else{t7X=0;O7X=R7X;o7X=A7X;J7X=R7X;Z7X=U7X;g7X=C7X;}W7X=X7X;F7X=D7X;a7X=g7X>>1;I7X=new cm_rect(W7X,F7X,M7X,M7X);if(F7X<G7X&&F7X>=0&&W7X<z7X&&W7X>=0){this["Blit"](this,z7X,G7X,I7X,x7X,S7X,p7X);}for(var i7X=0;i7X<g7X;i7X++){a7X-=Z7X;if(a7X<0){a7X+=g7X;W7X+=o7X;F7X+=J7X;}else{W7X+=t7X;F7X+=O7X;}if(F7X<G7X&&F7X>=0&&W7X<z7X&&W7X>=0){this["Blit"](this,z7X,G7X,new cm_rect(W7X,F7X,M7X,M7X),x7X,S7X,p7X);}}};e5["prototype"]["AlphaBlend"]=function(K7X,v7X,h7X,j7X,w7X,u7X,c7X,d7X){var e7X;e7X=new cm_color();e7X["a"]=255;e7X["r"]=v7X*w7X+u7X*(0xff-w7X)>>8;e7X["g"]=h7X*w7X+c7X*(0xff-w7X)>>8;e7X["b"]=j7X*w7X+d7X*(0xff-w7X)>>8;return e7X;};e5["prototype"]["ipart"]=function(b7X){return Math["floor"](b7X);};function e5(v5,h5){this["pixelWidth"]=0;this["pixelHeight"]=0;this["data"]=null;this["fillcolor"]=cm_color["fromrgba"](255,255,255,255);this["linecolor"]=cm_color["fromrgba"](0,0,0,255);this["linewidth"]=1;this["AntiAliasing"]=true;this["internal_x1"]=0.0;this["internal_y1"]=0.0;this["internal_x2"]=0.0;this["internal_y2"]=0.0;this["internal_offset"]=0.0;this["INSIDE"]=0;this["LEFT"]=1;this["RIGHT"]=2;this["BOTTOM"]=4;this["TOP"]=8;this["leftEdgeX"]=new Int32Array(8192);this["rightEdgeX"]=new Int32Array(8192);this["pixelWidth"]=v5;this["pixelHeight"]=h5;this["data"]=new Uint8ClampedArray(v5*h5*4);this["leftEdgeX"]["fill"](0);this["rightEdgeX"]["fill"](0);}e5["prototype"]["fpart"]=function(N7X){return N7X-Math["floor"](N7X);};e5["prototype"]["rfpart"]=function(P7X){return 1-this["fpart"](P7X);};e5["prototype"]["ToInteger"]=function(B7X){B7X=Number(B7X);return B7X<0?Math["ceil"](B7X):Math["floor"](B7X);};e5["prototype"]["modulo"]=function(q7X,Q7X){return q7X-Math["floor"](q7X/Q7X)*Q7X;};e5["prototype"]["ToUint32"]=function(f7X){return this["modulo"](this["ToInteger"](f7X),Math["pow"](2,32));};e5["prototype"]["ToUint16"]=function(H3X){return this["modulo"](this["ToInteger"](H3X),Math["pow"](2,16));};e5["prototype"]["rgbToHsl"]=function(V3X,k3X,m3X){var L3X,E3X,y3X,Y3X,l3X,s3X;V3X/=255,k3X/=255,m3X/=255;L3X=Math["max"](V3X,k3X,m3X),E3X=Math["min"](V3X,k3X,m3X);l3X=(L3X+E3X)/2;if(L3X==E3X){y3X=Y3X=0;}else{s3X=L3X-E3X;Y3X=l3X>0.5?s3X/(2-L3X-E3X):s3X/(L3X+E3X);switch(L3X){case V3X:y3X=(k3X-m3X)/s3X+(k3X<m3X?6:0);break;case k3X:y3X=(m3X-V3X)/s3X+2;break;case m3X:y3X=(V3X-k3X)/s3X+4;break;}y3X/=6;}return[y3X,Y3X,l3X];};e5["prototype"]["hslToRgb"]=function(M3X,W3X,r3X){var C3X,D3X,A3X,U3X,F3X,G3X;if(W3X==0){C3X=D3X=A3X=r3X;}else{U3X=function z3X(R3X,g3X,n3X){if(n3X<0)n3X+=1;if(n3X>1)n3X-=1;if(n3X<1/6)return R3X+(g3X-R3X)*6*n3X;if(n3X<1/2)return g3X;if(n3X<2/3)return R3X+(g3X-R3X)*(2/3-n3X)*6;return R3X;};F3X=r3X<0.5?r3X*(1+W3X):r3X+W3X-r3X*W3X;G3X=2*r3X-F3X;C3X=U3X(G3X,F3X,M3X+1/3);D3X=U3X(G3X,F3X,M3X);A3X=U3X(G3X,F3X,M3X-1/3);}return[C3X*255,D3X*255,A3X*255];};e5["prototype"]["swapPlot"]=function(i3X,Z3X,J3X,p3X){var o3X,X3X,t3X,a3X,T3X,x3X,O3X;o3X=this["linecolor"]["a"];X3X=this["linecolor"]["r"];t3X=this["linecolor"]["g"];a3X=this["linecolor"]["b"];T3X=this["rgbToHsl"](X3X,t3X,a3X);x3X=T3X[2]+T3X[2]*(1.0-p3X);O3X=this["hslToRgb"](T3X[0],T3X[1],x3X);X3X=O3X[0];t3X=O3X[1];a3X=O3X[2];if(i3X){this["setPixelrgba"](J3X,Z3X,X3X,t3X,a3X,o3X);}else{this["setPixelrgba"](Z3X,J3X,X3X,t3X,a3X,o3X);}};;e5["prototype"]["DrawLineWu"]=function(I3X,w3X,P3X,d3X){var m8X,L8X,k8X,H8X,q3X,K3X,f3X,B3X,v3X,b3X,N3X,Q3X,u3X,c3X,j3X,h3X,S3X,e3X;if(!this["CohenSutherlandLineClip"](new cm_rect(0,0,this["pixelWidth"],this["pixelHeight"]),I3X,w3X,P3X,d3X))return;I3X=this["internal_x1"];w3X=this["internal_y1"];P3X=this["internal_x2"];d3X=this["internal_y2"];m8X=8;L8X=1<<m8X;k8X=L8X-1;H8X=this["ToUint16"](16-m8X);if(w3X>d3X){Q3X=w3X;w3X=d3X;d3X=Q3X;Q3X=I3X;I3X=P3X;P3X=Q3X;}u3X=this["linecolor"]["a"];c3X=this["linecolor"]["r"];j3X=this["linecolor"]["g"];h3X=this["linecolor"]["b"];S3X=this["getPixel"](I3X,w3X);this["setPixel"](I3X,w3X,this["AlphaBlend"](u3X,c3X,j3X,h3X,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));v3X=(P3X-I3X)%32768;if(v3X>=0){N3X=1;}else{N3X=-1;v3X=-v3X;}b3X=(d3X-w3X)%32768;if(b3X==0){while(v3X--!=0){I3X+=N3X;S3X=this["getPixel"](I3X,w3X);this["setPixel"](I3X,w3X,this["AlphaBlend"](u3X,c3X,j3X,h3X,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));}return;}if(v3X==0){do{w3X++;S3X=this["getPixel"](I3X,w3X);this["setPixel"](I3X,w3X,this["AlphaBlend"](u3X,c3X,j3X,h3X,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));}while(--b3X!=0);return;}if(v3X==b3X){do{I3X+=N3X;w3X++;S3X=this["getPixel"](I3X,w3X);this["setPixel"](I3X,w3X,this["AlphaBlend"](u3X,c3X,j3X,h3X,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));}while(--b3X!=0);return;}K3X=0;if(b3X>v3X){q3X=this["ToUint16"]((v3X<<16)/b3X);while(--b3X!=0){f3X=K3X;K3X+=q3X;if(K3X<=f3X){I3X+=N3X;}w3X++;B3X=this["ToUint16"](K3X>>H8X);e3X=B3X^k8X;S3X=this["getPixelIndex"](w3X*this["pixelWidth"]+I3X+N3X);this["setPixel"](I3X,w3X,this["AlphaBlend"](u3X,c3X*e3X>>8,j3X*e3X>>8,h3X*e3X>>8,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));e3X=B3X;S3X=this["getPixelIndex"](w3X*this["pixelWidth"]+I3X+N3X);this["setPixelIndex"](w3X*this["pixelWidth"]+I3X+N3X,this["AlphaBlend"](u3X,c3X*e3X>>8,j3X*e3X>>8,h3X*e3X>>8,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));}S3X=this["getPixel"](P3X,d3X);this["setPixel"](P3X,d3X,this["AlphaBlend"](u3X,c3X,j3X,h3X,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));return;}q3X=this["ToUint16"]((b3X<<16)/v3X);while(--v3X!=0){f3X=K3X;K3X+=q3X;if(K3X<=f3X){w3X++;}I3X+=N3X;B3X=this["ToUint16"](K3X>>H8X);e3X=B3X^k8X;S3X=this["getPixel"](I3X,w3X);this["setPixel"](I3X,w3X,this["AlphaBlend"](u3X,c3X*e3X>>8,j3X*e3X>>8,h3X*e3X>>8,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));e3X=B3X;S3X=this["getPixel"](I3X,w3X+1);this["setPixel"](I3X,w3X+1,this["AlphaBlend"](u3X,c3X*e3X>>8,j3X*e3X>>8,h3X*e3X>>8,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));}S3X=this["getPixel"](I3X,d3X);this["setPixel"](P3X,d3X,this["AlphaBlend"](u3X,c3X,j3X,h3X,S3X["a"],S3X["r"],S3X["g"],S3X["b"]));};e5["prototype"]["DrawLineAa"]=function(E8X,l8X,y8X,Y8X){var o8X,s8X,t8X,X8X,g8X,R8X,T8X,a8X,U8X,G8X,W8X,F8X,h8X,c8X,u8X,v8X,z8X,n8X,w8X,I8X,j8X,e8X,O8X,x8X,D8X,p8X,A8X,S8X,M8X,Z8X,C8X,i8X,J8X;if(!this["CohenSutherlandLineClip"](new cm_rect(0,0,this["pixelWidth"],this["pixelHeight"]),E8X,l8X,y8X,Y8X))return;if(this["linewidth"]<=0)return;E8X=this["internal_x1"];l8X=this["internal_y1"];y8X=this["internal_x2"];Y8X=this["internal_y2"];if(l8X>Y8X){o8X=E8X;E8X=y8X;y8X=o8X;o8X=l8X;l8X=Y8X;Y8X=o8X;}if(E8X==y8X){E8X-=Math["floor"](this["linewidth"]/2);y8X+=Math["floor"](this["linewidth"]/2);if(E8X<0)E8X=0;if(y8X<0)return;if(E8X>=this["pixelWidth"])return;if(y8X>=this["pixelWidth"])y8X=this["pixelWidth"]-1;if(l8X>=this["pixelHeight"]||Y8X<0)return;if(l8X<0)l8X=0;if(Y8X>=this["pixelHeight"])Y8X=this["pixelHeight"]-1;for(var r8X=E8X;r8X<=y8X;r8X++){for(var V8X=l8X;V8X<=Y8X;V8X++){s8X=this["linecolor"]["a"];t8X=this["linecolor"]["r"];X8X=this["linecolor"]["g"];g8X=this["linecolor"]["b"];R8X=t8X;T8X=X8X;a8X=g8X;F8X=this["getPixel"](r8X,V8X);U8X=F8X["r"];G8X=F8X["g"];W8X=F8X["b"];U8X=R8X*s8X+U8X*(0xff-s8X)>>8;G8X=T8X*s8X+G8X*(0xff-s8X)>>8;W8X=a8X*s8X+W8X*(0xff-s8X)>>8;this["setPixelrgba"](r8X,V8X,U8X,G8X,W8X,255);}}return;}if(l8X==Y8X){if(E8X>y8X){o8X=E8X;E8X=y8X;y8X=o8X;}l8X-=Math["floor"](this["linewidth"]/2);Y8X+=Math["floor"](this["linewidth"]/2);if(l8X<0)l8X=0;if(Y8X<0)return;if(l8X>=this["pixelHeight"])return;if(Y8X>=this["pixelHeight"])y8X=this["pixelHeight"]-1;if(E8X>=this["pixelWidth"]||Y8X<0)return;if(E8X<0)E8X=0;if(y8X>=this["pixelWidth"])y8X=this["pixelWidth"]-1;for(var r8X=E8X;r8X<=y8X;r8X++){for(var V8X=l8X;V8X<=Y8X;V8X++){s8X=this["linecolor"]["a"];t8X=this["linecolor"]["r"];X8X=this["linecolor"]["g"];g8X=this["linecolor"]["b"];R8X=t8X;T8X=X8X;a8X=g8X;F8X=this["getPixel"](r8X,V8X);U8X=F8X["r"];G8X=F8X["g"];W8X=F8X["b"];U8X=R8X*s8X+U8X*(0xff-s8X)>>8;G8X=T8X*s8X+G8X*(0xff-s8X)>>8;W8X=a8X*s8X+W8X*(0xff-s8X)>>8;this["setPixelrgba"](r8X,V8X,U8X,G8X,W8X,255);}}return;}l8X+=1;Y8X+=1;h8X=(Y8X-l8X)/(y8X-E8X);c8X=(y8X-E8X)/(Y8X-l8X);u8X=h8X;v8X=this["linewidth"];z8X=y8X-E8X;n8X=Y8X-l8X;w8X=v8X*n8X/Math["sqrt"](z8X*z8X+n8X*n8X);I8X=v8X*z8X/Math["sqrt"](z8X*z8X+n8X*n8X);j8X=z8X*n8X/(z8X*z8X+n8X*n8X);E8X+=w8X/2;l8X-=I8X/2;y8X+=w8X/2;Y8X-=I8X/2;e8X=-w8X;O8X=+I8X;x8X=Math["floor"](E8X);D8X=Math["floor"](l8X);p8X=Math["floor"](y8X);A8X=Math["floor"](Y8X);S8X=Math["floor"](E8X+e8X);M8X=Math["floor"](l8X+O8X);Z8X=Math["floor"](y8X+e8X);C8X=Math["floor"](Y8X+O8X);if(this["linewidth"]==2){if(Math["abs"](n8X)<Math["abs"](z8X)){if(E8X<y8X){M8X=D8X+2;C8X=A8X+2;}else{D8X=M8X+2;A8X=C8X+2;}}else{x8X=S8X+2;p8X=Z8X+2;}}i8X=Math["floor"](Math["min"](Math["min"](D8X,A8X),Math["min"](M8X,C8X)));J8X=Math["floor"](Math["max"](Math["max"](D8X,A8X),Math["max"](M8X,C8X)));if(i8X<0)i8X=-1;if(J8X>=this["pixelHeight"])J8X=this["pixelHeight"]+1;for(V8X=i8X+1;V8X<J8X-1;V8X++){this["leftEdgeX"][V8X]=-1<<16;this["rightEdgeX"][V8X]=1<<16-1;}this["AALineQ1"](x8X,D8X,p8X,A8X,O8X>0,false);this["AALineQ1"](S8X,M8X,Z8X,C8X,O8X<0,true);if(this["linewidth"]>1){this["AALineQ1"](x8X,D8X,S8X,M8X,true,O8X>0);this["AALineQ1"](p8X,A8X,Z8X,C8X,false,O8X<0);}if(E8X<y8X){if(A8X>=0&&A8X<this["pixelHeight"])this["rightEdgeX"][A8X]=Math["min"](p8X,this["rightEdgeX"][A8X]);if(M8X>=0&&M8X<this["pixelHeight"])this["leftEdgeX"][M8X]=Math["max"](S8X,this["leftEdgeX"][M8X]);}else{if(D8X>=0&&D8X<this["pixelHeight"])this["rightEdgeX"][D8X]=Math["min"](x8X,this["rightEdgeX"][D8X]);if(C8X>=0&&C8X<this["pixelHeight"])this["leftEdgeX"][C8X]=Math["max"](Z8X,this["leftEdgeX"][C8X]);}for(V8X=i8X+1;V8X<J8X-1;V8X++){this["leftEdgeX"][V8X]=Math["max"](this["leftEdgeX"][V8X],0);this["rightEdgeX"][V8X]=Math["min"](this["rightEdgeX"][V8X],this["pixelWidth"]-1);for(r8X=this["leftEdgeX"][V8X];r8X<=this["rightEdgeX"][V8X];r8X++){s8X=this["linecolor"]["a"];t8X=this["linecolor"]["r"];X8X=this["linecolor"]["g"];g8X=this["linecolor"]["b"];R8X=t8X;T8X=X8X;a8X=g8X;F8X=this["getPixel"](r8X,V8X);U8X=F8X["r"];G8X=F8X["g"];W8X=F8X["b"];U8X=R8X*s8X+U8X*(0xff-s8X)>>8;G8X=T8X*s8X+G8X*(0xff-s8X)>>8;W8X=a8X*s8X+W8X*(0xff-s8X)>>8;this["setPixelrgba"](r8X,V8X,U8X,G8X,W8X,255);}}};e5["prototype"]["AALineQ1"]=function(P8X,V4X,B8X,E4X,D4X,C4X){var y4X,Y4X,m4X,L4X,K8X,d8X,s4X,N8X,l4X,M4X,G4X,U4X,r4X,F4X,W4X,H4X,f8X,Q8X,q8X,b8X,k4X;y4X=0;if(D4X)y4X=0xff;if(P8X==B8X)return;if(V4X==E4X)return;if(V4X>E4X){Y4X=P8X;P8X=B8X;B8X=Y4X;Y4X=V4X;V4X=E4X;E4X=Y4X;}m4X=B8X-P8X;L4X=E4X-V4X;if(P8X>B8X)m4X=P8X-B8X;K8X=P8X;d8X=V4X;s4X=0;if(m4X>L4X)s4X=this["ToUint16"]((L4X<<16)/m4X);else s4X=this["ToUint16"]((m4X<<16)/L4X);N8X=0;l4X=this["linecolor"]["a"];M4X=this["linecolor"]["r"];G4X=this["linecolor"]["g"];U4X=this["linecolor"]["b"];b8X=l4X;N8X=0;if(m4X>=L4X){while(m4X--!=0){k4X=this["ToUint16"](N8X+s4X);if(k4X<=N8X){d8X++;}N8X=k4X;if(P8X<B8X)K8X++;else K8X--;if(d8X<0||d8X>=this["pixelHeight"])continue;if(C4X)this["leftEdgeX"][d8X]=Math["max"](K8X+1,this["leftEdgeX"][d8X]);else this["rightEdgeX"][d8X]=Math["min"](K8X-1,this["rightEdgeX"][d8X]);if(K8X<0||K8X>=this["pixelWidth"])continue;b8X=l4X*this["ToUint16"](this["ToUint16"](N8X>>8)^y4X)>>8;r4X=M4X;F4X=G4X;W4X=U4X;q8X=this["getPixel"](K8X,d8X);H4X=q8X["r"];f8X=q8X["g"];Q8X=q8X["b"];H4X=r4X*b8X+H4X*(0xff-b8X)>>8;f8X=F4X*b8X+f8X*(0xff-b8X)>>8;Q8X=W4X*b8X+Q8X*(0xff-b8X)>>8;this["setPixelrgba"](K8X,d8X,H4X,f8X,Q8X,255);}}else{y4X^=0xff;while(--L4X!=0){k4X=this["ToUint16"](N8X+s4X);if(k4X<=N8X){if(P8X<B8X)K8X++;else K8X--;}N8X=k4X;d8X++;if(K8X<0||K8X>=this["pixelWidth"])continue;if(d8X<0||d8X>=this["pixelHeight"])continue;b8X=l4X*this["ToUint16"](this["ToUint16"](N8X>>8)^y4X)>>8;r4X=M4X;F4X=G4X;W4X=U4X;q8X=this["getPixel"](K8X,d8X);H4X=q8X["r"];f8X=q8X["g"];Q8X=q8X["b"];H4X=r4X*b8X+H4X*(0xff-b8X)>>8;f8X=F4X*b8X+f8X*(0xff-b8X)>>8;Q8X=W4X*b8X+Q8X*(0xff-b8X)>>8;this["setPixelrgba"](K8X,d8X,H4X,f8X,Q8X,255);if(C4X)this["leftEdgeX"][d8X]=K8X+1;else this["rightEdgeX"][d8X]=K8X-1;}}};e5["prototype"]["GetBrightness"]=function(z4X,n4X){var A4X;A4X=this["getPixel"](z4X,n4X);return(A4X["r"]*6966+A4X["g"]*23436+A4X["b"]*2366>>15)%256;};e5["prototype"]["drawLine"]=function(R4X,g4X,X4X,T4X){if(this["linewidth"]<=1){if(this["AntiAliasing"]==true){this["drawLineNormal"](R4X,g4X,X4X,T4X);}else{this["DrawLineWu"](R4X,g4X,X4X,T4X);}}else{this["DrawLineAa"](R4X,g4X,X4X,T4X);}};e5["prototype"]["drawPolyline"]=function(a4X){var O4X,o4X,J4X,Z4X;O4X=a4X[0];o4X=a4X[1];for(var t4X=2;t4X<a4X["length"];t4X+=2){J4X=a4X[t4X];Z4X=a4X[t4X+1];this["drawLine"](O4X,o4X,J4X,Z4X);O4X=J4X;o4X=Z4X;}};e5["prototype"]["drawPolygon"]=function(x4X){var i4X,p4X,I4X,w4X;if(x4X["length"]<6)return;i4X=x4X[0];p4X=x4X[1];for(var S4X=2;S4X<x4X["length"];S4X+=2){I4X=x4X[S4X];w4X=x4X[S4X+1];this["drawLine"](i4X,p4X,I4X,w4X);i4X=I4X;p4X=w4X;}if(x4X[0]!=i4X||x4X[1]!=p4X){this["drawLine"](i4X,p4X,x4X[0],x4X[1]);}};e5["prototype"]["isCross"]=function(e4X,v4X,h4X,j4X,u4X,c4X,d4X,K4X){return false;};e5["prototype"]["fillPolygon"]=function(b4X){this["fillPolygonNormal"](b4X);};e5["prototype"]["fillPolygonNormal"]=function(Q4X){var V2X,r2X,C2X,R2X,n2X,D2X,z2X,U2X,A2X,B4X,k2X,H2X,N4X,q4X,y2X,s2X,g2X,l2X,f4X,W2X,G2X,m2X,M2X,L2X,E2X,Y2X;V2X=this["pixelWidth"];r2X=this["pixelHeight"];C2X=this["fillcolor"]["a"];R2X=this["fillcolor"]["r"];n2X=this["fillcolor"]["g"];D2X=this["fillcolor"]["b"];z2X=C2X==255;U2X=Q4X["length"];A2X=Q4X["length"]>>1;B4X=new Array(A2X);k2X=r2X;H2X=0;for(N4X=1;N4X<U2X;N4X+=2){s2X=Q4X[N4X];if(s2X<k2X)k2X=s2X;if(s2X>H2X)H2X=s2X;}if(k2X<0)k2X=0;if(H2X>=r2X)H2X=r2X-1;g2X=0;for(var P4X=k2X;P4X<=H2X;P4X++){l2X=Q4X[0];f4X=Q4X[1];W2X=0;for(N4X=2;N4X<U2X;N4X+=2){G2X=Q4X[N4X];m2X=Q4X[N4X+1];if(f4X<P4X&&m2X>=P4X||m2X<P4X&&f4X>=P4X){B4X[W2X++]=Math["floor"](l2X+(P4X-f4X)/(m2X-f4X)*(G2X-l2X));}l2X=G2X;f4X=m2X;}for(N4X=1;N4X<W2X;N4X++){M2X=B4X[N4X];q4X=N4X;while(q4X>0&&B4X[q4X-1]>M2X){B4X[q4X]=B4X[q4X-1];q4X=q4X-1;}B4X[q4X]=M2X;}for(N4X=0;N4X<W2X-1;N4X+=2){L2X=B4X[N4X];E2X=B4X[N4X+1];if(E2X>0&&L2X<V2X){if(L2X<0)L2X=0;if(E2X>=V2X)E2X=V2X-1;for(var F2X=L2X;F2X<=E2X;F2X++){g2X+=1;Y2X=P4X*V2X+F2X;if(z2X==true){this["setPixelIndex"](Y2X,this["fillcolor"]);}else{y2X=this["getPixelIndex"](Y2X);this["setPixelIndex"](Y2X,this["AlphaBlend"](y2X["a"],y2X["r"],y2X["g"],y2X["b"],C2X,R2X,n2X,D2X));}}}}}};e5["prototype"]["fillPolygonEvenOdd"]=function(X2X){};e5["prototype"]["drawRectangle"]=function(T2X,a2X,t2X,O2X){this["drawLine"](T2X,a2X,T2X+t2X,a2X);this["drawLine"](T2X+t2X,a2X,T2X+t2X,a2X+O2X);this["drawLine"](T2X+t2X,a2X+t2X,T2X,a2X+O2X);this["drawLine"](T2X,a2X+O2X,T2X,a2X);};e5["prototype"]["fillRectangle"]=function(i2X,J2X,N2X,d2X){var c2X,v2X,j2X,u2X,I2X,Z2X,h2X,w2X,e2X,x2X,o2X,K2X,b2X;c2X=this["fillcolor"]["a"];v2X=this["fillcolor"]["r"];j2X=this["fillcolor"]["g"];u2X=this["fillcolor"]["b"];if(N2X<=0||d2X<=0||i2X+N2X<0||J2X+d2X<0||i2X>this["pixelWidth"]||J2X>this["pixelHeight"]){return;}I2X=i2X+N2X;Z2X=J2X+d2X;if(i2X<0){i2X=0;}if(J2X<0){J2X=0;}if(I2X<0){I2X=0;}if(Z2X<0){Z2X=0;}if(i2X>this["pixelWidth"]){i2X=this["pixelWidth"];}if(J2X>this["pixelHeight"]){J2X=this["pixelHeight"];}if(I2X>this["pixelWidth"]){I2X=this["pixelWidth"];}if(Z2X>this["pixelHeight"]){Z2X=this["pixelHeight"];}if(J2X>Z2X){Z2X-=J2X;J2X+=Z2X;Z2X=J2X-Z2X;}h2X=J2X*this["pixelWidth"];w2X=h2X+i2X;e2X=h2X+I2X;if(this["fillcolor"]["a"]==255){for(o2X=w2X;o2X<e2X;o2X++){this["setPixelIndex"](o2X,this["fillcolor"]);}}else{for(o2X=w2X;o2X<e2X;o2X++){x2X=this["getPixelIndex"](o2X);this["setPixelIndex"](o2X,this["AlphaBlend"](x2X["a"],x2X["r"],x2X["g"],x2X["b"],c2X,v2X,j2X,u2X));}}K2X=I2X-i2X;b2X=Z2X*this["pixelWidth"]+i2X;if(this["fillcolor"]["a"]==255){for(var p2X=w2X+this["pixelWidth"];p2X<b2X;p2X+=this["pixelWidth"]){for(var S2X=0;S2X<K2X;S2X++){o2X=p2X+S2X;this["setPixelIndex"](o2X,this["fillcolor"]);}}}else{for(var p2X=w2X+this["pixelWidth"];p2X<b2X;p2X+=this["pixelWidth"]){for(var S2X=0;S2X<K2X;S2X++){o2X=p2X+S2X;x2X=this["getPixelIndex"](o2X);this["setPixelIndex"](o2X,this["AlphaBlend"](x2X["a"],x2X["r"],x2X["g"],x2X["b"],c2X,v2X,j2X,u2X));}}}};e5["prototype"]["drawEllipse"]=function(q2X,Q2X,k1X,m1X){var P2X,B2X,f2X,H1X;P2X=k1X-q2X>>1;B2X=m1X-Q2X>>1;f2X=q2X+P2X;H1X=Q2X+B2X;this["drawEllipseCentered"](f2X,H1X,P2X,B2X);};e5["prototype"]["drawEllipseCentered"]=function(X1X,R1X,l1X,r1X){var E1X,Y1X,G1X,M1X,L1X,V1X,y1X,s1X,W1X,F1X,A1X,z1X,C1X,D1X,U1X,g1X,n1X;E1X=this["pixelWidth"];Y1X=this["pixelHeight"];if(l1X<1||r1X<1){return;}W1X=l1X;F1X=0;A1X=l1X*l1X<<1;z1X=r1X*r1X<<1;C1X=r1X*r1X*(1-(l1X<<1));D1X=l1X*l1X;U1X=0;g1X=z1X*l1X;n1X=0;while(g1X>=n1X){L1X=R1X+F1X;V1X=R1X-F1X;if(L1X<0)L1X=0;if(L1X>=Y1X)L1X=Y1X-1;if(V1X<0)V1X=0;if(V1X>=Y1X)V1X=Y1X-1;G1X=L1X*E1X;M1X=V1X*E1X;s1X=X1X+W1X;y1X=X1X-W1X;if(s1X<0)s1X=0;if(s1X>=E1X)s1X=E1X-1;if(y1X<0)y1X=0;if(y1X>=E1X)y1X=E1X-1;this["setPixelIndex"](s1X+G1X,this["linecolor"]);this["setPixelIndex"](y1X+G1X,this["linecolor"]);this["setPixelIndex"](y1X+M1X,this["linecolor"]);this["setPixelIndex"](s1X+M1X,this["linecolor"]);F1X++;n1X+=A1X;U1X+=D1X;D1X+=A1X;if(C1X+(U1X<<1)>0){W1X--;g1X-=z1X;U1X+=C1X;C1X+=z1X;}}W1X=0;F1X=r1X;L1X=R1X+F1X;V1X=R1X-F1X;if(L1X<0)L1X=0;if(L1X>=Y1X)L1X=Y1X-1;if(V1X<0)V1X=0;if(V1X>=Y1X)V1X=Y1X-1;G1X=L1X*E1X;M1X=V1X*E1X;C1X=r1X*r1X;D1X=l1X*l1X*(1-(r1X<<1));U1X=0;g1X=0;n1X=A1X*r1X;while(g1X<=n1X){s1X=X1X+W1X;y1X=X1X-W1X;if(s1X<0)s1X=0;if(s1X>=E1X)s1X=E1X-1;if(y1X<0)y1X=0;if(y1X>=E1X)y1X=E1X-1;this["setPixelIndex"](s1X+G1X,this["linecolor"]);this["setPixelIndex"](y1X+G1X,this["linecolor"]);this["setPixelIndex"](y1X+M1X,this["linecolor"]);this["setPixelIndex"](s1X+M1X,this["linecolor"]);W1X++;g1X+=z1X;U1X+=C1X;C1X+=z1X;if(D1X+(U1X<<1)>0){F1X--;L1X=R1X+F1X;V1X=R1X-F1X;if(L1X<0)L1X=0;if(L1X>=Y1X)L1X=Y1X-1;if(V1X<0)V1X=0;if(V1X>=Y1X)V1X=Y1X-1;G1X=L1X*E1X;M1X=V1X*E1X;n1X-=A1X;U1X+=D1X;D1X+=A1X;}}};e5["prototype"]["fillEllipse"]=function(t1X,O1X,Z1X,x1X){var T1X,a1X,o1X,J1X;T1X=Z1X-t1X>>1;a1X=x1X-O1X>>1;o1X=t1X+T1X;J1X=O1X+a1X;this["fillEllipseCentered"](o1X,J1X,T1X,a1X);};e5["prototype"]["fillEllipseCentered"]=function(m5X,N1X,j1X,u1X){var w1X,e1X,K1X,d1X,S1X,I1X,h1X,v1X,b1X,c1X,f1X,Q1X,q1X,B1X,P1X,H5X,k5X,y5X,L5X,V5X,E5X,i1X,p1X;w1X=this["pixelWidth"];e1X=this["pixelHeight"];if(j1X<1||u1X<1){return;}if(m5X-j1X>=w1X||m5X+j1X<0||N1X-u1X>=e1X||N1X+u1X<0){return;}b1X=j1X;c1X=0;f1X=j1X*j1X<<1;Q1X=u1X*u1X<<1;q1X=u1X*u1X*(1-(j1X<<1));B1X=j1X*j1X;P1X=0;H5X=Q1X*j1X;k5X=0;y5X=this["fillcolor"]["a"];L5X=this["fillcolor"]["r"];V5X=this["fillcolor"]["g"];E5X=this["fillcolor"]["b"];while(H5X>=k5X){S1X=N1X+c1X;I1X=N1X-c1X-1;if(S1X<0)S1X=0;if(S1X>=e1X)S1X=e1X-1;if(I1X<0)I1X=0;if(I1X>=e1X)I1X=e1X-1;K1X=S1X*w1X;d1X=I1X*w1X;v1X=m5X+b1X;h1X=m5X-b1X;if(v1X<0)v1X=0;if(v1X>=w1X)v1X=w1X-1;if(h1X<0)h1X=0;if(h1X>=w1X)h1X=w1X-1;if(this["fillcolor"]["a"]==255){for(i1X=h1X;i1X<=v1X;i1X++){this["setPixelIndex"](i1X+K1X,this["fillcolor"]);this["setPixelIndex"](i1X+d1X,this["fillcolor"]);}}else{for(i1X=h1X;i1X<=v1X;i1X++){p1X=this["getPixelIndex"](i1X+K1X);this["setPixelIndex"](i1X+K1X,this["AlphaBlend"](p1X["a"],p1X["r"],p1X["g"],p1X["b"],y5X,L5X,V5X,E5X));p1X=this["getPixelIndex"](i1X+d1X);this["setPixelIndex"](i1X+d1X,this["AlphaBlend"](p1X["a"],p1X["r"],p1X["g"],p1X["b"],y5X,L5X,V5X,E5X));}}c1X++;k5X+=f1X;P1X+=B1X;B1X+=f1X;if(q1X+(P1X<<1)>0){b1X--;H5X-=Q1X;P1X+=q1X;q1X+=Q1X;}}b1X=0;c1X=u1X;S1X=N1X+c1X;I1X=N1X-c1X;if(S1X<0)S1X=0;if(S1X>=e1X)S1X=e1X-1;if(I1X<0)I1X=0;if(I1X>=e1X)I1X=e1X-1;K1X=S1X*w1X;d1X=I1X*w1X;q1X=u1X*u1X;B1X=j1X*j1X*(1-(u1X<<1));P1X=0;H5X=0;k5X=f1X*u1X;while(H5X<=k5X){v1X=m5X+b1X;h1X=m5X-b1X;if(v1X<0)v1X=0;if(v1X>=w1X)v1X=w1X-1;if(h1X<0)h1X=0;if(h1X>=w1X)h1X=w1X-1;if(this["fillcolor"]["a"]==255){for(i1X=h1X;i1X<=v1X;i1X++){this["setPixelIndex"](i1X+K1X,this["fillcolor"]);this["setPixelIndex"](i1X+d1X,this["fillcolor"]);}}else{for(i1X=h1X;i1X<=v1X;i1X++){p1X=this["getPixelIndex"](i1X+K1X);this["setPixelIndex"](i1X+K1X,this["AlphaBlend"](p1X["a"],p1X["r"],p1X["g"],p1X["b"],y5X,L5X,V5X,E5X));p1X=this["getPixelIndex"](i1X+d1X);this["setPixelIndex"](i1X+d1X,this["AlphaBlend"](p1X["a"],p1X["r"],p1X["g"],p1X["b"],y5X,L5X,V5X,E5X));}}b1X++;H5X+=Q1X;P1X+=q1X;q1X+=Q1X;if(B1X+(P1X<<1)>0){c1X--;S1X=N1X+c1X;I1X=N1X-c1X;if(S1X<0)S1X=0;if(S1X>=e1X)S1X=e1X-1;if(I1X<0)I1X=0;if(I1X>=e1X)I1X=e1X-1;K1X=S1X*w1X;d1X=I1X*w1X;k5X-=f1X;P1X+=B1X;B1X+=f1X;}}};e5["prototype"]["drawString"]=function(n5X,U5X,T5X,X5X,g5X){var R5X,D5X,G5X,W5X,A5X,a5X,z5X,C5X,F5X,l5X,r5X;R5X=e5["find_font"]("NANUMGOTHIC");for(var M5X=0;M5X<n5X["length"];M5X++){D5X=n5X["charCodeAt"](M5X);if(D5X==32){U5X+=X5X*0.5;}else{G5X=e5["get_bitmap"](R5X,D5X,X5X,g5X);if(!G5X)continue;W5X=e5["get_width"]();A5X=e5["get_height"]();a5X=this["pixelWidth"]*4;z5X=Module["HEAPU8"]["subarray"](G5X,G5X+W5X*A5X);C5X=e5["get_left"]();F5X=e5["get_top"]();F5X=g5X-F5X;for(var Y5X=0;Y5X<W5X;Y5X++){for(var s5X=0;s5X<A5X;s5X++){r5X=255-z5X[s5X*W5X+Y5X];if(r5X==255)continue;l5X=this["getPixel"](U5X+C5X+Y5X,s5X+T5X+F5X);if(l5X!=null){this["setPixel"](U5X+C5X+Y5X,s5X+T5X+F5X,this["AlphaBlend"](l5X["a"],l5X["r"],l5X["g"],l5X["b"],r5X,r5X,r5X,255));}}}U5X+=e5["get_advance"]();}}};return e5;}();(function(t5X){var O5X;O5X=function(){o5X["checkMesh"]=function(J5X,x5X){if(J5X["geometry"]["faces"]["length"]>0&&J5X["geometry"]["vertices"]["length"]>0){for(var Z5X=0;Z5X<J5X["children"]["length"];Z5X++)if(!this["checkMesh"](J5X["children"][Z5X],Z5X))Z5X--;return true;}else{if(J5X["parent"]!=null)J5X["parent"]["children"]["splice"](x5X,1);console["log"](J5X["name"]+" has zero faces and/or vertices so it is removed.");J5X=null;return false;}};o5X["relativePath2AbsolutePath"]=function(p5X,S5X){var i5X;i5X=p5X+S5X;return i5X;};o5X["getElement"]=function(w5X){var I5X;I5X=null;if(typeof w5X==='string'){I5X=document["getElementById"](w5X);if(I5X===null){console["error"]('Element with id "'+w5X+'" does not exist in the document.');}}return I5X;};o5X["drawToConfirmCanvasArea"]=function(v5X,h5X){var e5X,u5X,j5X,c5X,d5X,K5X;if(t5X["Util"]["isDefined"](v5X)==false)return;if(t5X["Util"]["isDefined"](h5X)==false)return;e5X=v5X["getSize"]();u5X=new THREE["OrthographicCamera"](-e5X["width"]/2,e5X["width"]/2,e5X["height"]/2,-e5X["height"]/2,0,30);v5X["setClearColor"](0xffff00,1);v5X["clear"]();j5X=new THREE["MeshLambertMaterial"]({color:0xff0055,wireframe:true});c5X=new THREE["Mesh"](new THREE["PlaneBufferGeometry"](e5X["width"]-0.5,e5X["height"]-0.5),j5X);d5X=new THREE["Mesh"](new THREE["CircleGeometry"](e5X["width"]/2,60),j5X);K5X=new THREE["Mesh"](new THREE["CircleGeometry"](e5X["height"]/2,60),j5X);h5X["add"](c5X);h5X["add"](d5X);h5X["add"](K5X);v5X["render"](h5X,u5X);};function o5X(){}return o5X;}();t5X["CmEtcUtil"]=O5X;}(CMWORLD||(CMWORLD={})));(function(b5X){var N5X;N5X=function(){P5X["getCornerCoordinateArray"]=function(H6X,V6X){var k6X,y6X,f5X,Q5X,q5X,s6X,E6X,L6X,m6X;if(H6X){k6X=[];if(H6X["geometry"]["type"]=="BufferGeometry"){y6X=H6X;f5X=y6X["geometry"]["attributes"]["position"]["array"];Q5X=new THREE["Vector3"](99999999,0,0);q5X=new THREE["Vector3"](0,99999999,0);for(var B5X=0;B5X<f5X["length"];B5X+=3){if(Q5X["x"]>f5X[B5X]){Q5X["x"]=f5X[B5X];Q5X["y"]=f5X[B5X+1];Q5X["z"]=f5X[B5X+2];}}for(var B5X=0;B5X<f5X["length"];B5X+=3){if(q5X["y"]>f5X[B5X+1]){q5X["x"]=f5X[B5X];q5X["y"]=f5X[B5X+1];q5X["z"]=f5X[B5X+2];}}s6X=(q5X["z"]+Q5X["z"])*0.5;E6X=new THREE["Vector3"](Q5X["x"],q5X["y"],0);L6X=new THREE["Vector3"](Q5X["x"],Q5X["y"],0);m6X=new THREE["Vector3"](q5X["x"],q5X["y"],0);L6X["sub"](E6X);m6X["sub"](E6X);if(L6X["length"]<m6X["length"]){Q5X["add"](H6X["position"]);if(V6X){Q5X["add"](V6X);}k6X["push"](Q5X);}else{q5X["add"](H6X["position"]);if(q5X){q5X["add"](V6X);}k6X["push"](q5X);}return k6X;}}return null;};P5X["createWorldGeometry"]=function(l6X,U6X){var F6X,M6X,Y6X,A6X,C6X,D6X,W6X;if(U6X===void 0){U6X=false;}if(l6X){F6X=10000;if(U6X){M6X=new THREE["Geometry"]();for(var r6X in l6X){Y6X=b5X["CmMathEngine"]["Geo2Cartesian"](l6X[r6X]["x"],l6X[r6X]["y"],b5X["cm_const"]["EarthRadius"]+l6X[r6X]["z"]);M6X["vertices"]["push"](Y6X);}return M6X;}else{A6X=l6X[0]["z"];C6X=[];for(var r6X in l6X){C6X["push"](new THREE["Vector2"](l6X[r6X]["x"]*F6X,l6X[r6X]["y"]*F6X));}D6X=new THREE["Shape"](C6X);W6X=new THREE["ShapeGeometry"](D6X);for(var G6X in W6X["vertices"]){Y6X=W6X["vertices"][G6X];Y6X["x"]/=F6X;Y6X["y"]/=F6X;Y6X=b5X["CmMathEngine"]["Geo2Cartesian"](Y6X["x"],Y6X["y"],b5X["cm_const"]["EarthRadius"]+A6X);W6X["vertices"][G6X]=Y6X;}return W6X;}}return null;};function P5X(){}return P5X;}();b5X["GeometryUtil"]=N5X;}(CMWORLD||(CMWORLD={})));(function(z6X){var n6X;n6X=function(){R6X["createCORSRequest"]=function(a6X,t6X,X6X,T6X){var g6X;if(T6X===void 0){T6X="arraybuffer";}g6X=new XMLHttpRequest();if(X6X==true){g6X["responseType"]=T6X;}if("withCredentials"in g6X){g6X["open"](a6X,t6X,X6X);}else if(typeof XDomainRequest!="undefined"){g6X=new XDomainRequest();g6X["open"](a6X,t6X,X6X);}else{g6X=null;}return g6X;};R6X["getResponseContentType"]=function(O6X){if(z6X["Util"]["isDefined"](O6X))return O6X["getResponseHeader"]("Content-Type");return null;};R6X["getResponseContentLength"]=function(o6X){if(z6X["Util"]["isDefined"](o6X))return o6X["getResponseHeader"]("Content-Length");return-1;};R6X["createCORSRequestObject"]=function(){var J6X;J6X=null;{J6X=new XMLHttpRequest();if(J6X["withCredentials"]==true){}else{}}return J6X;};R6X["cmloadImage"]=function(x6X,i6X,p6X){var Z6X;Z6X=function(I6X){function e6X(){S6X["onload"]=null;S6X["onerror"]=null;S6X["onabort"]=null;}var S6X;S6X=new Image();S6X["onload"]=v6X;S6X["onerror"]=w6X;S6X["onabort"]=w6X;S6X["crossOrigin"]="Anonymous";function v6X(){e6X();I6X["resolve"](S6X);}function w6X(){var h6X;h6X=S6X;h6X["taskIndex"]=p6X;h6X["quadImageLoader"]=i6X;e6X();I6X["reject"](S6X);}S6X["src"]=x6X;};return $["Deferred"](Z6X)["promise"]();};function R6X(){if(R6X["cache"]==null){if(z6X["Util"]["isDefined"](z6X["CmWorld3"]["cache"]))R6X["cache"]=z6X["CmWorld3"]["cache"];}}R6X["requestFile"]=function(u6X,d6X,c6X,K6X,b6X){var N6X,P6X,j6X;if(c6X===void 0){c6X=null;}if(K6X===void 0){K6X=true;}if(b6X===void 0){b6X="arraybuffer";}if(z6X["Util"]["isDefined"](u6X)==false){console["warn"]("requestFile:url은 반드시 지정되어야 합니다.");return false;}if(z6X["Util"]["isDefined"](d6X)==false){console["warn"]("requestFile:callbackFn 함수는 반드시 지정되어야 합니다.");return false;}if(R6X["cache"]!=null){N6X=R6X["cache"]["get"](u6X);if(N6X){d6X({url:u6X,response:N6X,status:z6X["HttpStatusCode"]["OK"],tag:c6X});return false;}if(R6X["cache"]["isDeadUrl"](u6X)){d6X({url:u6X,response:null,status:z6X["HttpStatusCode"]["NoContent"],tag:c6X});return false;}}P6X=this;j6X=R6X["createCORSRequestObject"]();j6X["onreadystatechange"]=function(){var B6X,q6X;if(j6X["readyState"]===z6X["xHttp_readyState"]["finished"]){try{if(j6X["status"]===z6X["HttpStatusCode"]["OK"]){{if(j6X["response"]["byteLength"]<150){if(j6X["responseType"]==="arraybuffer"){B6X=j6X["getResponseHeader"]("Content-Type");if(B6X!=null&&B6X["startsWith"]('text/xml')){q6X=z6X["Util"]["arraybuffer2string"](j6X["response"]);console["warn"](q6X);d6X({url:u6X,response:null,status:z6X["HttpStatusCode"]["NOT_FOUND"],tag:c6X});return;}}}}if(R6X["cache"]!=null)R6X["cache"]["add"](u6X,j6X["response"]);d6X({url:u6X,response:j6X["response"],status:z6X["HttpStatusCode"]["OK"],tag:c6X});return;}else{d6X({url:u6X,response:null,status:j6X["status"],tag:c6X});return;}}catch(Q6X){console["error"](Q6X);}d6X({url:u6X,response:null,status:z6X["HttpStatusCode"]["NoContent"],tag:c6X});}};j6X["open"]("GET",u6X,K6X);{if(b6X=="arraybuffer"){j6X["responseType"]="arraybuffer";}else{}}j6X["send"](null);return true;};R6X["getParameterByName"]=function(H9X,k9X){var m9X,f6X;if(!k9X)k9X=window["location"]["href"];H9X=H9X["replace"](/[\[\]]/g,"\\$&");m9X=new RegExp("[?&]"+H9X+"(=([^&#]*)|&|#|$)"),f6X=m9X["exec"](k9X);if(!f6X)return null;if(!f6X[2])return'';return decodeURIComponent(f6X[2]["replace"](/\u002b/g," "));};return R6X;}();n6X["cache"]=null;z6X["NetWork"]=n6X;}(CMWORLD||(CMWORLD={})));(function(V9X){var L9X;L9X=function(){E9X["confirmFeatures"]=function(){if(typeof Storage!=="undefined"){}else{console["warn"]("Sorry! No Web Storage support..");}};function E9X(){}return E9X;}();V9X["ConfirmUtil"]=L9X;}(CMWORLD||(CMWORLD={})));Module={preRun:[function(){cm_canvas["preRun"]();}],postRun:[function(){cm_canvas["loadFont"]();}]};(function(s9X){var y9X;y9X=function(){Y9X["isDefined"]=function(l9X){return l9X!==null&&l9X!==undefined;};function Y9X(){}Y9X["isFuncDefined"]=function(r9X){if(typeof r9X=='function')return true;return false;};Y9X["defaultValue"]=function(F9X,W9X){if(F9X!==undefined&&F9X!==null){return F9X;}return W9X;};Y9X["removeFromArray"]=function(G9X,M9X){if(Y9X["isDefined"](M9X)==false){return-1;}if(Y9X["isDefined"](G9X)){for(var U9X=0;U9X<G9X["length"];U9X++){if(G9X[U9X]==M9X){G9X["splice"](U9X,1);return U9X;}}}return-1;};Y9X["findIndexFromArray"]=function(D9X,A9X){if(Y9X["isDefined"](A9X)==false){return;}if(Y9X["isDefined"](D9X)){for(var C9X=0;C9X<D9X["length"];C9X++){if(D9X[C9X]==A9X){return C9X;}}}return-1;};Y9X["stringFormat"]=function(){var n9X,R9X;n9X=arguments[0];for(var z9X=1;z9X<arguments["length"];z9X++){R9X=new RegExp("\\{"+(z9X-1)+"\\}","gm");n9X=n9X["replace"](R9X,arguments[z9X]);}return n9X;};Y9X["createGuid"]=function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'["replace"](/[xy]/g,function(T9X){var g9X,X9X;g9X=Math["random"]()*16|0;X9X=T9X==='x'?g9X:g9X&0x3|0x8;return X9X["toString"](16);});};Y9X["disposeMaterial"]=function(a9X){if(a9X instanceof THREE["Material"]){a9X["dispose"]();}else{for(var t9X in a9X){a9X[t9X]["dispose"]();}}};Y9X["arraybuffer2string"]=function(O9X){return String["fromCharCode"]["apply"](null,new Uint8Array(O9X));};return Y9X;}();s9X["Util"]=y9X;}(CMWORLD||(CMWORLD={})));(function(J9X){var o9X;o9X=function(){Z9X["prototype"]["activity"]=function(i9X){this["lastUpdateTime"]=i9X;};function Z9X(x9X){if(x9X===void 0){x9X=30000;}this["elapseTime"]=30000;this["lastUpdateTime"]=0;this["elapseTime"]=x9X;}Z9X["prototype"]["isActivity"]=function(p9X){if(p9X-this["lastUpdateTime"]<this["elapseTime"]){return true;}return false;};return Z9X;}();J9X["ActivityChecker"]=o9X;}(CMWORLD||(CMWORLD={})));(function(I9X){var S9X;S9X=function(){w9X["prototype"]["isStarted"]=function(){return this["m_Started"];};function w9X(e9X,v9X,h9X,j9X,u9X,c9X,d9X){if(e9X===void 0){e9X=2016;}if(v9X===void 0){v9X=1;}if(h9X===void 0){h9X=1;}if(j9X===void 0){j9X=1;}if(u9X===void 0){u9X=0;}if(c9X===void 0){c9X=0;}if(d9X===void 0){d9X=0;}this["m_EndDateTime"]=-1;this["m_Speed"]=1.0;this["m_Started"]=false;this["m_EndDateTime"]=-1;this["m_Speed"]=1.0;this["m_Started"]=false;this["m_TimeBase"]=0;this["m_StartDateTime"]=new Date(e9X,v9X,h9X,j9X,u9X,c9X,d9X)["getTime"]();}w9X["prototype"]["start"]=function(){this["m_Started"]=true;this["m_RealStartTime"]=Date["now"]();};w9X["prototype"]["stop"]=function(){this["m_TimeBase"]=this["m_TimeBase"]+(Date["now"]()-this["m_RealStartTime"]);this["m_Started"]=false;};w9X["prototype"]["reset"]=function(){this["m_Started"]=false;this["m_TimeBase"]=0;};w9X["prototype"]["getNow"]=function(){var P9X,N9X,K9X,b9X;P9X=Date["now"]();K9X=this["m_StartDateTime"];if(this["m_Started"]==true){N9X=this["m_TimeBase"];N9X=N9X+P9X-this["m_RealStartTime"];K9X=this["m_StartDateTime"]+N9X*this["m_Speed"];if(this["m_EndDateTime"]>0){if(K9X>this["m_EndDateTime"]){b9X=K9X-this["m_EndDateTime"];K9X=this["m_StartDateTime"]+b9X;b9X=b9X/this["m_Speed"];this["m_RealStartTime"]=P9X-b9X;this["m_TimeBase"]=0;}}}else{K9X=K9X+this["m_TimeBase"]*this["m_Speed"];}return K9X;};w9X["prototype"]["now"]=function(){var B9X;B9X=this["getNow"]();return new Date(B9X);};w9X["prototype"]["setSpeed"]=function(f9X){var Q9X,q9X;Q9X=this["m_Speed"]/f9X;if(this["m_Started"]==true){q9X=this["getNow"]();q9X=q9X-this["m_StartDateTime"];this["m_TimeBase"]=q9X*Q9X;this["m_RealStartTime"]=Date["now"]();}else{this["m_TimeBase"]*=Q9X;}this["m_Speed"]=f9X;};w9X["prototype"]["setStartDateTime"]=function(H0X,k0X,m0X,L0X,V0X,E0X,y0X){this["m_StartDateTime"]=new Date(H0X,k0X,m0X,L0X,V0X,E0X,y0X)["getTime"]();};w9X["prototype"]["setEndDateTime"]=function(s0X,Y0X,l0X,r0X,F0X,W0X,U0X){this["m_EndDateTime"]=new Date(s0X,Y0X,l0X,r0X,F0X,W0X,U0X)["getTime"]();};return w9X;}();I9X["CmWorldTimer"]=S9X;}(CMWORLD||(CMWORLD={})));(function(G0X){var M0X;M0X=function(){C0X["normalizeAngle360"]=function(A0X){var D0X;D0X=A0X%360;return D0X>=0?D0X:D0X<0?360+D0X:360-D0X;};C0X["normalizedDegreesLongitude"]=function(n0X){var z0X;z0X=n0X%360;return z0X>180?z0X-360:z0X<-180?360+z0X:z0X;};C0X["getAsCelestialLocation"]=function(Z0X){var o0X,g0X,O0X,T0X,X0X,a0X,t0X,J0X,R0X;o0X=this["computeJulianDate"](Z0X);g0X=o0X-2451545;O0X=this["normalizeAngle360"](280.460+0.9856474*g0X);T0X=this["normalizeAngle360"](357.528+0.9856003*g0X)*this["Deg2Rad"];X0X=O0X+1.915*Math["sin"](T0X)+0.02*Math["sin"](2*T0X);a0X=X0X*this["Deg2Rad"];t0X=(23.439-0.0000004*g0X)*this["Deg2Rad"];J0X=Math["asin"](Math["sin"](t0X)*Math["sin"](a0X))*this["Rad2Deg"];R0X=Math["atan"](Math["cos"](t0X)*Math["tan"](a0X))*this["Rad2Deg"];if(X0X>=90&&X0X<270){R0X+=180;}R0X=this["normalizeAngle360"](R0X);return{declination:J0X,rightAscension:R0X};};function C0X(){}C0X["celestialToGeographic"]=function(x0X,e0X){var i0X,p0X,S0X,I0X,w0X;i0X=this["computeJulianDate"](e0X);p0X=i0X-2451545;S0X=this["normalizeAngle360"](280.46061837+360.98564736629*p0X);I0X=this["normalizeAngle360"](S0X-x0X["rightAscension"]);w0X=this["normalizedDegreesLongitude"](-I0X);return{latitude:x0X["declination"],longitude:w0X};};C0X["computeJulianDate"]=function(v0X){var h0X,j0X,P0X,d0X,c0X,b0X,N0X,u0X,B0X,K0X;h0X=v0X["getUTCFullYear"]();j0X=v0X["getUTCMonth"]()+1;P0X=v0X["getUTCDate"]();d0X=v0X["getUTCHours"]();c0X=v0X["getUTCMinutes"]();b0X=v0X["getUTCSeconds"]();N0X=(d0X+c0X/60+b0X/3600)/24;if(j0X<=2){h0X-=1;j0X+=12;}u0X=Math["floor"](h0X/100);B0X=2-u0X+Math["floor"](u0X/4);K0X=Math["floor"](365.25*(h0X+4716))+Math["floor"](30.6001*(j0X+1))+P0X+B0X-1524.5;return K0X+N0X;};C0X["getPosition"]=function(H7n){var k7n,f0X,Q0X,q0X,m7n;k7n=this["getAsCelestialLocation"](H7n);f0X=this["celestialToGeographic"](k7n,H7n);Q0X=G0X["CmMathEngineS3D"]["Geo2Cartesian"](f0X["longitude"],f0X["latitude"],G0X["cm_const"]["EarthRadius"]*2);if(G0X["CmWorld3"]["getInstance"]()["option"]["SceneMode"]!=G0X["SceneModeType"]["SCENE_S3D"]){q0X=G0X["CmMathEngineS3D"]["Geo2Cartesian"](f0X["longitude"],f0X["latitude"],G0X["cm_const"]["EarthRadius"]);Q0X["normalize"]();q0X["normalize"]();m7n=new THREE["Quaternion"]()["setFromUnitVectors"](q0X,Q0X);q0X=new THREE["Vector3"](0,0,1);q0X["applyQuaternion"](m7n);Q0X["x"]=q0X["x"];Q0X["y"]=q0X["y"];Q0X["z"]=q0X["z"];}return Q0X;};return C0X;}();M0X["Rad2Deg"]=G0X["cm_const"]["Rad2Deg"];M0X["Deg2Rad"]=G0X["cm_const"]["Deg2Rad"];G0X["SunCalculator"]=M0X;}(CMWORLD||(CMWORLD={})));(function(V7n){var L7n;L7n=function(){E7n["Normalize"]=function(y7n){if(y7n>E7n["PI"]*2)y7n-=E7n["PI"]*2;if(y7n<-E7n["PI"]*2)y7n+=E7n["PI"]*2;return y7n;};E7n["Normalize180"]=function(s7n){if(s7n>180){s7n=s7n-360;return s7n;}if(s7n<-180){s7n=360+s7n;return s7n;}return s7n;};function E7n(){this["dlPIdiv180"]=0.01745329251994329576923690768489;this["dl180divPI"]=57.295779513082320876798154814105;this["Radian90"]=1.5707963267948966192313216916398;this["Radian180"]=3.1415926535897932384626433832795;this["Radian360"]=6.283185307179586476925286766559;}return E7n;}();L7n["PI"]=3.1415926535897932384626433832795;}(CMWORLD||(CMWORLD={})));(function(Y7n){var l7n;l7n=function(){r7n["getAngleBetweenTwoVector3"]=function(C7n,D7n){var F7n,W7n,U7n,G7n,M7n;F7n=C7n["clone"]();W7n=D7n["clone"]();F7n["normalize"]();W7n["normalize"]();U7n=F7n["dot"](W7n);G7n=Math["acos"](U7n);M7n=G7n*r7n["Rad2Deg"];return M7n;};r7n["Geo2CartesianEarth"]=function(A7n,z7n,n7n){return r7n["Geo2Cartesian"](A7n,z7n,Y7n["cm_const"]["EarthRadius"]+n7n);};r7n["Geo2Cartesian"]=function(o7n,Z7n,J7n,a7n){var R7n,X7n,g7n,T7n,O7n,t7n;if(a7n===void 0){a7n=Y7n["SceneModeType"]["SCENE_S3D"];}R7n=(90-Z7n)*r7n["Deg2Rad"];X7n=(180+o7n)*r7n["Deg2Rad"];g7n=J7n;T7n=g7n*Math["sin"](R7n)*Math["sin"](X7n);O7n=g7n*Math["cos"](R7n);t7n=g7n*Math["sin"](R7n)*Math["cos"](X7n);return new THREE["Vector3"](T7n,O7n,t7n);};r7n["GetTileGeoBoundary"]=function(e7n,S7n,I7n,i7n,p7n){var w7n,x7n;w7n=Y7n["CmWorld3"]["getInstance"]();x7n=w7n["option"]["TileLevelRange"][e7n];i7n["x"]=-180.0+I7n*x7n;i7n["y"]=-90+(S7n+1)*x7n;i7n["z"]=NaN;p7n["x"]=-180.0+(I7n+1)*x7n;p7n["y"]=-90+S7n*x7n;p7n["z"]=NaN;};r7n["GetTileSizeInMeter"]=function(h7n,j7n){var u7n,v7n;u7n=Y7n["CmWorld3"]["getInstance"]();v7n=2.0*Y7n["cm_const"]["PI"]*Y7n["cm_const"]["EarthRadius"]*Math["cos"](j7n*Y7n["cm_const"]["Deg2Rad"]);return v7n*h7n/360.0;};r7n["calContactDistanceWithCircle"]=function(N7n,K7n,P7n){var c7n,d7n,b7n;c7n=N7n["clone"]();c7n=c7n["sub"](P7n);d7n=c7n["length"]();if(d7n<K7n)return 0;b7n=Math["sqrt"](d7n*d7n-K7n*K7n);return b7n;};r7n["Cartesian2Geo"]=function(Q7n,f7n,H3n,m3n){var k3n,q7n,B7n;if(m3n===void 0){m3n=Y7n["SceneModeType"]["SCENE_S3D"];}k3n=Math["sqrt"](Q7n*Q7n+f7n*f7n+H3n*H3n);q7n=Math["acos"](f7n/k3n)*r7n["Rad2Deg"];B7n=Math["atan2"](Q7n,H3n)*r7n["Rad2Deg"];q7n=90-q7n;B7n=180+B7n;if(B7n>180){B7n=-360+B7n;}return new THREE["Vector3"](B7n,q7n,k3n);};function r7n(){}r7n["getRowFromLatitude"]=function(L3n,V3n){return Math["floor"]((L3n+90.0000001)/V3n);};r7n["getColFromLongitude"]=function(E3n,y3n){return Math["floor"]((E3n+180.0000001)/y3n);};r7n["getBoundFromRowCol"]=function(W3n,l3n,r3n){var F3n,Y3n,s3n;F3n=Y7n["CmWorld3"]["getInstance"]();Y3n=F3n["option"]["TileLevelRange"][W3n];s3n=new Y7n["CoordBound"]();s3n["West"]=-180+r3n*Y3n;s3n["East"]=-180+(r3n+1)*Y3n;s3n["South"]=-90+l3n*Y3n;s3n["North"]=-90+(l3n+1)*Y3n;return s3n;};r7n["rotateAroundLocalAxis"]=function(U3n,A3n,z3n,n3n,g3n,R3n){var M3n,G3n,C3n,D3n;M3n=new THREE["Vector3"]();M3n["copy"](U3n["position"])["sub"](A3n);G3n=z3n["clone"]();G3n["applyMatrix4"](U3n["matrix"]);G3n["sub"](U3n["position"]);G3n["normalize"]();C3n=new THREE["Quaternion"]();C3n["setFromAxisAngle"](G3n,n3n);M3n=r7n["MultiplyQuaternionVector"](C3n,M3n);G3n=r7n["MultiplyQuaternionVector"](C3n,U3n["up"]);U3n["up"]["set"](G3n["x"],G3n["y"],G3n["z"]);U3n["position"]["addVectors"](A3n,M3n);D3n=new THREE["Matrix4"]();D3n["makeRotationFromQuaternion"](C3n);D3n["multiply"](U3n["matrix"]);U3n["matrix"]=D3n;U3n["rotation"]["setFromRotationMatrix"](U3n["matrix"]);};r7n["prototype"]["rotateAroundWorldAxis"]=function(X3n,o3n,J3n,Z3n,i3n,x3n){var a3n,T3n,t3n,O3n;a3n=new THREE["Vector3"]();a3n["copy"](X3n["position"])["sub"](o3n);T3n=J3n["clone"]();t3n=new THREE["Quaternion"]();t3n["setFromAxisAngle"](T3n,Z3n);a3n=r7n["MultiplyQuaternionVector"](t3n,a3n);T3n=r7n["MultiplyQuaternionVector"](t3n,X3n["up"]);X3n["up"]["set"](T3n["x"],T3n["y"],T3n["z"]);X3n["position"]["addVectors"](o3n,a3n);O3n=new THREE["Matrix4"]();O3n["makeRotationFromQuaternion"](t3n);O3n["multiply"](X3n["matrix"]);X3n["matrix"]=O3n;X3n["rotation"]["setFromRotationMatrix"](X3n["matrix"]);};r7n["CalcRotatePosition"]=function(S3n,w3n,e3n){var p3n,I3n;S3n["normalize"]();p3n=new THREE["Quaternion"]();p3n["setFromAxisAngle"](S3n,e3n*r7n["Deg2Rad"]);I3n=r7n["MultiplyQuaternionVector"](p3n,w3n);return I3n;};r7n["prototype"]["does_ray_intersect_sphere"]=function(c3n,d3n,K3n,u3n){var v3n,j3n,h3n;v3n=THREE["Vector3"]["prototype"]["subVectors"](c3n,K3n);j3n=v3n["dot"](v3n);u3n*u3n;if(j3n<=0.0)return true;h3n=v3n["dot"](d3n);if(h3n>0.0)return false;return h3n*h3n-j3n>=0.0;};r7n["prototype"]["does_line_segment_intersect_sphere"]=function(k8n,E8n,V8n,L8n){var P3n,f3n,B3n,N3n,m8n,b3n,H8n,Q3n,q3n;P3n=THREE["Vector3"]["prototype"]["subVectors"](k8n,V8n);f3n=P3n["dot"](P3n)-L8n*L8n;if(f3n<=0.0)return true;B3n=THREE["Vector3"]["prototype"]["subVectors"](E8n,k8n);N3n=B3n["length"]();if(N3n==0.0)return false;m8n=B3n["divideScalar"](N3n);b3n=P3n["dot"](m8n);if(b3n>0.0)return false;H8n=Math["sqrt"](b3n*b3n-f3n);Q3n=-b3n+H8n;if(Q3n>=0.0&&Q3n<=N3n)return true;q3n=-b3n-H8n;if(q3n>=0.0&&q3n<=N3n)return true;};r7n["FindLineSphereIntersections"]=function(y8n,l8n,X8n,t8n){var U8n,a8n,M8n,D8n,G8n,F8n,W8n,r8n,C8n,R8n,A8n,g8n,n8n,o8n,z8n,Y8n,T8n,s8n,O8n;U8n=null;a8n=false;if(a8n){M8n=X8n["x"];D8n=X8n["y"];G8n=X8n["z"];F8n=y8n["x"];W8n=y8n["y"];r8n=y8n["z"];C8n=l8n["x"]-F8n;R8n=l8n["y"]-W8n;A8n=l8n["z"]-r8n;g8n=C8n*C8n+R8n*R8n+A8n*A8n;n8n=2.0*(F8n*C8n+W8n*R8n+r8n*A8n-C8n*M8n-R8n*D8n-A8n*G8n);o8n=F8n*F8n-2*F8n*M8n+M8n*M8n+W8n*W8n-2*W8n*D8n+D8n*D8n+r8n*r8n-2*r8n*G8n+G8n*G8n-t8n*t8n;z8n=n8n*n8n-4*g8n*o8n;Y8n=(-n8n-Math["sqrt"](z8n))/(2.0*g8n);T8n=new THREE["Vector3"](y8n["x"]*(1-Y8n)+Y8n*l8n["x"],y8n["y"]*(1-Y8n)+Y8n*l8n["y"],y8n["z"]*(1-Y8n)+Y8n*l8n["z"]);s8n=(-n8n+Math["sqrt"](z8n))/(2.0*g8n);O8n=new THREE["Vector3"](y8n["x"]*(1-s8n)+s8n*l8n["x"],y8n["y"]*(1-s8n)+s8n*l8n["y"],y8n["z"]*(1-s8n)+s8n*l8n["z"]);U8n=new Array();if(z8n<0||Y8n>1||Y8n<0||s8n>1||s8n<0){return null;}else if(z8n==0){U8n["push"](T8n);}else{U8n["push"](T8n);U8n["push"](O8n);}}return U8n;};r7n["setSceneMode"]=function(Z8n){var J8n;J8n=Y7n["CmWorld3"]["getInstance"]();J8n["option"]["SceneMode"]=Z8n;if(Z8n==Y7n["SceneModeType"]["SCENE_S3D"]){this["getAngleBetweenTwoVector3"]=Y7n["CmMathEngineS3D"]["getAngleBetweenTwoVector3"];this["Geo2Cartesian"]=Y7n["CmMathEngineS3D"]["Geo2Cartesian"];this["Cartesian2Geo"]=Y7n["CmMathEngineS3D"]["Cartesian2Geo"];this["getRowFromLatitude"]=Y7n["CmMathEngineS3D"]["getRowFromLatitude"];this["getColFromLongitude"]=Y7n["CmMathEngineS3D"]["getColFromLongitude"];this["getBoundFromRowCol"]=Y7n["CmMathEngineS3D"]["getBoundFromRowCol"];J8n["option"]["EarthRadius"]=Y7n["cm_const"]["EarthRadius"]*J8n["option"]["GlobalScale"];}else if(Z8n==Y7n["SceneModeType"]["SCENE_P3D"]){this["getAngleBetweenTwoVector3"]=Y7n["CmMathEngineP3D"]["getAngleBetweenTwoVector3"];this["Geo2Cartesian"]=Y7n["CmMathEngineP3D"]["Geo2Cartesian"];this["Cartesian2Geo"]=Y7n["CmMathEngineP3D"]["Cartesian2Geo"];this["getRowFromLatitude"]=Y7n["CmMathEngineP3D"]["getRowFromLatitude"];this["getColFromLongitude"]=Y7n["CmMathEngineP3D"]["getColFromLongitude"];this["getBoundFromRowCol"]=Y7n["CmMathEngineP3D"]["getBoundFromRowCol"];J8n["option"]["EarthRadius"]=0;}else if(Z8n==Y7n["SceneModeType"]["SCENE_P2D"]){this["getAngleBetweenTwoVector3"]=Y7n["CmMathEngineP2D"]["getAngleBetweenTwoVector3"];this["Geo2Cartesian"]=Y7n["CmMathEngineP2D"]["Geo2Cartesian"];this["Cartesian2Geo"]=Y7n["CmMathEngineP2D"]["Cartesian2Geo"];this["getRowFromLatitude"]=Y7n["CmMathEngineP2D"]["getRowFromLatitude"];this["getColFromLongitude"]=Y7n["CmMathEngineP2D"]["getColFromLongitude"];this["getBoundFromRowCol"]=Y7n["CmMathEngineP2D"]["getBoundFromRowCol"];J8n["option"]["EarthRadius"]=0;}};r7n["polygonArea"]=function(S8n,I8n,w8n){var i8n,p8n;i8n=0;p8n=w8n-1;for(var x8n=0;x8n<w8n;x8n++){i8n=i8n+(S8n[p8n]+S8n[x8n])*(I8n[p8n]-I8n[x8n]);p8n=x8n;}return i8n/2;};r7n["polygonAreaByVector2"]=function(e8n){var h8n,j8n;h8n=0;j8n=e8n["length"]-1;for(var v8n=0;v8n<e8n["length"];v8n++){h8n=h8n+(e8n[j8n]["x"]+e8n[v8n]["x"])*(e8n[j8n]["y"]-e8n[v8n]["y"]);j8n=v8n;}return h8n/2;};r7n["geodesicArea"]=function(b8n){var d8n,u8n,K8n,N8n,P8n;d8n=b8n["length"],u8n=0.0,K8n=r7n["Deg2Rad"];if(d8n>2){for(var c8n=0;c8n<d8n;c8n++){N8n=b8n[c8n];P8n=b8n[(c8n+1)%d8n];u8n+=(P8n["x"]-N8n["x"])*K8n*(2+Math["sin"](N8n["y"]*K8n)+Math["sin"](P8n["y"]*K8n));}u8n=u8n*Y7n["cm_const"]["EarthRadius"]*Y7n["cm_const"]["EarthRadius"]/2.0;}return Math["abs"](u8n);};r7n["getPosInPolyLine"]=function(q8n,H4n){var B8n,Q8n,L4n,k4n,m4n,f8n;B8n={};B8n["success"]=false;B8n["over"]=false;if(q8n==null)return B8n;if(q8n["length"]<2){if(q8n["length"]==1)return B8n;return B8n;}Q8n=0;L4n=true;k4n=0;while(q8n["length"]-1>Q8n){m4n=q8n[Q8n+1]["distanceTo"](q8n[Q8n]);if(H4n>=k4n+m4n){k4n+=m4n;Q8n++;continue;}else{H4n-=k4n;if(H4n>m4n){B8n["over"]=true;B8n["pos"]=q8n[Q8n+1];}else{f8n=new THREE["Vector3"]();f8n["subVectors"](q8n[Q8n+1],q8n[Q8n]);f8n=f8n["setLength"](H4n);B8n["pos"]=f8n["addVectors"](q8n[Q8n],f8n);B8n["success"]=true;return B8n;}}}return B8n;};r7n["toEulerianAngle"]=function(V4n){var y4n,s4n,Y4n,l4n,E4n,r4n,F4n;y4n=new THREE["Vector3"]();s4n=V4n["y"]*V4n["y"];Y4n=+2.0*(V4n["w"]*V4n["x"]+V4n["y"]*V4n["z"]);l4n=+1.0-2.0*(V4n["x"]*V4n["x"]+s4n);y4n["x"]=Math["atan2"](Y4n,l4n);E4n=+2.0*(V4n["w"]*V4n["y"]-V4n["z"]*V4n["x"]);E4n=E4n>1.0?1.0:E4n;E4n=E4n<-1.0?-1.0:E4n;y4n["y"]=Math["asin"](E4n);r4n=+2.0*(V4n["w"]*V4n["z"]+V4n["x"]*V4n["y"]);F4n=+1.0-2.0*(s4n+V4n["z"]*V4n["z"]);y4n["z"]=Math["atan2"](r4n,F4n);return y4n;};return r7n;}();l7n["PI"]=Y7n["cm_const"]["PI"];l7n["Rad2Deg"]=Y7n["cm_const"]["Rad2Deg"];l7n["Deg2Rad"]=Y7n["cm_const"]["Deg2Rad"];l7n["Tan30"]=Y7n["cm_const"]["Tan30"];l7n["Tan60"]=Y7n["cm_const"]["Tan60"];l7n["Vector3Zero"]=new THREE["Vector3"](0,0,0);l7n["m_MeterPerSec"]=2*Y7n["cm_const"]["PI"]*Y7n["cm_const"]["EarthRadius"]/360.0;l7n["MultiplyQuaternionVector"]=function(G4n,M4n){var W4n,U4n,C4n,D4n;C4n=new THREE["Vector3"](G4n["x"],G4n["y"],G4n["z"]);W4n=C4n["clone"]();W4n["cross"](M4n);U4n=C4n["clone"]();U4n["cross"](W4n);W4n["x"]*=2.0*G4n["w"];W4n["y"]*=2.0*G4n["w"];W4n["z"]*=2.0*G4n["w"];U4n["x"]*=2.0;U4n["y"]*=2.0;U4n["z"]*=2.0;D4n=new THREE["Vector3"](M4n["x"]+W4n["x"]+U4n["x"],M4n["y"]+W4n["y"]+U4n["y"],M4n["z"]+W4n["z"]+U4n["z"]);return D4n;};Y7n["CmMathEngine"]=l7n;}(CMWORLD||(CMWORLD={})));(function(z4n){var A4n;A4n=function(){n4n["arcCalc"]=function(R4n,g4n,X4n,T4n){var a4n,t4n,O4n,o4n;a4n=R4n*X4n+g4n*T4n;t4n=Math["sqrt"](R4n*R4n+g4n*g4n);O4n=Math["sqrt"](X4n*X4n+T4n*T4n);R4n=R4n/t4n;g4n=g4n/t4n;X4n=X4n/O4n;T4n=T4n/O4n;a4n=R4n*X4n+g4n*T4n;o4n=Math["acos"](a4n)*180/Math["PI"];return o4n;};function n4n(){}return n4n;}();z4n["MathEngine2d"]=A4n;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var J4n;J4n=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(Z4n,x4n){Z4n["__proto__"]=x4n;}||function(S4n,p4n){for(var i4n in p4n)if(p4n["hasOwnProperty"](i4n))S4n[i4n]=p4n[i4n];};return function(w4n,I4n){J4n(w4n,I4n);w4n["prototype"]=I4n===null?Object["create"](I4n):(e4n["prototype"]=I4n["prototype"],new e4n());function e4n(){this["constructor"]=w4n;}};}();(function(v4n){var h4n;h4n=function(u4n){__extends(j4n,u4n);j4n["getRowFromLatitude"]=function(c4n,d4n){return Math["floor"]((c4n+90.0000001)/d4n);};j4n["getColFromLongitude"]=function(K4n,b4n){return Math["floor"]((K4n+180.0000001)/b4n);};function j4n(){return u4n["call"](this)||this;}j4n["getBoundFromRowCol"]=function(Q4n,B4n,q4n){var P4n,N4n;P4n=v4n["CmWorld3"]["getInstance"]()["option"]["TileLevelRange"][Q4n];N4n=new v4n["CoordBound"]();N4n["West"]=-180+q4n*P4n;N4n["East"]=-180+(q4n+1)*P4n;N4n["South"]=-90+B4n*P4n;N4n["North"]=-90+(B4n+1)*P4n;return N4n;};j4n["getRotateQuat"]=function(m2n,L2n){var f4n,H2n,k2n;f4n=new THREE["Quaternion"]();H2n=new THREE["Quaternion"]();H2n["setFromAxisAngle"](v4n["CmCameraGlobe"]["getYAxis"](),-(180-m2n)*v4n["CmMathEngine"]["Deg2Rad"]);f4n["setFromAxisAngle"](v4n["CmCameraGlobe"]["getXAxis"](),-L2n*v4n["CmMathEngine"]["Deg2Rad"]);k2n=THREE["Quaternion"]["prototype"]["multiplyQuaternions"](H2n,f4n);return k2n;};return j4n;}(v4n["CmMathEngine"]);v4n["CmMathEngineS3D"]=h4n;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var V2n;V2n=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(E2n,y2n){E2n["__proto__"]=y2n;}||function(l2n,Y2n){for(var s2n in Y2n)if(Y2n["hasOwnProperty"](s2n))l2n[s2n]=Y2n[s2n];};return function(F2n,r2n){function W2n(){this["constructor"]=F2n;}V2n(F2n,r2n);F2n["prototype"]=r2n===null?Object["create"](r2n):(W2n["prototype"]=r2n["prototype"],new W2n());};}();(function(U2n){var G2n;G2n=function(C2n){__extends(M2n,C2n);M2n["getAngleBetweenTwoVector3"]=function(g2n,X2n){var D2n,A2n,z2n,n2n,R2n;D2n=g2n["clone"]();A2n=X2n["clone"]();D2n["normalize"]();A2n["normalize"]();z2n=D2n["dot"](A2n);n2n=Math["acos"](z2n);R2n=n2n*U2n["CmMathEngine"]["Rad2Deg"];return R2n;};M2n["Geo2Cartesian"]=function(o2n,J2n,Z2n){var T2n,a2n,t2n,O2n;T2n=new THREE["Vector3"](0,0,0);a2n=0;t2n=0;O2n=0;a2n=(o2n+180.0)*U2n["CmMathEngine"]["m_MeterPerSec"];t2n=(J2n+90.0)*U2n["CmMathEngine"]["m_MeterPerSec"];O2n=Z2n;T2n["x"]=a2n;T2n["y"]=t2n;T2n["z"]=O2n;return T2n;};M2n["Cartesian2Geo"]=function(S2n,I2n,w2n){var x2n,i2n,p2n;x2n=0;i2n=0;p2n=0;x2n=S2n/U2n["CmMathEngine"]["m_MeterPerSec"]-180;i2n=I2n/U2n["CmMathEngine"]["m_MeterPerSec"]-90;p2n=w2n;return new THREE["Vector3"](x2n,i2n,p2n);};M2n["getRowFromLatitude"]=function(e2n,v2n){return Math["floor"]((e2n+90.0000001)/v2n);};M2n["getColFromLongitude"]=function(h2n,j2n){return Math["floor"]((h2n+180.0000001)/j2n);};M2n["getBoundFromRowCol"]=function(b2n,d2n,K2n){var c2n,u2n;c2n=U2n["CmWorld3"]["getInstance"]()["option"]["TileLevelRange"][b2n];u2n=new U2n["CoordBound"]();u2n["West"]=-180+K2n*c2n;u2n["East"]=-180+(K2n+1)*c2n;u2n["South"]=-90+d2n*c2n;u2n["North"]=-90+(d2n+1)*c2n;return u2n;};function M2n(){return C2n["call"](this)||this;}M2n["rotateAroundLocalAxis"]=function(N2n,f2n,H1n,k1n,L1n,m1n){var B2n,P2n,q2n,Q2n;B2n=new THREE["Vector3"]();B2n["copy"](N2n["position"])["sub"](f2n);P2n=H1n["clone"]();P2n["applyMatrix4"](N2n["matrix"]);P2n["sub"](N2n["position"]);P2n["normalize"]();q2n=new THREE["Quaternion"]();q2n["setFromAxisAngle"](P2n,k1n);B2n=U2n["CmMathEngine"]["MultiplyQuaternionVector"](q2n,B2n);P2n=U2n["CmMathEngine"]["MultiplyQuaternionVector"](q2n,N2n["up"]);N2n["up"]["set"](P2n["x"],P2n["y"],P2n["z"]);N2n["position"]["addVectors"](f2n,B2n);Q2n=new THREE["Matrix4"]();Q2n["makeRotationFromQuaternion"](q2n);Q2n["multiply"](N2n["matrix"]);N2n["matrix"]=Q2n;N2n["rotation"]["setFromRotationMatrix"](N2n["matrix"]);};M2n["prototype"]["rotateAroundWorldAxis"]=function(V1n,l1n,r1n,F1n,U1n,W1n){var y1n,E1n,s1n,Y1n;y1n=new THREE["Vector3"]();y1n["copy"](V1n["position"])["sub"](l1n);E1n=r1n["clone"]();s1n=new THREE["Quaternion"]();s1n["setFromAxisAngle"](E1n,F1n);y1n=U2n["CmMathEngine"]["MultiplyQuaternionVector"](s1n,y1n);E1n=U2n["CmMathEngine"]["MultiplyQuaternionVector"](s1n,V1n["up"]);V1n["up"]["set"](E1n["x"],E1n["y"],E1n["z"]);V1n["position"]["addVectors"](l1n,y1n);Y1n=new THREE["Matrix4"]();Y1n["makeRotationFromQuaternion"](s1n);Y1n["multiply"](V1n["matrix"]);V1n["matrix"]=Y1n;V1n["rotation"]["setFromRotationMatrix"](V1n["matrix"]);};M2n["CalcRotatePosition"]=function(M1n,D1n,A1n){var G1n,C1n;M1n["normalize"]();G1n=new THREE["Quaternion"]();G1n["setFromAxisAngle"](M1n,A1n*U2n["CmMathEngine"]["Deg2Rad"]);C1n=U2n["CmMathEngine"]["MultiplyQuaternionVector"](G1n,D1n);return C1n;};M2n["prototype"]["does_ray_intersect_sphere"]=function(X1n,T1n,a1n,g1n){var z1n,R1n,n1n;z1n=THREE["Vector3"]["prototype"]["subVectors"](X1n,a1n);R1n=z1n["dot"](z1n);g1n*g1n;if(R1n<=0.0)return true;n1n=z1n["dot"](T1n);if(n1n>0.0)return false;return n1n*n1n-R1n>=0.0;};M2n["prototype"]["does_line_segment_intersect_sphere"]=function(S1n,v1n,e1n,w1n){var o1n,i1n,J1n,O1n,I1n,t1n,p1n,x1n,Z1n;o1n=THREE["Vector3"]["prototype"]["subVectors"](S1n,e1n);i1n=o1n["dot"](o1n)-w1n*w1n;if(i1n<=0.0)return true;J1n=THREE["Vector3"]["prototype"]["subVectors"](v1n,S1n);O1n=J1n["length"]();if(O1n==0.0)return false;I1n=J1n["divideScalar"](O1n);t1n=o1n["dot"](I1n);if(t1n>0.0)return false;p1n=Math["sqrt"](t1n*t1n-i1n);x1n=-t1n+p1n;if(x1n>=0.0&&x1n<=O1n)return true;Z1n=-t1n-p1n;if(Z1n>=0.0&&Z1n<=O1n)return true;};return M2n;}(U2n["CmMathEngine"]);G2n["MultiplyQuaternionVector"]=function(u1n,c1n){var h1n,j1n,d1n,K1n;d1n=new THREE["Vector3"](u1n["x"],u1n["y"],u1n["z"]);h1n=d1n["clone"]();h1n["cross"](c1n);j1n=d1n["clone"]();j1n["cross"](h1n);h1n["x"]*=2.0*u1n["w"];h1n["y"]*=2.0*u1n["w"];h1n["z"]*=2.0*u1n["w"];j1n["x"]*=2.0;j1n["y"]*=2.0;j1n["z"]*=2.0;K1n=new THREE["Vector3"](c1n["x"]+h1n["x"]+j1n["x"],c1n["y"]+h1n["y"]+j1n["y"],c1n["z"]+h1n["z"]+j1n["z"]);return K1n;};U2n["CmMathEngineP3D"]=G2n;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var b1n;b1n=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(N1n,P1n){N1n["__proto__"]=P1n;}||function(Q1n,q1n){for(var B1n in q1n)if(q1n["hasOwnProperty"](B1n))Q1n[B1n]=q1n[B1n];};return function(H5n,f1n){function k5n(){this["constructor"]=H5n;}b1n(H5n,f1n);H5n["prototype"]=f1n===null?Object["create"](f1n):(k5n["prototype"]=f1n["prototype"],new k5n());};}();(function(m5n){var L5n;L5n=function(E5n){__extends(V5n,E5n);V5n["getAngleBetweenTwoVector3"]=function(F5n,W5n){var y5n,s5n,Y5n,l5n,r5n;y5n=F5n["clone"]();s5n=W5n["clone"]();y5n["normalize"]();s5n["normalize"]();Y5n=y5n["dot"](s5n);l5n=Math["acos"](Y5n);r5n=l5n*m5n["CmMathEngine"]["Rad2Deg"];return r5n;};V5n["Geo2Cartesian"]=function(D5n,A5n,z5n){var U5n,G5n,M5n,C5n;U5n=new THREE["Vector3"](0,0,0);G5n=0;M5n=0;C5n=0;G5n=-(D5n+180.0)*m5n["CmMathEngine"]["m_MeterPerSec"];M5n=(A5n+90.0)*m5n["CmMathEngine"]["m_MeterPerSec"];C5n=0;U5n["x"]=G5n;U5n["y"]=M5n;U5n["z"]=C5n;return U5n;};V5n["Cartesian2Geo"]=function(X5n,T5n,a5n){var n5n,R5n,g5n;n5n=0;R5n=0;g5n=0;n5n=X5n/m5n["CmMathEngine"]["m_MeterPerSec"]-180;R5n=T5n/m5n["CmMathEngine"]["m_MeterPerSec"]-90;g5n=0;return new THREE["Vector3"](n5n,R5n,g5n);};V5n["polygonArea"]=function(J5n,Z5n,x5n){var O5n,o5n;O5n=0;o5n=x5n-1;for(var t5n=0;t5n<x5n;t5n++){O5n=O5n+(J5n[o5n]+J5n[t5n])*(Z5n[o5n]-Z5n[t5n]);o5n=t5n;}return O5n/2;};V5n["getRowFromLatitude"]=function(i5n,p5n){return Math["floor"]((i5n+90.0000001)/p5n);};V5n["getColFromLongitude"]=function(S5n,I5n){return Math["floor"]((S5n+180.0000001)/I5n);};function V5n(){return E5n["call"](this)||this;}V5n["getBoundFromRowCol"]=function(u5n,v5n,h5n){var j5n,e5n,w5n;j5n=m5n["CmWorld3"]["getInstance"]();e5n=j5n["option"]["TileLevelRange"][u5n];w5n=new m5n["CoordBound"]();w5n["West"]=-180+h5n*e5n;w5n["East"]=-180+(h5n+1)*e5n;w5n["South"]=-90+v5n*e5n;w5n["North"]=-90+(v5n+1)*e5n;return w5n;};V5n["rotateAroundLocalAxis"]=function(c5n,P5n,B5n,q5n,f5n,Q5n){var K5n,d5n,b5n,N5n;K5n=new THREE["Vector3"]();K5n["copy"](c5n["position"])["sub"](P5n);d5n=B5n["clone"]();d5n["applyMatrix4"](c5n["matrix"]);d5n["sub"](c5n["position"]);d5n["normalize"]();b5n=new THREE["Quaternion"]();b5n["setFromAxisAngle"](d5n,q5n);K5n=m5n["CmMathEngine"]["MultiplyQuaternionVector"](b5n,K5n);d5n=m5n["CmMathEngine"]["MultiplyQuaternionVector"](b5n,c5n["up"]);c5n["up"]["set"](d5n["x"],d5n["y"],d5n["z"]);c5n["position"]["addVectors"](P5n,K5n);N5n=new THREE["Matrix4"]();N5n["makeRotationFromQuaternion"](b5n);N5n["multiply"](c5n["matrix"]);c5n["matrix"]=N5n;c5n["rotation"]["setFromRotationMatrix"](c5n["matrix"]);};V5n["prototype"]["rotateAroundWorldAxis"]=function(H6n,E6n,y6n,s6n,l6n,Y6n){var m6n,k6n,L6n,V6n;m6n=new THREE["Vector3"]();m6n["copy"](H6n["position"])["sub"](E6n);k6n=y6n["clone"]();L6n=new THREE["Quaternion"]();L6n["setFromAxisAngle"](k6n,s6n);m6n=m5n["CmMathEngine"]["MultiplyQuaternionVector"](L6n,m6n);k6n=m5n["CmMathEngine"]["MultiplyQuaternionVector"](L6n,H6n["up"]);H6n["up"]["set"](k6n["x"],k6n["y"],k6n["z"]);H6n["position"]["addVectors"](E6n,m6n);V6n=new THREE["Matrix4"]();V6n["makeRotationFromQuaternion"](L6n);V6n["multiply"](H6n["matrix"]);H6n["matrix"]=V6n;H6n["rotation"]["setFromRotationMatrix"](H6n["matrix"]);};V5n["CalcRotatePosition"]=function(F6n,U6n,G6n){var r6n,W6n;F6n["normalize"]();r6n=new THREE["Quaternion"]();r6n["setFromAxisAngle"](F6n,G6n*m5n["CmMathEngine"]["Deg2Rad"]);W6n=m5n["CmMathEngine"]["MultiplyQuaternionVector"](r6n,U6n);return W6n;};V5n["prototype"]["does_ray_intersect_sphere"]=function(z6n,n6n,R6n,A6n){var M6n,D6n,C6n;M6n=THREE["Vector3"]["prototype"]["subVectors"](z6n,R6n);D6n=M6n["dot"](M6n);A6n*A6n;if(D6n<=0.0)return true;C6n=M6n["dot"](n6n);if(C6n>0.0)return false;return C6n*C6n-D6n>=0.0;};V5n["prototype"]["does_line_segment_intersect_sphere"]=function(Z6n,S6n,p6n,i6n){var T6n,o6n,a6n,X6n,x6n,g6n,J6n,O6n,t6n;T6n=THREE["Vector3"]["prototype"]["subVectors"](Z6n,p6n);o6n=T6n["dot"](T6n)-i6n*i6n;if(o6n<=0.0)return true;a6n=THREE["Vector3"]["prototype"]["subVectors"](S6n,Z6n);X6n=a6n["length"]();if(X6n==0.0)return false;x6n=a6n["divideScalar"](X6n);g6n=T6n["dot"](x6n);if(g6n>0.0)return false;J6n=Math["sqrt"](g6n*g6n-o6n);O6n=-g6n+J6n;if(O6n>=0.0&&O6n<=X6n)return true;t6n=-g6n-J6n;if(t6n>=0.0&&t6n<=X6n)return true;};return V5n;}(m5n["CmMathEngine"]);L5n["MultiplyQuaternionVector"]=function(e6n,v6n){var I6n,w6n,h6n,j6n;h6n=new THREE["Vector3"](e6n["x"],e6n["y"],e6n["z"]);I6n=h6n["clone"]();I6n["cross"](v6n);w6n=h6n["clone"]();w6n["cross"](I6n);I6n["x"]*=2.0*e6n["w"];I6n["y"]*=2.0*e6n["w"];I6n["z"]*=2.0*e6n["w"];w6n["x"]*=2.0;w6n["y"]*=2.0;w6n["z"]*=2.0;j6n=new THREE["Vector3"](v6n["x"]+I6n["x"]+w6n["x"],v6n["y"]+I6n["y"]+w6n["y"],v6n["z"]+I6n["z"]+w6n["z"]);return j6n;};m5n["CmMathEngineP2D"]=L5n;}(CMWORLD||(CMWORLD={})));(function(u6n){var c6n;c6n=function(){d6n["prototype"]["set"]=function(K6n,b6n,N6n,P6n){this["West"]=K6n;this["East"]=b6n;this["South"]=N6n;this["North"]=P6n;};d6n["prototype"]["getCenter"]=function(){return new THREE["Vector2"]((this["West"]+this["East"])*0.5,(this["South"]+this["North"])*0.5);};d6n["prototype"]["isIntersect"]=function(B6n){if(u6n["Util"]["isDefined"](B6n)){if(this["West"]>B6n["East"])return false;if(this["East"]<B6n["West"])return false;if(this["South"]>B6n["North"])return false;if(this["North"]<B6n["South"])return false;return true;}return false;};d6n["prototype"]["toRectangle"]=function(){var q6n;q6n=new u6n["Rectangle"]();q6n["setRectangle"](this["West"],this["South"],this["East"],this["North"]);return q6n;};function d6n(){this["West"]=180;this["East"]=-180;this["South"]=90;this["North"]=-90;}d6n["fromRectangle"]=function(Q6n){var f6n;if(u6n["Util"]["isDefined"](Q6n)==false)return null;f6n=new u6n["CoordBound"]();f6n["set"](Q6n["x"],Q6n["x2"],Q6n["y"],Q6n["y2"]);return f6n;};return d6n;}();u6n["CoordBound"]=c6n;}(CMWORLD||(CMWORLD={})));(function(H9n){var k9n;k9n=function(){m9n["prototype"]["getDistanceFromLook"]=function(){return this["distanceFromLook"];};m9n["prototype"]["setDistanceFromLook"]=function(L9n){if(L9n<0.1)return;this["distanceFromLook"]=L9n;};m9n["prototype"]["initPosition"]=function(V9n,E9n,y9n,s9n,Y9n){console["warn"]("not implement.");};m9n["prototype"]["commit"]=function(){console["warn"]("not implement.");};function m9n(){this["viewer"]=null;this["head"]=0.0;this["tilt"]=0.0;this["position"]=new THREE["Vector3"](0,0,0);this["positionGeo"]=new THREE["Vector3"](0,0,0);this["distanceFromLook"]=H9n["cm_const"]["EarthRadius"]*1.3;this["eventCommited"]=null;}return m9n;}();H9n["Camera"]=k9n;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var l9n;l9n=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(r9n,F9n){r9n["__proto__"]=F9n;}||function(G9n,U9n){for(var W9n in U9n)if(U9n["hasOwnProperty"](W9n))G9n[W9n]=U9n[W9n];};return function(C9n,M9n){function D9n(){this["constructor"]=C9n;}l9n(C9n,M9n);C9n["prototype"]=M9n===null?Object["create"](M9n):(D9n["prototype"]=M9n["prototype"],new D9n());};}();(function(A9n){var n9n,R9n,g9n,z9n;n9n=new THREE["Vector3"](1,0,0);R9n=new THREE["Vector3"](1,0,0);g9n=new THREE["Vector3"](1,0,0);z9n=function(T9n){__extends(X9n,T9n);X9n["getXAxis"]=function(){return new THREE["Vector3"](1,0,0);};X9n["getYAxis"]=function(){return new THREE["Vector3"](0,1,0);};X9n["getZAxis"]=function(){return new THREE["Vector3"](0,0,1);};X9n["getZeroLatitudeAxis"]=function(){return new THREE["Vector3"](0,0,-1);};X9n["prototype"]["getThreejsCamera"]=function(){return this["mainCamera"];};X9n["prototype"]["getProjectionMatrix"]=function(){return this["mainCamera"]["projectionMatrix"];};X9n["prototype"]["getViewMatrix"]=function(){return this["mainCamera"]["matrixWorldInverse"];};X9n["prototype"]["init"]=function(){var O9n;O9n=A9n["CmWorld3"]["getInstance"]();this["viewer"]=O9n;this["setAspect"](O9n["canvas"]["width"],O9n["canvas"]["height"]);this["head"]=0.0;this["tilt"]=0.0;this["distanceFromLook"]=A9n["cm_const"]["EarthRadius"]*1.3;this["positionGeo"]=new THREE["Vector3"](0,0,this["distanceFromLook"]);O9n["preUpdateEvent"]["removeEventListener"](this["beforeUpdate"]);O9n["preUpdateEvent"]["addEventListener"](this["beforeUpdate"],this);O9n["postUpdateEvent"]["removeEventListener"](this["afterUpdate"]);O9n["postUpdateEvent"]["addEventListener"](this["afterUpdate"],this);};X9n["prototype"]["getDirection"]=function(){return this["direction"]["clone"]();};X9n["prototype"]["getAltitude"]=function(){var o9n;o9n=this["viewer"];return this["cameraPositionGeo"]["z"]-A9n["cm_const"]["EarthRadius"];};X9n["prototype"]["getAltitudeFromGround"]=function(){var J9n;J9n=this["getAltitude"]();return J9n;};X9n["prototype"]["getDistanceFromEarthCenter"]=function(){return this["cameraPositionGeo"]["z"];};X9n["prototype"]["getPositionGeo"]=function(){return this["cameraPositionGeo"]["clone"]();};X9n["prototype"]["getPositionWorld"]=function(){return this["cameraPositionWorld"]["clone"]();};X9n["prototype"]["getLookPositionGeo"]=function(){var Z9n;Z9n=this["lookAtPositionGeo"]["clone"]();Z9n["z"]-=A9n["cm_const"]["EarthRadius"];return Z9n;};X9n["prototype"]["getLookPositionWorld"]=function(){return this["lookAtPositionWorld"]["clone"]();};X9n["prototype"]["setPositionGeo"]=function(i9n,p9n,S9n){var I9n,x9n;I9n=this["viewer"];x9n=this["getLookPositionGeo"]();this["setEyeLookPosition"](x9n["x"],x9n["y"],x9n["z"]-A9n["cm_const"]["EarthRadius"],i9n,p9n,S9n);};X9n["prototype"]["setLookPositionGeo"]=function(w9n,e9n,v9n){var h9n;h9n=this["viewer"];this["setEyeLookPosition"](w9n,e9n,v9n,this["cameraPositionGeo"]["x"],this["cameraPositionGeo"]["y"],this["cameraPositionGeo"]["z"]-A9n["cm_const"]["EarthRadius"]);};X9n["prototype"]["gotoGeo"]=function(c9n,d9n,j9n,u9n){if(u9n===void 0){u9n=true;}if(j9n==null||isNaN(j9n)){}else{this["setDistanceFromLook"](j9n);}this["initPosition"](c9n,d9n,j9n,this["head"],this["tilt"]);this["commit"]();};X9n["prototype"]["getDistanceToWorldPos"]=function(K9n){return this["position"]["distanceTo"](K9n);};X9n["prototype"]["setEyeLookPosition"]=function(H0n,Q9n,s0n,y0n,E0n,V0n){var L0n,f9n,B9n,P9n,k0n,m0n,q9n,b9n,N9n;L0n=this["viewer"];f9n=A9n["CmMathEngine"]["Geo2Cartesian"](H0n,Q9n,A9n["cm_const"]["EarthRadius"]+s0n);B9n=A9n["CmMathEngine"]["Geo2Cartesian"](y0n,E0n,A9n["cm_const"]["EarthRadius"]+V0n);P9n=X9n["calcHeadingTilt"](B9n,f9n);k0n=P9n["x"];m0n=P9n["y"];q9n=P9n["z"];b9n=A9n["CmMathEngine"]["FindLineSphereIntersections"](B9n,f9n,new THREE["Vector3"](0,0,0),A9n["cm_const"]["EarthRadius"]);if(b9n&&b9n["length"]>0){N9n=A9n["CmMathEngine"]["Cartesian2Geo"](b9n[0]["x"],b9n[0]["y"],b9n[0]["z"]);H0n=N9n["x"];Q9n=N9n["y"];q9n=B9n["sub"](N9n)["length"]();}else{}this["initPosition"](H0n,Q9n,q9n,k0n,m0n);};X9n["prototype"]["gotoTarget"]=function(Y0n,l0n,r0n,F0n,W0n,U0n){this["setEyeLookPosition"](Y0n,l0n,r0n,F0n,W0n,U0n);this["commit"]();};X9n["calcLocalWorldHeadingTilt"]=function(X0n,T0n){var C0n,R0n,A0n,D0n,M0n,g0n,n0n,G0n,z0n;C0n=X0n["sub"](T0n);R0n=C0n["length"]();A0n=0;D0n=0;if(true){M0n=C0n["clone"]();M0n["normalize"]();g0n=X9n["getZAxis"]();n0n=g0n["dot"](M0n);if(Math["abs"](n0n)>0.9999){A0n=0;}else{M0n=new THREE["Vector3"](C0n["x"],C0n["y"],0);M0n["normalize"]();G0n=A9n["CmMathEngine"]["getAngleBetweenTwoVector3"](X9n["getYAxis"](),M0n);if(M0n["x"]>0)G0n=180-G0n;else G0n=180+G0n;A0n=G0n;}}if(true){M0n=new THREE["Vector3"](C0n["x"],C0n["y"],0);G0n=A9n["CmMathEngine"]["getAngleBetweenTwoVector3"](C0n,M0n);if(C0n["z"]<0){D0n=-(90-G0n);}else{D0n=-90-G0n;}}z0n=new THREE["Vector3"](A0n,D0n,R0n);return z0n;};X9n["calcHeadingTilt"]=function(J0n,Z0n){var x0n,i0n,p0n,t0n,a0n,O0n,o0n;x0n=0;i0n=0;p0n=0;t0n=J0n["clone"]();a0n=Z0n["clone"]();O0n=A9n["CmMathEngine"]["Cartesian2Geo"](a0n["x"],a0n["y"],a0n["z"]);o0n=X9n["calcInverseRotationtoPlane"](O0n["x"],O0n["y"]);t0n=t0n["applyMatrix4"](o0n);a0n=a0n["applyMatrix4"](o0n);return X9n["calcLocalWorldHeadingTilt"](t0n,a0n);};X9n["prototype"]["attachToScene"]=function(S0n){if(S0n!=null){S0n["add"](this["mainCamera"]);S0n["add"](this["mainCameraForPicking"]);}};X9n["prototype"]["detachToScene"]=function(I0n){if(I0n!=null){I0n["remove"](this["mainCamera"]);I0n["remove"](this["mainCameraForPicking"]);}};X9n["prototype"]["setAspect"]=function(w0n,e0n){this["mainCamera"]["aspect"]=w0n/e0n;this["mainCamera"]["updateProjectionMatrix"]();this["mainCameraForPicking"]["aspect"]=w0n/e0n;this["mainCameraForPicking"]["updateProjectionMatrix"]();};X9n["prototype"]["GetLookPosition"]=function(v0n){if(v0n==A9n["GlobeCoordinateSystem"]["Geodetic"])return this["positionGeo"]["clone"]();return this["position"]["clone"]();};X9n["prototype"]["getDirectionForward"]=function(){var h0n;h0n=new THREE["Vector3"]();h0n=this["mainCamera"]["getWorldDirection"](h0n);return h0n;};X9n["prototype"]["getDirectionRight"]=function(){var j0n,u0n;j0n=X9n["getXAxis"]();u0n=this["mainCamera"]["matrix"];u0n["setPosition"](new THREE["Vector3"](0,0,0));j0n["applyMatrix4"](u0n);return j0n;};X9n["prototype"]["getDirectionUp"]=function(){var c0n,d0n;c0n=X9n["getYAxis"]();d0n=this["mainCamera"]["matrix"];d0n["setPosition"](new THREE["Vector3"](0,0,0));c0n["applyMatrix4"](d0n);return c0n;};X9n["prototype"]["setLookAltitude"]=function(K0n){this["lookAtPositionGeo"]["z"]=K0n;};X9n["prototype"]["initPosition"]=function(B0n,q0n,b0n,N0n,P0n){var Q0n;Q0n=this["viewer"];{if(isNaN(q0n))q0n=this["positionGeo"]["y"];if(isNaN(B0n))B0n=this["positionGeo"]["x"];if(b0n==null||isNaN(b0n))b0n=this["positionGeo"]["z"]-A9n["cm_const"]["EarthRadius"];if(N0n==null||isNaN(N0n))N0n=this["head"];if(P0n==null||isNaN(P0n))P0n=this["tilt"];if(b0n>Q0n["option"]["maxAltitude"]){b0n=Q0n["option"]["maxAltitude"];}}this["head"]=N0n;this["tilt"]=P0n;this["positionGeo"]=new THREE["Vector3"](B0n,q0n,A9n["cm_const"]["EarthRadius"]);this["setDistanceFromLook"](b0n);this["commit"]();};function X9n(t9n){var a9n;a9n=T9n["call"](this)||this;a9n["viewRange"]=0;a9n["testnumber"]=-10;a9n["panningMode"]=A9n["GlobePanningMode"]["AnyRotation"];a9n["cameraPositionWorld"]=new THREE["Vector3"](0,0,0);a9n["cameraPositionGeo"]=new THREE["Vector3"](0,0,0);a9n["lookAtPositionWorld"]=new THREE["Vector3"](0,0,0);a9n["lookAtPositionGeo"]=new THREE["Vector3"](0,0,0);a9n["mainCamera"]=new THREE["PerspectiveCamera"](45,A9n["CmWorld3"]["getInstance"]()["canvas"]["width"]/A9n["CmWorld3"]["getInstance"]()["canvas"]["height"],1,A9n["cm_const"]["EarthRadius"]*2);a9n["mainCameraForPicking"]=new THREE["PerspectiveCamera"](45,A9n["CmWorld3"]["getInstance"]()["canvas"]["width"]/A9n["CmWorld3"]["getInstance"]()["canvas"]["height"],1000,A9n["cm_const"]["EarthRadius"]*2);a9n["raycaster"]=new THREE["Raycaster"]();a9n["isGoing"]=false;a9n["direction"]=new THREE["Vector3"](0,0,1);a9n["positionChangedEvent"]=new A9n["Event"](null);if(A9n["Util"]["isDefined"](t9n)==false){console["error"]("map을 반드시 지정하여야 합니다.");}a9n["viewer"]=t9n;a9n["init"]();return a9n;}X9n["prototype"]["setPosition_1"]=function(f0n,H7U,k7U){this["initPosition"](f0n,H7U,k7U,null,null);};X9n["prototype"]["getHitCoordinate"]=function(y7U,s7U,L7U,V7U){var E7U,m7U;if(L7U===void 0){L7U=true;}if(V7U===void 0){V7U=true;}E7U=new THREE["Vector2"](y7U,s7U);m7U=this["getHitPositionOnGround"](E7U,V7U);if(m7U==null){}else{if(L7U)m7U=A9n["CmMathEngine"]["Cartesian2Geo"](m7U["x"],m7U["y"],m7U["z"]);}return m7U;};X9n["prototype"]["GetCameraRay"]=function(U7U,r7U,F7U){var W7U,Y7U,l7U;W7U=this["getRayCasterFromScreenCoordinate"](U7U["x"],U7U["y"]);Y7U=W7U["ray"]["origin"]["clone"]();l7U=W7U["ray"]["direction"]["clone"]();r7U["x"]=Y7U["x"];r7U["y"]=Y7U["y"];r7U["z"]=Y7U["z"];F7U["x"]=l7U["x"];F7U["y"]=l7U["y"];F7U["z"]=l7U["z"];};X9n["prototype"]["getRayCasterFromScreenCoordinate"]=function(C7U,D7U){var G7U,M7U;G7U=new THREE["Raycaster"]();M7U=A9n["CmWorld3"]["getInstance"]()["NormalizeScreenCoord"](C7U,D7U);G7U["setFromCamera"](M7U,this["mainCameraForPicking"]);return G7U;};X9n["prototype"]["pickingByScreenCoordinateInArray"]=function(R7U,g7U,A7U){var n7U,z7U;if(A7U==null||A7U["length"]<1)return null;n7U=this["getRayCasterFromScreenCoordinate"](R7U,g7U);z7U=n7U["intersectObjects"](A7U,true);if(z7U["length"]>0){return z7U;}return null;};X9n["prototype"]["getHitPositionOnGround"]=function(e7U,S7U){var a7U,T7U,u7U,J7U,h7U,v7U,X7U,t7U,w7U,I7U,p7U,i7U,x7U,O7U,j7U,c7U,o7U;if(S7U===void 0){S7U=true;}a7U=this["viewer"];if(a7U["option"]["enablePreciseTerrainCoordinate"])S7U=false;T7U=null;if(S7U==false){u7U=a7U["NormalizeScreenCoord"](e7U["x"],e7U["y"]);this["raycaster"]["setFromCamera"](u7U,this["mainCameraForPicking"]);J7U=this["raycaster"]["intersectObjects"](a7U["getTerrainScene"]()["children"]);if(J7U["length"]>0){T7U=new THREE["Vector3"]();}for(var Z7U=0;Z7U<J7U["length"];Z7U++){T7U=J7U[Z7U]["point"]["clone"]();T7U["x"]+=a7U["option"]["refCenter"]["x"];T7U["y"]+=a7U["option"]["refCenter"]["y"];T7U["z"]+=a7U["option"]["refCenter"]["z"];return T7U;}if(T7U!=null){T7U["x"]+=a7U["option"]["refCenter"]["x"];T7U["y"]+=a7U["option"]["refCenter"]["y"];T7U["z"]+=a7U["option"]["refCenter"]["z"];return T7U;}}h7U=new THREE["Vector3"]();v7U=new THREE["Vector3"]();this["GetCameraRay"](e7U,h7U,v7U);X7U=h7U;if(a7U["option"]["useRefCameraMode"]){X7U["add"](a7U["option"]["refCenter"]);}else{}t7U=X7U["clone"]();w7U=v7U;w7U["setLength"](A9n["cm_const"]["EarthRadius"]*2.0);t7U["add"](w7U);I7U=t7U["x"]-X7U["x"];p7U=t7U["y"]-X7U["y"];i7U=t7U["z"]-X7U["z"];x7U=I7U*I7U+p7U*p7U+i7U*i7U;O7U=2.0*(I7U*X7U["x"]+p7U*X7U["y"]+i7U*X7U["z"]);j7U=X7U["x"]*X7U["x"]+X7U["y"]*X7U["y"]+X7U["z"]*X7U["z"]-A9n["cm_const"]["EarthRadius"]*A9n["cm_const"]["EarthRadius"];c7U=O7U*O7U-4*x7U*j7U;if(c7U<=0){return null;}o7U=(-1.0*O7U-Math["sqrt"](O7U*O7U-4*x7U*j7U))/(2.0*x7U);T7U=new THREE["Vector3"](X7U["x"]+o7U*(t7U["x"]-X7U["x"]),X7U["y"]+o7U*(t7U["y"]-X7U["y"]),X7U["z"]+o7U*(t7U["z"]-X7U["z"]));return T7U;};X9n["prototype"]["getHitObjectFromScreenCoordinate"]=function(P7U,B7U){var d7U,b7U,q7U,K7U;if(B7U===void 0){B7U=false;}d7U=null;b7U=this["viewer"];q7U=b7U["NormalizeScreenCoord"](P7U["x"],P7U["y"]);this["raycaster"]["setFromCamera"](q7U,this["mainCameraForPicking"]);K7U=this["raycaster"]["intersectObjects"](b7U["getGroundScene"]()["children"],true);if(K7U["length"]>0){d7U=new THREE["Vector3"]();}else{K7U=this["raycaster"]["intersectObjects"](b7U["getUserScene"]()["children"],true);if(K7U["length"]>0){d7U=new THREE["Vector3"]();}else{K7U=this["raycaster"]["intersectObjects"](b7U["getInstantScene"]()["children"],true);if(K7U["length"]>0){d7U=new THREE["Vector3"]();}}}for(var N7U=0;N7U<K7U["length"];N7U++){d7U=K7U[N7U]["point"]["clone"]();d7U["key"]="";d7U["object"]=null;if(K7U[N7U]["object"]){d7U["object"]=K7U[N7U]["object"];if(K7U[N7U]["object"]["hasOwnProperty"]("key")){d7U["key"]=K7U[N7U]["object"]["key"];}d7U["userObject"]=null;if(K7U[N7U]["object"]["hasOwnProperty"]("userObject")){d7U["userObject"]=K7U[N7U]["object"]["userObject"];}}d7U["x"]+=b7U["option"]["refCenter"]["x"];d7U["y"]+=b7U["option"]["refCenter"]["y"];d7U["z"]+=b7U["option"]["refCenter"]["z"];return d7U;}if(d7U!=null){d7U["x"]+=b7U["option"]["refCenter"]["x"];d7U["y"]+=b7U["option"]["refCenter"]["y"];d7U["z"]+=b7U["option"]["refCenter"]["z"];return d7U;}return d7U;};X9n["prototype"]["getIntersectObjectsFromRay"]=function(V3U,Y3U){var f7U,m3U,L3U,Q7U,k3U,F3U,r3U,H3U,l3U,s3U,y3U,E3U;f7U=this["viewer"];if(f7U["getGroundScene"]()["children"]["length"]>0){m3U=V3U["clone"]();L3U=Y3U["clone"]();m3U=m3U["sub"](f7U["option"]["refCenter"]);L3U=L3U["sub"](f7U["option"]["refCenter"]);Q7U=V3U["clone"]();k3U=new THREE["Vector3"](-Q7U["x"],-Q7U["y"],-Q7U["z"]);k3U["normalize"]();{Q7U["x"]-=f7U["option"]["refCenter"]["x"];Q7U["y"]-=f7U["option"]["refCenter"]["y"];Q7U["z"]-=f7U["option"]["refCenter"]["z"];}F3U=new THREE["Raycaster"](Q7U,k3U);r3U=null;H3U=Y3U["clone"]();H3U=H3U["sub"](V3U);l3U=H3U["length"]();H3U["normalize"]();s3U=new THREE["Raycaster"](Q7U,H3U);y3U=s3U;E3U=y3U["intersectObjects"](f7U["getGroundScene"]()["children"],true);return E3U;}return null;};X9n["prototype"]["getHitPosition"]=function(C3U,z3U,D3U){var W3U,U3U,A3U,G3U;if(D3U===void 0){D3U=false;}W3U=null;U3U=this["viewer"];A3U=U3U["NormalizeScreenCoord"](C3U["x"],C3U["y"]);this["raycaster"]["setFromCamera"](A3U,this["mainCameraForPicking"]);G3U=this["raycaster"]["intersectObjects"](U3U["rootScene"]["children"],true);if(G3U["length"]>0){W3U=new THREE["Vector3"]();}for(var M3U=0;M3U<G3U["length"];M3U++){if(G3U[M3U]["object"]!=z3U){W3U=G3U[M3U]["point"]["clone"]();W3U["x"]+=U3U["option"]["refCenter"]["x"];W3U["y"]+=U3U["option"]["refCenter"]["y"];W3U["z"]+=U3U["option"]["refCenter"]["z"];return W3U;}}if(W3U!=null){W3U["x"]+=U3U["option"]["refCenter"]["x"];W3U["y"]+=U3U["option"]["refCenter"]["y"];W3U["z"]+=U3U["option"]["refCenter"]["z"];return W3U;}return W3U;};X9n["prototype"]["getIntersectObjects"]=function(R3U,g3U){var a3U,n3U,X3U,T3U;if(g3U===void 0){g3U=false;}a3U=null;n3U=this["viewer"];X3U=n3U["NormalizeScreenCoord"](R3U["x"],R3U["y"]);this["raycaster"]["setFromCamera"](X3U,this["mainCameraForPicking"]);T3U=this["raycaster"]["intersectObjects"](n3U["rootScene"]["children"],true);return T3U;};X9n["prototype"]["panning"]=function(j3U,c3U,I3U,w3U){var H8U,f3U,Q3U,d3U,q3U,B3U,P3U,N3U,h3U,S3U,i3U,b3U,p3U,K3U,J3U,v3U,x3U,o3U,Z3U,O3U,t3U,e3U,u3U;H8U=I3U-j3U;f3U=w3U-c3U;if(H8U==0&&f3U==0)return;Q3U=this["viewer"];if(this["panningMode"]==A9n["GlobePanningMode"]["AnyRotation"]){d3U=this["distanceFromLook"]*A9n["CmMathEngine"]["Tan30"]*(0.00000003/Q3U["option"]["GlobalScale"]);q3U=(c3U-w3U)*d3U;B3U=(j3U-I3U)*d3U;P3U=this["getDirectionRight"]();N3U=this["getDirectionUp"]();h3U=new THREE["Quaternion"]();S3U=new THREE["Quaternion"]();h3U["setFromAxisAngle"](P3U,q3U*A9n["CmMathEngine"]["Deg2Rad"]);S3U["setFromAxisAngle"](N3U,B3U*A9n["CmMathEngine"]["Deg2Rad"]);i3U=THREE["Quaternion"]["prototype"]["multiplyQuaternions"](h3U,S3U);b3U=A9n["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],A9n["cm_const"]["EarthRadius"]);p3U=A9n["CmMathEngine"]["MultiplyQuaternionVector"](i3U,this["position"]);K3U=A9n["CmMathEngine"]["MultiplyQuaternionVector"](i3U,this["mainCamera"]["up"]);J3U=A9n["CmMathEngine"]["MultiplyQuaternionVector"](i3U,b3U);v3U=A9n["CmMathEngine"]["Cartesian2Geo"](J3U["x"],J3U["y"],J3U["z"]);this["positionGeo"]["x"]=v3U["x"];this["positionGeo"]["y"]=v3U["y"];{x3U=X9n["calcInverseRotationtoPlane"](this["positionGeo"]["x"],this["positionGeo"]["y"]);p3U=p3U["applyMatrix4"](x3U);J3U=J3U["applyMatrix4"](x3U);K3U["applyMatrix4"](x3U);{o3U=p3U["sub"](J3U);o3U["set"](o3U["x"],o3U["y"],0);o3U["normalize"]();Z3U=A9n["CmMathEngine"]["getAngleBetweenTwoVector3"](X9n["getYAxis"](),o3U);if(o3U["x"]>0)Z3U=180-Z3U;else Z3U=180+Z3U;this["head"]=Z3U;}}}else{O3U=this["getHitCoordinate"](j3U,c3U,true);t3U=this["getHitCoordinate"](I3U,w3U,true);if(O3U!=null&&t3U!=null){if(t3U["y"]>O3U["y"])e3U=Math["abs"](O3U["y"]-t3U["y"]);else e3U=-Math["abs"](O3U["y"]-t3U["y"]);if(t3U["x"]>O3U["x"])u3U=Math["abs"](O3U["x"]-t3U["x"]);else u3U=-Math["abs"](O3U["x"]-t3U["x"]);{this["positionGeo"]["x"]-=u3U;this["positionGeo"]["y"]-=e3U;}}}this["commit"]();};X9n["calcInverseRotationtoPlane"]=function(V8U,E8U){var L8U,k8U,m8U;L8U=X9n["calcRotateQuaternion"](V8U,E8U);k8U=new THREE["Matrix4"]();k8U["makeRotationFromQuaternion"](L8U);m8U=new THREE["Matrix4"]();m8U["getInverse"](k8U);return m8U;};X9n["prototype"]["pan"]=function(y8U,s8U,Y8U,l8U){this["panning"](y8U,s8U,Y8U,l8U);};X9n["prototype"]["firstpersonRotate"]=function(X8U,R8U,g8U,T8U){var A8U,C8U,W8U,n8U,r8U,U8U,D8U,F8U,M8U,z8U,G8U;A8U=g8U-X8U;C8U=T8U-R8U;if(A8U==0&&C8U==0)return;W8U=this["viewer"];n8U=0.2;W8U["option"]["refCenter"];r8U=this["mainCamera"]["position"]["clone"]();r8U["x"]+=W8U["option"]["refCenter"]["x"];r8U["y"]+=W8U["option"]["refCenter"]["y"];r8U["z"]+=W8U["option"]["refCenter"]["z"];U8U=A9n["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],this["positionGeo"]["z"]);D8U=X9n["calcInverseRotationtoPlane"](this["positionGeo"]["x"],this["positionGeo"]["y"]);r8U=r8U["applyMatrix4"](D8U);U8U=U8U["applyMatrix4"](D8U);F8U=U8U["clone"]();F8U=U8U["sub"](r8U);M8U=new THREE["Matrix4"]();this["testnumber"]=this["testnumber"]+C8U;if(this["testnumber"]<-89)this["testnumber"]=-89;if(this["testnumber"]>-1)this["testnumber"]=-1;M8U=M8U["makeRotationX"](this["testnumber"]*A9n["CmMathEngine"]["Deg2Rad"]);F8U=F8U["applyMatrix4"](M8U);F8U["add"](r8U);z8U=F8U["z"];G8U=X9n["calcLocalWorldHeadingTilt"](r8U,F8U);this["positionGeo"]["z"]=A9n["cm_const"]["EarthRadius"]+z8U;this["head"]=G8U["x"];this["tilt"]=G8U["y"];this["setDistanceFromLook"](G8U["z"]);this["commit"]();};X9n["prototype"]["moveRotation"]=function(o8U,J8U,Z8U,x8U){var a8U,t8U,O8U;a8U=Z8U-o8U;t8U=x8U-J8U;if(a8U==0&&t8U==0)return;O8U=0.2;this["head"]+=a8U*O8U;this["tilt"]+=t8U*O8U;this["commit"]();};X9n["prototype"]["verifyTiltRange"]=function(){if(this["tilt"]<-170.0)this["tilt"]=-170.0;if(this["tilt"]>-0.005)this["tilt"]=-0.005;};X9n["prototype"]["isUnderSeaLine"]=function(){if(this["tilt"]<-90){return true;}return false;};X9n["prototype"]["verifyHeadRange"]=function(){if(this["head"]>360)this["head"]-=360;if(this["head"]<0)this["head"]+=360;};X9n["prototype"]["moveToward"]=function(i8U){if(i8U<0){this["pan"](0,5,0,0);}else{this["pan"](0,0,0,5);}};X9n["prototype"]["Zoom"]=function(p8U){this["distanceFromLook"]-=p8U;this["commit"]();};X9n["prototype"]["headDown"]=function(S8U){};X9n["prototype"]["moveRight"]=function(I8U){if(I8U<0){this["pan"](0,0,5,0);}else{this["pan"](5,0,0,0);}};X9n["prototype"]["getViewRange"]=function(){return this["viewRange"];};X9n["prototype"]["beforeUpdate"]=function(v8U,e8U){var w8U;w8U=e8U;if(A9n["Util"]["isDefined"](w8U)==false){return;}w8U["calcViewRage"](w8U["getAltitude"]());};X9n["prototype"]["update"]=function(){this["commit"]();};X9n["prototype"]["afterUpdate"]=function(h8U,j8U){};X9n["calcRotateQuaternion"]=function(d8U,K8U){var u8U,c8U;u8U=new THREE["Quaternion"]();c8U=new THREE["Quaternion"]();u8U["setFromAxisAngle"](X9n["getYAxis"](),d8U*A9n["CmMathEngine"]["Deg2Rad"]);c8U["setFromAxisAngle"](X9n["getXAxis"](),K8U*A9n["CmMathEngine"]["Deg2Rad"]);return THREE["Quaternion"]["prototype"]["multiplyQuaternions"](u8U,c8U);};X9n["prototype"]["commit"]=function(){var H4U,m4U,k4U,y4U,b8U,N8U,f8U,q8U,B8U,L4U,V4U,E4U,Q8U,P8U;H4U=this["viewer"];this["verifyTiltRange"]();this["verifyHeadRange"]();m4U=new THREE["Vector3"](0,0,-this["distanceFromLook"]);k4U=new THREE["Vector3"](0,1,0);y4U=new THREE["Vector3"](0,0,0);b8U=A9n["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],A9n["cm_const"]["EarthRadius"]);N8U=new THREE["Vector3"](m4U["x"],m4U["y"],m4U["z"]);f8U=new THREE["Vector3"](k4U["x"],k4U["y"],k4U["z"]);q8U=new THREE["Vector3"](0,0,0);B8U=new THREE["Quaternion"]();B8U=X9n["calcRotateQuaternion"](this["positionGeo"]["x"],this["positionGeo"]["y"]);if(true){L4U=new THREE["Quaternion"]();V4U=new THREE["Quaternion"]();L4U["setFromAxisAngle"](X9n["getZAxis"](),this["head"]*A9n["CmMathEngine"]["Deg2Rad"]);V4U["setFromAxisAngle"](X9n["getXAxis"](),this["tilt"]*A9n["CmMathEngine"]["Deg2Rad"]);B8U["multiplyQuaternions"](B8U,L4U);B8U["multiplyQuaternions"](B8U,V4U);}N8U=A9n["CmMathEngine"]["MultiplyQuaternionVector"](B8U,N8U);f8U=A9n["CmMathEngine"]["MultiplyQuaternionVector"](B8U,f8U);if(H4U["option"]["useRefCameraMode"]){N8U["add"](b8U);{H4U["option"]["refCenter"]=b8U["clone"]();}}else{N8U["add"](b8U);q8U["add"](b8U);H4U["option"]["refCenter"]=new THREE["Vector3"](0,0,0);}{this["position"]["x"]=N8U["x"];this["position"]["y"]=N8U["y"];this["position"]["z"]=N8U["z"];{this["cameraPositionWorld"]["x"]=N8U["x"];this["cameraPositionWorld"]["y"]=N8U["y"];this["cameraPositionWorld"]["z"]=N8U["z"];this["cameraPositionGeo"]=A9n["CmMathEngine"]["Cartesian2Geo"](this["cameraPositionWorld"]["x"],this["cameraPositionWorld"]["y"],this["cameraPositionWorld"]["z"]);this["lookAtPositionWorld"]["x"]=q8U["x"]+b8U["x"];this["lookAtPositionWorld"]["y"]=q8U["y"]+b8U["y"];this["lookAtPositionWorld"]["z"]=q8U["z"]+b8U["z"];this["lookAtPositionGeo"]=A9n["CmMathEngine"]["Cartesian2Geo"](this["lookAtPositionWorld"]["x"],this["lookAtPositionWorld"]["y"],this["lookAtPositionWorld"]["z"]);}{this["mainCamera"]["position"]["set"](this["position"]["x"]-b8U["x"],this["position"]["y"]-b8U["y"],this["position"]["z"]-b8U["z"]);this["mainCamera"]["up"]["set"](f8U["x"],f8U["y"],f8U["z"]);this["mainCamera"]["lookAt"](q8U);this["direction"]=q8U["clone"]();this["direction"]["sub"](this["mainCamera"]["position"]);{E4U=A9n["CmMathEngine"]["calContactDistanceWithCircle"](new THREE["Vector2"](0,0),A9n["cm_const"]["EarthRadius"],new THREE["Vector2"](0,A9n["cm_const"]["EarthRadius"]+this["getAltitude"]()));Q8U=E4U*1;if(Q8U<10000)Q8U=10000;if(Q8U!=this["mainCamera"]["far"]){if(H4U["shaderLib"]){}}P8U=Q8U*0.0001;if(A9n["GlobalOption"]["userSetCameraNear"]!=null){P8U=A9n["GlobalOption"]["userSetCameraNear"];}else{if(P8U>1000)P8U=1000;if(P8U<1)P8U=1;if(this["getAltitudeFromGround"]()<1000)P8U=1;}this["mainCamera"]["near"]=P8U;this["mainCamera"]["far"]=Q8U;this["mainCamera"]["updateProjectionMatrix"]();this["mainCameraForPicking"]["position"]["set"](this["mainCamera"]["position"]["x"],this["mainCamera"]["position"]["y"],this["mainCamera"]["position"]["z"]);this["mainCameraForPicking"]["up"]["set"](this["mainCamera"]["up"]["x"],this["mainCamera"]["up"]["y"],this["mainCamera"]["up"]["z"]);this["mainCameraForPicking"]["lookAt"](q8U);this["mainCameraForPicking"]["near"]=this["distanceFromLook"]*0.01;if(this["mainCameraForPicking"]["near"]<1)this["mainCameraForPicking"]["near"]=1;this["mainCameraForPicking"]["far"]=Q8U;this["mainCameraForPicking"]["updateProjectionMatrix"]();}}}this["viewRange"]=this["calcViewRage"](this["getAltitude"]());this["positionChangedEvent"]["raiseEvent"]({camera:this});};X9n["prototype"]["getReal3DWorldPosition"]=function(){return this["mainCamera"]["position"]["clone"]();};X9n["prototype"]["calcViewRage"]=function(s4U){var Y4U;Y4U=s4U/A9n["cm_const"]["EarthRadius"];if(Y4U<1)return Math["abs"](Math["asin"](s4U/A9n["cm_const"]["EarthRadius"]))*2*A9n["cm_const"]["Rad2Deg"];return A9n["cm_const"]["PI"]*A9n["cm_const"]["Rad2Deg"];};return X9n;}(A9n["Camera"]);A9n["CmCameraGlobe"]=z9n;}(CMWORLD||(CMWORLD={})));(function(r4U){var l4U;l4U=function(){F4U["checkTriangle"]=function(W4U,n4U,g4U,A4U){var t4U,z4U,D4U,M4U,R4U,G4U,U4U,a4U,T4U,C4U,X4U;z4U=W4U["center"]["distanceTo"](n4U);D4U=W4U["center"]["distanceTo"](g4U);M4U=W4U["center"]["distanceTo"](A4U);if(z4U<W4U["radius"]||D4U<W4U["radius"]||M4U<W4U["radius"]){if(z4U<D4U){if(z4U<M4U){return{distance:z4U,pos:n4U};}else{return{distance:M4U,pos:A4U};}}else{if(D4U<M4U){return{distance:D4U,pos:g4U};}else{return{distance:M4U,pos:A4U};}}}else{R4U=new THREE["Plane"]();R4U["setFromCoplanarPoints"](n4U,g4U,A4U);G4U=R4U["normal"]["clone"]();G4U["setLength"](W4U["radius"]);G4U["x"]+=W4U["center"]["x"];G4U["y"]+=W4U["center"]["y"];G4U["z"]+=W4U["center"]["z"];U4U=R4U["normal"]["clone"]();U4U["setLength"](W4U["radius"]);U4U["x"]*=-1;U4U["y"]*=-1;U4U["z"]*=-1;U4U["x"]+=W4U["center"]["x"];U4U["y"]+=W4U["center"]["y"];U4U["z"]+=W4U["center"]["z"];U4U["normalize"]();a4U=G4U["distanceTo"](U4U);T4U=new THREE["Ray"](G4U,U4U);C4U=new THREE["Vector3"]();C4U=T4U["intersectTriangle"](n4U,g4U,A4U,false,C4U);if(C4U){X4U=W4U["center"]["distanceTo"](C4U);{return{distance:X4U,pos:C4U};}}}return undefined;};F4U["checkBufferGeometry"]=function(w4U,h4U,J4U,v4U,e4U){var c4U,u4U,j4U,x4U,S4U,p4U,d4U,i4U,Z4U,I4U,o4U;x4U=new THREE["Vector3"]();S4U=new THREE["Vector3"]();p4U=new THREE["Vector3"]();I4U=false;if(J4U["index"]){if(J4U["index"]["count"]>0){I4U=true;}}if(I4U){if(J4U["attributes"]["position"]){o4U=J4U["attributes"]["position"];for(var O4U=0;O4U<J4U["index"]["count"];O4U+=3){x4U["x"]=o4U["array"][J4U["index"]["array"][O4U+0]*3+0];x4U["y"]=o4U["array"][J4U["index"]["array"][O4U+0]*3+1];x4U["z"]=o4U["array"][J4U["index"]["array"][O4U+0]*3+2];S4U["x"]=o4U["array"][J4U["index"]["array"][O4U+1]*3+0];S4U["y"]=o4U["array"][J4U["index"]["array"][O4U+1]*3+1];S4U["z"]=o4U["array"][J4U["index"]["array"][O4U+1]*3+2];p4U["x"]=o4U["array"][J4U["index"]["array"][O4U+2]*3+0];p4U["y"]=o4U["array"][J4U["index"]["array"][O4U+2]*3+1];p4U["z"]=o4U["array"][J4U["index"]["array"][O4U+2]*3+2];i4U=this["checkTriangle"](h4U,x4U,S4U,p4U);if(i4U){if(Z4U){if(i4U["distance"]<Z4U["distance"]){Z4U=i4U;}}else{Z4U=i4U;}}}if(Z4U){Z4U["pos"]["applyMatrix4"](v4U);e4U["push"]({object:w4U,distance:Z4U["distance"],pos:Z4U["pos"]});}}}else{if(J4U["attributes"]["position"]){o4U=J4U["attributes"]["position"];for(var O4U=0;O4U<o4U["count"];O4U+=9){x4U["x"]=o4U["array"][O4U*3+0];x4U["y"]=o4U["array"][O4U*3+1];x4U["z"]=o4U["array"][O4U*3+2];S4U["x"]=o4U["array"][O4U*3+0];S4U["y"]=o4U["array"][O4U*3+1];S4U["z"]=o4U["array"][O4U*3+2];p4U["x"]=o4U["array"][O4U*3+0];p4U["y"]=o4U["array"][O4U*3+1];p4U["z"]=o4U["array"][O4U*3+2];i4U=this["checkTriangle"](h4U,x4U,S4U,p4U);if(Z4U){if(i4U["distance"]<Z4U["distance"]){Z4U=i4U;}}else{Z4U=i4U;}}if(Z4U){Z4U["pos"]["applyMatrix4"](v4U);e4U["push"]({object:w4U,distance:Z4U["distance"],pos:Z4U["pos"]});}}}};F4U["checkGeometry"]=function(m2U,k2U,b4U,f4U,H2U){var E2U,y2U,L2U,B4U,q4U,Q4U,V2U,P4U,K4U;if(b4U){for(var N4U=0;N4U<b4U["faces"]["length"];N4U++){B4U=b4U["vertices"][b4U["faces"][N4U]["a"]];q4U=b4U["vertices"][b4U["faces"][N4U]["b"]];Q4U=b4U["vertices"][b4U["faces"][N4U]["c"]];P4U=this["checkTriangle"](k2U,B4U,q4U,Q4U);if(P4U){if(K4U){if(P4U["distance"]<K4U["distance"]){K4U=P4U;}}else{K4U=P4U;}}}if(K4U){K4U["pos"]["applyMatrix4"](f4U);H2U["push"]({object:m2U,distance:K4U["distance"],pos:K4U["pos"]});}}};F4U["sortFunc"]=function(s2U,Y2U){if(s2U["distance"]==Y2U["distance"]){return 0;}if(s2U["distance"]<Y2U["distance"]){return-1;}return 1;};F4U["collionCheck"]=function(C2U,r2U){var D2U,A2U,F2U,M2U,U2U,G2U,W2U;if(C2U){D2U=false;if(D2U){}else{A2U=new THREE["Triangle"]();if(r2U["length"]>0){F2U=[];M2U=new THREE["Matrix4"]();for(var l2U=0;l2U<r2U["length"];l2U++){if(r2U[l2U]["geometry"]){G2U=r2U[l2U]["matrixWorld"];M2U["getInverse"](G2U);U2U=C2U["clone"]();U2U["applyMatrix4"](M2U);W2U=r2U[l2U]["geometry"];if(W2U instanceof THREE["BufferGeometry"]){this["checkBufferGeometry"](r2U[l2U],U2U,W2U,G2U,F2U);}else if(W2U instanceof THREE["Geometry"]){this["checkGeometry"](r2U[l2U],U2U,W2U,G2U,F2U);}}}if(F2U["length"]>1){F2U["sort"](this["sortFunc"]);}return F2U;}}}return[];};F4U["checkChildCollionBoundingSphere"]=function(g2U,z2U,X2U){var R2U;if(!z2U){return;}if(z2U["visible"]===false)return;if(z2U instanceof THREE["Light"]){}else if(z2U instanceof THREE["Sprite"]){}else if(z2U instanceof THREE["LensFlare"]){}else if(z2U instanceof THREE["Mesh"]||z2U instanceof THREE["Line"]||z2U instanceof THREE["Points"]){if(z2U["geometry"]){if(z2U["geometry"]["boundingSphere"]==null)z2U["geometry"]["computeBoundingSphere"]();if(z2U["geometry"]["boundingSphere"]["intersectsSphere"](g2U)){X2U["push"](z2U);}}}R2U=z2U["children"];for(var n2U=0,T2U=R2U["length"];n2U<T2U;n2U++){this["checkChildCollionBoundingSphere"](g2U,R2U[n2U],X2U);}};function F4U(){}return F4U;}();r4U["CameraUtil"]=l4U;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var a2U;a2U=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(t2U,O2U){t2U["__proto__"]=O2U;}||function(Z2U,J2U){for(var o2U in J2U)if(J2U["hasOwnProperty"](o2U))Z2U[o2U]=J2U[o2U];};return function(i2U,x2U){function p2U(){this["constructor"]=i2U;}a2U(i2U,x2U);i2U["prototype"]=x2U===null?Object["create"](x2U):(p2U["prototype"]=x2U["prototype"],new p2U());};}();(function(S2U){var I2U;I2U=function(e2U){__extends(w2U,e2U);w2U["prototype"]["init"]=function(){var h2U;h2U=S2U["CmWorld3"]["getInstance"]();this["viewer"]=h2U;this["setAspect"](h2U["canvas"]["width"],h2U["canvas"]["height"]);this["distanceFromLook"]=h2U["option"]["EarthRadius"]*1.3;this["positionGeo"]=new THREE["Vector3"](0,0,0);h2U["postUpdateEvent"]["addEventListener"](this["afterUpdate"],this);};w2U["prototype"]["setWalkingMode"]=function(j2U){this["option_Walking"]=j2U;if(j2U){this["option_Fly"]=false;this["option_KeepHeight"]=false;}};w2U["prototype"]["pickingByScreenCoordinateInArray"]=function(u2U,c2U,d2U){console["warn"]("not implement.");return null;};w2U["prototype"]["getThreejsCamera"]=function(){return this["mainCamera"];};w2U["prototype"]["getProjectionMatrix"]=function(){return this["mainCamera"]["projectionMatrix"];};w2U["prototype"]["getViewMatrix"]=function(){return this["mainCamera"]["matrixWorldInverse"];};w2U["prototype"]["getViewRange"]=function(){return-1;};w2U["prototype"]["getDistanceToWorldPos"]=function(K2U){return this["position"]["distanceTo"](K2U);};w2U["prototype"]["getAltitude"]=function(){return this["positionGeo"]["z"]-S2U["cm_const"]["EarthRadius"];};w2U["prototype"]["getDirection"]=function(){return null;};w2U["prototype"]["getPositionGeo"]=function(){return this["positionGeo"]["clone"]();};w2U["prototype"]["getPositionWorld"]=function(){return this["position"]["clone"]();};w2U["prototype"]["getLookPositionGeo"]=function(){return this["targetPositionGeo"]["clone"]();};w2U["prototype"]["getLookPositionWorld"]=function(){return this["targetPosition"]["clone"]();};w2U["prototype"]["setPositionGeo"]=function(b2U,N2U,P2U){};w2U["prototype"]["setLookPositionGeo"]=function(B2U,q2U,Q2U){};w2U["prototype"]["gotoGeo"]=function(H1U,k1U,f2U){if(f2U==null||isNaN(f2U)){}else{}this["initPosition"](H1U,k1U,f2U,0,0);this["commit"]();};w2U["prototype"]["gotoTarget"]=function(V1U,E1U,y1U,s1U,Y1U,l1U){var r1U,m1U,L1U;r1U=S2U["CmWorld3"]["getInstance"]();this["positionGeo"]["set"](s1U,Y1U,S2U["cm_const"]["EarthRadius"]+l1U);this["targetPositionGeo"]["set"](V1U,E1U,S2U["cm_const"]["EarthRadius"]+y1U);m1U=S2U["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],this["positionGeo"]["z"]);L1U=S2U["CmMathEngine"]["Geo2Cartesian"](this["targetPositionGeo"]["x"],this["targetPositionGeo"]["y"],this["targetPositionGeo"]["z"]);this["direction"]["subVectors"](m1U,L1U);this["commit"]();};w2U["prototype"]["attachToScene"]=function(F1U){if(F1U!=null){F1U["add"](this["mainCamera"]);F1U["add"](this["mainCameraForPicking"]);}};w2U["prototype"]["detachToScene"]=function(W1U){if(W1U){W1U["remove"](this["mainCamera"]);W1U["remove"](this["mainCameraForPicking"]);}};w2U["prototype"]["setAspect"]=function(U1U,G1U){this["mainCamera"]["aspect"]=U1U/G1U;this["mainCamera"]["updateProjectionMatrix"]();this["mainCameraForPicking"]["aspect"]=U1U/G1U;this["mainCameraForPicking"]["updateProjectionMatrix"]();};w2U["prototype"]["getDirectionForward"]=function(){var M1U;M1U=new THREE["Vector3"]();M1U=this["mainCamera"]["getWorldDirection"](M1U);return M1U;};w2U["prototype"]["getDirectionRight"]=function(){var C1U,D1U;C1U=S2U["CmCameraGlobe"]["getXAxis"]();D1U=this["mainCamera"]["matrix"];D1U["setPosition"](new THREE["Vector3"](0,0,0));C1U["applyMatrix4"](D1U);return C1U;};w2U["prototype"]["getDirectionUp"]=function(){var A1U,z1U;A1U=S2U["CmCameraGlobe"]["getYAxis"]();z1U=this["mainCamera"]["matrix"];z1U["setPosition"](new THREE["Vector3"](0,0,0));A1U["applyMatrix4"](z1U);return A1U;};w2U["prototype"]["initPosition"]=function(R1U,g1U,n1U,T1U,a1U){var X1U;{if(isNaN(g1U))g1U=this["positionGeo"]["y"];if(isNaN(R1U))R1U=this["positionGeo"]["x"];if(n1U==null||isNaN(n1U))n1U=this["positionGeo"]["z"];X1U=S2U["CmWorld3"]["getInstance"]();if(n1U>X1U["option"]["maxAltitude"]){n1U=X1U["option"]["maxAltitude"];}}this["positionGeo"]=new THREE["Vector3"](R1U,g1U,n1U);this["commit"]();};w2U["prototype"]["setLookAltitude"]=function(t1U){this["positionGeo"]["z"]=t1U;};w2U["prototype"]["isUnderSeaLine"]=function(){return false;};w2U["prototype"]["updatePositionFrom"]=function(O1U){};w2U["prototype"]["getIntersectObjects"]=function(o1U,J1U){return null;};function w2U(){var v2U;v2U=e2U["call"](this)||this;v2U["panningMode"]=S2U["GlobePanningMode"]["AnyRotation"];v2U["targetPositionGeo"]=new THREE["Vector3"](0,0,0);v2U["targetPosition"]=new THREE["Vector3"](0,0,0);v2U["direction"]=new THREE["Vector3"](0,0,0);v2U["mainCamera"]=new THREE["PerspectiveCamera"](45,S2U["CmWorld3"]["getInstance"]()["canvas"]["width"]/S2U["CmWorld3"]["getInstance"]()["canvas"]["height"],1,S2U["CmWorld3"]["getInstance"]()["option"]["EarthRadius"]*3);v2U["mainCameraForPicking"]=new THREE["PerspectiveCamera"](45,S2U["CmWorld3"]["getInstance"]()["canvas"]["width"]/S2U["CmWorld3"]["getInstance"]()["canvas"]["height"],1000,S2U["CmWorld3"]["getInstance"]()["option"]["EarthRadius"]*3);v2U["raycaster"]=new THREE["Raycaster"]();v2U["isGoing"]=false;v2U["weight"]=60000;v2U["gravity"]=9.8;v2U["tall"]=3.0;v2U["boundingSpehere"]=new THREE["Sphere"](new THREE["Vector3"](0,0,0),1.5);v2U["option_Walking"]=true;v2U["option_Fly"]=true;v2U["option_KeepHeight"]=false;v2U["init"]();return v2U;}w2U["prototype"]["getIntersectObjectsFromRay"]=function(Z1U,x1U){return null;};w2U["prototype"]["moveRotation"]=function(v1U,u1U,j1U,h1U,c1U){var I1U,e1U,w1U,p1U,S1U,i1U;I1U=j1U-v1U;e1U=h1U-u1U;if(I1U==0&&e1U==0)return;I1U*=0.1;e1U*=0.1;{w1U=S2U["CmWorld3"]["getInstance"]();p1U=this["mainCamera"]["position"]["clone"]();p1U["add"](w1U["option"]["refCenter"]);p1U=this["mainCamera"]["worldToLocal"](p1U);p1U["normalize"]();this["mainCamera"]["rotateOnAxis"](p1U,I1U*S2U["cm_const"]["Deg2Rad"]);this["mainCamera"]["rotateX"](e1U*S2U["cm_const"]["Deg2Rad"]);}{S1U=this["mainCamera"]["position"]["clone"]();S1U["add"](w1U["option"]["refCenter"]);this["positionGeo"]=S2U["CmMathEngine"]["Cartesian2Geo"](S1U["x"],S1U["y"],S1U["z"]);}{i1U=new THREE["Vector3"](0,0,-1);i1U["setLength"](this["distanceFromLook"]);i1U=S2U["CmMathEngine"]["MultiplyQuaternionVector"](this["mainCamera"]["quaternion"],i1U);i1U["add"](this["mainCamera"]["position"]);i1U["add"](w1U["option"]["refCenter"]);this["targetPositionGeo"]=S2U["CmMathEngine"]["Cartesian2Geo"](i1U["x"],i1U["y"],i1U["z"]);}this["commit"]();};w2U["prototype"]["setPosition_1"]=function(d1U,K1U,b1U){this["initPosition"](d1U,K1U,b1U,null,null);};w2U["prototype"]["getHitCoordinate"]=function(Q1U,f1U,P1U,B1U){var q1U,N1U;if(P1U===void 0){P1U=true;}if(B1U===void 0){B1U=true;}q1U=new THREE["Vector2"](Q1U,f1U);N1U=this["getHitPositionOnGround"](q1U,B1U);if(N1U==null){}else{if(P1U)N1U=S2U["CmMathEngine"]["Cartesian2Geo"](N1U["x"],N1U["y"],N1U["z"]);}return N1U;};w2U["prototype"]["GetCameraRay"]=function(E5U,L5U,V5U){var H5U,y5U,k5U,m5U;H5U=new THREE["Raycaster"]();y5U=S2U["CmWorld3"]["getInstance"]()["NormalizeScreenCoord"](E5U["x"],E5U["y"]);if(true){H5U["setFromCamera"](y5U,this["mainCameraForPicking"]);}else{}k5U=H5U["ray"]["origin"]["clone"]();m5U=H5U["ray"]["direction"]["clone"]();L5U["x"]=k5U["x"];L5U["y"]=k5U["y"];L5U["z"]=k5U["z"];V5U["x"]=m5U["x"];V5U["y"]=m5U["y"];V5U["z"]=m5U["z"];};w2U["prototype"]["getHitPositionOnGround"]=function(R5U,A5U){var l5U,Y5U,a5U,U5U,X5U,g5U,s5U,r5U,n5U,z5U,D5U,C5U,M5U,F5U,T5U,t5U,W5U;if(A5U===void 0){A5U=true;}l5U=S2U["CmWorld3"]["getInstance"]();if(l5U["option"]["enablePreciseTerrainCoordinate"])A5U=false;Y5U=null;if(A5U==false){a5U=S2U["CmWorld3"]["getInstance"]()["NormalizeScreenCoord"](R5U["x"],R5U["y"]);this["raycaster"]["setFromCamera"](a5U,this["mainCameraForPicking"]);U5U=this["raycaster"]["intersectObjects"](S2U["CmWorld3"]["getInstance"]()["getTerrainScene"]()["children"]);if(U5U["length"]>0){Y5U=new THREE["Vector3"]();}for(var G5U=0;G5U<U5U["length"];G5U++){Y5U=U5U[G5U]["point"]["clone"]();Y5U["x"]+=l5U["option"]["refCenter"]["x"];Y5U["y"]+=l5U["option"]["refCenter"]["y"];Y5U["z"]+=l5U["option"]["refCenter"]["z"];return Y5U;}if(Y5U!=null){Y5U["x"]+=l5U["option"]["refCenter"]["x"];Y5U["y"]+=l5U["option"]["refCenter"]["y"];Y5U["z"]+=l5U["option"]["refCenter"]["z"];return Y5U;}}X5U=new THREE["Vector3"]();g5U=new THREE["Vector3"]();this["GetCameraRay"](R5U,X5U,g5U);s5U=X5U;if(l5U["option"]["useRefCameraMode"]){s5U["add"](l5U["option"]["refCenter"]);}else{}r5U=s5U["clone"]();n5U=g5U;n5U["setLength"](S2U["cm_const"]["EarthRadius"]*2.0);r5U["add"](n5U);z5U=r5U["x"]-s5U["x"];D5U=r5U["y"]-s5U["y"];C5U=r5U["z"]-s5U["z"];M5U=z5U*z5U+D5U*D5U+C5U*C5U;F5U=2.0*(z5U*s5U["x"]+D5U*s5U["y"]+C5U*s5U["z"]);T5U=s5U["x"]*s5U["x"]+s5U["y"]*s5U["y"]+s5U["z"]*s5U["z"]-S2U["cm_const"]["EarthRadius"]*S2U["cm_const"]["EarthRadius"];t5U=F5U*F5U-4*M5U*T5U;if(t5U<=0){return null;}W5U=(-1.0*F5U-Math["sqrt"](F5U*F5U-4*M5U*T5U))/(2.0*M5U);Y5U=new THREE["Vector3"](s5U["x"]+W5U*(r5U["x"]-s5U["x"]),s5U["y"]+W5U*(r5U["y"]-s5U["y"]),s5U["z"]+W5U*(r5U["z"]-s5U["z"]));return Y5U;};w2U["prototype"]["getHitPosition"]=function(x5U,p5U,S5U){var O5U,i5U,o5U,J5U;O5U=null;i5U=S2U["CmWorld3"]["getInstance"]()["NormalizeScreenCoord"](x5U["x"],x5U["y"]);o5U=S2U["CmWorld3"]["getInstance"]();this["raycaster"]["setFromCamera"](i5U,this["mainCameraForPicking"]);J5U=this["raycaster"]["intersectObjects"](o5U["rootScene"]["children"],true);if(J5U["length"]>0){O5U=new THREE["Vector3"]();}for(var Z5U=0;Z5U<J5U["length"];Z5U++){O5U=J5U[Z5U]["point"]["clone"]();O5U["x"]+=o5U["option"]["refCenter"]["x"];O5U["y"]+=o5U["option"]["refCenter"]["y"];O5U["z"]+=o5U["option"]["refCenter"]["z"];return O5U;}if(O5U!=null){O5U["x"]+=o5U["option"]["refCenter"]["x"];O5U["y"]+=o5U["option"]["refCenter"]["y"];O5U["z"]+=o5U["option"]["refCenter"]["z"];return O5U;}return O5U;};w2U["prototype"]["panning"]=function(I5U,w5U,e5U,v5U){this["moveRotation"](I5U,w5U,e5U,v5U,true);};w2U["prototype"]["pan"]=function(h5U,j5U,u5U,c5U){this["panning"](h5U,j5U,u5U,c5U);};w2U["prototype"]["moveToward"]=function(d5U){this["moveForward"](d5U);};w2U["prototype"]["Zoom"]=function(K5U){this["moveForward"](K5U);};w2U["prototype"]["moveForward"]=function(q5U){var P5U,N5U,B5U,b5U;P5U=S2U["CmWorld3"]["getInstance"]();this["mainCamera"]["translateZ"](-q5U);N5U=this["mainCamera"]["position"]["clone"]();N5U["add"](P5U["option"]["refCenter"]);this["positionGeo"]=S2U["CmMathEngine"]["Cartesian2Geo"](N5U["x"],N5U["y"],N5U["z"]);B5U=new THREE["Vector3"](0,0,-1);b5U=B5U["applyQuaternion"](this["mainCamera"]["quaternion"]);b5U["add"](this["mainCamera"]["position"]);b5U["add"](P5U["option"]["refCenter"]);this["targetPositionGeo"]=S2U["CmMathEngine"]["Cartesian2Geo"](b5U["x"],b5U["y"],b5U["z"]);this["commit"]();};w2U["prototype"]["headDown"]=function(Q5U){};w2U["prototype"]["moveRight"]=function(L6U){var k6U,H6U,m6U,f5U;k6U=S2U["CmWorld3"]["getInstance"]();this["mainCamera"]["translateX"](L6U);H6U=this["mainCamera"]["position"]["clone"]();H6U["add"](k6U["option"]["refCenter"]);this["positionGeo"]=S2U["CmMathEngine"]["Cartesian2Geo"](H6U["x"],H6U["y"],H6U["z"]);m6U=new THREE["Vector3"](0,0,-1);f5U=m6U["applyQuaternion"](this["mainCamera"]["quaternion"]);f5U["add"](this["mainCamera"]["position"]);f5U["add"](k6U["option"]["refCenter"]);this["targetPositionGeo"]=S2U["CmMathEngine"]["Cartesian2Geo"](f5U["x"],f5U["y"],f5U["z"]);this["commit"]();};w2U["prototype"]["beforeUpdate"]=function(){};w2U["prototype"]["update"]=function(){this["commit"]();};w2U["prototype"]["afterUpdate"]=function(a6U,V6U){var l6U,z6U,X6U,M6U,A6U,E6U,U6U,y6U,g6U,r6U,Y6U,s6U,W6U,G6U,C6U,R6U,D6U,n6U,T6U;if(S2U["Util"]["isDefined"](V6U)==false)return;l6U=S2U["CmWorld3"]["getInstance"]();z6U=false;X6U=false;if(X6U){M6U=V6U["positionGeo"]["clone"]();A6U=S2U["CmMathEngine"]["Geo2Cartesian"](M6U["x"],M6U["y"],M6U["z"]*l6U["option"]["VerticalExaggeration"]+S2U["cm_const"]["EarthRadius"]);E6U=A6U["clone"]();E6U["normalize"]();E6U["x"]=-E6U["x"];E6U["y"]=-E6U["y"];E6U["z"]=-E6U["z"];U6U=l6U["option"]["deltaTime"]*9.81*0.01;y6U=null;if(U6U>0){E6U["setLength"](U6U);g6U=A6U["clone"]();r6U=g6U["add"](E6U);y6U=S2U["CmMathEngine"]["Cartesian2Geo"](r6U["x"],r6U["y"],r6U["z"]);y6U["z"]=(y6U["z"]-S2U["cm_const"]["EarthRadius"])*l6U["option"]["VerticalExaggeration"];r6U["sub"](l6U["option"]["refCenter"]);Y6U=new THREE["Sphere"](r6U,V6U["tall"]);s6U=[];S2U["CameraUtil"]["checkChildCollionBoundingSphere"](Y6U,S2U["CmWorld3"]["getInstance"]()["getGroundScene"](),s6U);S2U["CameraUtil"]["checkChildCollionBoundingSphere"](Y6U,S2U["CmWorld3"]["getInstance"]()["getUserScene"](),s6U);W6U=l6U["quadTileLayer"]["getHighResolutionTile"](y6U["x"],y6U["y"]);if(W6U){S2U["CameraUtil"]["checkChildCollionBoundingSphere"](Y6U,W6U["NWmesh"],s6U);S2U["CameraUtil"]["checkChildCollionBoundingSphere"](Y6U,W6U["NEmesh"],s6U);S2U["CameraUtil"]["checkChildCollionBoundingSphere"](Y6U,W6U["SWmesh"],s6U);S2U["CameraUtil"]["checkChildCollionBoundingSphere"](Y6U,W6U["SEmesh"],s6U);}G6U=S2U["CameraUtil"]["collionCheck"](Y6U,s6U);C6U=true;for(var F6U=0;F6U<G6U["length"];F6U++){if(C6U==false)break;R6U=new THREE["Vector3"](G6U[F6U]["pos"]["x"],G6U[F6U]["pos"]["y"],G6U[F6U]["pos"]["z"]);R6U["sub"](V6U["mainCamera"]["position"]);D6U=R6U["length"]();if(D6U<V6U["tall"]){C6U=false;}else{D6U=D6U-0.1;E6U["normalize"]();V6U["mainCamera"]["translateOnAxis"](E6U,U6U);V6U["mainCameraForPicking"]["translateOnAxis"](E6U,U6U);break;}}if(C6U&&y6U!=null){S2U["CmWorld"]["outputInfo"]("moved");V6U["positionGeo"]["set"](y6U["x"],y6U["y"],y6U["z"]);}}}if(V6U["option_Walking"]){if(V6U["option_KeepHeight"]){}else{if(V6U["option_Fly"]==false){z6U=true;n6U=l6U["getGroundHeight"](V6U["positionGeo"]["x"],V6U["positionGeo"]["y"]);if(n6U<-9000){console["warn"]("PointMesh:getGroundHeight 에서 높이를 구하지 못했다.");}else{T6U=n6U+V6U["tall"];V6U["positionGeo"]["z"]=S2U["cm_const"]["EarthRadius"]+T6U;}}}}if(z6U){V6U["commit"]();}};w2U["prototype"]["calcViewRage"]=function(){};w2U["prototype"]["collisionCheck"]=function(Z6U){var t6U,o6U,J6U,O6U;t6U=new THREE["Vector3"](0,0,-1);t6U["applyQuaternion"](this["mainCamera"]["quaternion"]);o6U=S2U["CmWorld3"]["getInstance"]();J6U=new THREE["Raycaster"](this["mainCamera"]["position"],t6U,0,Z6U);O6U=J6U["intersectObjects"](o6U["rootScene"]["children"],true);if(O6U["length"]>0){return O6U[0]["distance"];}return Number["MAX_VALUE"];};w2U["prototype"]["commit"]=function(){var p6U,I6U,w6U,x6U,S6U,i6U;p6U=S2U["CmWorld3"]["getInstance"]();I6U=S2U["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],S2U["cm_const"]["EarthRadius"]);w6U=I6U["clone"]()["normalize"]();x6U=S2U["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],this["positionGeo"]["z"]);this["position"]["set"](x6U["x"],x6U["y"],x6U["z"]);x6U["sub"](p6U["option"]["refCenter"]);S6U=S2U["CmMathEngine"]["Geo2Cartesian"](this["targetPositionGeo"]["x"],this["targetPositionGeo"]["y"],this["targetPositionGeo"]["z"]);this["targetPosition"]=S6U["clone"]();S6U["sub"](p6U["option"]["refCenter"]);{this["mainCamera"]["position"]["set"](x6U["x"],x6U["y"],x6U["z"]);this["mainCameraForPicking"]["position"]["set"](x6U["x"],x6U["y"],x6U["z"]);i6U=this["getAltitude"]()*10;if(i6U<15000)i6U=15000;if(i6U>S2U["cm_const"]["EarthRadius"]*10)i6U=S2U["cm_const"]["EarthRadius"]*10;this["mainCamera"]["far"]=i6U;this["mainCameraForPicking"]["near"]=this["positionGeo"]["z"]*0.01;if(this["mainCameraForPicking"]["near"]<1)this["mainCameraForPicking"]["near"]=1;this["mainCameraForPicking"]["far"]=i6U;this["mainCamera"]["updateMatrixWorld"](false);this["mainCameraForPicking"]["updateMatrixWorld"](false);}};w2U["prototype"]["getReal3DWorldPosition"]=function(){return this["mainCamera"]["position"]["clone"]();};w2U["prototype"]["CopyFromCamera"]=function(h6U){var j6U,v6U,u6U,e6U;if(h6U){if(h6U["mainCamera"]){this["mainCamera"]=h6U["mainCamera"]["clone"]();this["mainCameraForPicking"]=h6U["mainCameraForPicking"]["clone"]();j6U=S2U["CmWorld3"]["getInstance"]();{v6U=this["mainCamera"]["position"]["clone"]();v6U["add"](j6U["option"]["refCenter"]);this["position"]=v6U;this["positionGeo"]=S2U["CmMathEngine"]["Cartesian2Geo"](v6U["x"],v6U["y"],v6U["z"]);}{u6U=new THREE["Vector3"](0,0,-1);e6U=u6U["applyQuaternion"](this["mainCamera"]["quaternion"]);e6U["setLength"](h6U["distanceFromLook"]);e6U["add"](this["mainCamera"]["position"]);e6U["add"](j6U["option"]["refCenter"]);this["targetPosition"]=e6U;this["targetPositionGeo"]=S2U["CmMathEngine"]["Cartesian2Geo"](e6U["x"],e6U["y"],e6U["z"]);}}}};return w2U;}(S2U["Camera"]);S2U["CmCameraGlobeFirstPerson"]=I2U;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var c6U;c6U=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(d6U,K6U){d6U["__proto__"]=K6U;}||function(P6U,N6U){for(var b6U in N6U)if(N6U["hasOwnProperty"](b6U))P6U[b6U]=N6U[b6U];};return function(q6U,B6U){function Q6U(){this["constructor"]=q6U;}c6U(q6U,B6U);q6U["prototype"]=B6U===null?Object["create"](B6U):(Q6U["prototype"]=B6U["prototype"],new Q6U());};}();(function(f6U){var H9U;H9U=function(m9U){__extends(k9U,m9U);k9U["prototype"]["init"]=function(){this["head"]=0.0;this["tilt"]=0.0;this["distanceFromLook"]=10000000;};k9U["prototype"]["getThreejsCamera"]=function(){return this["mainCamera"];};k9U["prototype"]["getProjectionMatrix"]=function(){return this["mainCamera"]["projectionMatrix"];};k9U["prototype"]["getViewMatrix"]=function(){return this["mainCamera"]["matrixWorldInverse"];};k9U["prototype"]["pickingByScreenCoordinateInArray"]=function(V9U,E9U,y9U){console["warn"]("not implement.");return null;};k9U["prototype"]["Zoom"]=function(s9U){console["warn"]("not implement.");};k9U["prototype"]["getViewRange"]=function(){return-1;};k9U["prototype"]["getDistanceToWorldPos"]=function(Y9U){return this["position"]["distanceTo"](Y9U);};k9U["prototype"]["getAltitude"]=function(){return 0;};k9U["prototype"]["getDirection"]=function(){return null;};k9U["prototype"]["getPositionGeo"]=function(){return null;};k9U["prototype"]["getPositionWorld"]=function(){return null;};k9U["prototype"]["getLookPositionGeo"]=function(){return null;};k9U["prototype"]["getLookPositionWorld"]=function(){return null;};k9U["prototype"]["setPositionGeo"]=function(l9U,r9U,F9U){};k9U["prototype"]["setLookPositionGeo"]=function(W9U,U9U,G9U){};k9U["prototype"]["gotoGeo"]=function(M9U,C9U,D9U){};k9U["prototype"]["attachToScene"]=function(A9U){if(A9U){A9U["add"](this["mainCamera"]);A9U["add"](this["mainCameraForPicking"]);}};k9U["prototype"]["detachToScene"]=function(z9U){if(z9U){z9U["remove"](this["mainCamera"]);z9U["remove"](this["mainCameraForPicking"]);}};k9U["prototype"]["setAspect"]=function(n9U,R9U){this["mainCamera"]["aspect"]=n9U/R9U;this["mainCamera"]["updateProjectionMatrix"]();this["mainCameraForPicking"]["aspect"]=n9U/R9U;this["mainCameraForPicking"]["updateProjectionMatrix"]();};k9U["prototype"]["GetLookPosition"]=function(g9U){return this["positionGeo"]["clone"]();};k9U["prototype"]["getDirectionForward"]=function(){var X9U;X9U=this["mainCamera"]["getWorldDirection"](new THREE["Vector3"]());return X9U;};k9U["prototype"]["getDirectionRight"]=function(){var T9U,a9U;T9U=this["XAxis"]["clone"]();a9U=this["mainCamera"]["matrix"];a9U["setPosition"](new THREE["Vector3"](0,0,0));T9U["applyMatrix4"](a9U);return T9U;};k9U["prototype"]["getDirectionUp"]=function(){var t9U,O9U;t9U=this["YAxis"]["clone"]();O9U=this["mainCamera"]["matrix"];O9U["setPosition"](new THREE["Vector3"](0,0,0));t9U["applyMatrix4"](O9U);return t9U;};k9U["prototype"]["initPosition"]=function(J9U,Z9U,o9U,x9U,i9U){var p9U;p9U=f6U["CmWorld3"]["getInstance"]();{if(isNaN(Z9U))Z9U=this["positionGeo"]["y"];if(isNaN(J9U))J9U=this["positionGeo"]["x"];if(isNaN(o9U))o9U=this["positionGeo"]["z"];if(x9U==null||isNaN(x9U))x9U=this["head"];if(i9U==null||isNaN(i9U))i9U=this["tilt"];if(o9U>p9U["option"]["maxAltitude"]){o9U=p9U["option"]["maxAltitude"];}}this["Longitude"]=J9U;this["Lattitude"]=Z9U;this["Altitude"]=o9U;this["positionGeo"]=new THREE["Vector3"](J9U,Z9U,o9U);this["head"]=x9U;this["tilt"]=i9U;this["commit"]();};k9U["prototype"]["getIntersectObjects"]=function(S9U,I9U){return null;};k9U["prototype"]["getIntersectObjectsFromRay"]=function(w9U,e9U){return null;};k9U["prototype"]["setPosition_1"]=function(v9U,h9U,j9U){this["initPosition"](v9U,h9U,j9U,null,null);};k9U["prototype"]["GetCameraRay"]=function(N9U,K9U,b9U){var u9U,P9U,c9U,d9U;u9U=new THREE["Raycaster"]();P9U=f6U["CmWorld3"]["getInstance"]()["NormalizeScreenCoord"](N9U["x"],N9U["y"]);u9U["setFromCamera"](P9U,this["mainCameraForPicking"]);c9U=u9U["ray"]["origin"]["clone"]();d9U=u9U["ray"]["direction"]["clone"]();K9U["x"]=c9U["x"];K9U["y"]=c9U["y"];K9U["z"]=c9U["z"];b9U["x"]=d9U["x"];b9U["y"]=d9U["y"];b9U["z"]=d9U["z"];};k9U["prototype"]["getHitCoordinate"]=function(f9U,H0U){var Q9U,B9U,q9U;Q9U=new THREE["Vector2"](f9U,H0U);B9U=this["getHitPosition"](Q9U,null,false);q9U=f6U["CmWorld3"]["getInstance"]();if(B9U==null){}else{B9U["x"]+=q9U["option"]["refCenter"]["x"];B9U["y"]+=q9U["option"]["refCenter"]["y"];B9U["z"]+=q9U["option"]["refCenter"]["z"];B9U=f6U["CmMathEngine"]["Cartesian2Geo"](B9U["x"],B9U["y"],B9U["z"]);}return B9U;};function k9U(){var L9U;L9U=m9U["call"](this)||this;L9U["Longitude"]=0.0;L9U["Lattitude"]=0.0;L9U["Altitude"]=f6U["CmMathEngine"]["m_MeterPerSec"]*360.0;L9U["XAxis"]=new THREE["Vector3"](1,0,0);L9U["YAxis"]=new THREE["Vector3"](0,1,0);L9U["ZAxis"]=new THREE["Vector3"](0,0,1);L9U["mainCamera"]=new THREE["PerspectiveCamera"](45,f6U["CmWorld3"]["getInstance"]()["canvas"]["width"]/f6U["CmWorld3"]["getInstance"]()["canvas"]["height"],0.1,1000*100000);L9U["mainCameraForPicking"]=new THREE["PerspectiveCamera"](45,f6U["CmWorld3"]["getInstance"]()["canvas"]["width"]/f6U["CmWorld3"]["getInstance"]()["canvas"]["height"],1000,1000*100000);L9U["raycaster"]=new THREE["Raycaster"]();L9U["earthPlane"]=new THREE["Plane"](L9U["ZAxis"],0);L9U["init"]();return L9U;}k9U["prototype"]["getHitPositionOnGround"]=function(E0U,s0U){var k0U,y0U,m0U,V0U;k0U=new THREE["Vector3"]();m0U=f6U["CmWorld3"]["getInstance"]();if(s0U==false){y0U=f6U["CmWorld3"]["getInstance"]()["NormalizeScreenCoord"](E0U["x"],E0U["y"]);}else{y0U=E0U["clone"]();}this["raycaster"]["setFromCamera"](y0U,this["mainCameraForPicking"]);V0U=this["raycaster"]["intersectObjects"](m0U["rootScene"]["children"]);for(var L0U=0;L0U<V0U["length"];L0U++){if(V0U[L0U]["object"]["hasOwnProperty"]("Ground")){k0U=V0U[L0U]["point"]["clone"]();k0U["x"]+=m0U["option"]["refCenter"]["x"];k0U["y"]+=m0U["option"]["refCenter"]["y"];k0U["z"]+=m0U["option"]["refCenter"]["z"];return k0U;}}return null;};k9U["prototype"]["getHitPosition"]=function(W0U,C0U,M0U){var Y0U,U0U,l0U,F0U,G0U;Y0U=new THREE["Vector3"]();if(M0U==false){U0U=f6U["CmWorld3"]["getInstance"]()["NormalizeScreenCoord"](W0U["x"],W0U["y"]);}else{U0U=W0U["clone"]();}this["raycaster"]["setFromCamera"](U0U,this["mainCameraForPicking"]);l0U=f6U["CmWorld3"]["getInstance"]();F0U=this["raycaster"]["intersectObjects"](l0U["rootScene"]["children"]);for(var r0U=0;r0U<F0U["length"];r0U++){if(F0U[r0U]["object"]["hasOwnProperty"]("Earth"))continue;Y0U=F0U[r0U]["point"]["clone"]();Y0U["x"]+=l0U["option"]["refCenter"]["x"];Y0U["y"]+=l0U["option"]["refCenter"]["y"];Y0U["z"]+=l0U["option"]["refCenter"]["z"];return Y0U;}G0U=this["raycaster"]["ray"]["intersectPlane"](this["earthPlane"],new THREE["Vector3"]());return G0U;};k9U["prototype"]["panning"]=function(g0U,a0U,n0U,R0U){var z0U,X0U,D0U,A0U,t0U,T0U;z0U=n0U-g0U;X0U=R0U-a0U;if(z0U==0&&X0U==0)return;D0U=this["getHitCoordinate"](g0U,a0U);A0U=this["getHitCoordinate"](n0U,R0U);t0U=D0U["x"]-A0U["x"];T0U=D0U["y"]-A0U["y"];this["Longitude"]+=t0U;this["Lattitude"]+=T0U;this["positionGeo"]["x"]=this["Longitude"];this["positionGeo"]["y"]=this["Lattitude"];this["commit"]();};k9U["prototype"]["pan"]=function(O0U,o0U,J0U,Z0U){this["panning"](O0U,o0U,J0U,Z0U);};k9U["prototype"]["localRotate"]=function(S0U,I0U,w0U,e0U){var x0U,i0U,p0U;x0U=w0U-S0U;i0U=e0U-I0U;if(x0U==0&&i0U==0)return;p0U=0.2;this["head"]+=x0U*p0U;this["tilt"]+=i0U*p0U;this["verifyTiltRange"]();this["verifyHeadRange"]();this["commit"]();};k9U["prototype"]["verifyTiltRange"]=function(){if(this["tilt"]<-89.99)this["tilt"]=-89.99;if(this["tilt"]>-0.01)this["tilt"]=-0.01;};k9U["prototype"]["verifyHeadRange"]=function(){if(this["head"]>360)this["head"]-=360;if(this["head"]<0)this["head"]+=360;};k9U["prototype"]["isUnderSeaLine"]=function(){if(this["tilt"]<-90){return true;}return false;};k9U["prototype"]["moveToward"]=function(v0U){this["Altitude"]-=v0U;this["distanceFromLook"]-=v0U;this["commit"]();};k9U["prototype"]["headDown"]=function(h0U){};k9U["prototype"]["moveRight"]=function(j0U){};k9U["prototype"]["beforeUpdate"]=function(){};k9U["prototype"]["update"]=function(){this["commit"]();};k9U["prototype"]["afterUpdate"]=function(){};k9U["prototype"]["calcViewRage"]=function(){};k9U["prototype"]["commit"]=function(){var b0U,K0U,Q0U,B0U,u0U,d0U,N0U,c0U,P0U,q0U;b0U=new THREE["Vector3"](0,0,this["distanceFromLook"]);K0U=new THREE["Vector3"](0,1,0);Q0U=new THREE["Vector3"](this["positionGeo"]["x"],this["positionGeo"]["y"],0);B0U=f6U["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],0);u0U=new THREE["Vector3"](b0U["x"],b0U["y"],b0U["z"]);d0U=new THREE["Vector3"](K0U["x"],K0U["y"],K0U["z"]);N0U=new THREE["Vector3"](0,0,0);c0U=new THREE["Quaternion"]();if(true){P0U=new THREE["Quaternion"]();q0U=new THREE["Quaternion"]();P0U["setFromAxisAngle"](this["ZAxis"],this["head"]*f6U["CmMathEngine"]["Deg2Rad"]);q0U["setFromAxisAngle"](this["XAxis"],-this["tilt"]*f6U["CmMathEngine"]["Deg2Rad"]);c0U["multiplyQuaternions"](c0U,P0U);c0U["multiplyQuaternions"](c0U,q0U);}u0U=f6U["CmMathEngine"]["MultiplyQuaternionVector"](c0U,u0U);d0U=f6U["CmMathEngine"]["MultiplyQuaternionVector"](c0U,d0U);u0U["add"](B0U);N0U["add"](B0U);{this["positionGeo"]=new THREE["Vector3"](this["positionGeo"]["x"],this["positionGeo"]["y"],this["distanceFromLook"]);this["position"]["x"]=u0U["x"];this["position"]["y"]=u0U["y"];this["position"]["z"]=u0U["z"];{this["mainCamera"]["position"]["set"](this["position"]["x"],this["position"]["y"],this["position"]["z"]);this["mainCamera"]["up"]["set"](d0U["x"],d0U["y"],d0U["z"]);this["mainCamera"]["lookAt"](N0U);this["mainCameraForPicking"]["position"]["set"](this["mainCamera"]["position"]["x"],this["mainCamera"]["position"]["y"],this["mainCamera"]["position"]["z"]);this["mainCameraForPicking"]["up"]["set"](this["mainCamera"]["up"]["x"],this["mainCamera"]["up"]["y"],this["mainCamera"]["up"]["z"]);this["mainCameraForPicking"]["lookAt"](N0U);}}};return k9U;}(f6U["Camera"]);f6U["CmCameraFlat3D"]=H9U;}(CMWORLD||(CMWORLD={})));CmAxis3D=function(){f0U["prototype"]["init"]=function(V72){var H72,k72,m72,L72,E72,s72,Y72,l72,r72,y72;if(V72!=null){H72=CMWORLD["cm_const"]["EarthRadius"]*2;k72=new THREE["Geometry"]();k72["vertices"]["push"](new THREE["Vector3"](0,0,0));k72["vertices"]["push"](new THREE["Vector3"](H72,0,0));m72=new THREE["Geometry"]();m72["vertices"]["push"](new THREE["Vector3"](0,0,0));m72["vertices"]["push"](new THREE["Vector3"](0,H72,0));L72=new THREE["Geometry"]();L72["vertices"]["push"](new THREE["Vector3"](0,0,0));L72["vertices"]["push"](new THREE["Vector3"](0,0,H72));E72=new THREE["LineBasicMaterial"]({color:0xff0000});s72=new THREE["LineBasicMaterial"]({color:0x00ff00});Y72=new THREE["LineBasicMaterial"]({color:0x0000ff});l72=new THREE["Line"](k72,E72);r72=new THREE["Line"](m72,s72);y72=new THREE["Line"](L72,Y72);V72["add"](l72);V72["add"](r72);V72["add"](y72);}};function f0U(){}return f0U;}();(function(F72){var W72;W72=function(){U72["addClippingAttri"]=function(G72){if(F72["Util"]["isDefined"](G72)){G72["clipping"]=true;G72["clippingPlanes"]=F72["CmWorld3"]["getInstance"]()["clipBox"]["localPlanes"];G72["clipIntersection"]=F72["CmWorld3"]["getInstance"]()["clipBox"]["clipIntersection"];}};function U72(){}return U72;}();F72["Material"]=W72;}(CMWORLD||(CMWORLD={})));(function(C72){var M72;M72=function(){function D72(){this["enabled"]=true;this["needsSwap"]=false;this["renderToScreen"]=false;}return D72;}();C72["CmPass"]=M72;}(CMWORLD||(CMWORLD={})));(function(A72){var z72;z72=function(){n72["prototype"]["init"]=function(){var R72,g72,X72,T72;R72=A72["CmWorld3"]["getInstance"]();this["innerRadius"]=this["radius"]*this["innerRadius"];this["outerRadius"]=this["radius"]*this["outerRadius"];g72={v3RefCenter:{type:"v3",value:new THREE["Vector3"](1e8,0,1e8)["normalize"]()},v3LightPosition:{type:"v3",value:new THREE["Vector3"](1e8,0,1e8)["normalize"]()},fCameraHeight:{type:"f",value:0},fCameraHeight2:{type:"f",value:0},fInnerRadius:{type:"f",value:this["innerRadius"]},fInnerRadius2:{type:"f",value:this["innerRadius"]*this["innerRadius"]},fOuterRadius:{type:"f",value:this["outerRadius"]},fOuterRadius2:{type:"f",value:this["outerRadius"]*this["outerRadius"]},fScale:{type:"f",value:1.0/(this["outerRadius"]-this["innerRadius"])},fScaleDepth:{type:"f",value:this["scaleDepth"]},fScaleOverScaleDepth:{type:"f",value:1.0/(this["outerRadius"]-this["innerRadius"])/this["scaleDepth"]}};X72=new THREE["SphereGeometry"](this["outerRadius"],320,160);T72=new THREE["ShaderMaterial"]({fragmentShader:R72["option"]["Shader"]["atmosphereskyps"],vertexShader:R72["option"]["Shader"]["atmosphereskyvb"],uniforms:g72,side:THREE["BackSide"],wireframe:false});this["skymesh"]=new THREE["Mesh"](X72,T72);this["skymesh"]["onBeforeRender"]=this["beforeSkyRender"];this["skymesh"]["onAfterRender"]=this["afterSkyRender"];R72["getSpaceScene"]()["add"](this["skymesh"]);this["isInitialized"]=true;};n72["prototype"]["release"]=function(){var a72;a72=A72["CmWorld3"]["getInstance"]();if(this["skymesh"]){a72["getSpaceScene"]()["remove"](this["skymesh"]);this["skymesh"]=null;}};n72["prototype"]["beforeSkyRender"]=function(o72,J72,t72,Z72,x72,i72){var O72;O72=A72["CmWorld3"]["getInstance"]();this["prefar"]=t72["far"];if(t72["far"]<A72["cm_const"]["EarthRadius"]){t72["far"]=A72["cm_const"]["EarthRadius"];}else{t72["far"]=t72["far"]*3;}t72["updateProjectionMatrix"]();};n72["prototype"]["afterSkyRender"]=function(S72,I72,p72,w72,e72,v72){S72["clearDepth"]();p72["far"]=this["prefar"];p72["updateProjectionMatrix"]();};n72["prototype"]["update"]=function(){var h72,P72,c72,q72,u72,K72,N72,d72,b72,B72,j72;h72=A72["CmWorld3"]["getInstance"]();if(h72["option"]["atmosphereEnabled"]==true){if(this["isInitialized"]==false){this["init"]();}P72=h72["getCamera"]();c72=h72["getCamera"]()["getThreejsCamera"]();q72=P72["getPositionGeo"]();u72=new THREE["Vector3"]();K72=A72["SunCalculator"]["getPosition"](h72["option"]["worldTimer"]["now"]());K72["normalize"]();if(c72 instanceof THREE["PerspectiveCamera"]){N72=c72;u72=N72["position"]["clone"]();d72=new THREE["Vector3"](0,0,0);d72["sub"](h72["option"]["refCenter"]);this["skymesh"]["position"]["copy"](d72);b72=K72;b72["normalize"]();u72["add"](h72["option"]["refCenter"]);B72=u72["length"]();j72=B72;this["skymesh"]["material"]["uniforms"]["v3RefCenter"]["value"]=h72["option"]["refCenter"];this["skymesh"]["material"]["uniforms"]["v3LightPosition"]["value"]=b72;this["skymesh"]["material"]["uniforms"]["fCameraHeight"]["value"]=j72;this["skymesh"]["material"]["uniforms"]["fCameraHeight2"]["value"]=j72*j72;}}};function n72(){this["radius"]=A72["cm_const"]["EarthRadius"];this["innerRadius"]=1.0;this["outerRadius"]=1.025;this["scaleDepth"]=0.25;this["sunPosition"]=new THREE["Vector3"]();this["zero"]=new THREE["Vector3"]();this["prenear"]=0.0;this["prefar"]=0.0;this["isInitialized"]=false;}return n72;}();A72["SkyShader"]=z72;}(CMWORLD||(CMWORLD={})));(function(Q72){var f72;f72=function(){H32["prototype"]["dispose"]=function(){};Object["defineProperty"](H32["prototype"],"clipIntersection",{get:function(){return this["_clipIntersection"];},set:function(k32){var m32,L32;if(this["_clipIntersection"]!=k32){this["_clipIntersection"]=k32;m32=this["cmworld"]["rootScene"];L32=this;m32["traverse"](function(V32){if(V32 instanceof THREE["Mesh"]){if(V32["material"]){V32["material"]["clipIntersection"]=L32["_clipIntersection"];}}});};},enumerable:true,configurable:true});Object["defineProperty"](H32["prototype"],"localMesh",{get:function(){return this["_localMesh"];},set:function(E32){this["_localMesh"]=E32;this["_localMesh"]["name"]="clipLocalMesh";this["cmworld"]["rootScene"]["add"](this["_localMesh"]);},enumerable:true,configurable:true});Object["defineProperty"](H32["prototype"],"globalMesh",{get:function(){return this["_globalMesh"];},set:function(y32){this["_globalMesh"]=y32;this["cmworld"]["rootScene"]["add"](this["_globalMesh"]);},enumerable:true,configurable:true});Object["defineProperty"](H32["prototype"],"localClipboxEnabled",{get:function(){return this["_localClipboxEnabled"];},set:function(s32){this["_localClipboxEnabled"]=s32;},enumerable:true,configurable:true});Object["defineProperty"](H32["prototype"],"globalClipboxEnabled",{get:function(){return this["_globalClipboxEnabled"];},set:function(Y32){this["_globalClipboxEnabled"]=Y32;},enumerable:true,configurable:true});H32["prototype"]["setGlobalPosition"]=function(l32,r32,F32){this["globalPositionGeo"]["set"](r32,l32,F32+Q72["cm_const"]["EarthRadius"]);};H32["prototype"]["getGlobalPosition"]=function(){return this["globalPositionGeo"];};H32["prototype"]["setLocalPosition"]=function(W32,U32,G32){this["localPositionGeo"]["set"](U32,W32,G32+Q72["cm_const"]["EarthRadius"]);};H32["prototype"]["getLocalPosition"]=function(){return this["localPositionGeo"];};H32["prototype"]["rotate4Earth"]=function(D32,M32){var C32;C32=Q72["CmMathEngineS3D"]["getRotateQuat"](M32["x"],M32["y"]);D32["quaternion"]["copy"](C32);};H32["prototype"]["updatePlanes"]=function(w32,Z32){var t32,O32,X32,J32,x32,R32,p32,z32,n32,i32,g32,a32,I32,S32,v32,T32;t32=new THREE["Vector3"]();O32=new THREE["Vector3"]();X32=new THREE["Vector3"]();J32=w32["matrix"];x32=w32["geometry"];R32=x32["vertices"];p32=x32["faces"];z32=[];for(var A32=0,e32=p32["length"];A32<e32;A32++){n32=p32[A32];if(this["_clipIntersection"]==true){t32["copy"](R32[n32["a"]]);O32["copy"](R32[n32["b"]]);X32["copy"](R32[n32["c"]]);}else{t32["copy"](R32[n32["a"]]);O32["copy"](R32[n32["c"]]);X32["copy"](R32[n32["b"]]);}t32["applyMatrix4"](J32);O32["applyMatrix4"](J32);X32["applyMatrix4"](J32);i32=new THREE["Plane"]();i32["setFromCoplanarPoints"](t32,O32,X32);z32["push"](i32);}if(z32["length"]>1){I32=[];for(var A32=0;A32<z32["length"];A32++){g32=z32[A32];S32=true;for(var o32=A32+1;o32<z32["length"];o32++){a32=z32[o32];if(!(Math["abs"](g32["normal"]["x"]-a32["normal"]["x"])>0.00001||Math["abs"](g32["normal"]["y"]-a32["normal"]["y"])>0.00001||Math["abs"](g32["normal"]["z"]-a32["normal"]["z"])>0.00001||Math["abs"](g32["constant"]-a32["constant"])>0.00001)){S32=false;}}if(S32==true){I32["push"](g32);}}}v32=Z32["length"];T32=0;Z32["length"]=0;for(T32=0;T32<z32["length"];T32++){Z32["push"](z32[T32]);}};H32["prototype"]["update"]=function(j32){var d32,u32,h32,K32,c32;d32=false;u32=Q72["CmWorld3"]["getInstance"]()["option"]["refCenter"];if(this["preRef"]["equals"](u32)==true){d32=true;}this["preRef"]["copy"](u32);if(this["_globalClipboxEnabled"]==true||this["_localClipboxEnabled"]==true){if(this["globalMesh"]){if(this["_globalClipboxEnabled"]==true){h32=Q72["CmMathEngine"]["Geo2Cartesian"](this["globalPositionGeo"]["x"],this["globalPositionGeo"]["y"],this["globalPositionGeo"]["z"]);h32["sub"](u32);this["globalMesh"]["position"]["set"](h32["x"],h32["y"],h32["z"]);this["rotate4Earth"](this["globalMesh"],this["globalPositionGeo"]);this["globalMesh"]["updateMatrix"]();this["updatePlanes"](this["globalMesh"],this["globalPlanes"]);j32["renderer"]["clippingPlanes"]=this["globalPlanes"];}else{j32["renderer"]["clippingPlanes"]=[];}}if(this["localMesh"]){if(this["_localClipboxEnabled"]==true){h32=Q72["CmMathEngine"]["Geo2Cartesian"](this["localPositionGeo"]["x"],this["localPositionGeo"]["y"],this["localPositionGeo"]["z"]);h32["sub"](u32);this["localMesh"]["position"]["set"](h32["x"],h32["y"],h32["z"]);this["rotate4Earth"](this["localMesh"],this["localPositionGeo"]);this["localMesh"]["updateMatrix"]();this["localMesh"]["updateMatrixWorld"](true);this["updatePlanes"](this["localMesh"],this["localPlanes"]);j32["renderer"]["localClippingEnabled"]=true;if(this["_localMesh"]){if(j32["rootScene"]["getObjectByName"]("clipLocalMesh")==null){j32["rootScene"]["add"](this["_localMesh"]);}}}else{j32["renderer"]["localClippingEnabled"]=false;}}}if(this["_localClipboxEnabled"]==false){j32["renderer"]["localClippingEnabled"]=false;if(this["_localMesh"]){j32["rootScene"]["remove"](this["_localMesh"]);}}K32=this["hidePlanes"][0];c32=j32["getCamera"]()["getThreejsCamera"]()["position"]["clone"]();K32["set"](c32,c32["length"]()+1);};function H32(){this["localPlanes"]=[];this["globalPlanes"]=[];this["hidePlanes"]=[];this["_clipIntersection"]=true;this["_localClipboxEnabled"]=false;this["_globalClipboxEnabled"]=false;this["globalPositionGeo"]=new THREE["Vector3"]();this["localPositionGeo"]=new THREE["Vector3"]();this["rotationQuaternion"]=new THREE["Quaternion"]();this["preRef"]=new THREE["Vector3"]();this["needGlobalClipboxUpdate"]=false;this["needLocalClipboxUpdate"]=false;this["cmworld"]=Q72["CmWorld3"]["getInstance"]();this["hidePlanes"]["push"](new THREE["Plane"]());}return H32;}();Q72["Clipbox"]=f72;}(CMWORLD||(CMWORLD={})));(function(b32){var N32;N32=function(){P32["prototype"]["init"]=function(){};function P32(){}return P32;}();N32["getTerraintMaterial"]=function(B32){var m82,f32,H82,y82,E82,L82,V82,k82,Q32;{m82=b32["CmWorld3"]["getInstance"]();B32=B32||{};if(B32["minFilter"]===undefined)B32["minFilter"]=THREE["LinearFilter"];f32={};H82={};y82=new THREE["Color"](0xffffff);E82=new THREE["Color"](0x010101);L82=new THREE["Color"](0x111111);V82=30;k82=1.0;for(var q32 in B32){if(q32=="map"){f32["USE_MAP"]="";}else if(q32=="color"){f32["USE_COLOR"]="";}else if(q32=="overlaymap"){f32["USE_OVERLAYMAP"]="";}else if(q32=="dynamictopmap"){f32["USE_DYNAMICTOPMAP"]="";}else if(q32=="diffuse"){y82=B32["diffuse"];}else if(q32=="emissive"){E82=B32["emissive"];}else if(q32=="specular"){L82=B32["specular"];}else if(q32=="shininess"){V82=B32["shininess"];}else if(q32=="opacity"){k82=B32["opacity"];}else{H82[q32]=B32[q32];}}if(m82["option"]["terrainTransparency"]==true){k82=m82["option"]["terrainOpacity"];B32["transparent"]=true;}f32["PHONG"]="";Q32=new THREE["ShaderMaterial"]({defines:f32,uniforms:THREE["UniformsUtils"]["merge"]([THREE["UniformsLib"]["common"],THREE["UniformsLib"]["fog"],THREE["UniformsLib"]["lights"],{emissive:{value:E82},specular:{value:L82},shininess:{value:V82},opacity:{value:k82},overlaymap:{value:null},dynamictopmap:{value:null}}]),vertexShader:["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","#endif",THREE["ShaderChunk"]["common"],THREE["ShaderChunk"]["color_pars_vertex"],THREE["ShaderChunk"]["uv_pars_vertex"],THREE["ShaderChunk"]["uv2_pars_vertex"],THREE["ShaderChunk"]["displacementmap_pars_vertex"],THREE["ShaderChunk"]["envmap_pars_vertex"],THREE["ShaderChunk"]["color_pars_vertex"],THREE["ShaderChunk"]["morphtarget_pars_vertex"],THREE["ShaderChunk"]["skinning_pars_vertex"],THREE["ShaderChunk"]["shadowmap_pars_vertex"],THREE["ShaderChunk"]["logdepthbuf_pars_vertex"],THREE["ShaderChunk"]["clipping_planes_pars_vertex"],"void main(){",THREE["ShaderChunk"]["uv_vertex"],THREE["ShaderChunk"]["uv2_vertex"],THREE["ShaderChunk"]["color_vertex"],THREE["ShaderChunk"]["beginnormal_vertex"],THREE["ShaderChunk"]["morphnormal_vertex"],THREE["ShaderChunk"]["skinbase_vertex"],THREE["ShaderChunk"]["skinnormal_vertex"],THREE["ShaderChunk"]["defaultnormal_vertex"],"#ifndef FLAT_SHADED","vNormal = normalize(transformedNormal);","#endif",THREE["ShaderChunk"]["begin_vertex"],THREE["ShaderChunk"]["morphtarget_vertex"],THREE["ShaderChunk"]["skinning_vertex"],THREE["ShaderChunk"]["displacementmap_vertex"],THREE["ShaderChunk"]["project_vertex"],THREE["ShaderChunk"]["logdepthbuf_vertex"],THREE["ShaderChunk"]["clipping_planes_vertex"],"vViewPosition = - mvPosition.xyz;",THREE["ShaderChunk"]["worldpos_vertex"],THREE["ShaderChunk"]["envmap_vertex"],THREE["ShaderChunk"]["shadowmap_vertex"],THREE["ShaderChunk"]["fog_vertex"],"}"]["join"]("\n"),fragmentShader:["#define PHYSICAL","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","#ifndef STANDARD","uniform float clearCoat;","uniform float clearCoatRoughness;","#endif","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","#endif","#ifdef USE_OVERLAYMAP","uniform sampler2D overlaymap;","#endif","#ifdef USE_DYNAMICTOPMAP","uniform sampler2D dynamictopmap;","#endif",THREE["ShaderChunk"]["common"],THREE["ShaderChunk"]["packing"],THREE["ShaderChunk"]["color_pars_fragment"],THREE["ShaderChunk"]["uv_pars_fragment"],THREE["ShaderChunk"]["uv2_pars_fragment"],THREE["ShaderChunk"]["map_pars_fragment"],THREE["ShaderChunk"]["alphamap_pars_fragment"],THREE["ShaderChunk"]["aomap_pars_fragment"],THREE["ShaderChunk"]["lightmap_pars_fragment"],THREE["ShaderChunk"]["emissivemap_pars_fragment"],THREE["ShaderChunk"]["envmap_pars_fragment"],THREE["ShaderChunk"]["fog_pars_fragment"],THREE["ShaderChunk"]["bsdfs"],THREE["ShaderChunk"]["cube_uv_reflection_fragment"],THREE["ShaderChunk"]["lights_pars_begin"],THREE["ShaderChunk"]["envmap_physical_pars_fragment"],THREE["ShaderChunk"]["lights_physical_pars_fragment"],THREE["ShaderChunk"]["shadowmap_pars_fragment"],THREE["ShaderChunk"]["bumpmap_pars_fragment"],THREE["ShaderChunk"]["normalmap_pars_fragment"],THREE["ShaderChunk"]["roughnessmap_pars_fragment"],THREE["ShaderChunk"]["metalnessmap_pars_fragment"],THREE["ShaderChunk"]["logdepthbuf_pars_fragment"],THREE["ShaderChunk"]["clipping_planes_pars_fragment"],"void main(){",THREE["ShaderChunk"]["clipping_planes_fragment"],"vec4 diffuseColor = vec4(diffuse, opacity);","ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));","vec3 totalEmissiveRadiance = emissive;",THREE["ShaderChunk"]["logdepthbuf_fragment"],THREE["ShaderChunk"]["map_fragment"],THREE["ShaderChunk"]["color_fragment"],"#ifdef USE_OVERLAYMAP","vec4 overColor = texture2D(overlaymap, vUv);","overColor = mapTexelToLinear(overColor);","if(overColor.a == 1.0)","{","   diffuseColor = overColor.rgba;","}","else if(overColor.a >= 0.0)","{","   overColor.rgb = (1.0 - overColor.a) * diffuseColor.rgb + overColor.a * overColor.rgb;","   diffuseColor = vec4(overColor.rgb, diffuseColor.a);","}","#endif","#ifdef USE_DYNAMICTOPMAP","overColor = texture2D(dynamictopmap, vUv);","overColor = mapTexelToLinear(overColor);","if (overColor.a == 1.0)","{","   diffuseColor = overColor.rgba;","}","else if (overColor.a >= 0.0)","{","   overColor.rgb = (1.0 - overColor.a) * diffuseColor.rgb + overColor.a * overColor.rgb;","   diffuseColor = vec4(overColor.rgb, diffuseColor.a);","}","#endif",THREE["ShaderChunk"]["alphamap_fragment"],THREE["ShaderChunk"]["alphatest_fragment"],THREE["ShaderChunk"]["roughnessmap_fragment"],THREE["ShaderChunk"]["metalnessmap_fragment"],THREE["ShaderChunk"]["normal_fragment_begin"],THREE["ShaderChunk"]["normal_fragment_maps"],THREE["ShaderChunk"]["emissivemap_fragment"],THREE["ShaderChunk"]["lights_physical_fragment"],THREE["ShaderChunk"]["lights_fragment_begin"],THREE["ShaderChunk"]["lights_fragment_maps"],THREE["ShaderChunk"]["lights_fragment_end"],THREE["ShaderChunk"]["aomap_fragment"],"   vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;","gl_FragColor = vec4(outgoingLight, diffuseColor.a);",THREE["ShaderChunk"]["tonemapping_fragment"],THREE["ShaderChunk"]["encodings_fragment"],THREE["ShaderChunk"]["fog_fragment"],THREE["ShaderChunk"]["premultiplied_alpha_fragment"],THREE["ShaderChunk"]["dithering_fragment"],"}"]["join"]("\n")});Q32["lights"]=true;if(B32["map"]){Q32["uniforms"]["map"]["value"]=B32["map"];Q32["needsUpdate"]=true;}if(B32["color"]){Q32["color"]=B32["color"];Q32["needsUpdate"]=true;}if(B32["overlaymap"]){Q32["uniforms"]["overlaymap"]["value"]=B32["overlaymap"];Q32["needsUpdate"]=true;}if(B32["dynamictopmap"]){Q32["uniforms"]["dynamictopmap"]["value"]=B32["dynamictopmap"];Q32["needsUpdate"]=true;}for(var q32 in H82){Q32[q32]=H82[q32];}Q32["uniforms"]["ambientLightColor"]["value"]=new THREE["Vector4"](0.9,0.9,0.9,1.0);}b32["Material"]["addClippingAttri"](Q32);return Q32;};N32["getVoxelMaterial"]=function(s82){var W82,r82,F82,U82,C82,D82,M82,G82,Y82;{W82=b32["CmWorld3"]["getInstance"]();s82=s82||{};if(s82["minFilter"]===undefined)s82["minFilter"]=THREE["LinearFilter"];r82={};F82={};U82=new THREE["Color"](0xffffff);C82=new THREE["Color"](0x010101);D82=new THREE["Color"](0x111111);M82=30;G82=1.0;for(var l82 in s82){if(l82=="map"){r82["USE_MAP"]="";}else if(l82=="diffuse"){U82=s82["diffuse"];}else{F82[l82]=s82[l82];}}if(W82["option"]["terrainTransparency"]==true){G82=W82["option"]["terrainOpacity"];s82["transparent"]=true;}r82["PHONG"]="";Y82=new THREE["ShaderMaterial"]({defines:r82,uniforms:THREE["UniformsUtils"]["merge"]([THREE["UniformsLib"]["common"]]),vertexShader:["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","attribute vec3 translate;","attribute vec3 tcolor;","varying vec3 vtColor;","#endif",THREE["ShaderChunk"]["common"],THREE["ShaderChunk"]["color_pars_vertex"],THREE["ShaderChunk"]["uv_pars_vertex"],THREE["ShaderChunk"]["uv2_pars_vertex"],THREE["ShaderChunk"]["color_pars_vertex"],THREE["ShaderChunk"]["logdepthbuf_pars_vertex"],THREE["ShaderChunk"]["clipping_planes_pars_vertex"],"void main(){",THREE["ShaderChunk"]["uv_vertex"],THREE["ShaderChunk"]["uv2_vertex"],THREE["ShaderChunk"]["color_vertex"],THREE["ShaderChunk"]["beginnormal_vertex"],THREE["ShaderChunk"]["defaultnormal_vertex"],"#ifndef FLAT_SHADED","vNormal = normalize(transformedNormal);","#endif",THREE["ShaderChunk"]["begin_vertex"],THREE["ShaderChunk"]["displacementmap_vertex"],THREE["ShaderChunk"]["project_vertex"],THREE["ShaderChunk"]["logdepthbuf_vertex"],THREE["ShaderChunk"]["clipping_planes_vertex"],"mvPosition = modelViewMatrix * vec4(translate, 1.0);","vtColor = tcolor;","mvPosition.xyz += position;","vViewPosition = -mvPosition.xyz;","gl_Position = projectionMatrix * mvPosition;",THREE["ShaderChunk"]["worldpos_vertex"],THREE["ShaderChunk"]["envmap_vertex"],THREE["ShaderChunk"]["shadowmap_vertex"],THREE["ShaderChunk"]["fog_vertex"],"}"]["join"]("\n"),fragmentShader:["#define PHYSICAL","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","#ifndef STANDARD","uniform float clearCoat;","uniform float clearCoatRoughness;","#endif","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","varying vec3 vtColor;","#endif","#ifdef USE_OVERLAYMAP","uniform sampler2D overlaymap;","#endif","#ifdef USE_DYNAMICTOPMAP","uniform sampler2D dynamictopmap;","#endif",THREE["ShaderChunk"]["common"],THREE["ShaderChunk"]["packing"],THREE["ShaderChunk"]["color_pars_fragment"],THREE["ShaderChunk"]["uv_pars_fragment"],THREE["ShaderChunk"]["uv2_pars_fragment"],THREE["ShaderChunk"]["map_pars_fragment"],THREE["ShaderChunk"]["bsdfs"],THREE["ShaderChunk"]["cube_uv_reflection_fragment"],THREE["ShaderChunk"]["logdepthbuf_pars_fragment"],THREE["ShaderChunk"]["clipping_planes_pars_fragment"],"void main(){",THREE["ShaderChunk"]["clipping_planes_fragment"],"vec4 diffuseColor = vec4(diffuse, opacity);","ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));","vec3 totalEmissiveRadiance = emissive;",THREE["ShaderChunk"]["logdepthbuf_fragment"],THREE["ShaderChunk"]["map_fragment"],THREE["ShaderChunk"]["color_fragment"],THREE["ShaderChunk"]["normal_fragment_begin"],THREE["ShaderChunk"]["normal_fragment_maps"],THREE["ShaderChunk"]["emissivemap_fragment"],"gl_FragColor = vec4(vtColor.xyz, 1);","}"]["join"]("\n")});Y82["lights"]=false;if(s82["map"]){Y82["uniforms"]["map"]["value"]=s82["map"];Y82["needsUpdate"]=true;}if(s82["color"]){Y82["color"]=s82["color"];Y82["needsUpdate"]=true;}for(var l82 in F82){Y82[l82]=F82[l82];}}b32["Material"]["addClippingAttri"](Y82);return Y82;};b32["CmShaderLib"]=N32;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var A82;A82=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(z82,n82){z82["__proto__"]=n82;}||function(X82,g82){for(var R82 in g82)if(g82["hasOwnProperty"](R82))X82[R82]=g82[R82];};return function(a82,T82){A82(a82,T82);a82["prototype"]=T82===null?Object["create"](T82):(t82["prototype"]=T82["prototype"],new t82());function t82(){this["constructor"]=a82;}};}();(function(O82){var o82;o82=function(Z82){__extends(J82,Z82);J82["prototype"]["setupAnaglyph"]=function(){var e82,v82,h82,j82;e82=O82["CmWorld3"]["getInstance"]();this["AG_cameraL"]=new THREE["PerspectiveCamera"]();this["AG_cameraL"]["matrixAutoUpdate"]=false;this["AG_cameraR"]=new THREE["PerspectiveCamera"]();this["AG_cameraR"]["matrixAutoUpdate"]=false;this["AG_camera"]=new THREE["OrthographicCamera"](-1,1,1,-1,0,1);this["AG_scene"]=new THREE["Scene"]();this["AG_params"]={minFilter:THREE["LinearFilter"],magFilter:THREE["NearestFilter"],format:THREE["RGBAFormat"]};v82=e82["canvas"]["width"];h82=e82["canvas"]["height"];this["AG_renderTargetL"]=new THREE["WebGLRenderTarget"](v82,h82,this["AG_params"]);this["AG_renderTargetR"]=new THREE["WebGLRenderTarget"](v82,h82,this["AG_params"]);this["AG_material"]=new THREE["ShaderMaterial"]({uniforms:{"mapLeft":{type:"t",value:this["AG_renderTargetL"]},"mapRight":{type:"t",value:this["AG_renderTargetR"]}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"]["join"]("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","	vec4 colorL, colorR;","	vec2 uv = vUv;","	colorL = texture2D( mapLeft, uv );","	colorR = texture2D( mapRight, uv );","	gl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;","}"]["join"]("\n")});j82=new THREE["Mesh"](new THREE["PlaneGeometry"](2,2),this["AG_material"]);this["AG_scene"]["add"](j82);};function J82(I82,w82,p82,S82,i82){var x82;if(I82===void 0){I82=null;}if(w82===void 0){w82=null;}if(p82===void 0){p82=null;}if(S82===void 0){S82=null;}if(i82===void 0){i82=null;}x82=Z82["call"](this)||this;x82["clear"]=true;x82["overrideMaterial"]=null;x82["clearColor"]=null;x82["clearAlpha"]=1;x82["oldClearColor"]=new THREE["Color"]();x82["oldClearAlpha"]=1;x82["EnableAnaglyph"]=false;x82["AG_material"]=null;x82["AG_camera"]=null;x82["AG_cameraL"]=null;x82["AG_cameraR"]=null;x82["AG_scene"]=null;x82["AG_renderTargetL"]=null;x82["AG_renderTargetR"]=null;x82["AG_params"]={};x82["AGeyeRight"]=new THREE["Matrix4"]();x82["AGeyeLeft"]=new THREE["Matrix4"]();x82["AGfocalLength"]=125;x82["cmImmediateRender"]=null;x82["overrideMaterial"]=p82;x82["clearColor"]=S82;x82["clearAlpha"]=i82!==undefined?i82:1;return x82;}J82["prototype"]["setSize"]=function(u82,c82){if(this["EnableAnaglyph"]==true){this["AG_renderTargetL"]=new THREE["WebGLRenderTarget"](u82,c82,this["AG_params"]);this["AG_renderTargetR"]=new THREE["WebGLRenderTarget"](u82,c82,this["AG_params"]);this["AG_material"]["uniforms"]["mapLeft"]["value"]=this["AG_renderTargetL"];this["AG_material"]["uniforms"]["mapRight"]["value"]=this["AG_renderTargetR"];}};J82["prototype"]["clearAnaglyph"]=function(){};J82["prototype"]["renderAnaglyph"]=function(f82,Q82,L42,k42,m42){var d82,H42,N82,q82,B82,P82,b82,K82;d82=f82["getCamera"]()["mainCamera"];H42=this["AG_aspect"]!==d82["aspect"]||this["AG_near"]!==d82["near"]||this["AG_far"]!==d82["far"]||this["AG_fov"]!==d82["fov"];if(H42){this["AG_aspect"]=d82["aspect"];this["AG_near"]=d82["near"];this["AG_far"]=d82["far"];this["AG_fov"]=d82["fov"];N82=d82["projectionMatrix"]["clone"]();q82=this["AGfocalLength"]/30*0.5;B82=q82*this["AG_near"]/this["AGfocalLength"];P82=this["AG_near"]*Math["tan"](THREE["Math"]["degToRad"](this["AG_fov"]*0.5));this["AGeyeRight"]["elements"][12]=q82;this["AGeyeLeft"]["elements"][12]=-q82;b82=-P82*this["AG_aspect"]+B82;K82=P82*this["AG_aspect"]+B82;N82["elements"][0]=2*this["AG_near"]/(K82-b82);N82["elements"][8]=(K82+b82)/(K82-b82);this["AG_cameraL"]["projectionMatrix"]["copy"](N82);b82=-P82*this["AG_aspect"]-B82;K82=P82*this["AG_aspect"]-B82;N82["elements"][0]=2*this["AG_near"]/(K82-b82);N82["elements"][8]=(K82+b82)/(K82-b82);this["AG_cameraR"]["projectionMatrix"]["copy"](N82);}this["AG_cameraL"]["matrixWorld"]["copy"](d82["matrixWorld"])["multiply"](this["AGeyeLeft"]);this["AG_cameraL"]["position"]["copy"](d82["position"]);this["AG_cameraL"]["near"]=d82["near"];this["AG_cameraL"]["far"]=d82["far"];Q82["render"](f82["rootScene"],this["AG_cameraL"],this["AG_renderTargetL"],true);this["AG_cameraR"]["matrixWorld"]["copy"](d82["matrixWorld"])["multiply"](this["AGeyeRight"]);this["AG_cameraR"]["position"]["copy"](d82["position"]);this["AG_cameraR"]["near"]=d82["near"];this["AG_cameraR"]["far"]=d82["far"];Q82["render"](f82["rootScene"],this["AG_cameraR"],this["AG_renderTargetR"],true);Q82["render"](this["AG_scene"],this["AG_camera"],k42,this["clear"]);};J82["prototype"]["render"]=function(V42,Y42,y42,l42){var E42,s42;E42=O82["CmWorld3"]["getInstance"]();E42["rootScene"]["overrideMaterial"]=this["overrideMaterial"];if(this["clearColor"]){this["oldClearColor"]["copy"](V42["getClearColor"]());this["oldClearAlpha"]=V42["getClearAlpha"]();V42["setClearColor"](this["clearColor"],this["clearAlpha"]);}if(this["EnableAnaglyph"]==true){this["renderAnaglyph"](E42,V42,Y42,y42,l42);}else{s42=E42["getCamera"]();V42["render"](E42["rootScene"],s42["getThreejsCamera"](),y42,this["clear"]);}if(this["cmImmediateRender"]){this["cmImmediateRender"]();}if(this["clearColor"]){V42["setClearColor"](this["oldClearColor"],this["oldClearAlpha"]);}E42["rootScene"]["overrideMaterial"]=null;};return J82;}(O82["CmPass"]);O82["CmBasePass"]=o82;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var r42;r42=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(F42,W42){F42["__proto__"]=W42;}||function(M42,G42){for(var U42 in G42)if(G42["hasOwnProperty"](U42))M42[U42]=G42[U42];};return function(D42,C42){r42(D42,C42);D42["prototype"]=C42===null?Object["create"](C42):(A42["prototype"]=C42["prototype"],new A42());function A42(){this["constructor"]=D42;}};}();(function(z42){var n42;n42=function(g42){__extends(R42,g42);R42["prototype"]["setupAnaglyph"]=function(){var J42,Z42,x42,i42;J42=z42["CmWorld3"]["getInstance"]();this["AG_cameraL"]=new THREE["PerspectiveCamera"]();this["AG_cameraL"]["matrixAutoUpdate"]=false;this["AG_cameraR"]=new THREE["PerspectiveCamera"]();this["AG_cameraR"]["matrixAutoUpdate"]=false;this["AG_camera"]=new THREE["OrthographicCamera"](-1,1,1,-1,0,1);this["AG_scene"]=new THREE["Scene"]();this["AG_params"]={minFilter:THREE["LinearFilter"],magFilter:THREE["NearestFilter"],format:THREE["RGBAFormat"]};Z42=J42["canvas"]["width"];x42=J42["canvas"]["height"];this["AG_renderTargetL"]=new THREE["WebGLRenderTarget"](Z42,x42,this["AG_params"]);this["AG_renderTargetR"]=new THREE["WebGLRenderTarget"](Z42,x42,this["AG_params"]);this["AG_material"]=new THREE["ShaderMaterial"]({uniforms:{"mapLeft":{type:"t",value:this["AG_renderTargetL"]},"mapRight":{type:"t",value:this["AG_renderTargetR"]}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"]["join"]("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","	vec4 colorL, colorR;","	vec2 uv = vUv;","	colorL = texture2D( mapLeft, uv );","	colorR = texture2D( mapRight, uv );","	gl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;","}"]["join"]("\n")});i42=new THREE["Mesh"](new THREE["PlaneGeometry"](2,2),this["AG_material"]);this["AG_scene"]["add"](i42);};function R42(O42,o42,a42,t42,T42){var X42;if(O42===void 0){O42=null;}if(o42===void 0){o42=null;}if(a42===void 0){a42=null;}if(t42===void 0){t42=null;}if(T42===void 0){T42=null;}X42=g42["call"](this)||this;X42["clear"]=true;X42["overrideMaterial"]=null;X42["clearColor"]=null;X42["clearAlpha"]=1;X42["oldClearColor"]=new THREE["Color"]();X42["oldClearAlpha"]=1;X42["EnableAnaglyph"]=false;X42["AG_material"]=null;X42["AG_camera"]=null;X42["AG_cameraL"]=null;X42["AG_cameraR"]=null;X42["AG_scene"]=null;X42["AG_renderTargetL"]=null;X42["AG_renderTargetR"]=null;X42["AG_params"]={};X42["AGeyeRight"]=new THREE["Matrix4"]();X42["AGeyeLeft"]=new THREE["Matrix4"]();X42["AGfocalLength"]=125;X42["overrideMaterial"]=a42;X42["clearColor"]=t42;X42["clearAlpha"]=T42!==undefined?T42:1;return X42;}R42["prototype"]["setSize"]=function(p42,S42){if(this["EnableAnaglyph"]==true){this["AG_renderTargetL"]=new THREE["WebGLRenderTarget"](p42,S42,this["AG_params"]);this["AG_renderTargetR"]=new THREE["WebGLRenderTarget"](p42,S42,this["AG_params"]);this["AG_material"]["uniforms"]["mapLeft"]["value"]=this["AG_renderTargetL"];this["AG_material"]["uniforms"]["mapRight"]["value"]=this["AG_renderTargetR"];}};R42["prototype"]["clearAnaglyph"]=function(){};R42["prototype"]["renderAnaglyph"]=function(d42,c42,P42,b42,N42){var I42,K42,v42,u42,j42,h42,e42,w42;I42=d42["getCamera"]()["mainCamera"];K42=this["AG_aspect"]!==I42["aspect"]||this["AG_near"]!==I42["near"]||this["AG_far"]!==I42["far"]||this["AG_fov"]!==I42["fov"];if(K42){this["AG_aspect"]=I42["aspect"];this["AG_near"]=I42["near"];this["AG_far"]=I42["far"];this["AG_fov"]=I42["fov"];v42=I42["projectionMatrix"]["clone"]();u42=this["AGfocalLength"]/30*0.5;j42=u42*this["AG_near"]/this["AGfocalLength"];h42=this["AG_near"]*Math["tan"](THREE["Math"]["degToRad"](this["AG_fov"]*0.5));this["AGeyeRight"]["elements"][12]=u42;this["AGeyeLeft"]["elements"][12]=-u42;e42=-h42*this["AG_aspect"]+j42;w42=h42*this["AG_aspect"]+j42;v42["elements"][0]=2*this["AG_near"]/(w42-e42);v42["elements"][8]=(w42+e42)/(w42-e42);this["AG_cameraL"]["projectionMatrix"]["copy"](v42);e42=-h42*this["AG_aspect"]-j42;w42=h42*this["AG_aspect"]-j42;v42["elements"][0]=2*this["AG_near"]/(w42-e42);v42["elements"][8]=(w42+e42)/(w42-e42);this["AG_cameraR"]["projectionMatrix"]["copy"](v42);}this["AG_cameraL"]["matrixWorld"]["copy"](I42["matrixWorld"])["multiply"](this["AGeyeLeft"]);this["AG_cameraL"]["position"]["copy"](I42["position"]);this["AG_cameraL"]["near"]=I42["near"];this["AG_cameraL"]["far"]=I42["far"];c42["render"](d42["rootScene"],this["AG_cameraL"],this["AG_renderTargetL"],true);this["AG_cameraR"]["matrixWorld"]["copy"](I42["matrixWorld"])["multiply"](this["AGeyeRight"]);this["AG_cameraR"]["position"]["copy"](I42["position"]);this["AG_cameraR"]["near"]=I42["near"];this["AG_cameraR"]["far"]=I42["far"];c42["render"](d42["rootScene"],this["AG_cameraR"],this["AG_renderTargetR"],true);c42["render"](this["AG_scene"],this["AG_camera"],b42,this["clear"]);};R42["prototype"]["render"]=function(Q42,m22,f42,L22){var q42,H22,B42,k22;q42=z42["CmWorld3"]["getInstance"]();q42["rootScene"]["overrideMaterial"]=this["overrideMaterial"];if(this["EnableAnaglyph"]==true){this["renderAnaglyph"](q42,Q42,m22,f42,L22);}else{H22=q42["getCamera"]();B42=H22["getThreejsCamera"]();k22=B42["far"];try{B42["far"]*=3;B42["updateProjectionMatrix"]();Q42["render"](q42["getSpaceScene"](),B42,f42,this["clear"]);}catch(V22){console["error"](V22);}finally{B42["far"]=k22;B42["updateProjectionMatrix"]();}}q42["rootScene"]["overrideMaterial"]=null;};return R42;}(z42["CmPass"]);z42["CmSpacePass"]=n42;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var E22;E22=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(y22,s22){y22["__proto__"]=s22;}||function(r22,l22){for(var Y22 in l22)if(l22["hasOwnProperty"](Y22))r22[Y22]=l22[Y22];};return function(W22,F22){function U22(){this["constructor"]=W22;}E22(W22,F22);W22["prototype"]=F22===null?Object["create"](F22):(U22["prototype"]=F22["prototype"],new U22());};}();(function(G22){var M22;M22=function(D22){__extends(C22,D22);C22["prototype"]["update"]=function(){this["hudContext"]["setTransform"](1,0,0,1,0,0);this["hudContext"]["fillStyle"]="rgba(255,0,0,1)";this["hudContext"]["clearRect"](0,0,this["hudCanvas"]["width"],this["hudCanvas"]["height"]);this["hudContext"]["globalAlpha"]=1.0;};C22["prototype"]["updateCanvasSize"]=function(z22,n22){var R22;this["scene"]=new THREE["Scene"]();this["hudCanvas"]=document["createElement"]('canvas');this["hudCanvas"]["width"]=z22;this["hudCanvas"]["height"]=n22;this["hudCanvas"]["transparent"]=true;this["hudContext"]=this["hudCanvas"]["getContext"]('2d');this["camera"]=new THREE["OrthographicCamera"](-z22/2,z22/2,n22/2,-n22/2,0,30);this["hudTexture"]=new THREE["Texture"](this["hudCanvas"]);this["hudTexture"]["minFilter"]=THREE["LinearFilter"];this["hudTexture"]["needsUpdate"]=true;this["uniforms"]={mainTex:{type:"t",value:null},subTex:{type:"t",value:this["hudTexture"]}};this["material"]=new THREE["ShaderMaterial"]({uniforms:this["uniforms"],vertexShader:["varying vec2 vUv;","varying vec3 vPosition;","void main( void )  {","   vUv = uv;","   vPosition = position;","   gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1); }"]["join"]("\n"),fragmentShader:["uniform sampler2D mainTex;","uniform sampler2D subTex;","varying vec2 vUv;","void main()  {","   vec3 c;","   vec4 mainColor = texture2D(mainTex, vUv);","   vec4 overColor = texture2D(subTex, vUv);","   if(overColor.a == 0.0)","   {","      c = mainColor.rgb;","   }","   else if(overColor.a == 1.0)","   {","      c = overColor.rgb;","   }","   else","   {","      c = (1.0 - overColor.a) * mainColor.rgb + overColor.a * overColor.rgb;","   }","   gl_FragColor= vec4(c, 1.0);","}"]["join"]("\n")});this["material"]["transparent"]=true;R22=new THREE["PlaneGeometry"](this["hudCanvas"]["width"],this["hudCanvas"]["height"]);this["hudPlane"]=new THREE["Mesh"](R22,this["material"]);this["scene"]["add"](this["hudPlane"]);this["update"]();};function C22(){var A22;A22=D22["call"](this)||this;A22["hudCanvas"]=null;A22["hudContext"]=null;A22["hudTexture"]=null;A22["scene"]=null;A22["camera"]=null;A22["uniforms"]=null;A22["material"]=null;A22["hudPlane"]=null;A22["needsSwap"]=true;A22["renderToScreen"]=true;A22["updateCanvasSize"](G22["CmWorld3"]["getInstance"]()["canvas"]["width"],G22["CmWorld3"]["getInstance"]()["canvas"]["height"]);return A22;}C22["prototype"]["render"]=function(g22,X22,T22,a22){this["hudTexture"]["needsUpdate"]=true;this["uniforms"]["mainTex"]["value"]=T22;this["hudPlane"]["material"]=this["material"];if(this["renderToScreen"]){g22["render"](this["scene"],this["camera"]);}else{g22["render"](this["scene"],this["camera"],X22,false);}};C22["prototype"]["setSize"]=function(t22,O22){this["updateCanvasSize"](t22,O22);};return C22;}(G22["CmPass"]);G22["HUDPass"]=M22;}(CMWORLD||(CMWORLD={})));(function(J22){var o22;o22=function(){function Z22(){}return Z22;}();o22["cubeVS"]=["precision highp float;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat4 modelMatrix;","uniform float cubeAlpha; //외부에서 알파를 조절하기위해서","attribute vec4 userValueTypeColor;","attribute vec3 position;","attribute vec3 offset;","attribute vec3 size;","attribute vec2 texCoord;","varying vec4 vValueTypeColor;","varying vec2 vTexCoord;","varying float vCubeAlpha;","void main(){","vec3 v3Pos;","v3Pos = vec3(position.x * size.x, position.y * size.y, position.z * size.z);","vec4 vec4Offset = vec4(offset, 1.0);","vec4 modelCol1 = modelMatrix[0];","vec4 modelCol2 = modelMatrix[1];","vec4 modelCol3 = modelMatrix[2];","vec4 modelCol4 = modelMatrix[3] + vec4Offset;","modelCol4.w = 1.0;","mat4 modelMat = mat4(modelCol1, modelCol2, modelCol3, modelCol4);","mat4 modelViewMat = viewMatrix * modelMat;","gl_Position = projectionMatrix * modelViewMat * vec4(v3Pos, 1.0);","vTexCoord = texCoord;","vValueTypeColor = userValueTypeColor;","vCubeAlpha = cubeAlpha;","}"]["join"]("\n");o22["cubeFS"]=["precision highp float;","uniform sampler2D textureMap;","uniform float uCubeAlpha;","varying vec4 vValueTypeColor;","varying vec2 vTexCoord;","//varying float vCubeAlpha;","void main() {","// gl_FragColor = vValueTypeColor;","vec4 v4Color = vec4(vValueTypeColor.xyzw);","if(uCubeAlpha > 0.0){","   v4Color = vec4(vValueTypeColor.xyz, uCubeAlpha );","}","gl_FragColor = texture2D(textureMap, vTexCoord) * v4Color;","}"]["join"]("\n");J22["ShaderCode"]=o22;}(CMWORLD||(CMWORLD={})));(function(x22){var i22;i22=function(){p22["prototype"]["dispose"]=function(){this["disposed"]=true;};p22["prototype"]["initTile"]=function(){this["keyNumber"]=-1;};p22["prototype"]["getLayer"]=function(){return this["parentLayer"];};function p22(S22){this["level"]=-1;this["row"]=-1;this["col"]=-1;this["originCoord"]=new THREE["Vector3"](0,0,0);this["keyNumber"]=-1;this["disposed"]=false;this["parentLayer"]=null;this["parentLayer"]=S22;this["initTile"]();}p22["prototype"]["isAlive"]=function(){return!this["disposed"];};p22["prototype"]["update"]=function(){};p22["prototype"]["setTileInfo"]=function(I22,w22,e22){this["level"]=I22;this["row"]=w22;this["col"]=e22;};p22["prototype"]["setName"]=function(v22){this["name"]=v22;};p22["prototype"]["getBoundary"]=function(){if(this["boundary"]==null){this["boundary"]=x22["CmMathEngine"]["getBoundFromRowCol"](this["level"],this["row"],this["col"]);}return this["boundary"];};p22["getBoundary"]=function(h22,j22,u22){return x22["CmMathEngine"]["getBoundFromRowCol"](h22,j22,u22);};p22["getKeyString"]=function(d22,K22,b22){var c22;c22="{z}:{y}:{x}";c22=c22["replace"](/\u007b\x7a\u007d/gi,d22["toString"]());c22=c22["replace"](/\x7b\u0079\x7d/gi,K22["toString"]());c22=c22["replace"](/\u007b\x78\u007d/gi,b22["toString"]());return c22;};p22["prototype"]["getKey"]=function(){return x22["Tile"]["getKeyString"](this["level"],this["row"],this["col"]);};p22["prototype"]["getKeyNumber"]=function(){if(this["keyNumber"]<0){this["keyNumber"]=this["row"]*10000000+this["col"];}return this["keyNumber"];};p22["prototype"]["setKeyNumber"]=function(N22){this["keyNumber"]=N22;};p22["prototype"]["setOrigin"]=function(P22){this["originCoord"]=P22["clone"]();};p22["prototype"]["getTileLevel"]=function(){return this["level"];};return p22;}();x22["Tile"]=i22;}(CMWORLD||(CMWORLD={})));(function(B22){var q22;q22=function(){Q22["prototype"]["dispose"]=function(){};function Q22(){this["styleArray"]=new Array();this["defaultStyle"]=new B22["StyleInfo"]();this["useDefaultStyle"]=true;}Q22["prototype"]["addStyle"]=function(f22,H12){this["styleArray"][f22]=H12;};Q22["prototype"]["getStyle"]=function(L12,k12){var V12;if(k12===void 0){k12=undefined;}if(this["styleArray"][L12]!=null){if(k12){V12=this["styleArray"][L12];return V12[k12];}else{return this["styleArray"][L12];}}if(this["useDefaultStyle"]){return this["defaultStyle"];}return null;};Q22["prototype"]["updateStyle"]=function(E12,s12,Y12){var y12;if(this["styleArray"][E12]!=null){y12=this["styleArray"][E12];y12[s12]=Y12;}};Q22["prototype"]["removeStyle"]=function(l12){delete this["styleArray"][l12];};Q22["prototype"]["clear"]=function(){this["styleArray"]=[];};return Q22;}();B22["StyleManager"]=q22;}(CMWORLD||(CMWORLD={})));(function(F12){var r12;r12=function(){W12["prototype"]["dispose"]=function(){};function W12(){this["_tiles"]=new Array();}W12["prototype"]["update"]=function(){this["_tiles"]["length"]=0;};W12["prototype"]["setShowTile"]=function(U12,G12,C12,M12){if(M12===void 0){M12=true;}if(this["_tiles"][U12]==null)this["_tiles"][U12]=new Array();if(this["_tiles"][U12][G12]==null)this["_tiles"][U12][G12]=new Array();this["_tiles"][U12][G12][C12]=M12;};W12["prototype"]["isShow"]=function(D12,A12,z12){if(this["_tiles"][D12]!=null){if(this["_tiles"][D12][A12]!=null){if(this["_tiles"][D12][A12][z12]){return true;}}}return false;};W12["prototype"]["getDistance"]=function(){return 0;};return W12;}();F12["QuadTileQuery"]=r12;}(CMWORLD||(CMWORLD={})));(function(n12){var R12;R12=function(){g12["purifyFileFormat"]=function(T12){var X12;if(n12["Util"]["isDefined"](T12)){if(typeof T12=='number'){return T12;}X12=T12;X12=X12["toLowerCase"]();if(X12["indexOf"]("jpg")>-1)return n12["FileFormat"]["_jpg"];if(X12["indexOf"]("png")>-1)return n12["FileFormat"]["_png"];if(X12["indexOf"]("cbt")>-1)return n12["FileFormat"]["_cbt"];if(X12["indexOf"]("json")>-1)return n12["FileFormat"]["_json"];if(X12["indexOf"]("cmv")>-1)return n12["FileFormat"]["_cmv"];if(X12["indexOf"](".zip")>-1)return n12["FileFormat"]["_zip"];if(X12["indexOf"]("pbuf")>-1)return n12["FileFormat"]["_pbuf"];if(X12["indexOf"](".dat")>-1)return n12["FileFormat"]["_dat"];if(X12["indexOf"]("dat")>-1)return n12["FileFormat"]["_dat"];if(X12["indexOf"]("cbr")>-1)return n12["FileFormat"]["_cbr"];if(X12["indexOf"]("spi")>-1)return n12["FileFormat"]["_spi"];}n12["CmWorld"]["outputWarn"]("purifyFileFormat:파일 타입을 확인 할 수 없습니다.");return null;};g12["purifyCube3DType"]=function(t12){var a12;if(n12["Util"]["isDefined"](t12)){if(typeof t12=='number'){return t12;}a12=t12;a12=a12["toLowerCase"]();if(a12["indexOf"]("raster")>-1)return n12["Cube3DType"]["_raster"];if(a12["indexOf"]("vector")>-1)return n12["Cube3DType"]["_vector"];if(a12["indexOf"]("undergroundclip")>-1)return n12["Cube3DType"]["_undergroundclip"];if(a12["indexOf"]("virtual")>-1)return n12["Cube3DType"]["_virtual"];}n12["CmWorld"]["outputWarn"]("purifyCube3DType:격자 형식을 확인 할 수 없습니다.");return null;};g12["generateUrlParam"]=function(o12,J12,Z12,x12){var O12;O12="?T={t}&L={z}&X={x}&Y={y}";O12=O12["replace"](/\x7b\u0074\u007d/gi,o12);O12=O12["replace"](/\u007b\u007a\x7d/gi,J12["toString"]());O12=O12["replace"](/\u007b\x78\u007d/gi,x12["toString"]());O12=O12["replace"](/\x7b\u0079\u007d/gi,Z12["toString"]());return O12;};g12["applyIndex"]=function(i12,p12,S12,I12){i12=i12["replace"](/\x7b\x5a\u007d/gi,p12["toString"]());i12=i12["replace"](/\u007b\x7a\x7d/gi,p12["toString"]());i12=i12["replace"](/\x7b\x58\x7d/gi,I12["toString"]());i12=i12["replace"](/\u007b\u0078\x7d/gi,I12["toString"]());i12=i12["replace"](/\u007b\x59\x7d/gi,S12["toString"]());i12=i12["replace"](/\u007b\u0079\x7d/gi,S12["toString"]());return i12;};g12["prototype"]["dispose"]=function(){this["clear"]();};g12["prototype"]["clear"]=function(){this["dataLevels"]=[];this["subLayerVisibleState"]=[];this["styles"]=[];};g12["prototype"]["getCmResourceURL"]=function(){if(this["resourceURL"]&&this["dataSetName"]){return this["resourceURL"]+"?ResourceName="+this["dataSetName"];}return this["resourceURL"];};g12["prototype"]["getResourceURL"]=function(){return this["resourceURL"];};g12["prototype"]["getRealizedTileIndex"]=function(w12,v12,h12){var j12,u12,c12,d12,K12;if(w12>this["MaxLevel"]||w12<this["MinLevel"]){return null;}j12=this["cmworld3"];u12=n12["CmMathEngine"]["getRowFromLatitude"](this["North"],j12["option"]["TileLevelRange"][w12]);c12=n12["CmMathEngine"]["getRowFromLatitude"](this["South"],j12["option"]["TileLevelRange"][w12]);if(v12<c12||v12>u12)return null;d12=n12["CmMathEngine"]["getColFromLongitude"](this["West"],j12["option"]["TileLevelRange"][w12]);K12=n12["CmMathEngine"]["getColFromLongitude"](this["East"],j12["option"]["TileLevelRange"][w12]);if(h12<d12||h12>K12)return null;if(this["dataLevels"]!=null){for(var e12=this["dataLevels"]["length"]-1;e12>-1;e12--){if(this["dataLevels"][e12]==w12){break;}else{if(this["dataLevels"][e12]<w12){v12=Math["floor"](v12/Math["pow"](2,w12-this["dataLevels"][e12]));h12=Math["floor"](h12/Math["pow"](2,w12-this["dataLevels"][e12]));w12=this["dataLevels"][e12];break;}else{}}}}return{level:w12,row:v12,col:h12};};g12["prototype"]["checkTileIndexBoundary"]=function(b12,B12,q12){var N12,Q12,f12,H52,k52;if(b12>this["MaxLevel"]||b12<this["MinLevel"]){return false;}N12=this["cmworld3"];Q12=n12["CmMathEngine"]["getRowFromLatitude"](this["North"],N12["option"]["TileLevelRange"][b12]);if(B12>Q12)return false;f12=n12["CmMathEngine"]["getRowFromLatitude"](this["South"],N12["option"]["TileLevelRange"][b12]);if(B12<f12)return false;H52=n12["CmMathEngine"]["getColFromLongitude"](this["West"],N12["option"]["TileLevelRange"][b12]);if(q12<H52)return false;k52=n12["CmMathEngine"]["getColFromLongitude"](this["East"],N12["option"]["TileLevelRange"][b12]);if(q12>k52)return false;if(this["dataLevels"]!=null){for(var P12=this["dataLevels"]["length"]-1;P12>-1;P12--){if(this["dataLevels"][P12]==b12){return true;}else{if(this["dataLevels"][P12]<b12){return false;}}}}return true;};function g12(){this["cmworld3"]=n12["CmWorld3"]["getInstance"]();this["name"]=null;this["serverURL"]="http://www.cmworld.net:5050/CmWorld/CmWorldServlet";this["resourceURL"]=null;this["dataSetName"]=null;this["fileFormat"]=null;this["MinLevel"]=0;this["MaxLevel"]=14;this["level0Height"]=16384;this["updateAgent"]=n12["Cube3DUpdateAgent"]["Camera"];this["dataLevels"]=[];this["MinFloorHeight"]=0;this["MaxFloorHeight"]=0;this["North"]=90;this["South"]=-90;this["West"]=-180;this["East"]=180;this["visible"]=true;this["styles"]=[];this["subLayerVisibleState"]=[];this["ogcProtocol"]=n12["OGC_ProtocolType"]["None"];this["opacity"]=1.0;this["progressive"]=false;}return g12;}();n12["TiledMapInfo"]=R12;}(CMWORLD||(CMWORLD={})));(function(m52){var L52,V52;L52=function(){E52["prototype"]["processCompleteFn"]=function(){this["imageurl"]="";this["processDownloading"]=false;};function E52(){this["index"]=0;this["Tile"]=null;this["imageError"]=false;this["imageLoadOK"]=false;this["imageRetryCount"]=5;this["terrainRetryCount"]=5;this["imageurl"]="";this["minHeight"]=0;this["maxHeight"]=0;this["processComplete"]=false;this["processDownloading"]=false;this["start_time"]=0;}return E52;}();V52=function(){y52["prototype"]["init"]=function(){var r52,l52,Y52;r52=m52["CmWorld3"]["getInstance"]();{l52=m52["CmWorkerManager"]["TerrainWorkerCount"]*2;for(var s52=0;s52<l52;s52++){Y52=new L52();Y52["index"]=s52;this["taskParams"]["push"](Y52);}}};y52["getResultImage"]=function(F52){var U52,W52;U52=m52["CmWorld3"]["getInstance"]();if(U52["option"]["quadImageCompressed"]==true){W52=F52;if(W52["mipmaps"]){if(W52["mipmaps"]["length"]>0){F52["width"]=W52["mipmaps"][0]["width"];F52["height"]=W52["mipmaps"][0]["height"];return F52;}else{return null;}}else{return null;}}else{return F52;}};y52["prototype"]["isProcessing"]=function(M52){for(var G52=0;G52<this["taskParams"]["length"];G52++){if(this["taskParams"][G52]["processDownloading"]){if(this["taskParams"][G52]["innerID"]==M52)return true;}}return false;};y52["prototype"]["setTileOrigin"]=function(C52,D52){if(C52!=null){C52["setOriginCoord"](D52);}};y52["setTerrain"]=function(A52,p52,O52,o52,J52,Z52,i52){var t52,g52,X52,T52,a52,x52,z52,R52,n52;if(A52==null){console["warn"]("mesh 가 null이다. 이런경우가 왜 발생하지?");return;}t52=m52["CmWorld3"]["getInstance"]();g52=new Float32Array(O52);X52=new Float32Array(J52);T52=new Float32Array(o52);a52=new Uint16Array(Z52);x52=0;z52=new THREE["BufferGeometry"]();z52["addAttribute"]('position',new THREE["BufferAttribute"](g52,3));z52["addAttribute"]('uv',new THREE["BufferAttribute"](X52,2));z52["addAttribute"]('normal',new THREE["BufferAttribute"](T52,3));z52["setIndex"](new THREE["BufferAttribute"](a52,1));R52=z52;{R52["needUpdate"]=true;}if(A52 instanceof THREE["Mesh"]){if(A52["geometry"]){A52["geometry"]["dispose"]();A52["geometry"]=null;}A52["geometry"]=z52;}A52["visible"]=true;n52=A52;{n52["ready"]=true;n52["edgeFaceStartIndex"]=i52;}return true;};y52["prototype"]["failFunc_Deprecated"]=function(v52,I52){var w52,e52,S52;w52=null;if(I52){if(I52["target"]["quadImageLoader"]){w52=I52["target"]["quadImageLoader"];}e52=-1;if(I52==undefined||I52==null){console["log"]("ERROR : Image ERROR");if(v52==null){console["log"]("INFO : Image == null");}else{e52=v52["taskIndex"];}}else{e52=I52["data"]["taskIndex"];}}if(w52!=null){S52=w52["getTaskParam"](e52);if(S52["tile"]){console["warn"]("이미지파일을 받는데 실패했다.QuadImageLoader. "+S52["imageurl"]);S52["tile"]["Image"]=null;S52["tile"]["imageReady"]=false;S52["tile"]["terrainReady"]=false;S52["tile"]["setImageFileNotExist"](true);S52["tile"]["dataComplete"]=true;}S52["imageError"]=true;S52["imageLoadOK"]=false;S52["processComplete"]=true;S52["processCompleteFn"]();}};y52["prototype"]["getTaskParam"]=function(h52){if(h52<0||h52>this["taskParams"]["length"]-1)return null;return this["taskParams"][h52];};y52["prototype"]["resultFunc_Deprecated"]=function(b52,c52){var d52,K52,j52,u52,P52,N52,B52;d52=c52["target"]["quadImageLoader"];K52=c52["data"]["taskIndex"];j52=d52["getTaskParam"](K52);if(c52["data"]["command"]=="error"){if(d52!=null){if(c52["data"]["status"]==404){j52["tile"]["terrainFileNotExist"]=true;}j52["processCompleteFn"]();j52["tile"]["dataComplete"]=true;j52["tile"]["terrainReady"]=false;return;}return;}try{if(false&&d52["hasOwnProperty"]("Tile")==false){}else{if(j52["tile"]==null){j52["imageError"]=true;j52["imageLoadOK"]=false;j52["processComplete"]=true;j52["processCompleteFn"]();}else{j52["tile"]["Image"]=y52["getResultImage"](b52);j52["tile"]["dataComplete"]=true;j52["tile"]["imageReady"]=true;j52["imageError"]=false;j52["imageLoadOK"]=true;}}}catch(q52){console["error"](q52);}u52=c52["data"];N52=0;if(j52["tile"]!=null){if(c52["data"]["dataState"]==false){console["log"]("ERROR : Terrain ERROR");j52["processComplete"]=true;j52["tile"]["terrainReady"]=false;j52["tile"]["dataComplete"]=true;j52["processCompleteFn"]();return;}d52["setTileOrigin"](j52["tile"],u52["Origin"]);y52["setTerrain"](j52["tile"]["getMesh"](m52["TilePositionType"]["NW"]),u52["origin"],u52["NWVertices"],u52["NWNormal"],u52["NWUV"],u52["NWIndex"],u52["NWEdgeFaceStartIndex"]);y52["setTerrain"](j52["tile"]["getMesh"](m52["TilePositionType"]["NE"]),u52["origin"],u52["NEVertices"],u52["NENormal"],u52["NEUV"],u52["NEIndex"],u52["NEEdgeFaceStartIndex"]);y52["setTerrain"](j52["tile"]["getMesh"](m52["TilePositionType"]["SW"]),u52["origin"],u52["SWVertices"],u52["SWNormal"],u52["SWUV"],u52["SWIndex"],u52["SWEdgeFaceStartIndex"]);y52["setTerrain"](j52["tile"]["getMesh"](m52["TilePositionType"]["SE"]),u52["origin"],u52["SEVertices"],u52["SENormal"],u52["SEUV"],u52["SEIndex"],u52["SEEdgeFaceStartIndex"]);}j52["tile"]["dataComplete"]=true;j52["processComplete"]=true;j52["processCompleteFn"]();};y52["prototype"]["getAvaiableTaskParamIndex"]=function(){var f52,H62;for(var Q52=0;Q52<this["taskParams"]["length"];Q52++){if(this["taskParams"][Q52]["processDownloading"]==false){return Q52;}}f52=Date["now"]();H62=10000;for(var Q52=0;Q52<this["taskParams"]["length"];Q52++){if(this["taskParams"][Q52]["processDownloading"]==false)return Q52;if(f52-this["taskParams"][Q52]["start_time"]>H62){m52["CmWorld"]["outputInfo"]("getAvaiableTaskParamIndex() warnning "+Q52["toString"]());this["taskParams"][Q52]["processDownloading"]=false;return Q52;}}return-1;};y52["prototype"]["isRunable"]=function(){var k62,m62,L62;k62=m52["CmWorld3"]["getInstance"]();m62=this["getAvaiableTaskParamIndex"]();if(m62>-1){L62=k62["workerManager"]["getAvaiableTerrainWorker"]();if(L62)return true;}return false;};function y52(){this["m_ID"]=m52["CmLayer"]["UniqueID"]++;this["name"]=this["m_ID"]["toString"]();this["topTiles"]=[];this["groundheightChangedRequesters"]=[];this["clipApply"]=true;this["mapInfo"]=null;this["taskParams"]=[];this["runWorker_Deprecated"]=null;}y52["prototype"]["startLoadQuadImage"]=function(V62){var Y62,E62,l62,r62,y62,F62,s62;if(V62===null)return false;Y62=false;if(V62["quadInfo"]["level"]<0||V62["quadInfo"]["row"]<0||V62["quadInfo"]["col"]<0){return Y62;}E62=null;l62=m52["CmWorld3"]["getInstance"]();r62=l62["getBaseQuadImageLayer"]();if(r62){E62=r62["getTileURL"](V62["quadInfo"]["level"],V62["quadInfo"]["row"],V62["quadInfo"]["col"]);}if(E62==undefined||E62===""||E62==null){return Y62;}y62=null;F62=l62["getBaseQuadTerrainLayer"]();if(m52["Util"]["isDefined"](F62)){y62=l62["getBaseQuadTerrainLayer"]()["getTileURL"](V62["quadInfo"]["level"],V62["quadInfo"]["row"],V62["quadInfo"]["col"]);}V62["requestedData"]=true;try{{s62=new Image();s62["onload"]=function(){V62["baseMapImage"]=s62;};s62["onerror"]=function(){console["warn"]("[CmWorld] 이미지파일을 받는데 실패했다.QuadImageLoader.Start "+E62);V62["setImageFileNotExist"](true);};s62["crossOrigin"]="Anonymous";s62["src"]=E62;}if(m52["Util"]["isDefined"](y62)){m52["NetWork"]["requestFile"](y62,function(W62){var U62;U62=W62["tag"];delete W62["tag"];if(W62["response"]!=null){if(W62["response"]["byteLength"]>0){U62["setTerrainFileBuffer"](W62["response"]["slice"](0));}}else{U62["setTerrainFileNotExist"]();console["warn"]("다운로드실패"+y62);m52["CmWorld3"]["cache"]["addDeadUrl"](y62);}},V62);}else{V62["setTerrainFileNotExist"]();}}catch(G62){V62["requestedData"]=false;}Y62=true;return Y62;};return y52;}();m52["QuadImageLoader"]=V52;}(CMWORLD||(CMWORLD={})));(function(M62){var C62,D62;C62=function(){A62["prototype"]["start"]=function(){this["starttime"]=Date["now"]();};function A62(){this["tile"]=null;this["distance"]=0;this["starttime"]=0;}A62["prototype"]["finish"]=function(){this["tile"]=null;this["starttime"]=0;};return A62;}();D62=function(){z62["prototype"]["downloadQuadImage"]=function(n62){if(n62===null)return;if(this["Loader"]["startLoadQuadImage"](n62)){}};z62["prototype"]["requestDownload"]=function(R62,g62){if(R62===null)return false;if(this["isRequested"](R62)===false){this["updateCandidate"](M62["CmWorkerManager"]["TerrainWorkerCount"],this["downloadCandidateList"],R62,g62);}return true;};z62["prototype"]["requestUpdate"]=function(X62,T62){if(M62["Util"]["isDefined"](X62)==false)return false;this["updateCandidate"](M62["CmWorkerManager"]["TerrainWorkerCount"],this["updateCandidateList"],X62,T62);return true;};z62["prototype"]["updateCandidate"]=function(Z62,t62,o62,O62){var J62,a62;if(t62["length"]>Z62){J62=t62["length"];if(O62<t62[J62-1]["distance"]){a62=new C62();a62["tile"]=o62;a62["distance"]=O62;t62["push"](a62);t62["sort"](function(x62,i62){return x62["distance"]-i62["distance"];});t62["pop"]();}}else{a62=new C62();a62["tile"]=o62;a62["distance"]=O62;t62["push"](a62);}};function z62(){this["downloadCandidateList"]=new Array();this["updateCandidateList"]=new Array();this["Loader"]=new M62["QuadImageLoader"]();}z62["prototype"]["isRequested"]=function(p62){return this["Loader"]["isProcessing"](p62["innerID"]);};z62["prototype"]["update"]=function(){var I62;I62=0;for(var S62=0;S62<this["updateCandidateList"]["length"];S62++){if(this["updateCandidateList"][S62]["tile"]["makeTerrain"]()==false){break;}++I62;}this["updateCandidateList"]["length"]=0;if(I62<1){I62=this["downloadCandidateList"]["length"];}if(I62>this["downloadCandidateList"]["length"]){I62=this["downloadCandidateList"]["length"];}for(var S62=0;S62<I62;S62++){this["downloadQuadImage"](this["downloadCandidateList"][S62]["tile"]);}this["downloadCandidateList"]["length"]=0;};z62["prototype"]["clear"]=function(){};return z62;}();M62["QuadImageLoadManager"]=D62;}(CMWORLD||(CMWORLD={})));Atmosphere=function(){var w62,e62,v62,h62,j62,u62,c62;w62={Kr:0.0025,Km:0.0010,ESun:20.0,g:-0.950,innerRadius:CMWORLD["cm_const"]["EarthRadius"]*1.1,outerRadius:CMWORLD["cm_const"]["EarthRadius"]*1.12,wavelength:[0.650,0.570,0.475],scaleDepth:0.25,mieScaleDepth:0.1};e62=new THREE["TextureLoader"]();v62=e62["load"]('textures/tile.jpg');h62=e62["load"]('textures/sky.jpg');j62=CMWORLD["CmWorld3"]["getInstance"]()["option"]["renderer"]["capabilities"]["getMaxAnisotropy"]();v62["anisotropy"]=j62;h62["anisotropy"]=j62;u62={v3LightPosition:{type:"v3",value:new THREE["Vector3"](1e8,0,1e8)["normalize"]()},v3InvWavelength:{type:"v3",value:new THREE["Vector3"](1/Math["pow"](w62["wavelength"][0],4),1/Math["pow"](w62["wavelength"][1],4),1/Math["pow"](w62["wavelength"][2],4))},fCameraHeight:{type:"f",value:0},fCameraHeight2:{type:"f",value:0},fInnerRadius:{type:"f",value:w62["innerRadius"]},fInnerRadius2:{type:"f",value:w62["innerRadius"]*w62["innerRadius"]},fOuterRadius:{type:"f",value:w62["outerRadius"]},fOuterRadius2:{type:"f",value:w62["outerRadius"]*w62["outerRadius"]},fKrESun:{type:"f",value:w62["Kr"]*w62["ESun"]},fKmESun:{type:"f",value:w62["Km"]*w62["ESun"]},fKr4PI:{type:"f",value:w62["Kr"]*4.0*Math["PI"]},fKm4PI:{type:"f",value:w62["Km"]*4.0*Math["PI"]},fScale:{type:"f",value:1/(w62["outerRadius"]-w62["innerRadius"])},fScaleDepth:{type:"f",value:w62["scaleDepth"]},fScaleOverScaleDepth:{type:"f",value:1/(w62["outerRadius"]-w62["innerRadius"])/w62["scaleDepth"]},g:{type:"f",value:w62["g"]},g2:{type:"f",value:w62["g"]*w62["g"]},nSamples:{type:"i",value:3},fSamples:{type:"f",value:3.0},tDiffuse:{type:"t",value:v62},tDiffuseNight:{type:"t",value:h62},tDisplacement:{type:"t",value:0},tSkyboxDiffuse:{type:"t",value:0},fNightScale:{type:"f",value:1},fExposure:{type:"f",value:0.4},logDepthBufFC:{type:"f",value:0.0}};this["ground"]={geometry:new THREE["SphereGeometry"](w62["innerRadius"],50,50),material:new THREE["ShaderMaterial"]({uniforms:u62,wireframe:false,vertexShader:CMWORLD["CmWorld3"]["getInstance"]()["option"]["Shader"]["atmospheregroundvb"],fragmentShader:CMWORLD["CmWorld3"]["getInstance"]()["option"]["Shader"]["atmospheregroundps"]})};this["ground"]["mesh"]=new THREE["Mesh"](this["ground"]["geometry"],this["ground"]["material"]);this["sky"]={geometry:new THREE["SphereGeometry"](w62["outerRadius"],50,50),material:new THREE["ShaderMaterial"]({uniforms:u62,wireframe:false,vertexShader:CMWORLD["CmWorld3"]["getInstance"]()["option"]["Shader"]["atmosphereskyvb"],fragmentShader:CMWORLD["CmWorld3"]["getInstance"]()["option"]["Shader"]["atmosphereskyps"]})};this["sky"]["mesh"]=new THREE["Mesh"](this["sky"]["geometry"],this["sky"]["material"]);this["sky"]["material"]["side"]=THREE["DoubleSide"];this["sky"]["material"]["transparent"]=true;this["ground"]["mesh"]["position"]["set"](0,0,0);this["sky"]["mesh"]["position"]["set"](0,0,0);c62=CMWORLD["CmWorld3"]["getInstance"]();c62["option"]["scene"]["add"](this["sky"]["mesh"]);this["c"]=null;this["f"]=0;this["g"]=0;};Atmosphere["prototype"]={render:function(){var N62,d62,P62,K62,B62,q62,Q62,f62,H92,b62;N62=CMWORLD["CmWorld3"]["getInstance"]();d62=N62["option"]["refCenter"]["clone"]();d62["x"]=-d62["x"];d62["y"]=-d62["y"];d62["z"]=-d62["z"];this["sky"]["mesh"]["position"]["copy"](d62);P62=N62["getSkyScene"]();P62["add"](this["sky"]["mesh"]);this["f"]+=0.0002;this["g"]+=0.008;K62=CMWORLD["CmWorld3"]["getInstance"]()["option"]["EarthRadius"]+CMWORLD["CmWorld3"]["getInstance"]()["getCamera"]()["getAltitude"]();b62=CMWORLD["CmWorld3"]["getInstance"]()["option"]["SunLight"]["position"]["clone"]();b62["normalize"]();this["sky"]["material"]["uniforms"]["v3LightPosition"]["value"]=b62;this["sky"]["material"]["uniforms"]["fCameraHeight"]["value"]=K62;this["sky"]["material"]["uniforms"]["fCameraHeight2"]["value"]=K62*K62;this["sky"]["material"]["uniforms"]["logDepthBufFC"]["value"]=2.0/(Math["log"](N62["getCamera"]()["mainCamera"]["far"]+1.0)/Math["LN2"]);this["ground"]["material"]["uniforms"]["v3LightPosition"]["value"]=b62;this["ground"]["material"]["uniforms"]["fCameraHeight"]["value"]=K62;this["ground"]["material"]["uniforms"]["fCameraHeight2"]["value"]=K62*K62;}};(function(k92){var m92,L92;m92=function(){V92["prototype"]["readHeader"]=function(E92){};function V92(){this["col"]=150;this["row"]=150;this["datasize"]=4;this["isfloat"]=0;this["min"]=0;this["max"]=0;this["blank"]=new Array(k92["DemHeader"]["headerBlankByte"]);}return V92;}();m92["headerBlankByte"]=32;k92["DemHeader"]=m92;L92=function(){y92["prototype"]["prepareHeightBuffer"]=function(s92){if(this["heightbuffer"]==null){this["heightBufferMaxWidth"]=s92;this["heightbuffer"]=new Array(s92);for(var Y92=0;Y92<s92;Y92++){this["heightbuffer"][Y92]=new Array(s92);for(var l92=0;l92<s92;l92++){this["heightbuffer"][Y92][l92]=0;}}}};y92["prototype"]["initHeightBuffer"]=function(W92){var r92,F92;r92=this["heightBufferMaxWidth"];while(--r92){F92=this["heightBufferMaxWidth"];while(--F92){this["heightbuffer"][r92][F92]=W92;}}};y92["genBuffer"]=function(G92){var M92;M92=new Array(G92);for(var U92=0;U92<G92;U92++){M92[U92]=new Array(G92);}};y92["prototype"]["resampleDEM"]=function(T92,z92){var n92,A92,R92,g92,X92;n92=z92-1;A92=n92*2+1;R92=y92["genBuffer"](A92);for(var C92=0;C92<z92;C92++){g92=C92*2;for(var D92=0;D92<z92;D92++){X92=D92*2;R92[g92][X92]=T92[C92][D92];}}for(var C92=0;C92<A92;C92++){for(var D92=0;D92<A92;D92++){}}};y92["prototype"]["readDemFromArray"]=function(i92){var Z92,x92,O92,S92,o92,J92,p92;Z92=new k92["BinaryReader"](i92,true);x92=Z92["getLength"]();O92=Math["sqrt"](x92)/2;S92=parseInt(O92["toString"]());this["header"]["col"]=O92;this["header"]["row"]=O92;this["header"]["datasize"]=4;this["header"]["isfloat"]=1;this["prepareHeightBuffer"](this["header"]["col"]);o92=Number["MIN_VALUE"];J92=Number["MAX_VALUE"];p92=0;for(var t92=0;t92<O92;t92++){for(var a92=0;a92<O92;a92++){this["heightbuffer"][t92][a92]=Z92["readSingle"]();if(this["heightbuffer"][t92][a92]<-9999){this["heightbuffer"][t92][a92]=-0.001;}if(this["heightbuffer"][t92][a92]>o92){o92=this["heightbuffer"][t92][a92];}if(this["heightbuffer"][t92][a92]<J92){J92=this["heightbuffer"][t92][a92];}}}this["header"]["max"]=o92;this["header"]["min"]=J92;return true;};function y92(){this["header"]=new m92();this["heightBufferMaxWidth"]=150;this["heightbuffer"]=null;this["isTin"]=false;}y92["prototype"]["readDemFile"]=function(b92){var j92,h92,e92,K92,u92,d92,v92,c92,N92;this["isTin"]=false;j92=Number["MIN_VALUE"];h92=Number["MAX_VALUE"];if(b92["byteLength"]==0){this["header"]["max"]=0;this["header"]["min"]=0;}else{e92=new k92["BinaryReader"](b92,true);K92=e92["readBytes"](10);u92=e92["bin2String"](K92);if(u92=="<!DOCTYPE "){this["header"]["max"]=0;this["header"]["min"]=0;return false;}if(u92=="CMTT.1.0.0"){this["isTin"]=true;return false;}if(u92=="CMBT.1.0.0"){this["header"]["col"]=e92["readInt32"]();this["header"]["row"]=e92["readInt32"]();this["header"]["datasize"]=e92["readInt16"]();this["header"]["isfloat"]=e92["readInt16"]();this["header"]["HUnit"]=e92["readInt16"]();this["header"]["min"]=e92["readSingle"]();this["header"]["max"]=e92["readSingle"]();j92=this["header"]["max"];h92=this["header"]["min"];this["prepareHeightBuffer"](this["header"]["col"]);e92["readBytes"](k92["DemHeader"]["headerBlankByte"]);if(this["header"]["datasize"]==4){for(var I92=0;I92<this["header"]["row"];I92++){for(var w92=0;w92<this["header"]["col"];w92++){this["heightbuffer"][I92][w92]=e92["readSingle"]();if(this["heightbuffer"][I92][w92]<-9999){this["heightbuffer"][I92][w92]=-0.001;}}}}else{for(var I92=0;I92<this["header"]["row"];I92++){for(var w92=0;w92<this["header"]["col"];w92++){this["heightbuffer"][I92][w92]=e92["readInt16"]();if(this["heightbuffer"][I92][w92]<-9999){this["heightbuffer"][I92][w92]=-0.001;}}}}this["header"]["max"]=j92;this["header"]["min"]=h92;}else{e92["moveFirst"]();d92=e92["getLength"]();v92=Math["sqrt"](d92)/2;c92=parseInt(v92["toString"]());this["header"]["col"]=v92;this["header"]["row"]=v92;this["header"]["datasize"]=4;this["header"]["isfloat"]=1;this["prepareHeightBuffer"](this["header"]["col"]);if(v92!=c92){this["header"]["max"]=0;this["header"]["min"]=0;}else{N92=0;for(var I92=0;I92<v92;I92++){for(var w92=0;w92<v92;w92++){this["heightbuffer"][I92][w92]=e92["readSingle"]();if(this["heightbuffer"][I92][w92]<-9999){this["heightbuffer"][I92][w92]=-0.001;}if(this["heightbuffer"][I92][w92]>j92){j92=this["heightbuffer"][I92][w92];}if(this["heightbuffer"][I92][w92]<h92){h92=this["heightbuffer"][I92][w92];}}}this["header"]["max"]=j92;this["header"]["min"]=h92;}}}return true;};return y92;}();k92["DemFile"]=L92;}(CMWORLD||(CMWORLD={})));(function(P92){var B92,q92;B92=function(){function Q92(f92,H02,k02,m02,L02){this["actiontype"]=null;this["time"]=null;this["actiontype"]=f92;this["lon"]=H02;this["lat"]=k02;this["alt"]=m02;this["time"]=L02;}return Q92;}();P92["ActionItem"]=B92;q92=function(){V02["prototype"]["setGlobalOption"]=function(){var F02,r02;F02=P92["CmWorld3"]["getInstance"]();r02=this["origin"]["clone"]();r02["x"]-=F02["option"]["refCenter"]["x"];r02["y"]-=F02["option"]["refCenter"]["y"];r02["z"]-=F02["option"]["refCenter"]["z"];this["object"]["position"]["set"](r02["x"],r02["y"],r02["z"]);if(this["vectorObjectType"]==P92["VectorObjectType"]["BILLBOARD"]){this["object"]["quaternion"]["copy"](F02["getCamera"]()["getThreejsCamera"]()["quaternion"]);}this["object"]["updateMatrixWorld"](true);};V02["prototype"]["clear"]=function(){this["object"]=null;};V02["prototype"]["startAction"]=function(){if(this["actionlist"]){this["starttime"]=new Date()["getTime"]();this["currentActionIndex"]=0;this["actionRunning"]=true;}};V02["prototype"]["stopAction"]=function(){this["actionRunning"]=false;};V02["prototype"]["update"]=function(){var A02,G02,D02,C02,z02,M02,n02,R02,g02,U02;if(this["actionlist"]){if(this["actionRunning"]&&this["actionlist"]["length"]>0){A02=new Date()["getTime"]();G02=A02-this["starttime"];D02=-1;for(var W02=this["currentActionIndex"];W02<this["actionlist"]["length"]-1;W02++){if(G02<this["actionlist"][W02]["time"]){if(W02==0){return;}C02=this["actionlist"][W02-1]["time"];z02=this["actionlist"][W02]["time"];M02=(G02-C02)/(z02-C02);n02=this["actionlist"][W02-1]["lon"]+(this["actionlist"][W02]["lon"]-this["actionlist"][W02-1]["lon"])*M02;R02=this["actionlist"][W02-1]["lat"]+(this["actionlist"][W02]["lat"]-this["actionlist"][W02-1]["lat"])*M02;g02=this["actionlist"][W02-1]["alt"]+(this["actionlist"][W02]["alt"]-this["actionlist"][W02-1]["alt"])*M02;U02=P92["CmMathEngine"]["Geo2Cartesian"](n02,R02,g02,P92["SceneModeType"]["SCENE_S3D"]);this["origin"]["set"](U02["x"],U02["y"],U02["z"]);this["setGlobalOption"]();this["currentActionIndex"]=W02-1;return;}}if(D02==-1){G02=0;this["currentActionIndex"]=0;U02=P92["CmMathEngine"]["Geo2Cartesian"](this["actionlist"][0]["lon"],this["actionlist"][0]["lat"],this["actionlist"][0]["alt"],P92["SceneModeType"]["SCENE_S3D"]);this["origin"]["set"](U02["x"],U02["y"],U02["z"]);this["setGlobalOption"]();this["starttime"]=new Date()["getTime"]();return;}}}};function V02(E02,y02,s02,Y02,l02){this["name"]=null;this["object"]=null;this["origin"]=null;this["vectorObjectType"]=null;this["actionlist"]=null;this["starttime"]=null;this["currentActionIndex"]=0;this["actionRunning"]=false;this["name"]=E02;this["object"]=y02;this["origin"]=s02;this["vectorObjectType"]=Y02;this["actionlist"]=l02;this["starttime"]=new Date()["getTime"]();}return V02;}();P92["VectorObject"]=q92;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var X02;X02=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(T02,a02){T02["__proto__"]=a02;}||function(o02,O02){for(var t02 in O02)if(O02["hasOwnProperty"](t02))o02[t02]=O02[t02];};return function(Z02,J02){function x02(){this["constructor"]=Z02;}X02(Z02,J02);Z02["prototype"]=J02===null?Object["create"](J02):(x02["prototype"]=J02["prototype"],new x02());};}();(function(i02){var p02;p02=function(I02){__extends(S02,I02);S02["prototype"]["clear"]=function(){this["level"]=-1;this["row"]=-1;this["col"]=-1;this["tilePosition"]=i02["TilePositionType"]["None"];this["ownerQuadTile"]=null;};S02["prototype"]["setState"]=function(d02,K02,b02,N02,j02){var v02,u02,h02,c02;this["level"]=d02;this["row"]=K02;this["col"]=b02;this["tilePosition"]=N02;v02=i02["CmMathEngine"]["getBoundFromRowCol"](this["level"],this["row"],this["col"]);this["north"]=v02["North"];this["south"]=v02["South"];this["east"]=v02["East"];this["west"]=v02["West"];this["ownerQuadTile"]=j02;u02=i02["CmWorld3"]["getInstance"]();h02=i02["cm_const"]["EarthRadius"];if(j02!=null){h02+=j02["getCenterHeight"]();}this["NWECEFPos"]=i02["CmMathEngine"]["Geo2Cartesian"](v02["West"],v02["North"],h02);this["NEECEFPos"]=i02["CmMathEngine"]["Geo2Cartesian"](v02["East"],v02["North"],h02);this["SWECEFPos"]=i02["CmMathEngine"]["Geo2Cartesian"](v02["West"],v02["South"],h02);this["SEECEFPos"]=i02["CmMathEngine"]["Geo2Cartesian"](v02["East"],v02["South"],h02);this["position"]=i02["CmMathEngine"]["Geo2Cartesian"](v02["West"]+u02["option"]["TileLevelRange"][this["level"]]*0.5,v02["South"]+u02["option"]["TileLevelRange"][this["level"]]*0.5,h02);c02=this["position"]["distanceTo"](this["SEECEFPos"]);this["boundingSphereECEF"]=new THREE["Sphere"](this["position"],c02);};S02["prototype"]["isInclude"]=function(P02,B02){if(this["west"]>P02)return false;if(this["east"]<P02)return false;if(this["north"]<B02)return false;if(this["south"]>B02)return false;return true;};S02["prototype"]["isIntersect"]=function(q02,Q02,f02,H7J){if(this["west"]>Q02)return false;if(this["east"]<q02)return false;if(this["north"]<f02)return false;if(this["south"]>H7J)return false;return true;};S02["prototype"]["getClosestDistanceFromCamera"]=function(V7J){var m7J,L7J,k7J,E7J;if(V7J===void 0){V7J=true;}m7J=Number["POSITIVE_INFINITY"];L7J=i02["CmWorld3"]["getInstance"]();k7J=L7J["getCamera"]()["getDistanceToWorldPos"](this["position"]);if(k7J<m7J){m7J=k7J;}if(V7J==undefined)V7J=true;if(V7J){E7J=this["NWECEFPos"]["distanceTo"](this["SEECEFPos"])*0.5;m7J-=E7J;}else{k7J=L7J["getCamera"]()["getDistanceToWorldPos"](this["NWECEFPos"]);if(k7J<m7J){m7J=k7J;}k7J=L7J["getCamera"]()["getDistanceToWorldPos"](this["NEECEFPos"]);if(k7J<m7J){m7J=k7J;}k7J=L7J["getCamera"]()["getDistanceToWorldPos"](this["SWECEFPos"]);if(k7J<m7J){m7J=k7J;}k7J=L7J["getCamera"]()["getDistanceToWorldPos"](this["SEECEFPos"]);if(k7J<m7J){m7J=k7J;}}return m7J;};S02["prototype"]["isInViewDistance"]=function(Y7J){var s7J,r7J,l7J,y7J;s7J=i02["CmWorld3"]["getInstance"]();r7J=true;if(r7J){l7J=this["boundingSphereECEF"]["clone"]();l7J["center"]["sub"](s7J["option"]["refCenter"]);if(s7J["cameraFrustum"]["intersectsSphere"](l7J)){return true;}return false;}else{y7J=s7J["getCamera"]()["getDistanceToWorldPos"](this["NWECEFPos"]);if(y7J<Y7J){return true;}y7J=s7J["getCamera"]()["getDistanceToWorldPos"](this["NEECEFPos"]);if(y7J<Y7J){return true;}y7J=s7J["getCamera"]()["getDistanceToWorldPos"](this["SWECEFPos"]);if(y7J<Y7J){return true;}y7J=s7J["getCamera"]()["getDistanceToWorldPos"](this["SEECEFPos"]);if(y7J<Y7J){return true;}y7J=s7J["getCamera"]()["getDistanceToWorldPos"](this["position"]);if(y7J<Y7J){return true;}return false;}};function S02(e02){var w02;w02=I02["call"](this,e02)||this;w02["north"]=-90;w02["south"]=90;w02["east"]=-180;w02["west"]=180;w02["tilePosition"]=i02["TilePositionType"]["None"];w02["position"]=new THREE["Vector3"]();w02["ownerQuadTile"]=null;return w02;}S02["prototype"]["isInFrustum"]=function(){var F7J,W7J;F7J=i02["CmWorld3"]["getInstance"]();if(this["level"]<0||this["level"]>=F7J["option"]["displayDist4Level"]["length"]){return false;}W7J=false;if(this["isInViewDistance"](F7J["option"]["displayDist4Level"][this["level"]])){W7J=true;}return W7J;};return S02;}(i02["Tile"]);i02["QuadinfoStruct"]=p02;}(CMWORLD||(CMWORLD={})));(function(U7J){var G7J;G7J=function(){M7J["prototype"]["initilize"]=function(){var R7J,z7J,g7J,C7J,X7J,D7J,n7J;if(this["cmworld3"]){this["cmworld3"]["addLayer"](this["myPOILayer"]);R7J=32400;z7J=new THREE["BufferGeometry"]();g7J=new Float32Array(R7J*3);C7J=new Float32Array(R7J*3);z7J["addAttribute"]('position',new THREE["BufferAttribute"](g7J,3));z7J["addAttribute"]('color',new THREE["BufferAttribute"](C7J,3));X7J=2;z7J["setDrawRange"](0,X7J);D7J=new THREE["LineBasicMaterial"]({color:0xffffff,linewidth:1,vertexColors:THREE["VertexColors"]});D7J["transparent"]=true;D7J["opacity"]=0.3;D7J["depthWrite"]=false;D7J["polygonOffset"]=false;this["lineMesh"]=new THREE["LineSegments"](z7J,D7J);this["cmworld3"]["getWorldScene"]()["add"](this["lineMesh"]);{for(var A7J=0;A7J<C7J["length"];A7J+=3){n7J=new THREE["Color"](0xffffff);C7J[A7J]=n7J["r"];C7J[A7J+1]=n7J["g"];C7J[A7J+2]=n7J["b"];}}this["isInitialized"]=true;}};M7J["prototype"]["show"]=function(T7J){if(this["visible"]==T7J)return;this["visible"]=T7J;if(!this["isInitialized"]){this["initilize"]();}if(this["lineMesh"]){this["lineMesh"]["visible"]=this["visible"];}};M7J["prototype"]["update"]=function(){var a7J;if(this["isInitialized"]==false){this["initilize"]();}if(!this["visible"]){return;}this["computeGridValues"]();this["myPOILayer"]["clear"]();if(this["hide"]){this["lineMesh"]["visible"]=false;return;}a7J=this["cmworld3"];if(this["lastCameraPostion"]==null){this["lastCameraPostion"]=a7J["getCamera"]()["getPositionGeo"]();}else{{}}this["lineMesh"]["visible"]=true;this["drawGlobeMode"]();this["lastCameraPostion"]=a7J["getCamera"]()["getPositionGeo"]();};M7J["prototype"]["drawGlobeMode"]=function(){var x7J,h7J,J7J,O7J,o7J,i7J,e7J,v7J,S7J,u7J,I7J,w7J,t7J,p7J,j7J;x7J=this["cmworld3"];h7J=x7J["getCamera"]()["getViewRange"]()/5;J7J=this["lineMesh"]["geometry"]["attributes"]["position"]["array"];O7J=0;if(this["longitudeInterval"]>0){for(var t7J=this["minVisibleLongitude"];t7J<this["maxVisibleLongitude"];t7J+=this["longitudeInterval"]){o7J=null;for(var Z7J=this["minVisibleLatitude"];Z7J<=this["maxVisibleLatitude"];Z7J+=this["latitudeInterval"]){i7J=U7J["CmMathEngine"]["Geo2Cartesian"](t7J,Z7J,this["earthRadius"]);if(o7J){J7J[O7J++]=o7J["x"];J7J[O7J++]=o7J["y"];J7J[O7J++]=o7J["z"];J7J[O7J++]=i7J["x"];J7J[O7J++]=i7J["y"];J7J[O7J++]=i7J["z"];}o7J=i7J;}{e7J=x7J["getCamera"]()["getPositionGeo"]()["y"];if(e7J>88)e7J=88;if(e7J<-88)e7J=-88;v7J=U7J["CmMathEngine"]["Geo2Cartesian"](t7J,e7J,this["earthRadius"]);v7J["sub"](x7J["option"]["refCenter"]);if(x7J["cameraFrustum"]["containsPoint"](v7J)){S7J=Math["floor"](t7J);if(S7J<=-180)S7J+=360;else if(S7J>180)S7J-=360;u7J=Math["abs"](S7J)["toPrecision"]();I7J=u7J["toString"]();if(S7J<0)I7J+="W";else if(S7J>0&&S7J<180)I7J+="E";w7J=new U7J["POI3D"]();w7J["setPosition"](t7J,e7J,2000);w7J["label"]=I7J;this["myPOILayer"]["add"](w7J);}}}}if(this["latitudeInterval"]>0){for(var Z7J=this["minVisibleLatitude"];Z7J<=this["maxVisibleLatitude"];Z7J+=this["latitudeInterval"]){{t7J=x7J["getCamera"]()["getPositionGeo"]()["x"]+h7J;v7J=U7J["CmMathEngine"]["Geo2Cartesian"](t7J,Z7J,this["earthRadius"]);v7J["sub"](x7J["option"]["refCenter"]);if(x7J["cameraFrustum"]["containsPoint"](v7J)){p7J=Z7J;if(p7J>90)p7J=180-p7J;else if(p7J<-90)p7J=-180-p7J;j7J=Math["abs"](p7J);I7J=j7J["toString"]();if(p7J>0)I7J+="N";else if(p7J<0)I7J+="S";w7J=new U7J["POI3D"]();w7J["setPosition"](t7J,Z7J,2000);w7J["label"]=I7J;this["myPOILayer"]["add"](w7J);}}o7J=null;for(var t7J=this["minVisibleLongitude"];t7J<=this["maxVisibleLongitude"];t7J+=this["longitudeInterval"]){i7J=U7J["CmMathEngine"]["Geo2Cartesian"](t7J,Z7J,this["earthRadius"]);if(o7J){J7J[O7J++]=o7J["x"];J7J[O7J++]=o7J["y"];J7J[O7J++]=o7J["z"];J7J[O7J++]=i7J["x"];J7J[O7J++]=i7J["y"];J7J[O7J++]=i7J["z"];}o7J=i7J;}}}this["lineMesh"]["position"]["set"](-x7J["option"]["refCenter"]["x"],-x7J["option"]["refCenter"]["y"],-x7J["option"]["refCenter"]["z"]);this["lineMesh"]["geometry"]["setDrawRange"](0,O7J/3);this["lineMesh"]["geometry"]["attributes"]["position"]["needsUpdate"]=true;this["lineMesh"]["needsUpdate"]=true;};M7J["prototype"]["renderTropicLines"]=function(){this["renderTropicLine"](23.439444,"Tropic Of Cancer",0xff0000);this["renderTropicLine"](-23.439444,"Tropic Of Capricorn",0x00ff00);this["renderTropicLine"](66.560556,"Arctic Circle",0x00ffff);this["renderTropicLine"](-66.560556,"Antarctic Circle",0xffff00);};M7J["prototype"]["renderTropicLine"]=function(b7J,Q7J,q7J){var N7J,P7J,d7J,B7J,K7J;N7J=0;for(var c7J=this["minVisibleLongitude"];c7J<=this["maxVisibleLongitude"];c7J=c7J+this["longitudeInterval"]){P7J=U7J["CmMathEngine"]["Geo2Cartesian"](c7J,b7J,this["earthRadius"]);this["lineMesh"]["geometry"]["vertices"]["push"](P7J);this["lineMesh"]["geometry"]["colors"]["push"](new THREE["Color"](q7J));N7J++;}d7J=this["cmworld3"];B7J=d7J["getCamera"]();K7J=U7J["CmMathEngine"]["Geo2Cartesian"](d7J["getCamera"]()["getPositionGeo"]()["x"]-B7J["viewRange"]*0.3*0.5,b7J,this["earthRadius"]);K7J["sub"](d7J["option"]["refCenter"]);if(d7J["cameraFrustum"]["containsPoint"](K7J)){}};function M7J(){this["longitudeInterval"]=10;this["latitudeInterval"]=10;this["isInitialized"]=false;this["visible"]=true;this["textList"]=[];this["hide"]=false;this["lastCameraPostion"]=null;this["cmworld3"]=U7J["CmWorld3"]["getInstance"]();this["myPOILayer"]=null;this["myPOILayer"]=new U7J["POI3DLayer"]("경위도 숫자");this["myPOILayer"]["font"]="12px Arial";this["myPOILayer"]["fontColor"]="white";}M7J["prototype"]["computeGridValues"]=function(){var H3J,k3J,f7J,m3J;H3J=this["cmworld3"];this["hide"]=false;k3J=H3J["getCamera"]()["getViewRange"]()*U7J["CmMathEngine"]["Deg2Rad"];k3J=k3J*(1+Math["abs"](Math["sin"](H3J["getCamera"]()["getPositionGeo"]()["y"]*U7J["CmMathEngine"]["Deg2Rad"])));f7J=0;if(k3J<0.07)this["hide"]=true;else if(k3J<0.18)f7J=3;else if(k3J<0.6)f7J=2;else if(k3J<1.0)f7J=1;else f7J=0;if(this["hide"]==true)return;this["longitudeInterval"]=this["latitudeInterval"];m3J=[10,5,2,1,0.5,0.2,0.1];this["latitudeInterval"]=m3J[f7J];this["longitudeInterval"]=m3J[f7J];if(Math["abs"](H3J["getCamera"]()["getPositionGeo"]()["y"])>80){f7J-=3;if(f7J<0)f7J=0;this["longitudeInterval"]=m3J[f7J];}else if(Math["abs"](H3J["getCamera"]()["getPositionGeo"]()["y"])>70){f7J-=2;if(f7J<0)f7J=0;this["longitudeInterval"]=m3J[f7J];}{this["minVisibleLongitude"]=this["longitudeInterval"]>=10?-180:Math["floor"](H3J["getCamera"]()["getPositionGeo"]()["x"]/this["longitudeInterval"])*this["longitudeInterval"]-18*this["longitudeInterval"];this["maxVisibleLongitude"]=this["longitudeInterval"]>=10?180:Math["floor"](H3J["getCamera"]()["getPositionGeo"]()["x"]/this["longitudeInterval"])*this["longitudeInterval"]+18*this["longitudeInterval"];this["minVisibleLatitude"]=Math["floor"](H3J["getCamera"]()["getPositionGeo"]()["y"]/this["latitudeInterval"])*this["latitudeInterval"]-9*this["latitudeInterval"];this["maxVisibleLatitude"]=Math["floor"](H3J["getCamera"]()["getPositionGeo"]()["y"]/this["latitudeInterval"])*this["latitudeInterval"]+9*this["latitudeInterval"];if(this["minVisibleLatitude"]<-90||this["maxVisibleLatitude"]>90){this["minVisibleLongitude"]=-180;this["maxVisibleLongitude"]=180;}if(this["maxVisibleLatitude"]-this["minVisibleLatitude"]>=180||this["longitudeInterval"]==10){this["minVisibleLatitude"]=-90;this["maxVisibleLatitude"]=90;}}this["earthRadius"]=H3J["getCamera"]()["getAltitude"]();if(this["earthRadius"]>U7J["cm_const"]["EarthRadius"])this["earthRadius"]=U7J["cm_const"]["EarthRadius"];if(this["lineMesh"]["material"]["polygonOffset"]==true){this["lineMesh"]["material"]["polygonOffsetFactor"]=this["earthRadius"]*0.00002;}this["earthRadius"]=this["earthRadius"]*0.01;if(this["earthRadius"]<500)this["earthRadius"]=500;if(this["earthRadius"]>50000)this["earthRadius"]=50000;this["earthRadius"]+=U7J["cm_const"]["EarthRadius"];};return M7J;}();U7J["LatLonGridLine"]=G7J;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var L3J;L3J=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(V3J,E3J){V3J["__proto__"]=E3J;}||function(Y3J,s3J){for(var y3J in s3J)if(s3J["hasOwnProperty"](y3J))Y3J[y3J]=s3J[y3J];};return function(r3J,l3J){function F3J(){this["constructor"]=r3J;}L3J(r3J,l3J);r3J["prototype"]=l3J===null?Object["create"](l3J):(F3J["prototype"]=l3J["prototype"],new F3J());};}();(function(W3J){var U3J,G3J;U3J=function(){M3J["prototype"]["dispose"]=function(){if(W3J["Util"]["isDefined"](this["tex"])){this["tex"]["dispose"]();this["tex"]=null;}this["context"]=null;this["canvas"]=null;};function M3J(){this["tex"]=null;this["canvas"]=null;this["context"]=null;this["width"]=0;this["height"]=0;}return M3J;}();;G3J=function(D3J){function C3J(n3J,z3J){var A3J;A3J=D3J["call"](this,z3J)||this;A3J["innerID"]=C3J["IDCounter"]++;A3J["cmworld3"]=W3J["CmWorld3"]["getInstance"]();A3J["quadInfo"]=new W3J["QuadinfoStruct"](null);A3J["isInitialize"]=false;A3J["imageLoadOK"]=false;A3J["parentTile"]=null;A3J["ParentLayer"]=null;A3J["NWChildTile"]=null;A3J["NEChildTile"]=null;A3J["SWChildTile"]=null;A3J["SEChildTile"]=null;A3J["NWmesh"]=null;A3J["NEmesh"]=null;A3J["SWmesh"]=null;A3J["SEmesh"]=null;A3J["id"]="0";A3J["lastUpdateTime"]=0;A3J["bound"]=new THREE["Box3"]();A3J["NWDraw"]=false;A3J["NEDraw"]=false;A3J["SWDraw"]=false;A3J["SEDraw"]=false;A3J["renderFrameID"]=0;A3J["overlayImageTiles"]=[];A3J["vectorImageSubTiles"]=[];A3J["shareMaterial"]=null;A3J["tempData"]=0;A3J["position"]=new THREE["Vector3"](0,0,0);A3J["overlayMapFrameID"]=0;A3J["dynamicMapFrameID"]=0;A3J["baseMapCanvas"]=new U3J();A3J["overlayMapCanvas"]=new U3J();A3J["dynamicMapCanvas"]=new U3J();A3J["textureCompressed"]=false;A3J["baseMapImage"]=null;A3J["overlayimagestate"]=[];A3J["reDrawOverlay"]=false;A3J["reDrawDynamicMap"]=false;A3J["textMesh"]=null;A3J["minHeight"]=0;A3J["maxHeight"]=0;A3J["dataComplete"]=false;A3J["imageReady"]=false;A3J["terrainReady"]=false;A3J["terrainFileNotExist"]=false;A3J["retryCount"]=0;A3J["imageFileNotExist"]=false;A3J["imageDownloading"]=false;A3J["requestedData"]=false;A3J["groundheightChangedRequesters"]=[];A3J["terrainFileBuffer"]=null;A3J["cmworld3"]=W3J["CmWorld3"]["getInstance"]();A3J["lastUpdateTime"]=A3J["cmworld3"]["option"]["renderFrameTime"];A3J["parentTile"]=n3J;A3J["ParentLayer"]=z3J;A3J["makeMeshData"](W3J["TilePositionType"]["NW"],A3J["shareMaterial"]);A3J["makeMeshData"](W3J["TilePositionType"]["NE"],A3J["shareMaterial"]);A3J["makeMeshData"](W3J["TilePositionType"]["SW"],A3J["shareMaterial"]);A3J["makeMeshData"](W3J["TilePositionType"]["SE"],A3J["shareMaterial"]);return A3J;}__extends(C3J,D3J);C3J["prototype"]["dispose"]=function(){D3J["prototype"]["initTile"]["call"](this);this["disposeTexture"]();this["clearChild"]();this["clear"]();};C3J["prototype"]["setTerrainFileNotExist"]=function(R3J){if(R3J===void 0){R3J=true;}this["terrainFileNotExist"]=R3J;};C3J["prototype"]["setImageFileNotExist"]=function(g3J){if(g3J===void 0){g3J=true;}if(g3J){this["imageReady"]=false;}this["imageFileNotExist"]=g3J;};C3J["prototype"]["resetDataReady"]=function(){this["terrainReady"]=false;this["imageReady"]=false;};C3J["prototype"]["setTerrainFileBuffer"]=function(X3J){this["terrainFileBuffer"]=X3J;};C3J["prototype"]["setMinMaxHeight"]=function(T3J,a3J){this["minHeight"]=T3J;this["maxHeight"]=a3J;};C3J["prototype"]["getMinHeight"]=function(){return this["minHeight"];};C3J["prototype"]["getMaxHeight"]=function(){return this["maxHeight"];};C3J["prototype"]["getCenterHeight"]=function(){return this["minHeight"]+(this["maxHeight"]-this["minHeight"])*0.5;};C3J["prototype"]["disposeTexture"]=function(){if(this["baseMapCanvas"]){this["baseMapCanvas"]["dispose"]();}if(this["overlayMapCanvas"]){this["overlayMapCanvas"]["dispose"]();}if(this["dynamicMapCanvas"]){this["dynamicMapCanvas"]["dispose"]();}};C3J["prototype"]["isIncludeCoord"]=function(t3J,O3J){return this["quadInfo"]["isInclude"](t3J,O3J);};C3J["prototype"]["isIntersect"]=function(o3J,J3J,Z3J,x3J){return this["quadInfo"]["isIntersect"](o3J,J3J,Z3J,x3J);};C3J["prototype"]["findHighestTile"]=function(e3J,v3J,h3J,j3J){var i3J,S3J,I3J;i3J=[];if(this["isIntersect"](e3J,v3J,h3J,j3J)){S3J=this["getChildTileArray"]();for(var p3J=0;p3J<S3J["length"];p3J++){if(W3J["Util"]["isDefined"](S3J[p3J])){I3J=S3J[p3J]["findHighestTile"](e3J,v3J,h3J,j3J);if(W3J["Util"]["isDefined"](I3J)){for(var w3J=0;w3J<I3J["length"];w3J++)i3J["push"](I3J[w3J]);}}}if(i3J["length"]<1){i3J["push"](this);}return i3J;}return null;};C3J["prototype"]["getMeshIncludeCoord"]=function(K3J,c3J){var b3J,d3J,u3J;if(this["isIncludeCoord"](K3J,c3J)==false)return null;b3J=this["quadInfo"]["west"]+Math["abs"](this["quadInfo"]["west"]-this["quadInfo"]["east"])*0.5;d3J=this["quadInfo"]["north"]-Math["abs"](this["quadInfo"]["north"]-this["quadInfo"]["south"])*0.5;u3J=null;if(K3J>b3J){if(c3J>d3J)u3J=this["getMesh"](W3J["TilePositionType"]["NE"]);else u3J=this["getMesh"](W3J["TilePositionType"]["SE"]);}else{if(c3J>d3J)u3J=this["getMesh"](W3J["TilePositionType"]["NW"]);else u3J=this["getMesh"](W3J["TilePositionType"]["SW"]);}return u3J;};C3J["prototype"]["setOriginCoord"]=function(N3J){if(W3J["Util"]["isDefined"](N3J)){this["originCoord"]=new THREE["Vector3"](N3J["x"],N3J["y"],N3J["z"]);}};C3J["prototype"]["getMesh"]=function(P3J){if(P3J==W3J["TilePositionType"]["NW"]){return this["NWmesh"];}if(P3J==W3J["TilePositionType"]["NE"]){return this["NEmesh"];}if(P3J==W3J["TilePositionType"]["SW"]){return this["SWmesh"];}if(P3J==W3J["TilePositionType"]["SE"]){return this["SEmesh"];}return null;};C3J["prototype"]["makeMeshData"]=function(q3J,k8J){var f3J,H8J,B3J,Q3J;f3J=this["getMesh"](q3J);if(f3J!=null)return;H8J=new THREE["PlaneBufferGeometry"](2,2,2,2);B3J=new THREE["Mesh"](H8J,k8J);B3J["castShadow"]=true;B3J["receiveShadow"]=true;B3J["position"]["set"](0,0,0);B3J["visible"]=false;Q3J=B3J;{Q3J["ready"]=false;Q3J["ground"]=true;Q3J["name"]=this["getKeyNumber"]();}if(q3J==W3J["TilePositionType"]["NW"]){this["NWmesh"]=B3J;B3J["name"]+="_NW";}if(q3J==W3J["TilePositionType"]["NE"]){this["NEmesh"]=B3J;B3J["name"]+="_NE";}if(q3J==W3J["TilePositionType"]["SW"]){this["SWmesh"]=B3J;B3J["name"]+="_SW";}if(q3J==W3J["TilePositionType"]["SE"]){this["SEmesh"]=B3J;B3J["name"]+="_SE";}};C3J["prototype"]["print"]=function(L8J){for(var m8J=0;m8J<L8J["length"];m8J++){console["log"](m8J["toString"]()+" : "+L8J[m8J]["vertexNormals"][0]["x"]["toString"]()+", "+L8J[m8J]["vertexNormals"][0]["y"]["toString"]()+", "+L8J[m8J]["vertexNormals"][0]["z"]["toString"]());console["log"](m8J["toString"]()+" : "+L8J[m8J]["vertexNormals"][1]["x"]["toString"]()+", "+L8J[m8J]["vertexNormals"][1]["y"]["toString"]()+", "+L8J[m8J]["vertexNormals"][1]["z"]["toString"]());console["log"](m8J["toString"]()+" : "+L8J[m8J]["vertexNormals"][2]["x"]["toString"]()+", "+L8J[m8J]["vertexNormals"][2]["y"]["toString"]()+", "+L8J[m8J]["vertexNormals"][2]["z"]["toString"]());}};C3J["prototype"]["updateMeshData"]=function(V8J,E8J){var y8J;V8J["material"]=E8J;V8J["visible"]=false;y8J=V8J["geometry"];{}};C3J["prototype"]["isInFrustum"]=function(){var r8J,l8J,s8J;if(this["isInitialize"]){r8J=this["cmworld3"];l8J=this["getMeshArray"]();for(var Y8J=0;Y8J<l8J["length"];Y8J++){s8J=l8J[Y8J];if(s8J!=null){if(s8J["geometry"]["boundingSphere"]==null){s8J["geometry"]["computeBoundingSphere"]();}if(r8J["cameraFrustum"]["intersectsSphere"](s8J["geometry"]["boundingSphere"])){return true;}}}return false;}else{if(this["quadInfo"]["isInFrustum"]())return true;}return false;};C3J["prototype"]["getBoundingBox"]=function(){var G8J,W8J,U8J,D8J,M8J,F8J;G8J=99999999;W8J=new THREE["Vector3"](G8J,G8J,G8J);U8J=new THREE["Vector3"](-G8J,-G8J,-G8J);D8J=this["getMeshArray"]();for(var C8J=0;C8J<D8J["length"];C8J++){M8J=D8J[C8J];if(M8J!=null){if(M8J["geometry"]["boundingBox"]==null){M8J["geometry"]["computeBoundingBox"]();}F8J=M8J["geometry"]["boundingBox"];if(F8J!=null){if(W8J["x"]>F8J["min"]["x"])W8J["x"]=F8J["min"]["x"];if(W8J["y"]>F8J["min"]["y"])W8J["y"]=F8J["min"]["y"];if(W8J["z"]>F8J["min"]["z"])W8J["z"]=F8J["min"]["z"];if(U8J["x"]<F8J["max"]["x"])U8J["x"]=F8J["max"]["x"];if(U8J["y"]<F8J["max"]["y"])U8J["y"]=F8J["max"]["y"];if(U8J["z"]<F8J["max"]["z"])U8J["z"]=F8J["max"]["z"];}}}return{min:W8J,max:U8J};};C3J["prototype"]["isPowerOf2"]=function(A8J){return(A8J&A8J-1)==0;};C3J["prototype"]["drawImage"]=function(x8J,z8J,O8J,o8J,T8J,a8J,n8J,g8J,X8J){var J8J,Z8J,R8J,t8J;if(X8J===void 0){X8J=1.0;}if(n8J==0){n8J=z8J["canvas"]["width"];g8J=z8J["canvas"]["height"];}J8J=O8J?-1:1,Z8J=o8J?-1:1;T8J=O8J?n8J*-1:0;a8J=o8J?g8J*-1:0;R8J=false;z8J["save"]();try{z8J["globalAlpha"]=X8J;z8J["scale"](J8J,Z8J);z8J["drawImage"](x8J,T8J,a8J,n8J,g8J);R8J=true;}catch(i8J){console["error"](i8J);}finally{z8J["restore"]();}t8J=false;if(t8J){}return R8J;};C3J["prototype"]["drawTileInfo"]=function(){var p8J,S8J,I8J;if(W3J["Util"]["isDefined"](this["overlayMapCanvas"])==false)return false;p8J=this["overlayMapCanvas"]["context"];if(W3J["Util"]["isDefined"](p8J)==false)return false;S8J=this["overlayMapCanvas"]["canvas"];I8J=false;p8J["save"]();try{p8J["strokeStyle"]='yellow';p8J["lineWidth"]=1.0;p8J["strokeRect"](0,0,S8J["width"],S8J["height"]);p8J["font"]="16px arial bold";p8J["fillStyle"]="black";p8J["strokeStyle"]="white";p8J["lineWidth"]=0.5;if(this["textureCompressed"]){p8J["scale"](1,-1);p8J["fillText"](this["id"],0,50-S8J["height"]);p8J["strokeText"](this["id"],0,50-S8J["height"]);}else{p8J["fillText"](this["id"],0,50);p8J["strokeText"](this["id"],0,50);}I8J=true;}catch(w8J){}finally{p8J["restore"]();}return I8J;};C3J["prototype"]["setReDrawMap"]=function(c8J,h8J,j8J,u8J){var v8J;if(j8J===void 0){j8J=0;}if(u8J===void 0){u8J=20;}if(W3J["Util"]["isDefined"](h8J)==false)return;if(this["quadInfo"]["getBoundary"]()["isIntersect"](h8J)){v8J=this["getChildTileArray"]();for(var e8J=0;e8J<v8J["length"];e8J++){if(W3J["Util"]["isDefined"](v8J[e8J])){v8J[e8J]["setReDrawMap"](c8J,h8J,j8J,u8J);}}{this["setReDrawMapFlag"](c8J);}}};C3J["prototype"]["initBaseMapCanvas"]=function(){var d8J;if(C3J["TESTCODE_UseBaseMapCanvas"]){if(W3J["Util"]["isDefined"](this["baseMapCanvas"])==false){d8J=document["createElement"]("canvas");d8J["id"]="baseMap"+this["getKeyNumber"]();d8J["width"]=this["baseMapImage"]["width"];d8J["height"]=this["baseMapImage"]["height"];this["baseMapCanvas"]["context"]=d8J["getContext"]("2d",{alpha:false});this["baseMapCanvas"]["canvas"]=d8J;}}};C3J["prototype"]["initBaseMapTexture"]=function(){if(this["textureCompressed"]){this["baseMapCanvas"]["tex"]=this["baseMapImage"];}else{if(C3J["TESTCODE_UseBaseMapCanvas"]){this["baseMapCanvas"]["tex"]=new THREE["Texture"](this["baseMapCanvas"]["canvas"]);this["updateBaseMapTexture"](this["baseMapImage"]);}else{this["baseMapCanvas"]["tex"]=new THREE["Texture"](this["baseMapImage"]);this["baseMapCanvas"]["tex"]["needsUpdate"]=true;}}this["baseMapCanvas"]["width"]=this["baseMapImage"]["width"];this["baseMapCanvas"]["height"]=this["baseMapImage"]["height"];this["baseMapImage"]=null;this["baseMapCanvas"]["tex"]["anisotropy"]=this["cmworld3"]["renderer"]["capabilities"]["getMaxAnisotropy"]();;this["baseMapCanvas"]["tex"]["magFilter"]=THREE["LinearFilter"];this["baseMapCanvas"]["tex"]["minFilter"]=THREE["LinearMipMapLinearFilter"];};C3J["prototype"]["generateOverlayMapCanvas"]=function(B8J){var K8J,N8J,P8J,b8J;K8J=document["createElement"]("canvas");K8J["id"]=B8J+this["getKeyNumber"]();K8J["width"]=this["baseMapCanvas"]["width"];K8J["height"]=this["baseMapCanvas"]["height"];N8J=K8J["getContext"]('2d');P8J=this["generateOverlayMapTexture"](K8J);b8J=new U3J();b8J["tex"]=P8J;b8J["context"]=N8J;b8J["canvas"]=K8J;return b8J;};C3J["prototype"]["generateOverlayMapTexture"]=function(Q8J){var f8J,q8J;if(Q8J["width"]*Q8J["height"]==0){return null;}f8J=this["cmworld3"];q8J=new THREE["Texture"](Q8J);q8J["anisotropy"]=f8J["renderer"]["capabilities"]["getMaxAnisotropy"]();q8J["magFilter"]=THREE["LinearFilter"];q8J["minFilter"]=THREE["LinearMipMapLinearFilter"];return q8J;};C3J["prototype"]["updateOverlayFrameID"]=function(H4J){this["overlayMapFrameID"]=H4J["frameState"]["overlayMapMinFrameID"];this["dynamicMapFrameID"]=H4J["frameState"]["dynamicMapFrameID"];};C3J["prototype"]["processData"]=function(){var k4J,E4J,y4J,l4J,s4J,Y4J,L4J,m4J,V4J;this["id"]=this["quadInfo"]["level"]["toString"]()+"-"+this["quadInfo"]["row"]["toString"]()+"-"+this["quadInfo"]["col"]["toString"]();k4J=this["cmworld3"];if(this["baseMapImage"]){this["disposeTexture"]();this["initBaseMapCanvas"]();this["initBaseMapTexture"]();this["overlayMapCanvas"]=this["generateOverlayMapCanvas"]("overlayMap");this["dynamicMapCanvas"]=this["generateOverlayMapCanvas"]("dynamicTopMap");}else{return false;}this["updateOverlayFrameID"](k4J);this["reDrawOverlay"]=this["checkRedrawOverlayMap"](true);if(k4J["option"]["viewTileInfo"]){if(this["drawTileInfo"]()){this["overlayMapCanvas"]["tex"]["needsUpdate"]=true;}}if(W3J["Util"]["isDefined"](this["shareMaterial"])==false){this["shareMaterial"]=W3J["CmShaderLib"]["getTerraintMaterial"]({map:this["baseMapCanvas"]["tex"],overlaymap:this["overlayMapCanvas"]["tex"],dynamictopmap:this["dynamicMapCanvas"]["tex"],polaimageenable:k4J["polar"]["polarImageOverlayEnable"],polamaxradius:k4J["polar"]["polarImageMaxRadius"],polaimagesize:1024,arcticmap:k4J["polar"]["arcticTexture"],antarcticmap:k4J["polar"]["antarcticTexture"],opacity:k4J["option"]["terrainOpacity"],transparent:k4J["option"]["terrainTransparency"],diffuse:new THREE["Color"](0xffffff),specular:new THREE["Color"](0),shininess:0.1});this["shareMaterial"]["side"]=THREE["DoubleSide"];this["shareMaterial"]["needsUpdate"]=true;}if(this["quadInfo"]["level"]!=-1&&this["quadInfo"]["row"]!=-1&&this["quadInfo"]["col"]!=-1&&!this["isInitialize"]){if(k4J["cubeGroupLayer"]){k4J["cubeGroupLayer"]["addCurVisibleTileInfo"](this);}this["quadInfo"]["position"]=W3J["CmMathEngine"]["Geo2Cartesian"](this["quadInfo"]["west"]+k4J["option"]["TileLevelRange"][this["quadInfo"]["level"]]/2,this["quadInfo"]["south"]+k4J["option"]["TileLevelRange"][this["quadInfo"]["level"]]/2,W3J["cm_const"]["EarthRadius"]);this["updateMeshData"](this["NWmesh"],this["shareMaterial"]);this["updateMeshData"](this["NEmesh"],this["shareMaterial"]);this["updateMeshData"](this["SWmesh"],this["shareMaterial"]);this["updateMeshData"](this["SEmesh"],this["shareMaterial"]);for(var F4J in k4J["ovelayImageTileLayerList"]){E4J=k4J["ovelayImageTileLayerList"][F4J];if(E4J["visible"]){y4J=E4J["getTileURL"](this["quadInfo"]["level"],this["quadInfo"]["row"],this["quadInfo"]["col"]);if(y4J){l4J=new W3J["OverlayImageTile"](E4J);l4J["set"](E4J,this["quadInfo"]["level"],this["quadInfo"]["row"],this["quadInfo"]["col"]);this["overlayImageTiles"]["push"](l4J);}}}for(var r4J in k4J["getVectorImageTileLayers"]()){s4J=k4J["getVectorImageTileLayers"]()[r4J];y4J=s4J["getTileURL"](this["quadInfo"]["level"],this["quadInfo"]["row"],this["quadInfo"]["col"]);if(y4J!=""){Y4J=new W3J["VectorImageTile"](s4J["name"],this["quadInfo"]["level"],this["quadInfo"]["row"],this["quadInfo"]["col"],s4J);Y4J["imageWidth"]=this["overlayMapCanvas"]["canvas"]["width"];Y4J["imageHeight"]=this["overlayMapCanvas"]["canvas"]["height"];this["vectorImageSubTiles"]["push"](Y4J);}}L4J=this["quadInfo"]["position"]["clone"]();L4J["x"]-=k4J["option"]["refCenter"]["x"];L4J["y"]-=k4J["option"]["refCenter"]["y"];L4J["z"]-=k4J["option"]["refCenter"]["z"];this["updateMeshPostion"](this["NWmesh"],L4J);this["updateMeshPostion"](this["NEmesh"],L4J);this["updateMeshPostion"](this["SWmesh"],L4J);this["updateMeshPostion"](this["SEmesh"],L4J);m4J=this["NWmesh"];{m4J["ready"]=true;m4J["onBeforeRender"]=this["beforeRender"];}m4J=this["NEmesh"];{m4J["ready"]=true;m4J["onBeforeRender"]=this["beforeRender"];}m4J=this["SWmesh"];{m4J["ready"]=true;m4J["onBeforeRender"]=this["beforeRender"];}m4J=this["SEmesh"];{m4J["ready"]=true;m4J["onBeforeRender"]=this["beforeRender"];}V4J=this["cmworld3"]["getTerrainScene"]();V4J["add"](this["NWmesh"]);V4J["add"](this["NEmesh"]);V4J["add"](this["SWmesh"]);V4J["add"](this["SEmesh"]);this["isInitialize"]=true;}return this["isInitialize"];};C3J["prototype"]["beforeRender"]=function(U4J,G4J,M4J,C4J,D4J,A4J){var W4J;W4J=W3J["CmWorld3"]["getInstance"]();};C3J["prototype"]["loadData"]=function(){var n4J,z4J;if(this["dataComplete"]){return true;}if(this["requestedData"]==false){if(this["parentTile"]&&this["parentTile"]["isInitialize"]==false){return false;}if(this["dataComplete"]===false&&this["terrainFileNotExist"]==false&&this["imageFileNotExist"]==false){if(this["ParentLayer"]==null){console["log"]("ERROR : Parent null");}if(this["ParentLayer"]["loadManager"]==null){console["log"]("ERROR : loadManager null");}n4J=this["cmworld3"];z4J=this["getClosestDistanceFromCamera"]();this["ParentLayer"]["loadManager"]["requestDownload"](this,z4J);return false;}}else{if(this["terrainFileNotExist"]||this["imageFileNotExist"]){return false;}if(this["baseMapImage"]&&this["terrainFileBuffer"]&&this["terrainFileBuffer"]["byteLength"]>0){z4J=this["getClosestDistanceFromCamera"]();this["ParentLayer"]["loadManager"]["requestUpdate"](this,z4J);}}return false;};C3J["prototype"]["makeTerrain"]=function(){var R4J,g4J,X4J,T4J;R4J=this["cmworld3"];if(this["terrainFileNotExist"]&&this["terrainFileBuffer"]==null){}else{g4J=R4J["workerManager"]["getTerrainWorker"]();if(g4J){X4J={command:W3J["WorkerCommand"]["loadTerrain"],EarthRadius:W3J["cm_const"]["EarthRadius"],GlobalScale:R4J["option"]["GlobalScale"],VerticalExaggeration:R4J["option"]["VerticalExaggeration"],TileSize:R4J["option"]["TileLevelRange"][this["quadInfo"]["level"]],SceneMode:R4J["option"]["SceneMode"],Level:this["quadInfo"]["level"],Row:this["quadInfo"]["row"],Col:this["quadInfo"]["col"],vertexWidth:R4J["option"]["tileVertexWidth"],flipY:false,cmworld3BaseRoot:W3J["GlobalOption"]["cmworld3BaseRoot"],terrainFileBuffer:this["terrainFileBuffer"]};T4J=this;g4J["onmessage"]=function(a4J){try{if(a4J["data"]["command"]==W3J["WorkerCommand"]["none"])return;if(a4J["data"]["success"]==true){T4J["completeCallbackFunc"](T4J["baseMapImage"],a4J["data"]);}}catch(t4J){console["error"](t4J["message"]);}finally{}};g4J["onerror"]=function(O4J){};g4J["postMessage"](X4J,[X4J["terrainFileBuffer"]]);return true;}}return false;};C3J["prototype"]["completeCallbackFunc"]=function(Z4J,J4J){var o4J,i4J,x4J,p4J;if(this["ParentLayer"]==null){return;}if(J4J["command"]=="error"){{if(J4J["status"]==404){this["terrainFileNotExist"]=true;}this["dataComplete"]=true;this["terrainReady"]=false;return;}}try{{}{this["baseMapImage"]=W3J["QuadImageLoader"]["getResultImage"](Z4J);this["dataComplete"]=true;this["imageReady"]=true;}}catch(S4J){console["error"](S4J);}o4J=J4J;x4J=0;if(J4J["dataState"]==false){console["log"]("ERROR : Terrain ERROR");this["terrainReady"]=false;this["dataComplete"]=true;return;}this["minHeight"]=o4J["minHeight"];this["maxHeight"]=o4J["maxHeight"];this["setOriginCoord"](o4J["origin"]);W3J["QuadImageLoader"]["setTerrain"](this["getMesh"](W3J["TilePositionType"]["NW"]),o4J["origin"],o4J["NWVertices"],o4J["NWNormal"],o4J["NWUV"],o4J["NWIndex"],o4J["NWEdgeFaceStartIndex"]);W3J["QuadImageLoader"]["setTerrain"](this["getMesh"](W3J["TilePositionType"]["NE"]),o4J["origin"],o4J["NEVertices"],o4J["NENormal"],o4J["NEUV"],o4J["NEIndex"],o4J["NEEdgeFaceStartIndex"]);W3J["QuadImageLoader"]["setTerrain"](this["getMesh"](W3J["TilePositionType"]["SW"]),o4J["origin"],o4J["SWVertices"],o4J["SWNormal"],o4J["SWUV"],o4J["SWIndex"],o4J["SWEdgeFaceStartIndex"]);W3J["QuadImageLoader"]["setTerrain"](this["getMesh"](W3J["TilePositionType"]["SE"]),o4J["origin"],o4J["SEVertices"],o4J["SENormal"],o4J["SEUV"],o4J["SEIndex"],o4J["SEEdgeFaceStartIndex"]);this["dataComplete"]=true;};C3J["prototype"]["initialize"]=function(){if(this["isInitialize"]==false){if(this["getKeyNumber"]()!=-1){if(this["loadData"]()==false){return this["isInitialize"];}if(this["imageReady"]==true||this["terrainReady"]==true){this["processData"]();}else{if(this["retryCount"]>0){this["retryCount"]=this["retryCount"]-1;this["dataComplete"]=false;this["imageReady"]=false;this["terrainReady"]=false;}}}}return this["isInitialize"];};C3J["prototype"]["isMakableChild"]=function(d4J){var c4J,e4J,v4J,h4J,j4J,I4J,w4J,u4J;if(this["quadInfo"]["level"]==0){return true;}if(this["quadInfo"]["south"]>=80||this["quadInfo"]["north"]<=-80){c4J=this["cmworld3"];e4J=W3J["CmMathEngine"]["Geo2Cartesian"](this["quadInfo"]["west"],this["quadInfo"]["north"],W3J["cm_const"]["EarthRadius"]);v4J=W3J["CmMathEngine"]["Geo2Cartesian"](this["quadInfo"]["east"],this["quadInfo"]["north"],W3J["cm_const"]["EarthRadius"]);h4J=W3J["CmMathEngine"]["Geo2Cartesian"](this["quadInfo"]["west"],this["quadInfo"]["south"],W3J["cm_const"]["EarthRadius"]);j4J=W3J["CmMathEngine"]["Geo2Cartesian"](this["quadInfo"]["east"],this["quadInfo"]["south"],W3J["cm_const"]["EarthRadius"]);I4J=new THREE["Vector3"]();w4J=new THREE["Vector3"]();I4J["subVectors"](v4J,e4J);w4J["subVectors"](j4J,h4J);u4J=I4J["length"]()+w4J["length"]();if(u4J<200000)return false;}return true;};C3J["prototype"]["newQuadImageTile"]=function(){var K4J;K4J=this["cmworld3"]["quadTileLayer"]["newQuadImageTile"](this);K4J["setMinMaxHeight"](this["minHeight"],this["maxHeight"]);return K4J;};C3J["prototype"]["makeChild"]=function(){var P4J,N4J,b4J;if(this["isMakableChild"](this["quadInfo"])===false)return;P4J=this["cmworld3"];if(this["NWChildTile"]==null){N4J=new W3J["QuadinfoStruct"](this["parentLayer"]);N4J["setState"](this["quadInfo"]["level"]+1,this["quadInfo"]["row"]*2+1,this["quadInfo"]["col"]*2,W3J["TilePositionType"]["NW"],this);if(N4J["isInFrustum"]()){b4J=this["newQuadImageTile"]();b4J["setTileInfo"](this["quadInfo"]["level"]+1,this["quadInfo"]["row"]*2+1,this["quadInfo"]["col"]*2);b4J["position"]=new THREE["Vector3"](N4J["position"]["x"],N4J["position"]["y"],N4J["position"]["z"]);b4J["quadInfo"]["setState"](b4J["level"],b4J["row"],b4J["col"],W3J["TilePositionType"]["NW"],this);b4J["setKeyNumber"](b4J["getKeyNumber"]());this["NWChildTile"]=b4J;}}if(this["NEChildTile"]==null){N4J=new W3J["QuadinfoStruct"](this["parentLayer"]);N4J["setState"](this["quadInfo"]["level"]+1,this["quadInfo"]["row"]*2+1,this["quadInfo"]["col"]*2+1,W3J["TilePositionType"]["NE"],this);if(N4J["isInFrustum"]()){b4J=this["newQuadImageTile"]();b4J["setTileInfo"](this["quadInfo"]["level"]+1,this["quadInfo"]["row"]*2+1,this["quadInfo"]["col"]*2+1);b4J["position"]=new THREE["Vector3"](N4J["position"]["x"],N4J["position"]["y"],N4J["position"]["z"]);b4J["quadInfo"]["setState"](b4J["level"],b4J["row"],b4J["col"],W3J["TilePositionType"]["NE"],this);b4J["setKeyNumber"](b4J["getKeyNumber"]());this["NEChildTile"]=b4J;}}if(this["SWChildTile"]==null){N4J=new W3J["QuadinfoStruct"](this["parentLayer"]);N4J["setState"](this["quadInfo"]["level"]+1,this["quadInfo"]["row"]*2,this["quadInfo"]["col"]*2,W3J["TilePositionType"]["SW"],this);if(N4J["isInFrustum"]()){b4J=this["newQuadImageTile"]();b4J["setTileInfo"](this["quadInfo"]["level"]+1,this["quadInfo"]["row"]*2,this["quadInfo"]["col"]*2);b4J["position"]=new THREE["Vector3"](N4J["position"]["x"],N4J["position"]["y"],N4J["position"]["z"]);b4J["quadInfo"]["setState"](b4J["level"],b4J["row"],b4J["col"],W3J["TilePositionType"]["SW"],this);b4J["setKeyNumber"](b4J["getKeyNumber"]());this["SWChildTile"]=b4J;}}if(this["SEChildTile"]==null){N4J=new W3J["QuadinfoStruct"](this["parentLayer"]);N4J["setState"](this["quadInfo"]["level"]+1,this["quadInfo"]["row"]*2,this["quadInfo"]["col"]*2+1,W3J["TilePositionType"]["SE"],this);if(N4J["isInFrustum"]()){b4J=this["newQuadImageTile"]();b4J["setTileInfo"](this["quadInfo"]["level"]+1,this["quadInfo"]["row"]*2,this["quadInfo"]["col"]*2+1);b4J["position"]=new THREE["Vector3"](N4J["position"]["x"],N4J["position"]["y"],N4J["position"]["z"]);b4J["quadInfo"]["setState"](b4J["level"],b4J["row"],b4J["col"],W3J["TilePositionType"]["SE"],this);b4J["setKeyNumber"](b4J["getKeyNumber"]());this["SEChildTile"]=b4J;}}};C3J["prototype"]["hasChild"]=function(){if(this["NWChildTile"]===null)return false;if(this["NEChildTile"]===null)return false;if(this["SWChildTile"]===null)return false;if(this["SEChildTile"]===null)return false;return true;};C3J["prototype"]["clearChild"]=function(){var Q4J,q4J;Q4J=this["cmworld3"];q4J=this["getChildTileArray"]();for(var B4J=0;B4J<q4J["length"];B4J++){if(q4J[B4J]!=null){q4J[B4J]["dispose"]();}}this["NWChildTile"]=null;this["NEChildTile"]=null;this["SWChildTile"]=null;this["SEChildTile"]=null;};C3J["prototype"]["clear"]=function(){var L2J,V2J,H2J,k2J;L2J=this["cmworld3"];this["initTile"]();V2J=this["cmworld3"]["getTerrainScene"]();H2J=this["getMeshArray"]();for(var f4J=0;f4J<H2J["length"];f4J++){if(W3J["Util"]["isDefined"](H2J[f4J])){V2J["remove"](H2J[f4J]);}}if(this["textMesh"]){L2J["rootScene"]["remove"](this["textMesh"]);this["textMesh"]["geometry"]["dispose"]();W3J["Util"]["disposeMaterial"](this["textMesh"]["material"]);this["textMesh"]=null;}this["disposeTexture"]();if(W3J["Util"]["isDefined"](this["shareMaterial"])){L2J["requestDispose"](this["shareMaterial"]);this["shareMaterial"]=null;}for(var f4J=0;f4J<H2J["length"];f4J++){if(W3J["Util"]["isDefined"](H2J[f4J])){if(H2J[f4J]instanceof THREE["Group"]){if(H2J[f4J]["children"]){for(var m2J=0;m2J<H2J[f4J]["children"]["length"];m2J++){if(H2J[f4J]["children"][m2J]){k2J=H2J[f4J]["children"][m2J];if(k2J["geometry"]){k2J["geometry"]["dispose"]();k2J["geometry"]=null;}if(k2J["material"]){L2J["requestDispose"](k2J["material"]);k2J["material"]=null;}H2J[f4J]["children"][m2J]=null;}}}}else{if(H2J[f4J]){if(H2J[f4J]["geometry"]){H2J[f4J]["geometry"]["dispose"]();H2J[f4J]["geometry"]=null;}if(H2J[f4J]["material"]){L2J["requestDispose"](H2J[f4J]["material"]);H2J[f4J]["material"]=null;}H2J[f4J]=null;}}}}this["NWmesh"]=null;this["NEmesh"]=null;this["SWmesh"]=null;this["SEmesh"]=null;this["isInitialize"]=false;this["ParentLayer"]=null;this["NWDraw"]=false;this["NEDraw"]=false;this["SWDraw"]=false;this["SEDraw"]=false;this["baseMapImage"]=null;this["tempData"]=0;for(var E2J in this["overlayImageTiles"]){this["overlayImageTiles"][E2J]["clear"]();}this["overlayImageTiles"]=[];this["overlayimagestate"]=[];for(var f4J=0;f4J<this["vectorImageSubTiles"]["length"];f4J++){this["vectorImageSubTiles"][f4J]["clear"]();}this["vectorImageSubTiles"]=[];this["minHeight"]=0;this["maxHeight"]=0;this["dataComplete"]=false;this["position"]=new THREE["Vector3"](0,0,0);};C3J["prototype"]["updateMeshPostion"]=function(y2J,s2J){if(W3J["Util"]["isDefined"](y2J)){y2J["position"]["set"](s2J["x"],s2J["y"],s2J["z"]);y2J["updateMatrix"]();}};C3J["prototype"]["resetOverlayImage"]=function(){var l2J;l2J=this["getChildTileArray"]();for(var Y2J=0;Y2J<l2J["length"];Y2J++){if(l2J[Y2J]!=null){l2J[Y2J]["resetOverlayImage"]();}}for(var r2J in this["overlayImageTiles"]){this["overlayImageTiles"][r2J]["imageUsed"]=false;}};C3J["prototype"]["resetVectorImage"]=function(){var W2J;W2J=this["getChildTileArray"]();for(var F2J=0;F2J<W2J["length"];F2J++){if(W2J[F2J]!=null){W2J[F2J]["resetVectorImage"]();}}for(var F2J=0;F2J<this["vectorImageSubTiles"]["length"];F2J++){this["vectorImageSubTiles"][F2J]["imageUsed"]=false;this["vectorImageSubTiles"][F2J]["redraw"]();}};C3J["prototype"]["redrawVectorImage"]=function(){var G2J;G2J=this["getChildTileArray"]();for(var U2J=0;U2J<G2J["length"];U2J++){if(G2J[U2J]!=null){G2J[U2J]["redrawVectorImage"]();}}for(var U2J=0;U2J<this["vectorImageSubTiles"]["length"];U2J++){this["vectorImageSubTiles"][U2J]["needsUpdate"]=true;this["vectorImageSubTiles"][U2J]["imageUsed"]=false;this["vectorImageSubTiles"][U2J]["redraw"]();}};C3J["prototype"]["updateImage"]=function(){};C3J["prototype"]["updateBaseMapTexture"]=function(M2J){if(W3J["Util"]["isDefined"](this["baseMapCanvas"]["context"])==false)return;if(this["textureCompressed"]){}else{this["baseMapCanvas"]["context"]["drawImage"](M2J,0,0);}this["baseMapCanvas"]["tex"]["needsUpdate"]=true;};Object["defineProperty"](C3J["prototype"],"contextDrawingVector",{get:function(){if(C3J["TESTCODE_UseBaseMapCanvas"])return this["baseMapCanvas"]["context"];return this["overlayMapCanvas"]["context"];},enumerable:true,configurable:true});C3J["prototype"]["getClosestDistanceFromCamera"]=function(){var C2J;{}C2J=this["quadInfo"]["getClosestDistanceFromCamera"]();return C2J;};C3J["prototype"]["doClearChild"]=function(z2J){var D2J,A2J;D2J=this["cmworld3"];A2J=D2J["option"]["displayDist4Level"][this["quadInfo"]["level"]+1];if(z2J>A2J*1.2){this["clearChild"]();}};C3J["prototype"]["checkRedrawOverlayMap"]=function(g2J){var X2J,n2J,t2J,T2J;if(g2J===void 0){g2J=false;}X2J=this["cmworld3"];n2J=false;for(var R2J=0;R2J<this["overlayImageTiles"]["length"]&&n2J==false;R2J++){if(g2J)return true;if(this["overlayImageTiles"][R2J]["imageUsed"]==false){n2J=true;break;}}for(var R2J=0;R2J<this["vectorImageSubTiles"]["length"]&&n2J==false;R2J++){if(g2J)return true;if(this["vectorImageSubTiles"][R2J]["imageUsed"]==false){n2J=true;break;}}if(n2J==false){for(var a2J in X2J["overlayImages"]){t2J=this["overlayimagestate"][a2J];if(t2J==undefined){n2J=true;break;}}}if(n2J==false){for(var O2J in X2J["measureLayer"]["gisObjectArray"]){if(g2J)return true;T2J=X2J["measureLayer"]["gisObjectArray"][O2J];if(T2J["needsRedraw"]){if(T2J["boundary"]["intersect"](this["quadInfo"]["getBoundary"]()["toRectangle"]())==true){n2J=true;break;}}}}return n2J;};C3J["prototype"]["update"]=function(){var o2J,j2J,p2J,i2J,Z2J,u2J,d2J,K2J,b2J,N2J,J2J,w2J,x2J,I2J,c2J,v2J;o2J=this["cmworld3"];o2J["option"]["tileCountDrawn"]++;if(this["isInFrustum"]()==false){if(this["lastUpdateTime"]>0){j2J=o2J["option"]["renderFrameTime"]-this["lastUpdateTime"];if(j2J>3000){p2J=this["getClosestDistanceFromCamera"]();this["doClearChild"](p2J);this["lastUpdateTime"]=o2J["option"]["renderFrameTime"];}}return;}this["lastUpdateTime"]=o2J["option"]["renderFrameTime"];if(this["initialize"]()==false)return;if(!this["NWmesh"]||!this["NEmesh"]||!this["SWmesh"]||!this["SEmesh"]){return false;}i2J=this["NWmesh"];if(!i2J["ready"])return false;i2J=this["NEmesh"];if(!i2J["ready"])return;i2J=this["SWmesh"];if(!i2J["ready"])return;i2J=this["SEmesh"];if(!i2J["ready"])return;if(this["quadInfo"]["tilePosition"]==W3J["TilePositionType"]["Top"]){o2J["option"]["earth"]["showTopTile"](this["getKeyNumber"](),false);}{o2J["quadTileQuery"]["setShowTile"](this["quadInfo"]["level"],this["quadInfo"]["row"],this["quadInfo"]["col"],true);o2J["notifyGenerateTile"](this["quadInfo"]["level"],this["quadInfo"]["row"],this["quadInfo"]["col"]);}Z2J=this["quadInfo"]["position"]["clone"]();{Z2J["x"]-=o2J["option"]["refCenter"]["x"];Z2J["y"]-=o2J["option"]["refCenter"]["y"];Z2J["z"]-=o2J["option"]["refCenter"]["z"];this["updateMeshPostion"](this["NWmesh"],Z2J);this["updateMeshPostion"](this["NEmesh"],Z2J);this["updateMeshPostion"](this["SWmesh"],Z2J);this["updateMeshPostion"](this["SEmesh"],Z2J);}if(this["textMesh"]){this["textMesh"]["position"]["set"](Z2J["x"],Z2J["y"],Z2J["z"]);this["textMesh"]["quaternion"]["copy"](o2J["getCamera"]()["getThreejsCamera"]()["quaternion"]);}p2J=this["getClosestDistanceFromCamera"]();u2J=o2J["option"]["displayDist4Level"][this["quadInfo"]["level"]+1];if(p2J<u2J){this["makeChild"]();}else{this["doClearChild"](p2J);}this["NWDraw"]=false;this["NEDraw"]=false;this["SWDraw"]=false;this["SEDraw"]=false;d2J=false;K2J=false;b2J=false;N2J=false;if(this["NWChildTile"]!=null){this["NWDraw"]=this["NWChildTile"]["update"]();}if(this["NEChildTile"]!=null){this["NEDraw"]=this["NEChildTile"]["update"]();}if(this["SWChildTile"]!=null){this["SWDraw"]=this["SWChildTile"]["update"]();}if(this["SEChildTile"]!=null){this["SEDraw"]=this["SEChildTile"]["update"]();}this["NWmesh"]["visible"]=!this["NWDraw"];this["NEmesh"]["visible"]=!this["NEDraw"];this["SWmesh"]["visible"]=!this["SWDraw"];this["SEmesh"]["visible"]=!this["SEDraw"];if(this["overlayMapFrameID"]<o2J["frameState"]["overlayMapMinFrameID"]){this["setReDrawMapFlag"](W3J["MapLayerType"]["overlayMap"]);}J2J=false;w2J=false;if(this["reDrawOverlay"]){J2J=true;w2J=true;this["setReDrawMapFlag"](W3J["MapLayerType"]["overlayMap"],false);}else{w2J=this["checkRedrawOverlayMap"]();}if(w2J){if(W3J["Util"]["isDefined"](this["overlayMapCanvas"]["context"])){this["overlayMapCanvas"]["context"]["clearRect"](0,0,this["overlayMapCanvas"]["canvas"]["width"],this["overlayMapCanvas"]["canvas"]["height"]);x2J=null;for(var h2J in this["overlayImageTiles"]){I2J=this["overlayImageTiles"][h2J];x2J=I2J["getImage"]();if(x2J!=null){if(this["textureCompressed"]){J2J=this["drawImage"](x2J,this["overlayMapCanvas"]["context"],false,true,0,0,0,0,I2J["parentLayer"]["mapInfo"]["opacity"])||J2J;}else{J2J=this["drawImage"](x2J,this["overlayMapCanvas"]["context"],false,false,0,0,0,0,I2J["parentLayer"]["mapInfo"]["opacity"])||J2J;}I2J["imageUsed"]=true;}}for(var S2J=0;S2J<this["vectorImageSubTiles"]["length"];S2J++){x2J=this["vectorImageSubTiles"][S2J]["getImage"]();if(x2J!=null){if(this["textureCompressed"]){J2J=this["drawImage"](x2J,this["overlayMapCanvas"]["context"],false,true,0,0,0,0)||J2J;}else{J2J=this["drawImage"](x2J,this["overlayMapCanvas"]["context"],false,false,0,0,0,0)||J2J;}this["vectorImageSubTiles"][S2J]["imageUsed"]=true;}}for(var e2J in o2J["overlayImages"]){c2J=o2J["overlayImages"][e2J];v2J=c2J["draw"](this["quadInfo"]["level"],this["quadInfo"]["row"],this["quadInfo"]["col"],this["overlayMapCanvas"]["context"],this["overlayMapCanvas"]["canvas"]["width"],this["overlayMapCanvas"]["canvas"]["height"],this["textureCompressed"]);this["overlayimagestate"][e2J]=v2J;J2J=J2J||v2J;}if(o2J["option"]["viewTileInfo"]==true){J2J=this["drawTileInfo"]()||J2J;}this["drawMeasureLayer"](o2J);if(J2J)this["overlayMapCanvas"]["tex"]["needsUpdate"]=J2J;this["overlayMapFrameID"]=o2J["option"]["renderFrameID"];this["clearMap"](this["dynamicMapCanvas"]["context"],this["dynamicMapCanvas"]["tex"]);}}this["requestPOIRendering"]();this["drawMeasurementObject"](o2J);this["cascadeHeightChangeEvent"]();if(o2J["option"]["maxDisplayLevel"]<this["quadInfo"]["level"]){o2J["option"]["maxDisplayLevel"]=this["quadInfo"]["level"];}this["checkUnderGround"](this["ParentLayer"]);return true;};C3J["prototype"]["requestPOIRendering"]=function(){var P2J,Q2J;for(var B2J=0;B2J<this["vectorImageSubTiles"]["length"];B2J++){P2J=this["vectorImageSubTiles"][B2J];if(P2J["getLayer"]()["visible"]){if(P2J["parentLayer"]["mapInfo"]["MaxLevel"]>this["level"]){Q2J=P2J["parentLayer"];for(var q2J=0;q2J<P2J["poiObjects"]["length"];q2J++){P2J["poiObjects"][q2J]["render"](0);}}}}};C3J["prototype"]["checkUnderGround"]=function(V1J){var f2J,H1J,m1J,L1J;f2J=this["cmworld3"];if(W3J["Util"]["isDefined"](f2J)){if(f2J["option"]["showUnderGround"]==true)return;}H1J=true;if(f2J["camera"]["isUnderSeaLine"]()){H1J=false;}else if(f2J["camera"]["getAltitude"]()<0){H1J=false;}if(H1J==false){m1J=this["getMeshArray"]();for(var k1J=0;k1J<m1J["length"];k1J++){L1J=m1J[k1J];if(W3J["Util"]["isDefined"](L1J)){L1J["visible"]=H1J;}}}};C3J["prototype"]["getMeshArray"]=function(){return[this["NWmesh"],this["NEmesh"],this["SWmesh"],this["SEmesh"]];};C3J["prototype"]["clearMap"]=function(E1J,y1J){E1J["clearRect"](0,0,E1J["canvas"]["width"],E1J["canvas"]["height"]);y1J["needsUpdate"]=true;};C3J["prototype"]["drawMeasureLayer"]=function(r1J){var s1J,F1J,U1J,G1J,l1J,W1J;if(r1J["measureLayer"]["gisObjectArray"]["length"]<1)return;{}s1J=this["overlayMapCanvas"]["context"];if(W3J["Util"]["isDefined"](s1J)==false)return;F1J=false;U1J=Math["abs"](this["quadInfo"]["north"]-this["quadInfo"]["south"]);G1J=s1J["canvas"]["width"]/U1J;s1J["save"]();try{s1J["lineWidth"]=2;s1J["strokeStyle"]="rgb(255, 0, 0)";s1J["fillStyle"]="rgba(255,165,0,0.5)";for(var Y1J=0;Y1J<r1J["measureLayer"]["gisObjectArray"]["length"];Y1J++){l1J=r1J["measureLayer"]["gisObjectArray"][Y1J];if(W3J["Util"]["isDefined"](l1J)==false)continue;if(l1J["vectorRenderMode"]==W3J["VectorRenderMode"]["image"]){W1J=l1J;if(W1J["boundary"]["intersect"](this["quadInfo"]["getBoundary"]()["toRectangle"]())==true){W1J["drawToCanvas"](s1J,G1J,this["quadInfo"]["west"],this["quadInfo"]["north"]);F1J=true;}}}}catch(M1J){console["error"](M1J);}finally{s1J["restore"]();}if(F1J){this["overlayMapCanvas"]["tex"]["needsUpdate"]=true;}};C3J["prototype"]["drawMeasurementObject"]=function(D1J){var C1J,A1J,z1J,n1J,R1J;C1J=this["dynamicMapCanvas"]["context"];if(W3J["Util"]["isDefined"](C1J)==false)return;A1J=this["reDrawDynamicMap"];this["setReDrawMapFlag"](W3J["MapLayerType"]["dynamicMap"],false);if(this["dynamicMapFrameID"]>=D1J["option"]["renderFrameID"])return;if(this["dynamicMapFrameID"]<D1J["frameState"]["dynamicMapFrameID"])A1J=true;if(A1J){this["clearMap"](this["dynamicMapCanvas"]["context"],this["dynamicMapCanvas"]["tex"]);if(W3J["Util"]["isDefined"](D1J["mouse"]["userDrawHandler"])){z1J=D1J["mouse"]["userDrawHandler"]["getEditingGisObject"]();if(W3J["Util"]["isDefined"](z1J)){if(z1J["vectorRenderMode"]==W3J["VectorRenderMode"]["image"]){n1J=Math["abs"](this["quadInfo"]["north"]-this["quadInfo"]["south"]);R1J=C1J["canvas"]["width"]/n1J;C1J["save"]();try{C1J["lineWidth"]=2;C1J["strokeStyle"]="rgb(255, 0, 0)";C1J["fillStyle"]="rgba(255,165,0,0.5)";z1J["drawToCanvas"](C1J,R1J,this["quadInfo"]["west"],this["quadInfo"]["north"]);}catch(g1J){console["error"](g1J);}finally{C1J["restore"]();}}}}this["dynamicMapCanvas"]["tex"]["needsUpdate"]=A1J;}this["dynamicMapFrameID"]=D1J["option"]["renderFrameID"];};C3J["prototype"]["cascadeHeightChangeEvent"]=function(){var T1J,O1J,a1J;for(var X1J=0;X1J<this["groundheightChangedRequesters"]["length"];X1J++){T1J=this["groundheightChangedRequesters"][X1J];O1J=this["getChildTileArray"]();for(var t1J=0;t1J<O1J["length"];t1J++){a1J=O1J[t1J];if(a1J!=null){if(a1J["isIncludeCoord"](T1J["lon"],T1J["lat"])){this["groundheightChangedRequesters"]["splice"](X1J,1);--X1J;T1J["tile"]=a1J;a1J["groundheightChangedRequesters"]["push"](T1J);break;}}}}};C3J["prototype"]["getChildTileArray"]=function(){var o1J;o1J=[this["NWChildTile"],this["NEChildTile"],this["SWChildTile"],this["SEChildTile"]];return o1J;};C3J["prototype"]["removeOverlayImage"]=function(x1J){var Z1J;this["overlayimagestate"]=[];Z1J=this["getChildTileArray"]();for(var J1J=0;J1J<Z1J["length"];J1J++){if(Z1J[J1J]!=null){Z1J[J1J]["removeOverlayImage"](x1J);}}};C3J["prototype"]["resetOverlayImageLayer"]=function(){var p1J;p1J=this["getChildTileArray"]();for(var i1J=0;i1J<p1J["length"];i1J++){if(p1J[i1J]!=null){p1J[i1J]["resetOverlayImageLayer"]();}}for(var S1J in this["overlayImageTiles"]){this["overlayImageTiles"][S1J]["imageUsed"]=false;}};C3J["prototype"]["removeOverlayImageLayer"]=function(v1J){var w1J;w1J=this["getChildTileArray"]();for(var I1J=0;I1J<w1J["length"];I1J++){if(w1J[I1J]!=null){w1J[I1J]["removeOverlayImageLayer"](v1J);}}for(var e1J in this["overlayImageTiles"]){if(this["overlayImageTiles"][e1J]["parentLayer"]["name"]==v1J){delete this["overlayImageTiles"][e1J];}}this["setReDrawMapFlag"](W3J["MapLayerType"]["overlayMap"]);};C3J["prototype"]["setReDrawMapFlag"]=function(j1J,h1J){if(h1J===void 0){h1J=true;}if(j1J==W3J["MapLayerType"]["overlayMap"]){this["reDrawOverlay"]=h1J;}else if(j1J==W3J["MapLayerType"]["dynamicMap"]){this["reDrawDynamicMap"]=h1J;}};C3J["prototype"]["getGroundHeight"]=function(q1J,B1J){var b1J,Q1J,P1J,k5J,u1J,L5J,K1J,c1J,f1J,m5J,H5J,d1J,V5J;b1J=-9999;Q1J=this["getChildTileArray"]();for(var N1J=0;N1J<Q1J["length"];N1J++){P1J=Q1J[N1J];if(P1J!=null){if(P1J["isIncludeCoord"](q1J,B1J)){k5J=P1J["getGroundHeight"](q1J,B1J);if(k5J>-9998){b1J=k5J;return b1J;}}}}u1J=this["getMeshIncludeCoord"](q1J,B1J);if(W3J["Util"]["isDefined"](u1J)){if(u1J instanceof THREE["Group"]){if(u1J["children"]["length"]>0){u1J=u1J["children"][0];}else{u1J=null;}}if(W3J["Util"]["isDefined"](u1J)){L5J=this["maxHeight"]+100;K1J=this["cmworld3"];c1J=W3J["CmMathEngine"]["Geo2Cartesian"](q1J,B1J,W3J["cm_const"]["EarthRadius"]+L5J);f1J=new THREE["Vector3"](-c1J["x"],-c1J["y"],-c1J["z"]);f1J["normalize"]();{c1J["x"]-=K1J["option"]["refCenter"]["x"];c1J["y"]-=K1J["option"]["refCenter"]["y"];c1J["z"]-=K1J["option"]["refCenter"]["z"];}m5J=new THREE["Raycaster"](c1J,f1J);H5J=m5J["intersectObject"](u1J,false);if(H5J["length"]>0){d1J=H5J[0]["point"];d1J["x"]+=K1J["option"]["refCenter"]["x"];d1J["y"]+=K1J["option"]["refCenter"]["y"];d1J["z"]+=K1J["option"]["refCenter"]["z"];V5J=W3J["CmMathEngine"]["Cartesian2Geo"](d1J["x"],d1J["y"],d1J["z"]);b1J=V5J["z"]-W3J["cm_const"]["EarthRadius"];}}}return b1J;};C3J["prototype"]["getHighResolutionTile"]=function(s5J,Y5J){var F5J,l5J,E5J,r5J;F5J=null;l5J=this["getChildTileArray"]();for(var y5J=0;y5J<l5J["length"];y5J++){E5J=l5J[y5J];if(E5J!=null){if(E5J["isIncludeCoord"](s5J,Y5J)){E5J=E5J["getHighResolutionTile"](s5J,Y5J);if(E5J){return E5J;}}}}r5J=this["getMeshIncludeCoord"](s5J,Y5J);if(r5J==null)return null;return this;};C3J["prototype"]["traverse"]=function(G5J){var U5J;if(G5J){G5J(this);U5J=this["getChildTileArray"]();for(var W5J=0;W5J<U5J["length"];W5J++){if(U5J[W5J]!=null){U5J[W5J]["traverse"](G5J);}}}};C3J["prototype"]["resetPolaimage"]=function(){var C5J,M5J;C5J=W3J["CmWorld3"]["getInstance"]();if(C5J["polar"]["polarImageOverlayEnable"]==true){if(this["NWmesh"]){if(this["NWmesh"]["material"]){M5J=this["NWmesh"]["material"];if(W3J["Util"]["isDefined"](M5J["uniforms"]["polaimageenable"])){M5J["uniforms"]["polaimageenable"]["value"]=C5J["polar"]["polarImageOverlayEnable"];M5J["uniforms"]["polamaxradius"]["value"]=C5J["polar"]["polarImageMaxRadius"];M5J["uniforms"]["arcticmap"]["value"]=C5J["polar"]["arcticTexture"];M5J["uniforms"]["antarcticmap"]["value"]=C5J["polar"]["antarcticTexture"];}}}if(this["NEmesh"]){if(this["NEmesh"]["material"]){M5J=this["NEmesh"]["material"];if(W3J["Util"]["isDefined"](M5J["uniforms"]["polaimageenable"])){M5J["uniforms"]["polaimageenable"]["value"]=C5J["polar"]["polarImageOverlayEnable"];M5J["uniforms"]["polamaxradius"]["value"]=C5J["polar"]["polarImageMaxRadius"];M5J["uniforms"]["arcticmap"]["value"]=C5J["polar"]["arcticTexture"];M5J["uniforms"]["antarcticmap"]["value"]=C5J["polar"]["antarcticTexture"];}}if(this["SWmesh"]){if(this["SWmesh"]["material"]){M5J=this["SWmesh"]["material"];if(W3J["Util"]["isDefined"](M5J["uniforms"]["polaimageenable"])){M5J["uniforms"]["polaimageenable"]["value"]=C5J["polar"]["polarImageOverlayEnable"];M5J["uniforms"]["polamaxradius"]["value"]=C5J["polar"]["polarImageMaxRadius"];M5J["uniforms"]["arcticmap"]["value"]=C5J["polar"]["arcticTexture"];M5J["uniforms"]["antarcticmap"]["value"]=C5J["polar"]["antarcticTexture"];}}}if(this["SEmesh"]){if(this["SEmesh"]["material"]){M5J=this["SEmesh"]["material"];if(W3J["Util"]["isDefined"](M5J["uniforms"]["polaimageenable"])){M5J["uniforms"]["polaimageenable"]["value"]=C5J["polar"]["polarImageOverlayEnable"];M5J["uniforms"]["polamaxradius"]["value"]=C5J["polar"]["polarImageMaxRadius"];M5J["uniforms"]["arcticmap"]["value"]=C5J["polar"]["arcticTexture"];M5J["uniforms"]["antarcticmap"]["value"]=C5J["polar"]["antarcticTexture"];}}}}else{M5J=this["NWmesh"]["material"];if(W3J["Util"]["isDefined"](M5J["uniforms"]["polaimageenable"])){M5J["uniforms"]["polaimageenable"]["value"]=C5J["polar"]["polarImageOverlayEnable"];M5J=this["NEmesh"]["material"];M5J["uniforms"]["polaimageenable"]["value"]=C5J["polar"]["polarImageOverlayEnable"];M5J=this["SWmesh"]["material"];M5J["uniforms"]["polaimageenable"]["value"]=C5J["polar"]["polarImageOverlayEnable"];M5J=this["SEmesh"]["material"];M5J["uniforms"]["polaimageenable"]["value"]=C5J["polar"]["polarImageOverlayEnable"];}}};};C3J["prototype"]["updateOpacityAll"]=function(n5J){var D5J,z5J;if(this["NWmesh"]["material"]==null){return;}D5J=this["NWmesh"]["material"];D5J["opacity"]=n5J;if(D5J instanceof THREE["ShaderMaterial"]){D5J["uniforms"]["opacity"]["value"]=n5J;}if(n5J>=1.0){D5J["transparent"]=false;}else{D5J["transparent"]=true;}z5J=this["getChildTileArray"]();for(var A5J=0;A5J<z5J["length"];A5J++){if(W3J["Util"]["isDefined"](z5J[A5J])&&z5J[A5J]["NWmesh"]["material"]!=null){z5J[A5J]["updateOpacityAll"](n5J);}}D5J["needsUpdate"]=true;};return C3J;}(W3J["Tile"]);G3J["IDCounter"]=1;G3J["TESTCODE_UseBaseMapCanvas"]=false;W3J["QuadImageTile"]=G3J;}(CMWORLD||(CMWORLD={})));(function(g5J){var R5J;R5J=function(){X5J["prototype"]["startJob"]=function(T5J){if(T5J===null)return;if(T5J["startJob"](null)){this["starttime"]=Date["now"]();this["currentJob"]=T5J;}};X5J["prototype"]["directJob"]=function(a5J){this["startJob"](a5J);this["currentJob"]=null;return true;};X5J["prototype"]["requestJob"]=function(t5J){if(t5J===null)return false;if(this["isRequested"](t5J)===false){this["requestedQueue"]["push"](t5J);}return true;};X5J["prototype"]["isRequested"]=function(o5J){for(var O5J in this["requestedQueue"]){if(this["requestedQueue"][O5J]===o5J)return true;}return false;};function X5J(){this["requestedQueue"]=[];this["starttime"]=0;this["currentJob"]=null;}X5J["prototype"]["poupCurrentJob"]=function(){try{if(this["requestedQueue"]["length"]>0){this["requestedQueue"]["shift"]();}if(this["currentJob"]!=null)this["currentJob"]["completeJob"]();this["currentJob"]=null;}catch(J5J){console["error"](J5J);}};X5J["prototype"]["update"]=function(){var Z5J;if(this["currentJob"]!=null){if(this["currentJob"]["isBusy"]()===false){this["starttime"]=0;this["poupCurrentJob"]();}else{if(this["starttime"]>0){Z5J=Date["now"]()-this["starttime"];if(Z5J>20000){console["warn"]('error: cm_jobmanager에서 이런경우가 발생했다. 시간나면 점검해봐라');this["starttime"]=0;this["poupCurrentJob"]();}}return;}return;}while(this["requestedQueue"]["length"]>0){if(this["requestedQueue"][0]["level"]<0){this["requestedQueue"]["shift"]();continue;}this["startJob"](this["requestedQueue"][0]);break;}};X5J["prototype"]["clear"]=function(){};return X5J;}();g5J["JobManager"]=R5J;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var x5J;x5J=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(i5J,p5J){i5J["__proto__"]=p5J;}||function(w5J,I5J){for(var S5J in I5J)if(I5J["hasOwnProperty"](S5J))w5J[S5J]=I5J[S5J];};return function(v5J,e5J){x5J(v5J,e5J);v5J["prototype"]=e5J===null?Object["create"](e5J):(h5J["prototype"]=e5J["prototype"],new h5J());function h5J(){this["constructor"]=v5J;}};}();(function(j5J){var u5J;u5J=function(d5J){function c5J(b5J){var K5J;K5J=d5J["call"](this,b5J)||this;K5J["url"]="";K5J["image"]=null;K5J["isInitialize"]=false;K5J["imageLoader"]=null;K5J["retryCount"]=5;K5J["imageUsed"]=false;K5J["imageLoadOK"]=false;K5J["imageError"]=false;K5J["dataLoading"]=false;return K5J;}__extends(c5J,d5J);c5J["prototype"]["set"]=function(N5J,P5J,B5J,q5J){this["level"]=P5J;this["row"]=B5J;this["col"]=q5J;this["parentLayer"]=N5J;if(j5J["Util"]["isDefined"](N5J)){this["url"]=N5J["getTileURL"](P5J,B5J,q5J);}};c5J["prototype"]["loadData"]=function(){var Q5J;Q5J=this;if(j5J["Util"]["isDefined"](this["imageLoader"])==false){this["imageLoader"]=new THREE["ImageLoader"]();this["imageLoader"]["setCrossOrigin"]("Anonymous");}this["imageLoader"]["load"](this["url"],function(f5J){if(f5J==null){Q5J["imageError"]=true;Q5J["imageLoadOK"]=false;}else{Q5J["image"]=f5J;Q5J["imageError"]=false;Q5J["imageLoadOK"]=true;}},function(H6J){},function(k6J){Q5J["imageError"]=true;Q5J["imageLoadOK"]=true;});};c5J["prototype"]["update"]=function(){if(!this["isInitialize"]){if(this["imageLoadOK"]==false){if(this["dataLoading"]==false){this["dataLoading"]=true;this["loadData"]();}return;}if(this["image"]==null){this["retryCount"]-=1;if(this["retryCount"]>0){this["imageLoadOK"]=false;}return;}this["isInitialize"]=true;}};c5J["prototype"]["clear"]=function(){this["image"]=null;};c5J["prototype"]["getImage"]=function(){if(this["isInitialize"]==false){this["update"]();return null;}if(this["imageLoadOK"]==false){return null;}if(this["parentLayer"]&&this["parentLayer"]["visible"]==false){return null;}return this["image"];};return c5J;}(j5J["Tile"]);j5J["OverlayImageTile"]=u5J;}(CMWORLD||(CMWORLD={})));(function(m6J){var L6J;L6J=function(){V6J["prototype"]["draw"]=function(x6J,w6J,I6J,M6J,p6J,J6J,i6J){var G6J,C6J,g6J,R6J,O6J,S6J,z6J,t6J,D6J,T6J,n6J,a6J,A6J,X6J,Z6J,o6J;try{if(x6J<this["MinLevel"])return false;if(x6J>this["MaxLevel"])return false;G6J=m6J["CmMathEngine"]["getBoundFromRowCol"](x6J,w6J,I6J);if(G6J==null)return false;C6J=this["West"];g6J=this["East"];R6J=this["South"];O6J=this["North"];S6J=m6J["CmWorld3"]["getInstance"]();if(this["South"]>this["North"]){}else{if(this["West"]>this["East"]){if(G6J["West"]<180&&G6J["West"]>=0){C6J=-360+this["West"];G6J["West"]-=360;G6J["East"]-=360;}else{g6J=360+this["East"];G6J["West"]+=360;G6J["East"]+=360;}if(G6J["East"]<=C6J){return false;}if(G6J["West"]>=g6J){return false;}if(G6J["South"]>=O6J){return false;}if(G6J["North"]<R6J){return false;}z6J=this["Image"]["width"]*(G6J["West"]-C6J)/(g6J-C6J);t6J=this["Image"]["width"]*(G6J["East"]-C6J)/(g6J-C6J);D6J=this["Image"]["height"]*(1.0-(G6J["North"]-R6J)/(O6J-R6J));T6J=this["Image"]["height"]*(1.0-(G6J["South"]-R6J)/(O6J-R6J));n6J=0;a6J=J6J;A6J=0;X6J=p6J;M6J["globalAlpha"]=this["Opacity"];if(i6J==true){M6J["save"]();M6J["scale"](1,-1);M6J["drawImage"](this["Image"],z6J,D6J,t6J-z6J,T6J-D6J,A6J,n6J-J6J,X6J-A6J,a6J-n6J);M6J["restore"]();}else{M6J["drawImage"](this["Image"],z6J,D6J,t6J-z6J,T6J-D6J,A6J,n6J,X6J-A6J,a6J-n6J);}return true;}else{if(G6J["East"]<=C6J){return false;}if(G6J["West"]>=g6J){return false;}if(G6J["South"]>=O6J){return false;}if(G6J["North"]<R6J){return false;}z6J=this["Image"]["width"]*(G6J["West"]-C6J)/(g6J-C6J);t6J=this["Image"]["width"]*(G6J["East"]-C6J)/(g6J-C6J);D6J=this["Image"]["height"]*(1.0-(G6J["North"]-R6J)/(O6J-R6J));T6J=this["Image"]["height"]*(1.0-(G6J["South"]-R6J)/(O6J-R6J));n6J=0;a6J=J6J;A6J=0;X6J=p6J;M6J["globalAlpha"]=this["Opacity"];if(i6J==true){M6J["save"]();M6J["scale"](1,-1);M6J["drawImage"](this["Image"],z6J,D6J,t6J-z6J,T6J-D6J,A6J,n6J-J6J,X6J-A6J,a6J-n6J);M6J["restore"]();}else{Z6J=t6J-z6J;o6J=T6J-D6J;Z6J=Math["max"](1,Math["floor"](Z6J));o6J=Math["max"](1,Math["floor"](o6J));M6J["drawImage"](this["Image"],z6J,D6J,Z6J,o6J,A6J,n6J,X6J-A6J,a6J-n6J);}return true;}}return false;}catch(e6J){}};function V6J(U6J,y6J,s6J,Y6J,l6J,r6J,F6J,W6J,E6J){this["Name"]=null;this["MinLevel"]=0;this["MaxLevel"]=0;this["North"]=0;this["South"]=0;this["East"]=0;this["West"]=0;this["Image"]=null;this["Opacity"]=1.0;this["isInitialize"]=false;this["MinLevel"]=s6J;this["MaxLevel"]=Y6J;this["North"]=W6J;this["South"]=F6J;this["East"]=r6J;this["West"]=l6J;this["Image"]=y6J;if(E6J){this["Opacity"]=E6J;}else{this["Opacity"]=1.0;}}V6J["prototype"]["clear"]=function(){this["Image"]=null;};return V6J;}();m6J["OverlayImage"]=L6J;}(CMWORLD||(CMWORLD={})));(function(v6J){var h6J,j6J;h6J=function(){u6J["prototype"]["start"]=function(){this["updating"]=true;this["starttime"]=Date["now"]();};function u6J(){this["updating"]=false;this["candidate"]=null;this["distance"]=0;this["material"]=null;this["starttime"]=0;this["url"]=null;}u6J["prototype"]["finish"]=function(){this["candidate"]=null;this["updating"]=false;this["starttime"]=0;this["url"]=null;};return u6J;}();v6J["downloadCandidate"]=h6J;j6J=function(){c6J["prototype"]["update"]=function(){this["updateMeshCandidate"]();};;c6J["prototype"]["getRequestMaxCountForModelGen"]=function(){var b6J,K6J,N6J,d6J;if(this["requestCountForModelGen"]<1){b6J=v6J["CmWorld3"]["getInstance"]()["getFrameElapsedTime"]();K6J=50;N6J=10;d6J=N6J+b6J*0.1;if(d6J>K6J)d6J=K6J;this["requestCountForModelGen"]=d6J;}return this["requestCountForModelGen"];};c6J["prototype"]["requestGenMesh"]=function(B6J,q6J){var Q6J,f6J,P6J,H9J;if(this["genMeshCandidateKeyList"][B6J["uid"]])return;Q6J=this["getRequestMaxCountForModelGen"]();if(this["genMeshCandidateList"]["length"]>Q6J){f6J=this["genMeshCandidateList"]["length"];if(q6J<this["genMeshCandidateList"][f6J-1]["distance"]){P6J=new h6J();P6J["candidate"]=B6J;P6J["distance"]=q6J;this["genMeshCandidateList"]["push"](P6J);this["genMeshCandidateList"]["sort"](function(k9J,m9J){return k9J["distance"]-m9J["distance"];});this["genMeshCandidateKeyList"][B6J["uid"]]=B6J;H9J=this["genMeshCandidateList"]["pop"]();delete this["genMeshCandidateKeyList"][H9J["candidate"]["uid"]];}}else{P6J=new h6J();P6J["candidate"]=B6J;P6J["distance"]=q6J;this["genMeshCandidateList"]["push"](P6J);this["genMeshCandidateKeyList"][B6J["uid"]]=B6J;}};c6J["prototype"]["updateMeshCandidate"]=function(){var s9J,L9J,V9J,Y9J,E9J,y9J;if(this["genMeshCandidateList"]["length"]>0){s9J=v6J["CmWorld3"]["getInstance"]();L9J=s9J["workerManager"]["rentModelWorker"]();if(L9J){V9J=[];try{Y9J=50;for(var l9J in this["genMeshCandidateList"]){E9J=this["genMeshCandidateList"][l9J]["candidate"];if(E9J){y9J=E9J["genWorkerParam"]();if(y9J){V9J["push"](y9J);if(--Y9J<1)break;}}}if(V9J["length"]>0){if(this["makeModelData"](L9J,v6J["WorkerCommand"]["loadModel"],V9J)==false){L9J["isWorking"]=false;}}else{L9J["isWorking"]=false;}}catch(r9J){L9J["isWorking"]=false;console["error"](r9J);}}this["genMeshCandidateKeyList"]=[];this["genMeshCandidateList"]=[];this["requestCountForModelGen"]=0;}};function c6J(){this["requestCountForModelGen"]=0;this["starttime"]=0;this["textureDownloadOK"]=false;this["currentDOwnloadImageIndex"]=-1;this["imageDownloading"]=false;this["diffuseColors"]=[];this["material"]=[];this["genMeshCandidateList"]=[];this["genMeshCandidateKeyList"]=new Array();}c6J["prototype"]["makeModelData"]=function(M9J,T9J,F9J){var U9J,X9J,G9J,C9J,A9J,z9J,n9J,D9J,R9J,g9J;if(v6J["Util"]["isDefined"](M9J)==false){for(var W9J=0;W9J<F9J["length"];W9J++){if(F9J[W9J]["owner"]){F9J[W9J]["owner"]["processingMesh"]=false;}}return false;}U9J=function(a9J,t9J,O9J){if(a9J!=null){if(O9J==null){if(t9J){console["log"]("failed "+t9J);}a9J["setFail"]();}else{a9J["setMesh"](O9J);}}};M9J["onmessage"]=function(p9J){var o9J,i9J,J9J,x9J,Z9J;o9J=p9J["data"];if(o9J["command"]==v6J["WorkerCommand"]["none"])return;i9J=false;try{if(o9J["success"]){J9J=o9J["argIndex"];if(J9J<F9J["length"]){x9J=[];Z9J=F9J[J9J];if(Z9J["fileFormat"]==v6J["FileFormat"]["_3ds"]){x9J=v6J["Max3DSLoader"]["makeMeshFromPackingData"](o9J);if(Z9J["owner"]){Z9J["owner"]["diffuseColors"]=new Array(o9J["diffuseColors"]["length"]);}}else if(Z9J["fileFormat"]==v6J["FileFormat"]["_xdo"]){x9J=v6J["XDOLoader"]["makeMeshFromPackingData"](o9J);}if(U9J){U9J(Z9J["owner"],Z9J["url"],x9J);i9J=true;}}else{v6J["CmWorld"]["outputlog"]("버그다 argIndex가 inArgArray의 길이보다 큰경우가 온다.");}}else{if(F9J!=null&&U9J){if(J9J!=null&&J9J!=undefined){U9J(F9J[J9J]["owner"],F9J[J9J]["url"],null);}}}}catch(S9J){console["error"](S9J["message"]);}finally{if(i9J==false){if(F9J!=null&&U9J){U9J(null,null,null);}}}};M9J["onerror"]=function(I9J){console["info"]("worker onerror ");if(F9J!=null&&U9J){U9J(null,null,null);}};X9J=v6J["CmWorld3"]["getInstance"]();G9J=[];C9J=null;A9J=[];z9J=[];n9J=[];D9J=[];for(var W9J=0;W9J<F9J["length"];W9J++){if(v6J["Util"]["isDefined"](F9J[W9J]["arraybuffer"])&&F9J[W9J]["arraybuffer"]["byteLength"]>0){G9J["push"](F9J[W9J]["arraybuffer"]);}F9J[W9J]["arraybuffer"]=null;A9J["push"](F9J[W9J]["fileName"]);n9J["push"](F9J[W9J]["dataAltitude"]);D9J["push"](F9J[W9J]["url"]);z9J["push"](F9J[W9J]["fileFormat"]);}R9J={buffers:G9J,fileNames:A9J,fileFormats:z9J,dataAltitudes:n9J,urls:D9J,version:F9J[0]["version"],earthRadius:v6J["cm_const"]["EarthRadius"],xorig:F9J[0]["xorig"],yorig:F9J[0]["yorig"],zorig:F9J[0]["zorig"]};g9J=msgpack["encode"](R9J);C9J={command:T9J,cmworld3BaseRoot:v6J["GlobalOption"]["cmworld3BaseRoot"],requestCount:G9J["length"],msgpackBuffer:g9J["buffer"]};try{M9J["postMessage"](C9J,[C9J["msgpackBuffer"]]);}catch(w9J){console["error"](w9J["message"]);return false;}return true;};return c6J;}();v6J["ModelLoadManager"]=j6J;}(CMWORLD||(CMWORLD={})));(function(v9J){var e9J;e9J=function(){h9J["prototype"]["dispose"]=function(){this["disposed"]=true;};function h9J(){this["name"]=null;this["visible"]=true;this["disposed"]=false;this["clipApply"]=true;this["mapViewer"]=null;this["id"]=h9J["UniqueID"]++;this["name"]=this["id"]["toString"]();this["visible"]=true;}h9J["prototype"]["isAlive"]=function(){return!this["disposed"];};h9J["prototype"]["update"]=function(){};h9J["prototype"]["render"]=function(){};return h9J;}();e9J["UniqueID"]=1000;v9J["CmLayer"]=e9J;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var j9J;j9J=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(u9J,c9J){u9J["__proto__"]=c9J;}||function(b9J,K9J){for(var d9J in K9J)if(K9J["hasOwnProperty"](d9J))b9J[d9J]=K9J[d9J];};return function(P9J,N9J){j9J(P9J,N9J);P9J["prototype"]=N9J===null?Object["create"](N9J):(B9J["prototype"]=N9J["prototype"],new B9J());function B9J(){this["constructor"]=P9J;}};}();(function(q9J){var Q9J;Q9J=function(H0J){__extends(f9J,H0J);f9J["prototype"]["setMapInfo"]=function(m0J){this["mapInfo"]=m0J;};f9J["prototype"]["getMapInfo"]=function(){return this["mapInfo"];};f9J["prototype"]["addTile"]=function(L0J){if(L0J==null)return;if(q9J["Util"]["isDefined"](this["isAlive"]())==false)return;if(this["m_tiles"][L0J["level"]]==null)this["m_tiles"][L0J["level"]]=new Array();if(this["m_tiles"][L0J["level"]][L0J["row"]]==null)this["m_tiles"][L0J["level"]][L0J["row"]]=new Array();L0J["parentLayer"]=this;this["m_tiles"][L0J["level"]][L0J["row"]][L0J["col"]]=L0J;};f9J["prototype"]["getTileURL"]=function(V0J,y0J,s0J){var E0J,Y0J,l0J,r0J,F0J,W0J;if(this["mapInfo"]!=null){if(V0J>this["mapInfo"]["MaxLevel"]||V0J<this["mapInfo"]["MinLevel"]){return null;}E0J=this["mapViewer"];Y0J=q9J["CmMathEngine"]["getRowFromLatitude"](this["mapInfo"]["North"],E0J["option"]["TileLevelRange"][V0J]);l0J=q9J["CmMathEngine"]["getRowFromLatitude"](this["mapInfo"]["South"],E0J["option"]["TileLevelRange"][V0J]);if(y0J<l0J||y0J>Y0J)return null;r0J=q9J["CmMathEngine"]["getColFromLongitude"](this["mapInfo"]["West"],E0J["option"]["TileLevelRange"][V0J]);F0J=q9J["CmMathEngine"]["getColFromLongitude"](this["mapInfo"]["East"],E0J["option"]["TileLevelRange"][V0J]);if(s0J<r0J||s0J>F0J)return null;W0J=q9J["TiledMapInfo"]["applyIndex"](this["mapInfo"]["serverURL"],V0J,y0J,s0J);return W0J;}return null;};f9J["prototype"]["addEmptyTile"]=function(U0J){if(this["isAlive"]()){this["emptyTiles"][U0J]=true;}};function f9J(){var k0J;k0J=H0J["call"](this)||this;k0J["mapInfo"]=new q9J["TiledMapInfo"]();k0J["m_tiles"]=new Array();k0J["emptyTiles"]=new Array();k0J["mapViewer"]=q9J["CmWorld3"]["getInstance"]();return k0J;}f9J["prototype"]["clearAllTile"]=function(){for(var G0J in this["m_tiles"]){for(var M0J in this["m_tiles"][G0J]){for(var C0J in this["m_tiles"][G0J][M0J]){if(this["m_tiles"][G0J][M0J][C0J]!=null){this["m_tiles"][G0J][M0J][C0J]["dispose"]();}}}}this["m_tiles"]=new Array();};f9J["prototype"]["getTile"]=function(D0J,A0J,z0J){if(this["m_tiles"][D0J]!=null){if(this["m_tiles"][D0J][A0J]!=null){return this["m_tiles"][D0J][A0J][z0J];}}return null;};f9J["prototype"]["clearTile"]=function(R0J,g0J,X0J){var n0J;n0J=this["getTile"](R0J,g0J,X0J);if(q9J["Util"]["isDefined"](n0J)){q9J["CmWorld"]["outputInfo"]("clearTile");n0J["dispose"]();delete this["m_tiles"][R0J][g0J][X0J];}};f9J["prototype"]["updateTile"]=function(a0J,t0J,O0J){var T0J;T0J=this["getTile"](a0J,t0J,O0J);if(q9J["Util"]["isDefined"](T0J)){T0J["update"]();}};return f9J;}(q9J["CmLayer"]);q9J["TileLayer"]=Q9J;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var o0J;o0J=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(J0J,Z0J){J0J["__proto__"]=Z0J;}||function(p0J,i0J){for(var x0J in i0J)if(i0J["hasOwnProperty"](x0J))p0J[x0J]=i0J[x0J];};return function(I0J,S0J){o0J(I0J,S0J);I0J["prototype"]=S0J===null?Object["create"](S0J):(w0J["prototype"]=S0J["prototype"],new w0J());function w0J(){this["constructor"]=I0J;}};}();(function(e0J){var v0J;v0J=function(j0J){__extends(h0J,j0J);h0J["prototype"]["addObject"]=function(K0J){this["gisObjectArray"]["push"](K0J);if(e0J["Util"]["isDefined"](this["addObjectEvent"])){this["addObjectEvent"]["raiseEvent"]({object:K0J});}};function h0J(c0J,d0J){var u0J;u0J=j0J["call"](this)||this;u0J["userObjects"]=new Array();u0J["mapInfo"]=new e0J["TiledMapInfo"]();u0J["gisObjectArray"]=new Array();u0J["addObjectEvent"]=null;if(c0J){u0J["name"]=c0J;}u0J["mapViewer"]=d0J;return u0J;}h0J["prototype"]["test"]=function(){var b0J;b0J=new e0J["GisPolyline"]();b0J["points"]["push"](new THREE["Vector3"](126,38));b0J["points"]["push"](new THREE["Vector3"](128,38));b0J["points"]["push"](new THREE["Vector3"](128,36));b0J["points"]["push"](new THREE["Vector3"](126,36));b0J["points"]["push"](new THREE["Vector3"](126,38));this["gisObjectArray"]["push"](b0J);};h0J["prototype"]["clear"]=function(){if(this["gisObjectArray"]["length"]>0){}this["gisObjectArray"]["length"]=0;};h0J["prototype"]["update"]=function(){var N0J;for(var P0J in this["gisObjectArray"]){N0J=this["gisObjectArray"][P0J];if(N0J["vectorRenderMode"]==e0J["VectorRenderMode"]["vector"]){N0J["update"]();}else{}N0J["needsRedraw"]=false;}};return h0J;}(e0J["CmLayer"]);e0J["GisLayer"]=v0J;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var B0J;B0J=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(q0J,Q0J){q0J["__proto__"]=Q0J;}||function(k7S,H7S){for(var f0J in H7S)if(H7S["hasOwnProperty"](f0J))k7S[f0J]=H7S[f0J];};return function(L7S,m7S){function V7S(){this["constructor"]=L7S;}B0J(L7S,m7S);L7S["prototype"]=m7S===null?Object["create"](m7S):(V7S["prototype"]=m7S["prototype"],new V7S());};}();(function(E7S){var y7S;y7S=function(Y7S){__extends(s7S,Y7S);s7S["prototype"]["reDrawOverlayMap"]=function(){this["mapViewer"]["frameState"]["overlayMapMinFrameID"]=this["mapViewer"]["option"]["renderFrameID"];};s7S["prototype"]["reDrawDynamicMap"]=function(){this["mapViewer"]["frameState"]["dynamicMapFrameID"]=this["mapViewer"]["option"]["renderFrameID"];};s7S["prototype"]["setReDrawMap"]=function(U7S,G7S,r7S,F7S){if(r7S===void 0){r7S=0;}if(F7S===void 0){F7S=20;}for(var W7S in this["topTiles"]){if(E7S["Util"]["isDefined"](this["topTiles"][W7S])){this["topTiles"][W7S]["setReDrawMap"](U7S,G7S,r7S,F7S);}}};s7S["prototype"]["getTileURL"]=function(C7S,D7S,A7S){var M7S,z7S;if(C7S==-1||D7S==-1||A7S==-1){return"";}M7S=E7S["CmMathEngine"]["getBoundFromRowCol"](C7S,D7S,A7S);if(C7S>=this["mapInfo"]["MinLevel"]&&C7S<=this["mapInfo"]["MaxLevel"]&&this["mapInfo"]["visible"]==true){if(M7S["West"]>=this["mapInfo"]["West"]&&M7S["West"]<=this["mapInfo"]["East"]&&(M7S["East"]>=this["mapInfo"]["West"]&&M7S["East"]<=this["mapInfo"]["East"])&&(M7S["South"]>=this["mapInfo"]["South"]&&M7S["South"]<=this["mapInfo"]["North"])&&(M7S["North"]>=this["mapInfo"]["South"]&&M7S["North"]<=this["mapInfo"]["North"])){z7S=E7S["TiledMapInfo"]["applyIndex"](this["mapInfo"]["serverURL"],C7S,D7S,A7S);return z7S;}else{}}return"";};s7S["prototype"]["newQuadImageTile"]=function(R7S){var n7S;n7S=null;if(this["quadTileBuffer"]["length"]>0){n7S=this["quadTileBuffer"]["shift"]();}else{n7S=new E7S["QuadImageTile"](R7S,this);n7S["textureCompressed"]=this["mapViewer"]["option"]["quadImageCompressed"];}return n7S;};s7S["prototype"]["removeTopTiles"]=function(){var X7S,T7S;X7S=this["mapViewer"];for(var g7S in this["topTiles"]){X7S["option"]["earth"]["showTopTile"](this["topTiles"][g7S]["getKeyNumber"](),true);this["topTiles"][g7S]["clear"]();delete this["topTiles"][g7S];}this["topTiles"]=[];T7S=X7S["getTerrainScene"]();T7S["children"]["length"]=0;};s7S["prototype"]["requestNotiGroundHeightChanged"]=function(a7S,t7S,O7S){if(a7S){if(a7S["onGroundHeightChanged"]){return;}console["warn"]("onGroundHeightChanged function is not exist.s");}};s7S["prototype"]["resetLayer"]=function(){for(var o7S in this["topTiles"]){this["topTiles"][o7S]["resetOverlayImageLayer"]();}};s7S["prototype"]["redrawVectorImageLayer"]=function(){for(var J7S in this["topTiles"]){this["topTiles"][J7S]["redrawVectorImage"]();}};s7S["prototype"]["removeOverlayImageLayer"]=function(x7S){for(var Z7S in this["topTiles"]){this["topTiles"][Z7S]["removeOverlayImageLayer"](x7S);}};s7S["prototype"]["makeTopTiles"]=function(){var i7S,h7S,K7S,Q7S,B7S,d7S,c7S,f7S,N7S,P7S,H3S,V3S,E3S,y3S,k3S,m3S,L3S,v7S,j7S,u7S,w7S,b7S,e7S,I7S,q7S,S7S;i7S=this["mapViewer"];h7S=i7S["getCamera"]()["getAltitude"]();if(h7S>i7S["option"]["displayDist4Level"][0]){this["removeTopTiles"]();return;}K7S=i7S["getCamera"]()["getPositionGeo"]();Q7S=K7S["y"];B7S=K7S["x"];d7S=E7S["CmMathEngine"]["getRowFromLatitude"](Q7S,i7S["option"]["TileLevelRange"][0]);c7S=E7S["CmMathEngine"]["getColFromLongitude"](B7S,i7S["option"]["TileLevelRange"][0]);f7S=-90+d7S*i7S["option"]["TileLevelRange"][0];N7S=-90+d7S*i7S["option"]["TileLevelRange"][0]+i7S["option"]["TileLevelRange"][0];P7S=-180+c7S*i7S["option"]["TileLevelRange"][0];H3S=-180+c7S*i7S["option"]["TileLevelRange"][0]+i7S["option"]["TileLevelRange"][0];V3S=0.5*(N7S+f7S);E3S=0.5*(P7S+H3S);for(var p7S in this["topTiles"]){this["topTiles"][p7S]["tempData"]=0;}for(var p7S in i7S["option"]["earth"]["earthTileList"]){v7S=i7S["option"]["earth"]["earthTileList"][p7S];h7S=i7S["getCamera"]()["getDistanceToWorldPos"](v7S["origin"]);if(h7S<i7S["option"]["displayDist4Level"][0]){j7S=v7S["row"];u7S=v7S["col"];w7S=v7S["key"];b7S=this["topTiles"][w7S];if(!b7S){e7S=E7S["CmMathEngine"]["getBoundFromRowCol"](0,j7S,u7S);y3S=e7S["North"];k3S=e7S["South"];m3S=e7S["West"];L3S=e7S["East"];I7S=new E7S["QuadinfoStruct"](null);I7S["setState"](0,j7S,u7S,E7S["TilePositionType"]["Top"],null);if(I7S["isInFrustum"]()){q7S=this["topTiles"][w7S];if(!q7S){S7S=this["newQuadImageTile"](null);S7S["position"]=new THREE["Vector3"](I7S["position"]["x"],I7S["position"]["y"],I7S["position"]["z"]);S7S["quadInfo"]["setState"](0,j7S,u7S,E7S["TilePositionType"]["Top"],null);S7S["setKeyNumber"](w7S);S7S["tempData"]=1;this["topTiles"][w7S]=S7S;}}}else{b7S["tempData"]=1;}}}for(var p7S in this["topTiles"]){if(this["topTiles"][p7S]["tempData"]==0){i7S["option"]["earth"]["showTopTile"](this["topTiles"][p7S]["getKeyNumber"](),true);S7S=this["topTiles"][p7S];S7S["clear"]();delete this["topTiles"][p7S];}}};s7S["prototype"]["update"]=function(){var s3S,Y3S;s3S=this["mapViewer"];s3S["option"]["maxDisplayLevel"]=0;s3S["option"]["tileCountDrawn"]=0;this["makeTopTiles"]();for(var l3S in this["topTiles"]){Y3S=this["topTiles"][l3S];if(Y3S!=null){if(Y3S["update"]()==false){s3S["option"]["earth"]["showTopTile"](l3S,true);}Y3S["renderFrameID"]=s3S["option"]["renderFrameID"];}}this["loadManager"]["update"]();};s7S["prototype"]["getGroundHeight"]=function(U3S,G3S){var W3S,r3S,F3S;W3S=0;r3S=null;for(var M3S in this["topTiles"]){F3S=this["topTiles"][M3S];if(F3S!=null){if(F3S["isIncludeCoord"](U3S,G3S)){r3S=F3S;break;}}}if(r3S!=null){W3S=r3S["getGroundHeight"](U3S,G3S);}return W3S;};function s7S(){var l7S;l7S=Y7S["call"](this)||this;l7S["topTiles"]=[];l7S["quadTileBuffer"]=[];l7S["mapInfo"]=null;l7S["loadManager"]=new E7S["QuadImageLoadManager"]();l7S["mapViewer"]=E7S["CmWorld3"]["getInstance"]();return l7S;}s7S["prototype"]["getHighResolutionTile"]=function(A3S,z3S){var R3S,C3S,D3S;R3S=0;C3S=null;for(var n3S in this["topTiles"]){D3S=this["topTiles"][n3S];if(D3S!=null){if(D3S["isIncludeCoord"](A3S,z3S)){C3S=D3S;break;}}}if(C3S!=null){C3S=C3S["getHighResolutionTile"](A3S,z3S);}return C3S;};s7S["prototype"]["findHighestTileInBound"]=function(O3S,o3S,J3S,Z3S){var T3S,a3S,g3S;T3S=[];for(var t3S in this["topTiles"]){a3S=this["topTiles"][t3S];if(E7S["Util"]["isDefined"](a3S)){g3S=a3S["findHighestTile"](O3S,o3S,J3S,Z3S);if(E7S["Util"]["isDefined"](g3S)){for(var X3S=0;X3S<g3S["length"];X3S++){T3S["push"](g3S[X3S]);}}}}return T3S;};s7S["prototype"]["removeOverlayImage"]=function(i3S){for(var x3S in this["topTiles"]){this["topTiles"][x3S]["removeOverlayImage"](i3S);}};s7S["prototype"]["resetOverlayImage"]=function(){for(var p3S in this["topTiles"]){this["topTiles"][p3S]["resetOverlayImage"]();}};s7S["prototype"]["resetVectorImage"]=function(){for(var S3S in this["topTiles"]){this["topTiles"][S3S]["resetVectorImage"]();}};s7S["prototype"]["traverse"]=function(I3S){if(I3S){for(var w3S in this["topTiles"]){this["topTiles"][w3S]["traverse"](I3S);}}};s7S["prototype"]["updateOpacityAll"]=function(e3S){var h3S;h3S=e3S>=1.0?false:true;for(var v3S in this["topTiles"]){this["topTiles"][v3S]["updateOpacityAll"](e3S);}};return s7S;}(E7S["CmLayer"]);E7S["QuadImageLayer"]=y7S;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var j3S;j3S=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(u3S,c3S){u3S["__proto__"]=c3S;}||function(b3S,K3S){for(var d3S in K3S)if(K3S["hasOwnProperty"](d3S))b3S[d3S]=K3S[d3S];};return function(P3S,N3S){j3S(P3S,N3S);P3S["prototype"]=N3S===null?Object["create"](N3S):(B3S["prototype"]=N3S["prototype"],new B3S());function B3S(){this["constructor"]=P3S;}};}();(function(q3S){var Q3S;Q3S=function(H8S){function f3S(m8S){var k8S;k8S=H8S["call"](this)||this;if(m8S){k8S["name"]=m8S;}return k8S;}__extends(f3S,H8S);f3S["prototype"]["getTileURL"]=function(y8S,s8S,r8S){var n8S,z8S,A8S,D8S,E8S,L8S,F8S,G8S,M8S,C8S,U8S,W8S,l8S,Y8S,V8S;n8S=0;z8S=0;A8S=0;D8S=0;if(y8S==-1||s8S==-1||r8S==-1){return"";}E8S=q3S["CmMathEngine"]["getBoundFromRowCol"](y8S,s8S,r8S);L8S=this["getMapInfo"]();if(!L8S)return"";if(y8S>=L8S["MinLevel"]&&y8S<=L8S["MaxLevel"]){if(E8S["East"]<L8S["West"]||E8S["West"]>L8S["East"]||E8S["North"]<L8S["South"]||E8S["South"]>L8S["North"]){return"";}{if(L8S["progressive"]==true){U8S=256;W8S=256;l8S=L8S["East"]-L8S["West"];Y8S=L8S["North"]-L8S["South"];F8S=(E8S["West"]-L8S["West"])*100/l8S;M8S=(E8S["East"]-L8S["West"])*100/l8S;G8S=(L8S["North"]-E8S["North"])*100/Y8S;C8S=(L8S["North"]-E8S["South"])*100/Y8S;V8S=L8S["serverURL"]+"&X1={x1}&X2={x2}&Y1={y1}&Y2={y2}&WIDTH={w}&HEIGHT={h}";V8S=V8S["replace"](/\u007b\u0078\x31\x7d/gi,F8S["toString"]());V8S=V8S["replace"](/\x7b\x78\x32\x7d/gi,M8S["toString"]());V8S=V8S["replace"](/\u007b\x79\u0031\u007d/gi,G8S["toString"]());V8S=V8S["replace"](/\x7b\x79\x32\x7d/gi,C8S["toString"]());V8S=V8S["replace"](/\u007b\u0077\u007d/gi,U8S["toString"]());V8S=V8S["replace"](/\x7b\u0068\u007d/gi,W8S["toString"]());return V8S;}else{V8S=q3S["TiledMapInfo"]["applyIndex"](L8S["serverURL"],y8S,s8S,r8S);return V8S;}}}return"";};return f3S;}(q3S["TileLayer"]);q3S["OverlayImageTileLayer"]=Q3S;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var R8S;R8S=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(g8S,X8S){g8S["__proto__"]=X8S;}||function(t8S,a8S){for(var T8S in a8S)if(a8S["hasOwnProperty"](T8S))t8S[T8S]=a8S[T8S];};return function(o8S,O8S){R8S(o8S,O8S);o8S["prototype"]=O8S===null?Object["create"](O8S):(J8S["prototype"]=O8S["prototype"],new J8S());function J8S(){this["constructor"]=o8S;}};}();(function(Z8S){var x8S;x8S=function(p8S){function i8S(I8S){var S8S;S8S=p8S["call"](this)||this;S8S["mapInfo"]=new Z8S["TiledMapInfo"]();if(I8S){S8S["name"]=I8S;}return S8S;}__extends(i8S,p8S);i8S["prototype"]["getTileURL"]=function(e8S,v8S,h8S){var w8S,j8S;if(e8S<0||v8S<0||h8S<0){return null;}w8S=Z8S["CmMathEngine"]["getBoundFromRowCol"](e8S,v8S,h8S);if(e8S>=this["mapInfo"]["MinLevel"]&&e8S<=this["mapInfo"]["MaxLevel"]&&this["mapInfo"]["visible"]==true){if(w8S["West"]>=this["mapInfo"]["West"]&&w8S["West"]<=this["mapInfo"]["East"]&&(w8S["East"]>=this["mapInfo"]["West"]&&w8S["East"]<=this["mapInfo"]["East"])&&(w8S["South"]>=this["mapInfo"]["South"]&&w8S["South"]<=this["mapInfo"]["North"])&&(w8S["North"]>=this["mapInfo"]["South"]&&w8S["North"]<=this["mapInfo"]["North"])){j8S=Z8S["TiledMapInfo"]["applyIndex"](this["mapInfo"]["serverURL"],e8S,v8S,h8S);return j8S;}else{console["warn"]("Unknown bounded Layer is Inserted.");return null;}}return null;};return i8S;}(Z8S["CmLayer"]);Z8S["QuadTerrainLayer"]=x8S;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var u8S;u8S=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(c8S,d8S){c8S["__proto__"]=d8S;}||function(N8S,b8S){for(var K8S in b8S)if(b8S["hasOwnProperty"](K8S))N8S[K8S]=b8S[K8S];};return function(B8S,P8S){u8S(B8S,P8S);B8S["prototype"]=P8S===null?Object["create"](P8S):(q8S["prototype"]=P8S["prototype"],new q8S());function q8S(){this["constructor"]=B8S;}};}();(function(Q8S){var f8S;f8S=function(k4S){__extends(H4S,k4S);H4S["prototype"]["dispose"]=function(){this["clear"]();};H4S["prototype"]["updateBoundingBox"]=function(){var V4S;V4S=[];for(var E4S in this["poi3dArray"]){V4S["push"](this["poi3dArray"][E4S]["getWorldPos"]());}this["boundingBox"]["setFromPoints"](V4S);};H4S["prototype"]["add"]=function(y4S){if(y4S&&y4S instanceof Q8S["POI3D"]){y4S["parentLayer"]=this;this["poi3dArray"]["push"](y4S);this["boundingBox"]["expandByPoint"](y4S["getWorldPos"]());}};H4S["prototype"]["getPOI"]=function(s4S){if(s4S){if(typeof s4S=="number"){return this["getPOIbyID"](s4S);}else if(typeof s4S=="string"){return this["getPOIbyName"](s4S);}}};H4S["prototype"]["getPOIbyName"]=function(l4S){if(l4S){for(var Y4S=0;Y4S<this["poi3dArray"]["length"];Y4S++){if(l4S==this["poi3dArray"][Y4S]["name"]){return this["poi3dArray"][Y4S];}}}return null;};H4S["prototype"]["getPOIbyID"]=function(F4S){for(var r4S=0;r4S<this["poi3dArray"]["length"];r4S++){if(F4S==this["poi3dArray"][r4S]["id"]){return this["poi3dArray"][r4S];}}return null;};H4S["prototype"]["remove"]=function(W4S){if(W4S&&W4S instanceof Q8S["POI3D"]){if(W4S["id"]){this["removebyID"](W4S["id"]);}else if(W4S["name"]){this["removebyName"](W4S["name"]);}}};H4S["prototype"]["removebyName"]=function(G4S){if(G4S){for(var U4S=0;U4S<this["poi3dArray"]["length"];U4S++){if(G4S==this["poi3dArray"][U4S]["name"]){this["poi3dArray"][U4S]["parentLayer"]=null;this["poi3dArray"]["splice"](U4S,1);this["updateBoundingBox"]();return;}}}};H4S["prototype"]["removebyID"]=function(C4S){for(var M4S=0;M4S<this["poi3dArray"]["length"];M4S++){if(C4S==this["poi3dArray"][M4S]["id"]){this["poi3dArray"][M4S]["parentLayer"]=null;this["poi3dArray"]["splice"](M4S,1);this["updateBoundingBox"]();return;}}};H4S["prototype"]["clear"]=function(){this["poi3dArray"]=[];this["poi3dArray"]["length"]=0;this["boundingBox"]["makeEmpty"]();};H4S["prototype"]["getPOIArray"]=function(){return this["poi3dArray"];};function H4S(L4S){var m4S;m4S=k4S["call"](this)||this;m4S["poi3dArray"]=new Array();m4S["font"]="20px Arial";m4S["fontColor"]="red";m4S["clipBack"]=false;m4S["boundingBox"]=new THREE["Box3"]()["makeEmpty"]();m4S["cmworld3Viewer"]=Q8S["CmWorld3"]["getInstance"]();if(L4S){m4S["name"]=L4S;}return m4S;}H4S["prototype"]["intersect"]=function(z4S,n4S){var D4S;D4S=this["cmworld3Viewer"]["convertCoordinateToPixel"](z4S,n4S);{for(var A4S in this["poi3dArray"]){if(this["poi3dArray"][A4S]["drawnRect"]["includePoint"](D4S["x"],D4S["y"])){return this["poi3dArray"][A4S];}}}return null;};H4S["prototype"]["update"]=function(){for(var R4S in this["poi3dArray"]){if(this["poi3dArray"][R4S]){this["poi3dArray"][R4S]["update"]();}}};H4S["prototype"]["render"]=function(){var X4S;X4S=this["poi3dArray"]["length"];if(X4S<1)return;if(this["boundingBox"]["isEmpty"]()==false){if(this["cmworld3Viewer"]["cameraFrustum"]["intersectsBox"](this["boundingBox"])==false)return;}if(this["clipBack"]){}else{for(var g4S in this["poi3dArray"]){if(this["poi3dArray"][g4S]){this["poi3dArray"][g4S]["render"](0);}}}};return H4S;}(Q8S["CmLayer"]);f8S["drawnRectArray"]=new Array();Q8S["POI3DLayer"]=f8S;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var T4S;T4S=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(a4S,t4S){a4S["__proto__"]=t4S;}||function(J4S,o4S){for(var O4S in o4S)if(o4S["hasOwnProperty"](O4S))J4S[O4S]=o4S[O4S];};return function(x4S,Z4S){T4S(x4S,Z4S);x4S["prototype"]=Z4S===null?Object["create"](Z4S):(i4S["prototype"]=Z4S["prototype"],new i4S());function i4S(){this["constructor"]=x4S;}};}();(function(p4S){var S4S;S4S=function(w4S){__extends(I4S,w4S);I4S["prototype"]["setMapInfo"]=function(h4S){this["mapInfo"]=h4S;};I4S["prototype"]["getMapInfo"]=function(){return this["mapInfo"];};function I4S(v4S){var e4S;e4S=w4S["call"](this)||this;e4S["userObjects"]=new Array();e4S["objectCount"]=0;e4S["mapInfo"]=new p4S["TiledMapInfo"]();e4S["cmworld3Viewer"]=p4S["CmWorld3"]["getInstance"]();if(v4S){e4S["name"]=v4S;}return e4S;}I4S["prototype"]["pickingByScreenCoordinate"]=function(N4S,P4S){var u4S,d4S,K4S,j4S,c4S;if(this["cmworld3Viewer"]["getCamera"]()){u4S=this["cmworld3Viewer"]["convertCoordinateToPixel"](N4S,P4S);d4S=this["cmworld3Viewer"]["getCamera"]();K4S=this["getThreejObj3dArray"]();j4S=d4S["pickingByScreenCoordinateInArray"](u4S["x"],u4S["y"],K4S);for(var b4S in j4S){c4S=j4S[b4S];c4S["userObject"]=c4S["object"]["userObject"];}return j4S;}};I4S["prototype"]["getThreejObj3dArray"]=function(){var B4S;B4S=new Array();for(var q4S in this["userObjects"]){B4S["push"](this["userObjects"][q4S]["getMesh"]());}return B4S;};I4S["prototype"]["add"]=function(Q4S){if(Q4S instanceof p4S["UserObject"]){this["userObjects"][Q4S["id"]]=Q4S;this["objectCount"]++;return true;}return false;};I4S["prototype"]["getObject"]=function(H2S){if(H2S){for(var f4S in this["userObjects"]){if(H2S==this["userObjects"][f4S]["name"]){return this["userObjects"][f4S];}}}};I4S["prototype"]["remove"]=function(k2S){if(k2S instanceof p4S["UserObject"]){if(k2S["id"]){this["removebyID"](k2S["id"]);}else if(k2S["name"]){this["removebyName"](k2S["name"]);}}};I4S["prototype"]["removebyName"]=function(L2S){if(L2S!=null){for(var m2S in this["userObjects"]){if(L2S==this["userObjects"][m2S]["name"]){delete this["userObjects"][m2S];this["objectCount"]--;return;}}}};I4S["prototype"]["removebyID"]=function(V2S){delete this["userObjects"][V2S];this["objectCount"]--;};I4S["prototype"]["clear"]=function(){this["userObjects"]=[];this["userObjects"]["length"]=0;this["objectCount"]=0;};I4S["prototype"]["update"]=function(){for(var E2S in this["userObjects"]){if(this["userObjects"][E2S]){this["userObjects"][E2S]["update"]();}}};I4S["prototype"]["render"]=function(){if(this["visible"]==true){for(var y2S in this["userObjects"]){if(this["userObjects"][y2S]){this["userObjects"][y2S]["render"]();}}}};return I4S;}(p4S["CmLayer"]);p4S["UserObjectLayer"]=S4S;}(CMWORLD||(CMWORLD={})));(function(s2S){var Y2S;Y2S=function(){l2S["requestCubeFile"]=function(W2S,U2S,r2S){var F2S;if(r2S===void 0){r2S=true;}F2S=U2S;if(!s2S["NetWork"]["requestFile"](W2S,function(M2S){var G2S;if(F2S!=null){G2S=M2S["response"];if(G2S!=null&&G2S["byteLength"]<1){G2S=null;}F2S({success:G2S?true:false,arraybuffer:G2S});}},null,r2S)){return false;}};l2S["prototype"]["downloadCubeGroupData"]=function(A2S){var z2S,n2S,C2S,R2S,D2S;z2S=null;n2S=null;C2S=null;R2S=A2S["quadImageTile"];D2S=R2S["quadInfo"];n2S=s2S["CmWorld3"]["getInstance"]();C2S=n2S["getCubeGroupLayer"]('cubeGroup');if(C2S){z2S=C2S["getServerUrl"](D2S["level"],D2S["row"],D2S["col"]);}A2S["bRequestData"]=true;if(!s2S["NetWork"]["requestFile"](z2S,function(g2S){if(g2S["response"]!=null){g2S["tag"]["arrBufData"]=g2S["response"]["slice"](0);g2S["tag"]["bDownloadComplete"]=true;}},A2S)){return false;}return true;};l2S["prototype"]["parseCubeGroupData"]=function(X2S){var O2S,a2S,T2S,t2S,J2S,Z2S,o2S;O2S=null;a2S=null;T2S={};J2S=null;if(!X2S["bDownloadComplete"]){return false;}O2S=s2S["CmWorld3"]["getInstance"]();a2S=O2S["workerManager"]["getCubeGroupWorker"]();J2S=O2S["getCubeGroupLayer"]('cubeGroup');if(a2S){Z2S=X2S["quadImageTile"];o2S=Z2S["quadInfo"];T2S["state"]='start';T2S["arrBufData"]=X2S["arrBufData"];T2S["cmworld3BaseRoot"]=s2S["GlobalOption"]["cmworld3BaseRoot"],T2S["level"]=o2S["level"];T2S["row"]=o2S["row"];T2S["col"]=o2S["col"];a2S["onmessage"]=function(x2S){t2S=x2S["data"];switch(t2S["state"]){case'dataSetComplete':X2S["cubeSize"]=t2S["cubeSize"];X2S["cubeBlockHeight"]=t2S["cubeBlockDepth"];X2S["cubeValueBuffer"]=t2S["cubeValueBuffer"];X2S["cubeValueOutsideBuffers"]=t2S["cubeValueOutsideBuffers"];break;case'finish':a2S["isWorking"]=false;X2S["bLoadCompleteData"]=true;break;}};a2S["postMessage"](T2S);return true;}return false;};function l2S(){}return l2S;}();s2S["CubeGroupLoader"]=Y2S;}(CMWORLD||(CMWORLD={})));(function(i2S){var p2S;p2S=function(){S2S["prototype"]["processDownloadCubeGroupData"]=function(e2S,I2S){var w2S;w2S=I2S["quadImageTile"];if(I2S==null){return false;}if(w2S["quadInfo"]["level"]<0||w2S["quadInfo"]["row"]<0||w2S["quadInfo"]["col"]<0){return false;}this["cubeGroupLoader"]["downloadCubeGroupData"](I2S);this["addLoadingDataCubeGroup"](e2S,I2S);return true;};function S2S(){this["cubeGroupLoader"]=null;this["loadingDataCubeGroup"]=[];this["cubeGroupLoader"]=new i2S["CubeGroupLoader"]();}S2S["prototype"]["update"]=function(){var v2S;for(v2S in this["loadingDataCubeGroup"]){if(this["cubeGroupLoader"]["parseCubeGroupData"](this["loadingDataCubeGroup"][v2S])){delete this["loadingDataCubeGroup"][v2S];}}};S2S["prototype"]["addLoadingDataCubeGroup"]=function(h2S,j2S){this["loadingDataCubeGroup"][h2S]=j2S;};return S2S;}();i2S["CubeGroupLoadManager"]=p2S;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var u2S;u2S=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(c2S,d2S){c2S["__proto__"]=d2S;}||function(N2S,b2S){for(var K2S in b2S)if(b2S["hasOwnProperty"](K2S))N2S[K2S]=b2S[K2S];};return function(B2S,P2S){u2S(B2S,P2S);B2S["prototype"]=P2S===null?Object["create"](P2S):(q2S["prototype"]=P2S["prototype"],new q2S());function q2S(){this["constructor"]=B2S;}};}();(function(Q2S){var f2S;f2S=function(k1S){__extends(H1S,k1S);H1S["prototype"]["setColorHashTable"]=function(V1S){this["colorHashTable"]=V1S;};H1S["prototype"]["getColor"]=function(E1S){if(this["colorHashTable"]["hasOwnProperty"](E1S["toString"]()))return this["colorHashTable"][E1S];return this["colorHashTable"][0];};function H1S(L1S){var m1S;m1S=k1S["call"](this)||this;m1S["cubeGroupLoadManager"]=null;m1S["curVisibleCubeGroup"]=[];m1S["mapInfo"]=null;m1S["cubeGroupImageURL"]=Q2S["GlobalOption"]["texturesURL"]+"whitebox.png";m1S["bInitialize"]=false;m1S["bEnableCubeGroup"]=true;m1S["minAltitude"]=0;m1S["colorHashTable"]=new Array();m1S["uniformParams"]={};m1S["cubeMaterial"]=null;m1S["name"]=L1S;m1S["cubeGroupLoadManager"]=new Q2S["CubeGroupLoadManager"]();return m1S;}H1S["prototype"]["isShowCube"]=function(){return Q2S["CubeGroupLayer"]["showCube"];};H1S["prototype"]["isShowExtraCube"]=function(){return Q2S["CubeGroupLayer"]["showExtraCube"];};H1S["prototype"]["showCube"]=function(y1S){if(y1S===void 0){y1S=true;}Q2S["CubeGroupLayer"]["showCube"]=y1S;};H1S["prototype"]["showExtraCube"]=function(s1S){if(s1S===void 0){s1S=true;}Q2S["CubeGroupLayer"]["showExtraCube"]=s1S;};H1S["prototype"]["initialize"]=function(){var l1S,Y1S,r1S;l1S=Q2S["CmWorld3"]["getInstance"]();{this["colorHashTable"][0]=new THREE["Vector4"](0,0,0,1);this["colorHashTable"][1]=new THREE["Vector4"](1,0,0,0.6);this["colorHashTable"][2]=new THREE["Vector4"](1,0,1,0.6);this["colorHashTable"][3]=new THREE["Vector4"](0,1,1,0.6);this["colorHashTable"][4]=new THREE["Vector4"](0,0,1,0.6);this["colorHashTable"][1000]=new THREE["Vector4"](0,0,0,0.3);this["colorHashTable"][1001]=new THREE["Vector4"](1,1,0,0.3);this["colorHashTable"][1002]=new THREE["Vector4"](1,1,1,0.3);}Y1S=new THREE["TextureLoader"]()["load"](this["cubeGroupImageURL"]);r1S=0.9;this["uniformParams"]={textureMap:{type:'t',value:Y1S},uCubeAlpha:{type:'f',value:H1S["cubeAlpha"]}};this["cubeMaterial"]=new THREE["RawShaderMaterial"]({uniforms:this["uniformParams"],vertexShader:Q2S["ShaderCode"]["cubeVS"],fragmentShader:Q2S["ShaderCode"]["cubeFS"],transparent:true,side:THREE["DoubleSide"],wireframe:false});this["bInitialize"]=true;};H1S["prototype"]["setCubeAlpha"]=function(W1S){var F1S;F1S=this["uniformParams"];F1S["uCubeAlpha"]["value"]=W1S;F1S["uCubeAlpha"]["needsUpdate"]=true;H1S["cubeAlpha"]=W1S;};H1S["prototype"]["refreshInitialize"]=function(){var G1S,U1S;U1S=null;for(G1S in this["curVisibleCubeGroup"]){U1S=this["curVisibleCubeGroup"][G1S];U1S["bRefresh"]=true;U1S["remove"]();}};H1S["prototype"]["setCubeGroupURL"]=function(M1S){this["cubeGroupImageURL"]=M1S;};H1S["getServerUrlEx"]=function(D1S,A1S,z1S,n1S){var C1S;C1S=D1S;C1S=C1S["replace"](/\x7b\u006c\u007d/gi,A1S["toString"]());C1S=C1S["replace"](/\u007b\x78\u007d/gi,n1S["toString"]());C1S=C1S["replace"](/\x7b\u0079\x7d/gi,z1S["toString"]());return C1S;};H1S["prototype"]["getServerUrl"]=function(R1S,g1S,X1S){return H1S["getServerUrlEx"](this["mapInfo"]["serverURL"],R1S,g1S,X1S);};H1S["prototype"]["getCubeTileIndexByCoord"]=function(o1S,J1S,Z1S){var T1S,a1S,t1S,O1S;T1S=this["mapInfo"]["MaxLevel"];a1S=Q2S["CmWorld3"]["getInstance"]();t1S=Q2S["CmMathEngine"]["getRowFromLatitude"](J1S,a1S["option"]["TileLevelRange"][T1S]);O1S=Q2S["CmMathEngine"]["getColFromLongitude"](o1S,a1S["option"]["TileLevelRange"][T1S]);return{level:T1S,row:t1S,col:O1S};};H1S["prototype"]["addCurVisibleTileInfo"]=function(S1S){var I1S,x1S,p1S,i1S;I1S=null;x1S=S1S["quadInfo"];p1S={};i1S=x1S["level"]["toString"]()+'-'+x1S["row"]["toString"]()+'-'+x1S["col"]["toString"]();if(this["curVisibleCubeGroup"][i1S]==undefined||this["curVisibleCubeGroup"]==null){p1S["minAltitude"]=this["minAltitude"];I1S=Q2S["CmWorld3"]["getInstance"]();if(this["mapInfo"]["MinLevel"]<=x1S["level"]&&x1S["level"]<=this["mapInfo"]["MaxLevel"]){this["curVisibleCubeGroup"][i1S]=new Q2S["CubeGroup"](this,S1S,p1S);this["cubeGroupLoadManager"]["processDownloadCubeGroupData"](i1S,this["curVisibleCubeGroup"][i1S]);}}};H1S["prototype"]["enableCubeGroup"]=function(w1S){this["bEnableCubeGroup"]=w1S;};H1S["prototype"]["update"]=function(){var v1S,e1S,h1S,j1S;e1S=null;h1S=Object["keys"](this["curVisibleCubeGroup"])["length"];j1S=Q2S["CmWorld3"]["getInstance"]();if(!this["bInitialize"]){this["initialize"]();}for(v1S in this["curVisibleCubeGroup"]){e1S=this["curVisibleCubeGroup"][v1S];e1S["update"](this["bEnableCubeGroup"]);}this["removeCubeGroup"]();this["cubeGroupLoadManager"]["update"]();};H1S["prototype"]["removeCubeGroup"]=function(){var u1S;for(u1S in this["curVisibleCubeGroup"]){if(this["curVisibleCubeGroup"][u1S]["remove"]()){delete this["curVisibleCubeGroup"][u1S];}}};return H1S;}(Q2S["CmLayer"]);f2S["showCube"]=true;f2S["showExtraCube"]=true;f2S["outSideCubeColorIndex"]=1000;f2S["cubeAlpha"]=0.0;Q2S["CubeGroupLayer"]=f2S;}(CMWORLD||(CMWORLD={})));(function(c1S){var d1S,K1S,b1S,P1S,N1S;(function(B1S){B1S[B1S["WIDTH"]=0]="WIDTH";B1S[B1S["HEIGHT"]=1]="HEIGHT";B1S[B1S["DEPTH"]=2]="DEPTH";}(d1S||(d1S={})));;(function(q1S){q1S[q1S["NW"]=0]="NW";q1S[q1S["NE"]=1]="NE";q1S[q1S["SW"]=2]="SW";q1S[q1S["SE"]=3]="SE";}(K1S||(K1S={})));;(function(Q1S){Q1S[Q1S["EMPTY"]=0]="EMPTY";Q1S[Q1S["BLUE"]=1]="BLUE";Q1S[Q1S["GREEN"]=2]="GREEN";Q1S[Q1S["YELLOW"]=3]="YELLOW";Q1S[Q1S["ORANGE"]=4]="ORANGE";Q1S[Q1S["RED"]=5]="RED";Q1S[Q1S["COUNT"]=5]="COUNT";}(b1S||(b1S={})));;(function(f1S){f1S[f1S["EMPTY"]=0]="EMPTY";f1S[f1S["BUILDING"]=1]="BUILDING";f1S[f1S["TERRAIN"]=2]="TERRAIN";}(P1S||(P1S={})));;N1S=function(){H5S["prototype"]["getBoundaryWidth"]=function(){return Math["abs"](this["boundaryMaxX"]-this["boundaryMinX"]);};H5S["prototype"]["getBoundaryHeight"]=function(){return Math["abs"](this["boundaryMaxY"]-this["boundaryMinY"]);};H5S["prototype"]["getCubeBlockTopHeight"]=function(){return this["baseHeight"]+this["cubeBlockHeight"];};H5S["prototype"]["calCubeHeight"]=function(){return this["cubeBlockHeight"]/this["cubeSize"][d1S["DEPTH"]];};H5S["prototype"]["setCubeData"]=function(V5S){this["cubeValueBuffer"]=V5S;};H5S["prototype"]["setDataInfo"]=function(E5S,y5S,s5S,Y5S,l5S,r5S,F5S){this["cubeSize"]=E5S;this["cubeBlockHeight"]=y5S;this["baseHeight"]=s5S;this["boundaryMinX"]=Y5S;this["boundaryMaxX"]=l5S;this["boundaryMinY"]=r5S;this["boundaryMaxY"]=F5S;};H5S["prototype"]["getCubeIndexbyCoord"]=function(t5S,O5S,A5S){var G5S,M5S,z5S,C5S,n5S,R5S,g5S,X5S,T5S,a5S,D5S,U5S,W5S;G5S=this["getBoundaryWidth"]();if(G5S<0.0000000001){return 0;}M5S=t5S-this["boundaryMinX"];if(M5S<0||M5S>G5S)return 0;z5S=this["getBoundaryHeight"]();C5S=O5S-this["boundaryMinY"];if(C5S<0||C5S>z5S)return 0;n5S=this["getCubeBlockTopHeight"]();if(this["baseHeight"]>A5S||n5S<A5S)return 0;R5S=this["cubeSize"][d1S["WIDTH"]];g5S=this["cubeSize"][d1S["HEIGHT"]];X5S=G5S/R5S;T5S=z5S/g5S;a5S=this["calCubeHeight"]();D5S=C5S/T5S;U5S=M5S/X5S;W5S=(A5S-this["baseHeight"])/a5S;U5S=U5S|0;D5S=D5S|0;W5S=W5S|0;return{x:U5S,y:D5S,z:W5S};};H5S["prototype"]["getValue"]=function(o5S,J5S,Z5S){return this["getCubeValuebyIndex"](o5S,J5S,Z5S);};H5S["prototype"]["getCubeValuebyIndex"]=function(i5S,p5S,S5S){var x5S,I5S,w5S,e5S,v5S,h5S;x5S=this["cubeSize"][d1S["WIDTH"]];I5S=this["cubeSize"][d1S["HEIGHT"]];w5S=this["cubeSize"][d1S["DEPTH"]];if(i5S<0||p5S<0||S5S<0){return 0;}if(i5S>=w5S||p5S>=I5S||S5S>=x5S){return 0;}e5S=i5S*(I5S*x5S);v5S=p5S*x5S;h5S=e5S+v5S+S5S;return this["cubeValueBuffer"][h5S];};H5S["prototype"]["getCubeCenterCoordinatebyIndex"]=function(Q5S,H6S,f5S){var K5S,b5S,N5S,d5S,u5S,c5S,j5S,q5S,B5S,P5S;K5S=this["getBoundaryWidth"]();b5S=this["getBoundaryHeight"]();N5S=this["cubeSize"][d1S["WIDTH"]];d5S=this["cubeSize"][d1S["HEIGHT"]];u5S=this["calCubeHeight"]();c5S=K5S/N5S;j5S=b5S/d5S;q5S=this["baseHeight"]+Q5S*u5S+u5S*0.5;B5S=this["boundaryMinY"]+H6S*j5S+j5S*0.5;P5S=this["boundaryMinX"]+f5S*c5S+c5S*0.5;return{x:P5S,y:B5S,z:q5S};};H5S["prototype"]["dispose"]=function(){var k6S;k6S=c1S["CmWorld3"]["getInstance"]();k6S["requestDispose"](this["cubeInstancedBufferGeometry"]);if(this["cubeMesh"]!=null){k6S["requestDispose"](this["cubeMesh"]);this["cubeMesh"]=null;}for(var m6S in this["extraCubeMesh"]){k6S["requestDispose"](this["cubeMesh"]);}this["extraCubeMesh"]=[];};H5S["prototype"]["initialize"]=function(){var y6S,L6S,V6S,E6S;y6S=c1S["CmWorld3"]["getInstance"]();if(!this["bLoadCompleteData"]){return false;}this["initCubeTemplate"]();this["cubeInstancedBufferGeometry"]=this["makeBufferedCubeGeometry"](this["cubeTemplate"]["vertices"],this["cubeTemplate"]["indices"],this["cubeTemplate"]["texCoords"]);this["setCubeDataAttribs"](this["cubeInstancedBufferGeometry"],this["cubeValueBuffer"]);this["cubeMesh"]=this["makeCubeMesh"](this["cubeInstancedBufferGeometry"]);L6S=null;if(this["cubeValueOutsideBuffers"]!=null){V6S=this["makeBufferedCubeGeometry"](this["cubeTemplate"]["vertices"],this["cubeTemplate"]["indices"],this["cubeTemplate"]["texCoords"]);this["setCubeDataAttribs"](V6S,this["cubeValueOutsideBuffers"],c1S["CubeGroupLayer"]["outSideCubeColorIndex"]);L6S=this["makeCubeMesh"](V6S);if(L6S!=null){this["extraCubeMesh"]["push"](L6S);}}E6S=y6S["getGroundScene"]();E6S["add"](this["cubeMesh"]);if(L6S!=null){E6S["add"](L6S);}this["bInitialize"]=true;return true;};H5S["prototype"]["checkRemove"]=function(){var s6S;s6S=this["quadImageTile"]["quadInfo"];if(s6S["level"]==-1&&s6S["row"]==-1&&s6S["col"]==-1){return true;}return false;};H5S["prototype"]["remove"]=function(){var Y6S,l6S;if(!this["cubeMesh"]){return false;}Y6S=null;l6S=null;if(this["checkRemove"]()||this["bRefresh"]){Y6S=c1S["CmWorld3"]["getInstance"]();l6S=Y6S["getTerrainScene"]();l6S["remove"](this["cubeMesh"]);this["showCube"](false);this["cubeMesh"]["material"]["dispose"]();this["cubeMesh"]["geometry"]["dispose"]();this["cubeMesh"]=null;this["bInitialize"]=false;this["bRefresh"]=false;return true;}return false;};function H5S(L5S,k5S,m5S){this["quadImageTile"]=null;this["quadTileMesh"]=null;this["parentLayer"]=null;this["cubeTemplate"]={};this["bRefresh"]=false;this["bInitialize"]=false;this["bRequestData"]=false;this["bDownloadComplete"]=false;this["bLoadCompleteData"]=false;this["cubeBlockHeight"]=100;this["arrBufData"]=null;this["cubeValueBuffer"]=null;this["cubeValueOutsideBuffers"]=null;this["cubeSize"]=[10,10,10];this["uniformParams"]={};this["cubeInstancedBufferGeometry"]=null;this["cubeMesh"]=null;this["extraCubeMesh"]=[];this["baseHeight"]=0;this["boundaryMinX"]=0;this["boundaryMaxX"]=0;this["boundaryMinY"]=0;this["boundaryMaxY"]=0;this["parentLayer"]=L5S;if(k5S!=null){this["quadImageTile"]=k5S;this["quadTileMesh"]=[k5S["NWmesh"],k5S["NEmesh"],k5S["SWmesh"],k5S["SEmesh"]];}if(m5S!=null){this["minAltitude"]=m5S["minAltitude"];}}H5S["prototype"]["showCube"]=function(r6S){if(r6S===void 0){r6S=true;}if(this["cubeMesh"]!=null){this["cubeMesh"]["visible"]=r6S;}this["showExtraCube"](r6S);};H5S["prototype"]["showExtraCube"]=function(F6S){if(F6S===void 0){F6S=true;}for(var W6S in this["extraCubeMesh"]){this["extraCubeMesh"][W6S]["visible"]=F6S;}};H5S["prototype"]["update"]=function(C6S){var U6S,M6S,G6S;U6S=null;M6S=this["quadImageTile"]["quadInfo"];G6S=new THREE["Vector3"]();U6S=c1S["CmWorld3"]["getInstance"]();if(!this["bInitialize"]){if(!this["initialize"]()){return;}}if(!c1S["CubeGroupLayer"]["showCube"]){this["showCube"](c1S["CubeGroupLayer"]["showCube"]);return;}else{this["showCube"](c1S["CubeGroupLayer"]["showCube"]);}this["showExtraCube"](c1S["CubeGroupLayer"]["showExtraCube"]);U6S=c1S["CmWorld3"]["getInstance"]();if(this["quadTileMesh"][K1S["NW"]]["visible"]&&this["quadTileMesh"][K1S["NE"]]["visible"]&&this["quadTileMesh"][K1S["SW"]]["visible"]&&this["quadTileMesh"][K1S["SE"]]["visible"]){G6S["x"]=-U6S["option"]["refCenter"]["x"];G6S["y"]=-U6S["option"]["refCenter"]["y"];G6S["z"]=-U6S["option"]["refCenter"]["z"];this["setCubeMeshPosition"](G6S);}else{if(M6S["level"]===this["parentLayer"]["mapInfo"]["MaxLevel"]){this["showCube"](true);G6S["x"]=-U6S["option"]["refCenter"]["x"];G6S["y"]=-U6S["option"]["refCenter"]["y"];G6S["z"]=-U6S["option"]["refCenter"]["z"];this["setCubeMeshPosition"](G6S);}else{this["showCube"](false);}}};H5S["prototype"]["setCubeMeshPosition"]=function(D6S){if(this["cubeMesh"]!=null){this["cubeMesh"]["position"]["copy"](D6S);}for(var A6S in this["extraCubeMesh"]){this["extraCubeMesh"][A6S]["position"]["copy"](D6S);}};H5S["prototype"]["initCubeTemplate"]=function(){var z6S,n6S;z6S=1;n6S=1;this["cubeTemplate"]["vertices"]=new Float32Array([-z6S,n6S,1,z6S,n6S,1,z6S,n6S,-1,-z6S,n6S,-1,z6S,-n6S,1,-z6S,-n6S,1,-z6S,-n6S,-1,z6S,-n6S,-1,-z6S,-n6S,-1,-z6S,-n6S,1,-z6S,n6S,1,-z6S,n6S,-1,z6S,-n6S,1,z6S,-n6S,-1,z6S,n6S,-1,z6S,n6S,1,-z6S,-n6S,1,z6S,-n6S,1,z6S,n6S,1,-z6S,n6S,1,-z6S,n6S,-1,z6S,n6S,-1,z6S,-n6S,-1,-z6S,-n6S,-1]);this["cubeTemplate"]["indices"]=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);this["cubeTemplate"]["texCoords"]=new Float32Array([0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]);};H5S["prototype"]["makeBufferedCubeGeometry"]=function(g6S,o6S,J6S){var R6S,O6S,T6S,a6S,X6S,t6S;T6S=null;a6S=null;O6S=g6S["length"]/3;X6S=new THREE["InstancedBufferGeometry"]();t6S=new THREE["BufferAttribute"](g6S,3);for(R6S=0;R6S<O6S;++R6S){t6S["setXYZ"](R6S,g6S[3*R6S+0],g6S[3*R6S+1],g6S[3*R6S+2]);}X6S["addAttribute"]('position',t6S);T6S=new THREE["BufferAttribute"](o6S,1);X6S["setIndex"](T6S);a6S=new THREE["BufferAttribute"](J6S,2);X6S["addAttribute"]('texCoord',a6S);return X6S;};H5S["readData"]=function(v6S){var Z6S,j6S,p6S,e6S,w6S,i6S,h6S,I6S,S6S;Z6S=new c1S["BinaryReader"](v6S,true);j6S=Z6S["readBytes"](1);p6S=Z6S["readBytes"](3);e6S=Z6S["readSingle"]();w6S=Z6S["readUInt32"]();i6S=Z6S["readUInt32"]();h6S=p6S[0]*p6S[1]*p6S[2];I6S=new Uint8Array(i6S);Z6S["seek"](w6S);for(var x6S=0;x6S<i6S;++x6S){I6S[x6S]=Z6S["readUInt8"]();}i6S=0;S6S=null;try{i6S=Z6S["readUInt32"]();if(i6S>0){S6S=new Uint8Array(i6S);for(x6S=0;x6S<i6S;++x6S){S6S[x6S]=Z6S["readUInt8"]();}}}catch(u6S){console["error"](u6S);}finally{if(Z6S!=null){Z6S["dispose"]();}}return{cubeSize:p6S,cubeBlockHeight:e6S,droneGilTypeDataStartPoint:w6S,cubeValueBuffer:I6S,cubeValueOutsideBuffers:S6S};};H5S["prototype"]["isVisibleData"]=function(c6S){if(c6S!=b1S["EMPTY"]){if(c6S<H5S["limitedValue"]){return true;}}return false;};H5S["prototype"]["setCubeDataAttribs"]=function(C9S,r9S,X9S){var d6S,P6S,B6S,k9S,p9S,I9S,K6S,b6S,N6S,l9S,Y9S,y9S,T9S,o9S,a9S,t9S,O9S,J9S,i9S,L9S,z9S,g9S,W9S,U9S,G9S,F9S,f6S,M9S,D9S,A9S,H9S,n9S,R9S,m9S,S9S,Z9S,E9S,x9S,q6S,Q6S,s9S,V9S;if(X9S===void 0){X9S=0;}if(r9S==null){return;}d6S=this["quadImageTile"]["quadInfo"];L9S=new THREE["Vector3"]();z9S=new THREE["Vector3"]();g9S=new THREE["Vector3"]();W9S=new THREE["Vector3"]();U9S=new THREE["Vector3"]();G9S=new THREE["Vector3"]();F9S=new THREE["Vector3"]();f6S=new THREE["Vector3"]();H9S=0,n9S=0,R9S=0;Z9S=c1S["CmWorld3"]["getInstance"]();P6S=this["cubeSize"][d1S["WIDTH"]];B6S=this["cubeSize"][d1S["HEIGHT"]];k9S=this["cubeSize"][d1S["DEPTH"]];E9S=P6S*B6S*k9S;x9S=b1S["EMPTY"];l9S=(d6S["east"]-d6S["west"])/P6S;Y9S=(d6S["north"]-d6S["south"])/B6S;y9S=this["cubeBlockHeight"]/k9S;z9S=c1S["CmMathEngine"]["Geo2Cartesian"](d6S["west"],d6S["south"],c1S["cm_const"]["EarthRadius"]+this["minAltitude"]);g9S=c1S["CmMathEngine"]["Geo2Cartesian"](d6S["west"]+1.0*l9S,d6S["south"],c1S["cm_const"]["EarthRadius"]+this["minAltitude"]);W9S=c1S["CmMathEngine"]["Geo2Cartesian"](d6S["west"],d6S["south"],c1S["cm_const"]["EarthRadius"]+this["minAltitude"]);U9S=c1S["CmMathEngine"]["Geo2Cartesian"](d6S["west"],d6S["south"]+1.0*Y9S,c1S["cm_const"]["EarthRadius"]+this["minAltitude"]);G9S=c1S["CmMathEngine"]["Geo2Cartesian"](d6S["west"],d6S["south"],c1S["cm_const"]["EarthRadius"]+this["minAltitude"]);F9S=c1S["CmMathEngine"]["Geo2Cartesian"](d6S["west"],d6S["south"],c1S["cm_const"]["EarthRadius"]+this["minAltitude"]+1.0*y9S);T9S=(d6S["west"]+d6S["east"])/2;o9S=(d6S["south"]+d6S["north"])/2;a9S=Math["cos"](-(180-T9S)*c1S["CmMathEngine"]["Deg2Rad"]);t9S=Math["cos"](-o9S*c1S["CmMathEngine"]["Deg2Rad"]);O9S=g9S["x"]-z9S["x"];J9S=U9S["y"]-W9S["y"];i9S=F9S["z"]-G9S["z"];f6S["x"]=O9S/a9S;f6S["y"]=J9S/t9S;f6S["z"]=y9S;H9S=0;{for(N6S=0;N6S<k9S;++N6S){q6S=N6S*B6S*P6S;for(K6S=0;K6S<B6S;++K6S){Q6S=K6S*P6S;for(b6S=0;b6S<P6S;++b6S){m9S=q6S+Q6S+b6S;if(this["isVisibleData"](r9S[m9S])){++H9S;}}}}}E9S=H9S;M9S=new THREE["InstancedBufferAttribute"](new Float32Array(E9S*3),3,1);{H9S=0;for(N6S=0;N6S<k9S;++N6S){q6S=N6S*B6S*P6S;for(K6S=0;K6S<B6S;++K6S){Q6S=K6S*P6S;for(b6S=0;b6S<P6S;++b6S){m9S=q6S+Q6S+b6S;if(this["isVisibleData"](r9S[m9S])){L9S=c1S["CmMathEngine"]["Geo2Cartesian"](d6S["west"]+b6S*l9S+0.5*l9S,d6S["south"]+K6S*Y9S+0.5*Y9S,c1S["cm_const"]["EarthRadius"]+this["minAltitude"]+N6S*y9S+0.5*y9S);M9S["setXYZ"](H9S,L9S["x"],L9S["y"],L9S["z"]);++H9S;}}}}}C9S["addAttribute"]('offset',M9S);A9S=new THREE["InstancedBufferAttribute"](new Float32Array(E9S*3),3,1);D9S=new THREE["InstancedBufferAttribute"](new Float32Array(E9S*4),4,1);for(N6S=0;N6S<k9S;++N6S){q6S=N6S*B6S*P6S;for(K6S=0;K6S<B6S;++K6S){Q6S=K6S*P6S;for(b6S=0;b6S<P6S;++b6S){m9S=q6S+Q6S+b6S;s9S=r9S[m9S];A9S["setXYZ"](n9S,f6S["x"]/2,f6S["y"]/2,f6S["z"]/2);++n9S;switch(s9S){case b1S["EMPTY"]:break;default:if(s9S<H5S["limitedValue"]){V9S=this["parentLayer"]["getColor"](s9S+X9S);D9S["setXYZW"](R9S,V9S["x"],V9S["y"],V9S["z"],V9S["w"]);++R9S;}break;}}}}C9S["addAttribute"]('size',A9S);C9S["addAttribute"]('userValueTypeColor',D9S);};H5S["prototype"]["makeCubeMesh"]=function(b9S){var v9S,h9S,d9S,c9S,j9S,u9S,K9S,w9S,e9S;if(b9S==null)return null;v9S=this["quadImageTile"]["quadInfo"];h9S=null;j9S=new THREE["Quaternion"]();u9S=new THREE["Quaternion"]();w9S=new THREE["Vector3"]();e9S=new THREE["Mesh"](b9S,this["parentLayer"]["cubeMaterial"]);e9S["frustumCulled"]=false;d9S=(v9S["west"]+v9S["east"])/2;c9S=(v9S["south"]+v9S["north"])/2;j9S=new THREE["Quaternion"]();u9S=new THREE["Quaternion"]();j9S["setFromAxisAngle"](c1S["CmCameraGlobe"]["getXAxis"](),-c9S*c1S["CmMathEngine"]["Deg2Rad"]);u9S["setFromAxisAngle"](c1S["CmCameraGlobe"]["getYAxis"](),-(180-d9S)*c1S["CmMathEngine"]["Deg2Rad"]);K9S=THREE["Quaternion"]["prototype"]["multiplyQuaternions"](u9S,j9S);w9S=new THREE["Vector3"]();h9S=c1S["CmWorld3"]["getInstance"]();w9S["x"]=-h9S["option"]["refCenter"]["x"];w9S["y"]=-h9S["option"]["refCenter"]["y"];w9S["z"]=-h9S["option"]["refCenter"]["z"];e9S["quaternion"]["copy"](K9S);e9S["position"]["copy"](w9S);return e9S;};return H5S;}();N1S["limitedValue"]=230;c1S["CubeGroup"]=N1S;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var N9S;N9S=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(P9S,B9S){P9S["__proto__"]=B9S;}||function(f9S,Q9S){for(var q9S in Q9S)if(Q9S["hasOwnProperty"](q9S))f9S[q9S]=Q9S[q9S];};return function(k0S,H0S){N9S(k0S,H0S);k0S["prototype"]=H0S===null?Object["create"](H0S):(m0S["prototype"]=H0S["prototype"],new m0S());function m0S(){this["constructor"]=k0S;}};}();(function(L0S){var V0S;V0S=function(y0S){__extends(E0S,y0S);E0S["prototype"]["initialize"]=function(){this["cmworld"]=L0S["CmWorld3"]["getInstance"]();this["bInitialize"]=true;};E0S["prototype"]["update"]=function(){};E0S["prototype"]["render"]=function(){};function E0S(Y0S){var s0S;s0S=y0S["call"](this)||this;s0S["bInitialize"]=false;s0S["mapInfo"]=null;s0S["name"]=Y0S;return s0S;}return E0S;}(L0S["CmLayer"]);L0S["Cube3DGroupLayer"]=V0S;}(CMWORLD||(CMWORLD={})));(function(l0S){var r0S;r0S=function(){F0S["getRowFromLatitude"]=function(W0S,U0S){return Math["floor"]((W0S+90.0000001)/U0S);};F0S["getColFromLongitude"]=function(G0S,M0S){return Math["floor"]((G0S+180.0000001)/M0S);};F0S["getFloorFromAltitude"]=function(C0S,D0S){return Math["floor"](C0S/D0S);};function F0S(){}F0S["getBoundFromRowColFloor"]=function(R0S,g0S,X0S,a0S,t0S){var T0S,z0S,n0S,A0S;T0S=l0S["CmWorld3"]["getInstance"]();z0S=T0S["option"]["TileLevelRange"][R0S];n0S=t0S/Math["pow"](2.0,R0S);A0S=new l0S["Cube3DCoordBound"]();A0S["West"]=-180+X0S*z0S;A0S["East"]=-180+(X0S+1)*z0S;A0S["South"]=-90+g0S*z0S;A0S["North"]=-90+(g0S+1)*z0S;A0S["BottomHeight"]=a0S*n0S+l0S["cm_const"]["EarthRadius"];A0S["TopHeight"]=A0S["BottomHeight"]+n0S;return A0S;};F0S["getBoundFromRowColFloor2"]=function(v0S,i0S,Z0S,e0S,O0S,J0S){var S0S,I0S,w0S,p0S,o0S,x0S;S0S=-180+Z0S*O0S;I0S=-180+(Z0S+1)*O0S;w0S=-90+i0S*O0S;p0S=-90+(i0S+1)*O0S;o0S=e0S*J0S+l0S["cm_const"]["EarthRadius"];x0S=o0S+J0S;return{west:S0S,east:I0S,south:w0S,north:p0S,bottomHeight:o0S,topHeight:x0S};};return F0S;}();r0S["PI"]=l0S["cm_const"]["PI"];r0S["Rad2Deg"]=l0S["cm_const"]["Rad2Deg"];r0S["Deg2Rad"]=l0S["cm_const"]["Deg2Rad"];r0S["Tan30"]=l0S["cm_const"]["Tan30"];r0S["Tan60"]=l0S["cm_const"]["Tan60"];r0S["Vector3Zero"]=new THREE["Vector3"](0,0,0);r0S["m_MeterPerSec"]=2*l0S["cm_const"]["PI"]*l0S["cm_const"]["EarthRadius"]/360.0;l0S["Cube3DMath"]=r0S;}(CMWORLD||(CMWORLD={})));(function(h0S){var j0S;j0S=function(){u0S["prototype"]["set"]=function(c0S,d0S,K0S,b0S,N0S,P0S){this["West"]=c0S;this["East"]=d0S;this["South"]=K0S;this["North"]=b0S;this["BottomHeight"]=N0S;this["TopHeight"]=P0S;};u0S["prototype"]["getCenter"]=function(){return new THREE["Vector3"]((this["West"]+this["East"])*0.5,(this["South"]+this["North"])*0.5,(this["BottomHeight"]+this["TopHeight"])*0.5);};u0S["prototype"]["isIntersect"]=function(B0S){if(h0S["Util"]["isDefined"](B0S)){if(this["West"]>B0S["East"])return false;if(this["East"]<B0S["West"])return false;if(this["South"]>B0S["North"])return false;if(this["North"]<B0S["South"])return false;if(this["BottomHeight"]>B0S["TopHeight"])return false;if(this["TopHeight"]<B0S["BottomHeight"])return false;return true;}return false;};function u0S(){this["West"]=180;this["East"]=-180;this["South"]=90;this["North"]=-90;this["BottomHeight"]=0;this["TopHeight"]=0;}return u0S;}();h0S["Cube3DCoordBound"]=j0S;}(CMWORLD||(CMWORLD={})));(function(q0S){var Q0S;Q0S=function(){f0S["prototype"]["clear"]=function(){this["level"]=-1;this["row"]=-1;this["col"]=-1;this["floor"]=0;this["cubePosition"]=q0S["Cube3DPositionType"]["None"];this["ownerCube3D"]=null;};f0S["prototype"]["setState"]=function(V7b,E7b,y7b,s7b,Y7b,l7b){var k7b,m7b,L7b;this["level"]=V7b;this["row"]=E7b;this["col"]=y7b;this["floor"]=s7b;this["cubePosition"]=Y7b;k7b=q0S["Cube3DMath"]["getBoundFromRowColFloor"](this["level"],this["row"],this["col"],this["floor"],this["parentLayer"]["mapInfo"]["level0Height"]);this["north"]=k7b["North"];this["south"]=k7b["South"];this["east"]=k7b["East"];this["west"]=k7b["West"];this["bottomHeight"]=k7b["BottomHeight"];this["topHeight"]=k7b["TopHeight"];this["ownerCube3D"]=l7b;m7b=q0S["CmWorld3"]["getInstance"]();this["NWTECEFPos"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["West"],k7b["North"],k7b["TopHeight"]);this["NWBECEFPos"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["West"],k7b["North"],k7b["BottomHeight"]);this["NETECEFPos"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["East"],k7b["North"],k7b["TopHeight"]);this["NEBECEFPos"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["East"],k7b["North"],k7b["BottomHeight"]);this["SWTECEFPos"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["West"],k7b["South"],k7b["TopHeight"]);this["SWBECEFPos"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["West"],k7b["South"],k7b["BottomHeight"]);this["SETECEFPos"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["East"],k7b["South"],k7b["TopHeight"]);this["SEBECEFPos"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["East"],k7b["South"],k7b["BottomHeight"]);this["centerposition"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["West"]+m7b["option"]["TileLevelRange"][this["level"]]*0.5,k7b["South"]+m7b["option"]["TileLevelRange"][this["level"]]*0.5,(this["bottomHeight"]+this["topHeight"])*0.5);this["position"]=q0S["CmMathEngine"]["Geo2Cartesian"](k7b["West"],k7b["South"],this["bottomHeight"]);L7b=this["centerposition"]["distanceTo"](this["SEBECEFPos"]);this["boundingSphereECEF"]=new THREE["Sphere"](this["centerposition"],L7b);};f0S["prototype"]["isInclude"]=function(r7b,F7b,W7b){if(this["west"]>r7b)return false;if(this["east"]<r7b)return false;if(this["north"]<F7b)return false;if(this["south"]>F7b)return false;if(this["bottomHeight"]>W7b)return false;if(this["topHeight"]<W7b)return false;return true;};f0S["prototype"]["isIntersect"]=function(U7b,G7b,M7b,C7b,D7b,A7b){if(this["west"]>G7b)return false;if(this["east"]<U7b)return false;if(this["north"]<M7b)return false;if(this["south"]>C7b)return false;if(this["bottomHeight"]>A7b)return false;if(this["topHeight"]<D7b)return false;return true;};f0S["prototype"]["getClosestDistanceFromCamera"]=function(g7b){var n7b,R7b,z7b,X7b;if(g7b===void 0){g7b=true;}n7b=Number["POSITIVE_INFINITY"];R7b=q0S["CmWorld3"]["getInstance"]();z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["centerposition"]);if(z7b<n7b){n7b=z7b;}if(g7b==undefined)g7b=true;if(g7b){X7b=this["NWTECEFPos"]["distanceTo"](this["SEBECEFPos"])*0.5;n7b-=X7b;}else{z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["NWTECEFPos"]);if(z7b<n7b){n7b=z7b;}z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["NWBECEFPos"]);if(z7b<n7b){n7b=z7b;}z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["NETECEFPos"]);if(z7b<n7b){n7b=z7b;}z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["NEBECEFPos"]);if(z7b<n7b){n7b=z7b;}z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["SWTECEFPos"]);if(z7b<n7b){n7b=z7b;}z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["SWBECEFPos"]);if(z7b<n7b){n7b=z7b;}z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["SETECEFPos"]);if(z7b<n7b){n7b=z7b;}z7b=R7b["getCamera"]()["getDistanceToWorldPos"](this["SEBECEFPos"]);if(z7b<n7b){n7b=z7b;}}return n7b;};f0S["prototype"]["isInViewDistance"]=function(t7b){var T7b,a7b;T7b=q0S["CmWorld3"]["getInstance"]();a7b=this["boundingSphereECEF"]["clone"]();a7b["center"]["sub"](T7b["option"]["refCenter"]);if(T7b["cameraFrustum"]["intersectsSphere"](a7b)){return true;}return false;};function f0S(H7b){this["level"]=-1;this["row"]=-1;this["col"]=-1;this["floor"]=0;this["north"]=-90;this["south"]=90;this["east"]=-180;this["west"]=180;this["bottomHeight"]=0;this["topHeight"]=0;this["cubePosition"]=q0S["Cube3DPositionType"]["None"];this["position"]=new THREE["Vector3"]();this["centerposition"]=new THREE["Vector3"]();this["ownerCube3D"]=null;this["parentLayer"]=H7b;}f0S["prototype"]["isInFrustum"]=function(){var O7b,o7b;O7b=q0S["CmWorld3"]["getInstance"]();if(this["level"]<0||this["level"]>=O7b["option"]["displayDist4Level"]["length"]){return false;}o7b=false;if(this["isInViewDistance"](O7b["option"]["displayDist4Level"][this["level"]])){o7b=true;}return o7b;};return f0S;}();q0S["Cube3DInfoStruct"]=Q0S;}(CMWORLD||(CMWORLD={})));(function(J7b){var Z7b;Z7b=function(){x7b["prototype"]["dispose"]=function(){};function x7b(i7b,p7b,S7b,I7b,w7b){this["newCubeAdded"]=false;this["cubes"]=[];this["visible"]=true;this["parentLayer"]=S7b;this["key"]=i7b;this["targetObject"]=p7b;this["targetLevel"]=I7b;this["boundaryRadius"]=w7b;}x7b["prototype"]["getCubeIndexFromPositionRadius"]=function(f7b,y3b,E3b,V3b,v7b){var k3b,e7b,h7b,j7b,Q7b,K7b,P7b,B7b,q7b,N7b,d7b,c7b,u7b,L3b,H3b,m3b;k3b=J7b["CmWorld3"]["getInstance"]();e7b=J7b["CmMathEngine"]["Geo2Cartesian"](y3b,E3b,V3b);j7b=[];h7b=J7b["CmMathEngine"]["Cartesian2Geo"](e7b["x"]-v7b,e7b["y"]-v7b,e7b["z"]-v7b);j7b["push"](h7b);h7b=J7b["CmMathEngine"]["Cartesian2Geo"](e7b["x"]+v7b,e7b["y"]-v7b,e7b["z"]-v7b);j7b["push"](h7b);h7b=J7b["CmMathEngine"]["Cartesian2Geo"](e7b["x"]+v7b,e7b["y"]-v7b,e7b["z"]+v7b);j7b["push"](h7b);h7b=J7b["CmMathEngine"]["Cartesian2Geo"](e7b["x"]-v7b,e7b["y"]-v7b,e7b["z"]+v7b);j7b["push"](h7b);h7b=J7b["CmMathEngine"]["Cartesian2Geo"](e7b["x"]-v7b,e7b["y"]+v7b,e7b["z"]-v7b);j7b["push"](h7b);h7b=J7b["CmMathEngine"]["Cartesian2Geo"](e7b["x"]+v7b,e7b["y"]+v7b,e7b["z"]-v7b);j7b["push"](h7b);h7b=J7b["CmMathEngine"]["Cartesian2Geo"](e7b["x"]+v7b,e7b["y"]+v7b,e7b["z"]+v7b);j7b["push"](h7b);h7b=J7b["CmMathEngine"]["Cartesian2Geo"](e7b["x"]-v7b,e7b["y"]+v7b,e7b["z"]+v7b);j7b["push"](h7b);Q7b=Number["MAX_VALUE"];K7b=-Number["MAX_VALUE"];P7b=Number["MAX_VALUE"];B7b=-Number["MAX_VALUE"];q7b=Number["MAX_VALUE"];N7b=-Number["MAX_VALUE"];L3b=this["parentLayer"]["mapInfo"]["level0Height"]/Math["pow"](2.0,f7b);for(var b7b in j7b){d7b=J7b["Cube3DMath"]["getRowFromLatitude"](j7b[b7b]["y"],k3b["option"]["TileLevelRange"][f7b]);c7b=J7b["Cube3DMath"]["getColFromLongitude"](j7b[b7b]["x"],k3b["option"]["TileLevelRange"][f7b]);u7b=J7b["Cube3DMath"]["getFloorFromAltitude"](j7b[b7b]["z"]-J7b["cm_const"]["EarthRadius"],L3b);if(d7b<Q7b)Q7b=d7b;if(d7b>K7b)K7b=d7b;if(c7b<P7b)P7b=c7b;if(c7b>B7b)B7b=c7b;if(u7b<q7b)q7b=u7b;if(u7b>N7b)N7b=u7b;}H3b=[];for(u7b=q7b;u7b<=N7b;u7b++){for(d7b=Q7b;d7b<=K7b;d7b++){for(c7b=P7b;c7b<=B7b;c7b++){m3b=u7b["toString"]()+":"+d7b["toString"]()+","+c7b["toString"]();H3b[m3b]={floor:u7b,row:d7b,col:c7b};}}}return H3b;};x7b["prototype"]["reset"]=function(){this["parentLayer"]["resetCubeBuffer"]();this["cubes"]=[];};x7b["prototype"]["update"]=function(){var M3b,F3b,T3b,U3b,W3b,A3b,z3b,n3b,G3b,s3b,O3b,t3b,a3b,g3b,X3b,D3b,C3b,r3b,R3b;M3b=J7b["CmWorld3"]["getInstance"]();F3b=null;if(this["targetObject"]instanceof THREE["Camera"]){T3b=M3b["getCamera"]();F3b=M3b["option"]["mainCamera"]["getPositionGeo"]();}if(this["targetObject"]instanceof J7b["UserObject"]){U3b=this["targetObject"];U3b["calcWorldPosition"]();F3b=U3b["getPosition"]()["clone"]();F3b["z"]+=J7b["cm_const"]["EarthRadius"];}if(F3b){this["newCubeAdded"]=false;for(var l3b in this["cubes"]){this["cubes"][l3b]["tempData"]=0;}W3b=F3b;A3b=W3b["y"];z3b=W3b["x"];n3b=W3b["z"];G3b=this["parentLayer"]["mapInfo"]["level0Height"]/Math["pow"](2.0,this["targetLevel"]);s3b=this["getCubeIndexFromPositionRadius"](this["targetLevel"],z3b,A3b,n3b,this["boundaryRadius"]);g3b=J7b["Cube3DMath"]["getFloorFromAltitude"](this["parentLayer"]["mapInfo"]["MinFloorHeight"],G3b);X3b=J7b["Cube3DMath"]["getFloorFromAltitude"](this["parentLayer"]["mapInfo"]["MaxFloorHeight"],G3b);if(s3b){for(var Y3b in s3b){if(s3b[Y3b]["floor"]>=g3b&&s3b[Y3b]["floor"]<=X3b){D3b=J7b["Cube3D"]["getKeyString"](this["targetLevel"],s3b[Y3b]["row"],s3b[Y3b]["col"],s3b[Y3b]["floor"]);C3b=this["cubes"][D3b];if(!C3b){r3b=this["parentLayer"]["getCube3D"](this["targetLevel"],s3b[Y3b]["row"],s3b[Y3b]["col"],s3b[Y3b]["floor"]);if(r3b){if(this["cubeFrameColor"])r3b["cubeFrameColor"]=this["cubeFrameColor"];r3b["targetUsed"]=true;r3b["tempData"]=1;this["cubes"][D3b]=r3b;this["newCubeAdded"]=true;}}else{C3b["tempData"]=1;}}}}for(var l3b in this["cubes"]){if(this["cubes"][l3b]["tempData"]==0){R3b=this["cubes"][l3b];R3b["clear"]();delete this["cubes"][l3b];this["newCubeAdded"]=true;}}}};x7b["prototype"]["render"]=function(){if(this["visible"]==false)return;for(var o3b in this["cubes"]){if(this["cubes"][o3b]["aleadyRender"]==false){this["cubes"][o3b]["aleadyRender"]=true;this["cubes"][o3b]["update"]();}}};return x7b;}();J7b["Cube3DTarget"]=Z7b;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var J3b;J3b=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(Z3b,x3b){Z3b["__proto__"]=x3b;}||function(S3b,p3b){for(var i3b in p3b)if(p3b["hasOwnProperty"](i3b))S3b[i3b]=p3b[i3b];};return function(w3b,I3b){function e3b(){this["constructor"]=w3b;}J3b(w3b,I3b);w3b["prototype"]=I3b===null?Object["create"](I3b):(e3b["prototype"]=I3b["prototype"],new e3b());};}();(function(v3b){var j3b,h3b;j3b=function(){function u3b(){}return u3b;}();h3b=function(d3b){function c3b(b3b,N3b,P3b,B3b,q3b){var K3b;K3b=d3b["call"](this,b3b,N3b,P3b,B3b,q3b)||this;K3b["isInitialized"]=false;K3b["needsUpdate"]=true;K3b["preLocalPosition"]=null;K3b["clipMeshs"]=[];K3b["worker"]=null;K3b["boundaryRadius"]=0.01;K3b["needsUpdate"]=true;K3b["cmworld"]=v3b["CmWorld3"]["getInstance"]();return K3b;}__extends(c3b,d3b);c3b["prototype"]["dispose"]=function(){};c3b["prototype"]["Initialize"]=function(){this["isInitialized"]=true;};c3b["prototype"]["setPlaneImage"]=function(H8b,k8b,m8b){var Q3b,f3b;Q3b=H8b["clipMeshs"][k8b];if(Q3b==null)return;f3b=new Uint8ClampedArray(m8b);Q3b["imageData"]["data"]["set"](f3b);Q3b["context"]["putImageData"](Q3b["imageData"],0,0);Q3b["mesh"]["material"]["map"]["needsUpdate"]=true;};c3b["prototype"]["getPlaneMeshCorner"]=function(L8b){var V8b,E8b,y8b,s8b;V8b={x:L8b["geometry"]["attributes"]["position"]["array"][0],y:L8b["geometry"]["attributes"]["position"]["array"][0+1],z:L8b["geometry"]["attributes"]["position"]["array"][0+2]};E8b={x:L8b["geometry"]["attributes"]["position"]["array"][1*3+0],y:L8b["geometry"]["attributes"]["position"]["array"][1*3+1],z:L8b["geometry"]["attributes"]["position"]["array"][1*3+2]};y8b={x:L8b["geometry"]["attributes"]["position"]["array"][2*3+0],y:L8b["geometry"]["attributes"]["position"]["array"][2*3+1],z:L8b["geometry"]["attributes"]["position"]["array"][2*3+2]};s8b={x:L8b["geometry"]["attributes"]["position"]["array"][4*3+0],y:L8b["geometry"]["attributes"]["position"]["array"][4*3+1],z:L8b["geometry"]["attributes"]["position"]["array"][4*3+2]};return{lt:V8b,lb:E8b,rt:y8b,rb:s8b};};c3b["prototype"]["sendPlaneInfo"]=function(){var Y8b,r8b,F8b;for(var l8b in this["clipMeshs"]){Y8b=this["getPlaneMeshCorner"](this["clipMeshs"][l8b]["mesh"]);r8b=new Uint8ClampedArray(this["clipMeshs"][l8b]["w"]*this["clipMeshs"][l8b]["h"]*4);r8b["set"](this["clipMeshs"][l8b]["imageData"]["data"]);F8b={state:c3b["ID_SetPlaneInfo"],ID:l8b,lbx:Y8b["lb"]["x"],lby:Y8b["lb"]["y"],lbz:Y8b["lb"]["z"],ltx:Y8b["lt"]["x"],lty:Y8b["lt"]["y"],ltz:Y8b["lt"]["z"],rbx:Y8b["rb"]["x"],rby:Y8b["rb"]["y"],rbz:Y8b["rb"]["z"],rtx:Y8b["rt"]["x"],rty:Y8b["rt"]["y"],rtz:Y8b["rt"]["z"],w:this["clipMeshs"][l8b]["w"],h:this["clipMeshs"][l8b]["h"],imageData:r8b["buffer"]};this["worker"]["postMessage"](F8b,[F8b["imageData"]]);}};c3b["prototype"]["sendClipPosition"]=function(){var W8b,U8b,G8b;W8b=this["cmworld"]["clipBox"]["localMesh"]["matrixWorld"]["elements"];U8b=this["cmworld"]["clipBox"]["getLocalPosition"]();G8b={state:c3b["ID_SetClipPosition"],x:U8b["x"],y:U8b["y"],z:U8b["z"],m0:W8b[0],m1:W8b[1],m2:W8b[2],m3:W8b[3],m4:W8b[4],m5:W8b[5],m6:W8b[6],m7:W8b[7],m8:W8b[8],m9:W8b[9],m10:W8b[10],m11:W8b[11],m12:W8b[12],m13:W8b[13],m14:W8b[14],m15:W8b[15],refX:this["cmworld"]["option"]["refCenter"]["x"],refY:this["cmworld"]["option"]["refCenter"]["y"],refZ:this["cmworld"]["option"]["refCenter"]["z"]};this["worker"]["postMessage"](G8b);};c3b["prototype"]["sendColorValue"]=function(){var C8b;for(var M8b in this["parentLayer"]["pointColors"]){C8b={state:c3b["ID_SetColorValue"],value:M8b,r:this["parentLayer"]["pointColors"][M8b]["r"],g:this["parentLayer"]["pointColors"][M8b]["g"],b:this["parentLayer"]["pointColors"][M8b]["b"]};this["worker"]["postMessage"](C8b);}};c3b["prototype"]["makePlanes"]=function(){var w8b,A8b,J8b,Z8b,X8b,T8b,D8b,i8b,p8b,x8b,z8b,I8b,g8b,O8b,t8b,o8b,a8b,S8b;w8b=this["cmworld"]["clipBox"]["localMesh"];if(this["cmworld"]["clipBox"]["localMesh"]["geometry"]instanceof THREE["BoxGeometry"]==false)return;A8b=this["cmworld"]["clipBox"]["localMesh"]["geometry"];T8b=0;D8b=[[2,3,0,3,1,0],[0,1,5,1,4,5],[5,4,7,4,6,7],[7,6,2,6,3,2],[5,7,0,7,2,0],[6,4,3,4,1,3]];i8b=[0.0,1.0,0.0,0.0,1.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0];p8b=this["parentLayer"]["mapInfo"]["level0Height"]/Math["pow"](2.0,this["targetLevel"]);x8b=p8b/1024;this["clipMeshs"]=[];for(var n8b=0;n8b<D8b["length"];n8b++){z8b=new j3b();T8b=0;J8b=new THREE["BufferGeometry"]();X8b=new Float32Array(18);for(var R8b=0;R8b<D8b[n8b]["length"];R8b++){X8b[T8b++]=A8b["vertices"][D8b[n8b][R8b]]["x"];X8b[T8b++]=A8b["vertices"][D8b[n8b][R8b]]["y"];X8b[T8b++]=A8b["vertices"][D8b[n8b][R8b]]["z"];}I8b=new Float32Array(i8b);J8b["addAttribute"]('position',new THREE["BufferAttribute"](X8b,3));J8b["addAttribute"]('uv',new THREE["BufferAttribute"](I8b,2));g8b=document["createElement"]("canvas");O8b=A8b["vertices"][D8b[0][0]]["distanceTo"](A8b["vertices"][D8b[0][2]])/x8b;t8b=A8b["vertices"][D8b[0][0]]["distanceTo"](A8b["vertices"][D8b[0][1]])/x8b;g8b["width"]=O8b;g8b["height"]=t8b;o8b=g8b["getContext"]("2d");o8b["clearRect"](0,0,O8b,t8b);a8b=new THREE["Texture"](g8b);a8b["minFilter"]=THREE["LinearMipMapLinearFilter"];a8b["magFilter"]=THREE["LinearFilter"];a8b["needsUpdate"]=true;S8b=new THREE["MeshPhongMaterial"]({map:a8b,transparent:true,wireframe:false,side:THREE["DoubleSide"],clippingPlanes:[]});Z8b=new THREE["Mesh"](J8b,S8b);Z8b["matrixWorld"]["copy"](this["cmworld"]["clipBox"]["localMesh"]["matrixWorld"]);z8b["canvas"]=g8b;z8b["mesh"]=Z8b;z8b["context"]=o8b;z8b["w"]=O8b;z8b["h"]=t8b;z8b["imageData"]=o8b["getImageData"](0,0,O8b,t8b);this["clipMeshs"]["push"](z8b);}};c3b["prototype"]["localToWorldGeo"]=function(v8b,h8b,j8b,u8b){var e8b;e8b=new THREE["Vector3"](h8b,j8b,u8b);e8b=v8b["localToWorld"](e8b);e8b["add"](this["cmworld"]["option"]["refCenter"]);e8b=v3b["CmMathEngine"]["Cartesian2Geo"](e8b["x"],e8b["y"],e8b["z"]);return e8b;};c3b["prototype"]["setClipPlanePosition"]=function(){var d8b,c8b,K8b;d8b=this["cmworld"]["clipBox"]["getLocalPosition"]();c8b=v3b["CmMathEngine"]["Geo2Cartesian"](d8b["x"],d8b["y"],d8b["z"]);c8b["x"]-=this["cmworld"]["option"]["refCenter"]["x"];c8b["y"]-=this["cmworld"]["option"]["refCenter"]["y"];c8b["z"]-=this["cmworld"]["option"]["refCenter"]["z"];for(var b8b in this["clipMeshs"]){K8b=this["clipMeshs"][b8b];if(K8b["mesh"]){K8b["mesh"]["position"]["set"](c8b["x"],c8b["y"],c8b["z"]);v3b["CmWorld3"]["setRotate4Earth"](K8b["mesh"],d8b);K8b["mesh"]["updateMatrix"]();}}};c3b["prototype"]["sendLayerInfo"]=function(){var N8b;if(this["worker"]==null)return false;N8b={state:c3b["ID_SetLayerInfo"],cmworld3BaseRoot:v3b["GlobalOption"]["cmworld3BaseRoot"],key:this["key"],serverUrl:this["parentLayer"]["mapInfo"]["serverURL"],minLevel:this["parentLayer"]["mapInfo"]["MinLevel"],maxLevel:this["parentLayer"]["mapInfo"]["MaxLevel"],minHeight:this["parentLayer"]["mapInfo"]["MinFloorHeight"],maxHeight:this["parentLayer"]["mapInfo"]["MaxFloorHeight"],targetLevel:this["targetLevel"],tileSize:this["cmworld"]["option"]["TileLevelRange"][this["targetLevel"]],level0Height:this["parentLayer"]["mapInfo"]["level0Height"],cubeHeight:this["parentLayer"]["mapInfo"]["level0Height"]/Math["pow"](2.0,this["targetLevel"])};this["worker"]["postMessage"](N8b);};c3b["prototype"]["clearClipImage"]=function(){};c3b["prototype"]["makeClipImage"]=function(){var P8b;if(this["worker"]!=null){this["worker"]["terminate"]();}this["worker"]=new Worker(v3b["GlobalOption"]["workerLibraryURL"]+'cube2imagegroupworker.js');if(this["worker"]==null)return false;P8b=this;this["worker"]["onmessage"]=function(q8b){var B8b;B8b=q8b["data"];switch(B8b["state"]){case c3b["ID_GetPlaneImage"]:P8b["setPlaneImage"](P8b,B8b["ID"],B8b["imageData"]);break;case v3b["VectorCube3D"]["ID_Finish"]:if(P8b["worker"]!=null){P8b["worker"]["terminate"]();}P8b["worker"]=null;break;}};this["sendLayerInfo"]();this["sendColorValue"]();this["sendPlaneInfo"]();this["sendClipPosition"]();};c3b["prototype"]["update"]=function(){var Q8b;if(this["isInitialized"]==false)this["Initialize"]();Q8b=null;if(this["cmworld"]["clipBox"]["localMesh"]==null)return;if(this["cmworld"]["clipBox"]["localMesh"]["position"]["x"]==0&&this["cmworld"]["clipBox"]["localMesh"]["position"]["y"]==0&&this["cmworld"]["clipBox"]["localMesh"]["position"]["z"]==0)return;if(this["clipMeshs"]["length"]==0){this["makePlanes"]();return;}this["render"]();};c3b["prototype"]["render"]=function(){var f8b,k4b,H4b;f8b=v3b["CmWorld3"]["getInstance"]();if(f8b["clipBox"]["localMesh"]==null)return;if(f8b["clipBox"]["localClipboxEnabled"]==false)return;this["setClipPlanePosition"]();k4b=f8b["getCube3DScene"]();for(var m4b in this["clipMeshs"]){H4b=this["clipMeshs"][m4b];if(H4b["mesh"]){k4b["add"](H4b["mesh"]);}}};return c3b;}(v3b["Cube3DTarget"]);h3b["ID_SetLayerInfo"]=1001;h3b["ID_SetPlaneInfo"]=1002;h3b["ID_SetClipPosition"]=1004;h3b["ID_GetPlaneImage"]=1005;h3b["ID_DataReadyState"]=1006;h3b["ID_SetColorValue"]=1007;h3b["ID_MakeCubeDataProcess"]=1234;h3b["ID_Finish"]=1235;v3b["Cube3DClipTarget"]=h3b;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var L4b;L4b=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(V4b,E4b){V4b["__proto__"]=E4b;}||function(Y4b,s4b){for(var y4b in s4b)if(s4b["hasOwnProperty"](y4b))Y4b[y4b]=s4b[y4b];};return function(r4b,l4b){function F4b(){this["constructor"]=r4b;}L4b(r4b,l4b);r4b["prototype"]=l4b===null?Object["create"](l4b):(F4b["prototype"]=l4b["prototype"],new F4b());};}();(function(W4b){var U4b;U4b=function(M4b){__extends(G4b,M4b);G4b["prototype"]["initialize"]=function(){this["cmworld"]=W4b["CmWorld3"]["getInstance"]();this["bInitialize"]=true;};G4b["prototype"]["addApplicationMesh"]=function(n4b,A4b,z4b){if(z4b&&z4b==true){A4b["needrotate4Earth"]=true;}this["applicationMesh"][n4b]=A4b;};function G4b(D4b){var C4b;C4b=M4b["call"](this)||this;C4b["bInitialize"]=false;C4b["mapInfo"]=null;C4b["pointColors"]=[];C4b["cubeBuffers"]=[];C4b["renderFrame"]=false;C4b["renderOnlyFrame"]=false;C4b["targetObject"]=[];C4b["applicationMesh"]=[];C4b["cubeBeforeUpdate"]=null;C4b["cubeBeforeLayerRender"]=null;C4b["cubeAfterLayerRender"]=null;C4b["cubeBeforeCubeRender"]=null;C4b["cubeAfterCubeRender"]=null;C4b["name"]=D4b;return C4b;}G4b["prototype"]["removeApplicationMesh"]=function(R4b){this["applicationMesh"][R4b]=null;};G4b["prototype"]["addTargetCamera"]=function(g4b,a4b,t4b){var X4b,T4b;if(this["targetObject"][g4b]!=null){return;}X4b=W4b["CmWorld3"]["getInstance"]();T4b=new W4b["Cube3DTarget"](g4b,X4b["getCamera"]()["getThreejsCamera"](),this,a4b,t4b);this["targetObject"][g4b]=T4b;};G4b["prototype"]["addTargetObject"]=function(O4b,J4b,Z4b,x4b){var o4b;if(this["targetObject"][O4b]!=null){return;}o4b=new W4b["Cube3DTarget"](O4b,J4b,this,Z4b,x4b);this["targetObject"][O4b]=o4b;};G4b["prototype"]["addTargetObject2"]=function(i4b,S4b,I4b,w4b,e4b){var p4b;if(this["targetObject"][i4b]!=null){return;}p4b=new W4b["Cube3DTarget"](i4b,S4b,this,I4b,w4b);p4b["cubeFrameColor"]=e4b;this["targetObject"][i4b]=p4b;};G4b["prototype"]["addTargetClipbox"]=function(v4b,j4b){var h4b;if(this["targetObject"][v4b]!=null){return;}h4b=new W4b["Cube3DClipTarget"](v4b,null,this,j4b,0);this["targetObject"][v4b]=h4b;};G4b["prototype"]["removeTargetObject"]=function(c4b){var u4b;u4b=this["targetObject"][c4b];if(u4b!=null){this["targetObject"][c4b]=null;u4b["dispose"]();u4b=null;}};G4b["prototype"]["getCube3D"]=function(b4b,N4b,P4b,B4b){var q4b,d4b,K4b;q4b=W4b["Cube3D"]["getKeyString"](b4b,N4b,P4b,B4b);d4b=this["cubeBuffers"][q4b];if(d4b==null){K4b=new W4b["Cube3DInfoStruct"](this);K4b["setState"](b4b,N4b,P4b,B4b,W4b["Cube3DPositionType"]["Top"],null);if(this["mapInfo"]["cubeType"]==W4b["Cube3DType"]["_vector"])d4b=new W4b["VectorCube3D"](null,this);else if(this["mapInfo"]["cubeType"]==W4b["Cube3DType"]["_raster"])d4b=new W4b["RasterCube3D"](null,this);else if(this["mapInfo"]["cubeType"]==W4b["Cube3DType"]["_undergroundclip"])d4b=new W4b["UndergroundClipCube3D"](null,this);else if(this["mapInfo"]["cubeType"]==W4b["Cube3DType"]["_virtual"])d4b=new W4b["VirtualCube3D"](null,this);if(d4b!=null){d4b["position"]=new THREE["Vector3"](K4b["position"]["x"],K4b["position"]["y"],K4b["position"]["z"]);d4b["setTileInfo"](b4b,N4b,P4b,B4b);d4b["cubeInfo"]["setState"](b4b,N4b,P4b,B4b,W4b["Cube3DPositionType"]["Top"],null);this["cubeBuffers"][q4b]=d4b;}}return d4b;};G4b["prototype"]["resetCubeBuffer"]=function(){this["cubeBuffers"]=[];};G4b["prototype"]["update"]=function(){var f4b;f4b=this["cmworld"];if(this["bInitialize"]==false){this["initialize"]();return;}for(var Q4b in this["cubeBuffers"]){this["cubeBuffers"][Q4b]["targetUsed"]=false;this["cubeBuffers"][Q4b]["aleadyRender"]=false;}for(var Q4b in this["targetObject"]){this["targetObject"][Q4b]["update"]();}if(this["cubeBeforeLayerRender"]!=null){this["cubeBeforeLayerRender"](this);}for(var Q4b in this["targetObject"]){this["targetObject"][Q4b]["render"]();}if(this["cubeAfterLayerRender"]!=null){this["cubeAfterLayerRender"](this);}};G4b["prototype"]["render"]=function(){};return G4b;}(W4b["CmLayer"]);W4b["Cube3DLayer"]=U4b;}(CMWORLD||(CMWORLD={})));(function(H2b){var k2b;k2b=function(){m2b["prototype"]["dispose"]=function(){this["disposed"]=true;};m2b["prototype"]["initTile"]=function(){this["key"]="";this["cubeInfo"]=new H2b["Cube3DInfoStruct"](this["parentLayer"]);};m2b["prototype"]["getLayer"]=function(){return this["parentLayer"];};function m2b(L2b,V2b){this["level"]=-1;this["row"]=-1;this["col"]=-1;this["floor"]=0;this["targetUsed"]=false;this["aleadyRender"]=false;this["originCoord"]=new THREE["Vector3"](0,0,0);this["disposed"]=false;this["parentLayer"]=null;this["tempData"]=0;this["position"]=new THREE["Vector3"](0,0,0);this["cubeFrameColor"]=new THREE["Color"](1,1,1);this["requestedData"]=false;this["retryCount"]=0;this["dataFileBuffer"]=null;this["dataNoExist"]=false;this["dataReady"]=false;this["lastUpdateTime"]=0;this["dataComplete"]=false;this["isInitialize"]=false;this["tempMesh"]=null;this["mainBox"]=null;this["childMesh"]=[];this["cmworld3"]=H2b["CmWorld3"]["getInstance"]();this["parentCube"]=L2b;this["parentLayer"]=V2b;this["cmworld3"]=H2b["CmWorld3"]["getInstance"]();this["lastUpdateTime"]=this["cmworld3"]["option"]["renderFrameTime"];this["initTile"]();}m2b["prototype"]["isAlive"]=function(){return!this["disposed"];};m2b["prototype"]["setTileInfo"]=function(E2b,y2b,s2b,Y2b){this["level"]=E2b;this["row"]=y2b;this["col"]=s2b;this["floor"]=Y2b;this["key"]=H2b["Cube3D"]["getKeyString"](E2b,y2b,s2b,Y2b);};m2b["prototype"]["setName"]=function(l2b){this["name"]=l2b;};m2b["prototype"]["getBoundary"]=function(){if(this["boundary"]==null){this["boundary"]=H2b["Cube3DMath"]["getBoundFromRowColFloor"](this["level"],this["row"],this["col"],this["floor"],this["parentLayer"]["mapInfo"]["level0Height"]);}return this["boundary"];};m2b["getBoundary"]=function(r2b,F2b,W2b,U2b,G2b){return H2b["Cube3DMath"]["getBoundFromRowColFloor"](r2b,F2b,W2b,U2b,G2b);};m2b["getKeyString"]=function(C2b,D2b,A2b,z2b){var M2b;if(C2b==-1)return"";M2b="{z}:{y}:{x}:{f}";M2b=M2b["replace"](/\x7b\x7a\x7d/gi,C2b["toString"]());M2b=M2b["replace"](/\x7b\x79\u007d/gi,D2b["toString"]());M2b=M2b["replace"](/\x7b\u0078\u007d/gi,A2b["toString"]());M2b=M2b["replace"](/\u007b\u0066\u007d/gi,z2b["toString"]());return M2b;};m2b["prototype"]["getKey"]=function(){return H2b["Cube3D"]["getKeyString"](this["level"],this["row"],this["col"],this["floor"]);};m2b["prototype"]["setOrigin"]=function(n2b){this["originCoord"]=n2b["clone"]();};m2b["prototype"]["getTileLevel"]=function(){return this["level"];};m2b["prototype"]["isInFrustum"]=function(){if(this["cubeInfo"]["isInFrustum"]())return true;return false;};m2b["prototype"]["getCubeUrl"]=function(){var g2b,X2b,T2b,a2b,t2b,R2b;if(this["parentLayer"]["mapInfo"]!=null){if(this["level"]>this["parentLayer"]["mapInfo"]["MaxLevel"]||this["level"]<this["parentLayer"]["mapInfo"]["MinLevel"]){return null;}g2b=H2b["CmWorld3"]["getInstance"]();X2b=H2b["Cube3DMath"]["getRowFromLatitude"](this["parentLayer"]["mapInfo"]["North"],g2b["option"]["TileLevelRange"][this["level"]]);T2b=H2b["Cube3DMath"]["getRowFromLatitude"](this["parentLayer"]["mapInfo"]["South"],g2b["option"]["TileLevelRange"][this["level"]]);if(this["row"]<T2b||this["row"]>X2b)return null;a2b=H2b["Cube3DMath"]["getColFromLongitude"](this["parentLayer"]["mapInfo"]["West"],g2b["option"]["TileLevelRange"][this["level"]]);t2b=H2b["Cube3DMath"]["getColFromLongitude"](this["parentLayer"]["mapInfo"]["East"],g2b["option"]["TileLevelRange"][this["level"]]);if(this["col"]<a2b||this["col"]>t2b)return null;R2b=this["parentLayer"]["mapInfo"]["serverURL"];R2b=R2b["replace"](/\u007b\u007a\u007d/gi,this["level"]["toString"]());R2b=R2b["replace"](/\u007b\u0078\u007d/gi,this["col"]["toString"]());R2b=R2b["replace"](/\x7b\x79\x7d/gi,this["row"]["toString"]());R2b=R2b["replace"](/\u007b\u0066\x7d/gi,this["floor"]["toString"]());return R2b;}return null;};m2b["prototype"]["requestData"]=function(J2b){var O2b,o2b;O2b=new XMLHttpRequest();if("withCredentials"in O2b){O2b["open"]("GET",J2b,true);}else if(typeof XDomainRequest!="undefined"){O2b=new XDomainRequest();O2b["open"]("GET",J2b,true);}else{O2b=null;}O2b["responseType"]='arraybuffer';o2b=this;if(O2b){O2b["onload"]=function(){if(O2b["status"]==200){o2b["dataFileBuffer"]=O2b["response"];o2b["dataNoExist"]=false;o2b["dataReady"]=true;o2b["processData"](o2b);}else{o2b["dataNoExist"]=true;}};O2b["onerror"]=function(){o2b["dataNoExist"]=true;};try{O2b["send"]();}catch(Z2b){}}};m2b["prototype"]["loadData"]=function(){var i2b,x2b;if(this["dataComplete"]){return true;}if(this["requestedData"]==false){if(this["parentCube"]&&this["parentCube"]["isInitialize"]==false){return false;}if(this["dataComplete"]===false&&this["dataNoExist"]===false){if(this["parentLayer"]==null){console["log"]("ERROR : Parent null");}i2b=this["cmworld3"];x2b=this["getCubeUrl"]();this["requestedData"]=true;this["requestData"](x2b);return false;}}else{if(this["dataNoExist"]){return false;}}return false;};m2b["prototype"]["getBoundaryBoxGeometry"]=function(p2b){var I2b,K2b,e2b,v2b,w2b,j2b,u2b,c2b,d2b,S2b,h2b;I2b=this["cubeInfo"]["centerposition"]["clone"]();K2b=H2b["CmMathEngine"]["Geo2Cartesian"](p2b["west"],p2b["south"],p2b["bottomHeight"]);e2b=H2b["CmMathEngine"]["Geo2Cartesian"](p2b["east"],p2b["south"],p2b["bottomHeight"]);v2b=H2b["CmMathEngine"]["Geo2Cartesian"](p2b["east"],p2b["north"],p2b["bottomHeight"]);w2b=H2b["CmMathEngine"]["Geo2Cartesian"](p2b["west"],p2b["north"],p2b["bottomHeight"]);j2b=H2b["CmMathEngine"]["Geo2Cartesian"](p2b["west"],p2b["south"],p2b["topHeight"]);u2b=H2b["CmMathEngine"]["Geo2Cartesian"](p2b["east"],p2b["south"],p2b["topHeight"]);c2b=H2b["CmMathEngine"]["Geo2Cartesian"](p2b["east"],p2b["north"],p2b["topHeight"]);d2b=H2b["CmMathEngine"]["Geo2Cartesian"](p2b["west"],p2b["north"],p2b["topHeight"]);S2b=new THREE["Geometry"]();h2b=new THREE["LineBasicMaterial"]({color:this["cubeFrameColor"],linewidth:5});S2b["vertices"]["push"](K2b["sub"](I2b),e2b["sub"](I2b),v2b["sub"](I2b),w2b["sub"](I2b));S2b["vertices"]["push"](S2b["vertices"][0]);S2b["vertices"]["push"](j2b["sub"](I2b),u2b["sub"](I2b),c2b["sub"](I2b),d2b["sub"](I2b));S2b["vertices"]["push"](S2b["vertices"][5]);S2b["vertices"]["push"](S2b["vertices"][6]);S2b["vertices"]["push"](S2b["vertices"][1]);S2b["vertices"]["push"](S2b["vertices"][2]);S2b["vertices"]["push"](S2b["vertices"][7]);S2b["vertices"]["push"](S2b["vertices"][8]);S2b["vertices"]["push"](S2b["vertices"][3]);return new THREE["Line"](S2b,h2b);};m2b["prototype"]["getBoundaryBoxGeometry_원본"]=function(q2b){var B2b,L1b,V1b,E1b,Q2b,f2b,H1b,k1b,m1b,P2b,b2b,N2b,y1b,s1b;B2b=this["cubeInfo"]["centerposition"]["clone"]();L1b=H2b["CmMathEngine"]["Geo2Cartesian"](q2b["west"],q2b["south"],q2b["bottomHeight"]);V1b=H2b["CmMathEngine"]["Geo2Cartesian"](q2b["east"],q2b["south"],q2b["bottomHeight"]);E1b=H2b["CmMathEngine"]["Geo2Cartesian"](q2b["east"],q2b["north"],q2b["bottomHeight"]);Q2b=H2b["CmMathEngine"]["Geo2Cartesian"](q2b["west"],q2b["north"],q2b["bottomHeight"]);f2b=H2b["CmMathEngine"]["Geo2Cartesian"](q2b["west"],q2b["south"],q2b["topHeight"]);H1b=H2b["CmMathEngine"]["Geo2Cartesian"](q2b["east"],q2b["south"],q2b["topHeight"]);k1b=H2b["CmMathEngine"]["Geo2Cartesian"](q2b["east"],q2b["north"],q2b["topHeight"]);m1b=H2b["CmMathEngine"]["Geo2Cartesian"](q2b["west"],q2b["north"],q2b["topHeight"]);P2b=new Float32Array(24);b2b=0;P2b[b2b++]=L1b["x"]-B2b["x"];P2b[b2b++]=L1b["y"]-B2b["y"];P2b[b2b++]=L1b["z"]-B2b["z"];P2b[b2b++]=V1b["x"]-B2b["x"];P2b[b2b++]=V1b["y"]-B2b["y"];P2b[b2b++]=V1b["z"]-B2b["z"];P2b[b2b++]=E1b["x"]-B2b["x"];P2b[b2b++]=E1b["y"]-B2b["y"];P2b[b2b++]=E1b["z"]-B2b["z"];P2b[b2b++]=Q2b["x"]-B2b["x"];P2b[b2b++]=Q2b["y"]-B2b["y"];P2b[b2b++]=Q2b["z"]-B2b["z"];P2b[b2b++]=f2b["x"]-B2b["x"];P2b[b2b++]=f2b["y"]-B2b["y"];P2b[b2b++]=f2b["z"]-B2b["z"];P2b[b2b++]=H1b["x"]-B2b["x"];P2b[b2b++]=H1b["y"]-B2b["y"];P2b[b2b++]=H1b["z"]-B2b["z"];P2b[b2b++]=k1b["x"]-B2b["x"];P2b[b2b++]=k1b["y"]-B2b["y"];P2b[b2b++]=k1b["z"]-B2b["z"];P2b[b2b++]=m1b["x"]-B2b["x"];P2b[b2b++]=m1b["y"]-B2b["y"];P2b[b2b++]=m1b["z"]-B2b["z"];N2b=new Uint16Array(36);b2b=0;N2b[b2b++]=0;N2b[b2b++]=1;N2b[b2b++]=2;N2b[b2b++]=0;N2b[b2b++]=2;N2b[b2b++]=3;N2b[b2b++]=0;N2b[b2b++]=1;N2b[b2b++]=5;N2b[b2b++]=0;N2b[b2b++]=5;N2b[b2b++]=4;N2b[b2b++]=4;N2b[b2b++]=5;N2b[b2b++]=6;N2b[b2b++]=4;N2b[b2b++]=6;N2b[b2b++]=7;N2b[b2b++]=7;N2b[b2b++]=6;N2b[b2b++]=2;N2b[b2b++]=7;N2b[b2b++]=2;N2b[b2b++]=3;N2b[b2b++]=1;N2b[b2b++]=2;N2b[b2b++]=6;N2b[b2b++]=1;N2b[b2b++]=6;N2b[b2b++]=5;N2b[b2b++]=3;N2b[b2b++]=0;N2b[b2b++]=4;N2b[b2b++]=3;N2b[b2b++]=4;N2b[b2b++]=7;y1b=new THREE["BufferGeometry"]();s1b=new THREE["MeshBasicMaterial"]({color:0xffffff,wireframe:true});y1b["addAttribute"]('position',new THREE["BufferAttribute"](P2b,3));y1b["setIndex"](new THREE["BufferAttribute"](N2b,1));return new THREE["Mesh"](y1b,s1b);};m2b["prototype"]["makeData"]=function(l1b,r1b,Y1b){if(Y1b===void 0){Y1b=false;}};m2b["prototype"]["processData"]=function(F1b){var W1b;if(F1b["dataReady"]==true){W1b=new JSZip();W1b["loadAsync"](F1b["dataFileBuffer"])["then"](function(U1b){Object["keys"](U1b["files"])["forEach"](function(G1b){W1b["file"](G1b)["async"]('arraybuffer')["then"](function(M1b){F1b["makeData"](F1b,M1b,false);});});});}};m2b["prototype"]["initialize"]=function(){if(this["isInitialize"]==false){if(this["getKey"]()!=""){if(this["level"]<this["parentLayer"]["mapInfo"]["MinLevel"]&&this["level"]!=-1){this["isInitialize"]=true;}else{if(this["parentLayer"]["renderOnlyFrame"]==false){if(this["loadData"]()==false){return this["isInitialize"];}else{if(this["retryCount"]>0){this["retryCount"]=this["retryCount"]-1;this["dataComplete"]=false;this["dataReady"]=false;}}}this["isInitialize"]=true;}}}return this["isInitialize"];};m2b["prototype"]["clear"]=function(){};m2b["prototype"]["update"]=function(){return true;};m2b["prototype"]["render"]=function(){var C1b,D1b;if(this["parentLayer"]["renderFrame"]==true){if(this["mainBox"]==null){this["mainBox"]=this["getBoundaryBoxGeometry"](this["cubeInfo"]);}C1b=this["cubeInfo"]["centerposition"]["clone"]();C1b["x"]-=this["cmworld3"]["option"]["refCenter"]["x"];C1b["y"]-=this["cmworld3"]["option"]["refCenter"]["y"];C1b["z"]-=this["cmworld3"]["option"]["refCenter"]["z"];this["mainBox"]["position"]["set"](C1b["x"],C1b["y"],C1b["z"]);this["mainBox"]["updateMatrix"]();D1b=this["cmworld3"]["getCube3DScene"]();D1b["add"](this["mainBox"]);}};return m2b;}();H2b["Cube3D"]=k2b;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var A1b;A1b=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(z1b,n1b){z1b["__proto__"]=n1b;}||function(X1b,g1b){for(var R1b in g1b)if(g1b["hasOwnProperty"](R1b))X1b[R1b]=g1b[R1b];};return function(a1b,T1b){A1b(a1b,T1b);a1b["prototype"]=T1b===null?Object["create"](T1b):(t1b["prototype"]=T1b["prototype"],new t1b());function t1b(){this["constructor"]=a1b;}};}();(function(O1b){var o1b,J1b,Z1b;o1b=function(){function x1b(){this["subData"]=[];}return x1b;}();O1b["RasterCube3DDataBlock"]=o1b;J1b=function(){i1b["prototype"]["clear"]=function(){this["dataBlock"]=[];};function i1b(){this["dataBlock"]=[];}return i1b;}();O1b["RasterCube3DData"]=J1b;Z1b=function(S1b){__extends(p1b,S1b);p1b["prototype"]["dispose"]=function(){this["cubeData"]=null;S1b["prototype"]["dispose"]["call"](this);};p1b["prototype"]["clear"]=function(){S1b["prototype"]["clear"]["call"](this);for(var v1b=O1b["Cube3DPositionType"]["LBF"];v1b<=O1b["Cube3DPositionType"]["RTB"];v1b++){if(this["childMesh"][v1b]!=null){this["childMesh"][v1b]=null;}}this["childMesh"]=[];};p1b["prototype"]["getWorldPosition"]=function(B1b,b1b,N1b,P1b,Q1b){var h1b,j1b,u1b,d1b,K1b,c1b,q1b;h1b=(this["cubeInfo"]["east"]-this["cubeInfo"]["west"])/B1b["dataSidePointCount"];j1b=(this["cubeInfo"]["north"]-this["cubeInfo"]["south"])/B1b["dataSidePointCount"];u1b=(this["cubeInfo"]["topHeight"]-this["cubeInfo"]["bottomHeight"])/B1b["dataSidePointCount"];switch(Q1b){case O1b["Cube3DPositionType"]["LBF"]:{d1b=this["cubeInfo"]["west"]+N1b*h1b+h1b*0.5;K1b=this["cubeInfo"]["south"]+b1b*j1b+j1b*0.5;c1b=this["cubeInfo"]["bottomHeight"]+P1b*u1b+u1b*0.5;}break;case O1b["Cube3DPositionType"]["LBB"]:{d1b=this["cubeInfo"]["west"]+N1b*h1b+h1b*0.5;K1b=(this["cubeInfo"]["south"]+this["cubeInfo"]["north"])*0.5+b1b*j1b+j1b*0.5;c1b=this["cubeInfo"]["bottomHeight"]+P1b*u1b+u1b*0.5;}break;case O1b["Cube3DPositionType"]["RBF"]:{d1b=(this["cubeInfo"]["west"]+this["cubeInfo"]["east"])*0.5+N1b*h1b+h1b*0.5;K1b=this["cubeInfo"]["south"]+b1b*j1b+j1b*0.5;c1b=this["cubeInfo"]["bottomHeight"]+P1b*u1b+u1b*0.5;}break;case O1b["Cube3DPositionType"]["RBB"]:{d1b=(this["cubeInfo"]["west"]+this["cubeInfo"]["east"])*0.5+N1b*h1b+h1b*0.5;K1b=(this["cubeInfo"]["south"]+this["cubeInfo"]["north"])*0.5+b1b*j1b+j1b*0.5;c1b=this["cubeInfo"]["bottomHeight"]+P1b*u1b+u1b*0.5;}break;case O1b["Cube3DPositionType"]["LTF"]:{d1b=this["cubeInfo"]["west"]+N1b*h1b+h1b*0.5;K1b=this["cubeInfo"]["south"]+b1b*j1b+j1b*0.5;c1b=(this["cubeInfo"]["bottomHeight"]+this["cubeInfo"]["topHeight"])*0.5+P1b*u1b+u1b*0.5;}break;case O1b["Cube3DPositionType"]["LTB"]:{d1b=this["cubeInfo"]["west"]+N1b*h1b+h1b*0.5;K1b=(this["cubeInfo"]["south"]+this["cubeInfo"]["north"])*0.5+b1b*j1b+j1b*0.5;c1b=(this["cubeInfo"]["bottomHeight"]+this["cubeInfo"]["topHeight"])*0.5+P1b*u1b+u1b*0.5;}break;case O1b["Cube3DPositionType"]["RTF"]:{d1b=(this["cubeInfo"]["west"]+this["cubeInfo"]["east"])*0.5+N1b*h1b+h1b*0.5;K1b=this["cubeInfo"]["south"]+b1b*j1b+j1b*0.5;c1b=(this["cubeInfo"]["bottomHeight"]+this["cubeInfo"]["topHeight"])*0.5+P1b*u1b+u1b*0.5;}break;case O1b["Cube3DPositionType"]["RTB"]:{d1b=(this["cubeInfo"]["west"]+this["cubeInfo"]["east"])*0.5+N1b*h1b+h1b*0.5;K1b=(this["cubeInfo"]["south"]+this["cubeInfo"]["north"])*0.5+b1b*j1b+j1b*0.5;c1b=(this["cubeInfo"]["bottomHeight"]+this["cubeInfo"]["topHeight"])*0.5+P1b*u1b+u1b*0.5;}break;}q1b=O1b["CmMathEngine"]["Geo2Cartesian"](d1b,K1b,c1b);return q1b;};p1b["prototype"]["makeMesh"]=function(s5b,A5b,M5b){var k5b,H5b,l5b,Y5b,D5b,W5b,z5b,C5b,V5b,G5b,F5b,f1b,E5b,r5b,U5b;k5b=this["cubeInfo"]["centerposition"];H5b=new THREE["BufferGeometry"]();l5b=[];Y5b=[];D5b=new THREE["Color"]();W5b=0;z5b=0;C5b=16;V5b=s5b["dataSidePointCount"]/2;G5b=this["parentLayer"]["mapInfo"]["level0Height"]/Math["pow"](2.0,this["cubeInfo"]["level"]);F5b=G5b/s5b["dataSidePointCount"];for(var y5b=0;y5b<V5b;y5b++){for(var L5b=0;L5b<V5b;L5b++){for(var m5b=0;m5b<V5b;m5b++){f1b=A5b[W5b++];if(this["parentLayer"]["pointColors"][f1b]!=null){E5b=this["getWorldPosition"](s5b,L5b,m5b,y5b,M5b);l5b["push"](E5b["x"]-k5b["x"],E5b["y"]-k5b["y"],E5b["z"]-k5b["z"]);Y5b["push"](this["parentLayer"]["pointColors"][f1b]["r"],this["parentLayer"]["pointColors"][f1b]["g"],this["parentLayer"]["pointColors"][f1b]["b"]);}else{}}}}H5b["addAttribute"]('position',new THREE["Float32BufferAttribute"](l5b,3));H5b["addAttribute"]('color',new THREE["Float32BufferAttribute"](Y5b,3));H5b["computeBoundingSphere"]();r5b=new THREE["PointsMaterial"]({size:F5b*2,map:new THREE["TextureLoader"]()["load"]('textures/sprites/disc.png'),vertexColors:THREE["VertexColors"],transparent:true,alphaTest:0.5,depthTest:true,depthWrite:true});O1b["Material"]["addClippingAttri"](r5b);U5b=new THREE["Points"](H5b,r5b);return U5b;};p1b["prototype"]["makeData"]=function(i5b,p5b,J5b){var T5b,O5b,n5b,R5b,a5b,o5b,t5b,S5b,I5b,Z5b,x5b;if(J5b===void 0){J5b=false;}T5b=i5b;O5b=[];n5b=new J1b();R5b=new O1b["BinaryReader"](p5b,false);O5b=R5b["readBytes"](2);n5b["vertsion"]=R5b["bin2String"](O5b);if(n5b["vertsion"]!="R0")return;n5b["level"]=R5b["readByte"]();n5b["row"]=R5b["readInt32"]();n5b["col"]=R5b["readInt32"]();n5b["floor"]=R5b["readInt32"]();n5b["dataBlockCount"]=R5b["readByte"]();n5b["dataSidePointCount"]=R5b["readByte"]();n5b["groundSurface"]=R5b["readByte"]();a5b=n5b["dataSidePointCount"]/2;o5b=a5b*a5b*a5b;for(var X5b=0;X5b<n5b["dataBlockCount"];X5b++){t5b=new o1b();t5b["dataType"]=R5b["readByte"]();switch(t5b["dataType"]){case 1:{for(var g5b=O1b["Cube3DPositionType"]["LBF"];g5b<=O1b["Cube3DPositionType"]["RTB"];g5b++){Z5b=R5b["readBytes"](o5b);x5b=this["makeMesh"](n5b,Z5b,g5b);T5b["childMesh"][g5b]=x5b;}}}n5b["dataBlock"][X5b]=t5b;}T5b["cubeData"]=n5b;T5b["dataComplete"]=true;};p1b["prototype"]["renderchild"]=function(v5b){var e5b,j5b,w5b,h5b;if(this["childMesh"][v5b]!=null){e5b=this["childMesh"][v5b];j5b=Date["now"]()*0.001;w5b=this["cubeInfo"]["centerposition"]["clone"]();w5b["x"]-=this["cmworld3"]["option"]["refCenter"]["x"];w5b["y"]-=this["cmworld3"]["option"]["refCenter"]["y"];w5b["z"]-=this["cmworld3"]["option"]["refCenter"]["z"];e5b["position"]["set"](w5b["x"],w5b["y"],w5b["z"]);e5b["updateMatrix"]();O1b["Material"]["addClippingAttri"](e5b["material"]);h5b=this["cmworld3"]["getCube3DScene"]();h5b["add"](e5b);}};p1b["prototype"]["update"]=function(){var u5b,c5b,d5b;S1b["prototype"]["update"]["call"](this);u5b=this["cmworld3"];this["lastUpdateTime"]=u5b["option"]["renderFrameTime"];if(this["initialize"]()==false)return false;c5b=this["cubeInfo"]["getClosestDistanceFromCamera"]();d5b=u5b["option"]["displayDist4Level"][this["cubeInfo"]["level"]+1];this["render"]();return true;};p1b["prototype"]["render"]=function(){S1b["prototype"]["render"]["call"](this);for(var K5b=O1b["Cube3DPositionType"]["LBF"];K5b<=O1b["Cube3DPositionType"]["RTB"];K5b++){this["renderchild"](K5b);}};function p1b(w1b,e1b){var I1b;I1b=S1b["call"](this,w1b,e1b)||this;I1b["childMesh"]=[];I1b["cubeData"]=null;return I1b;}return p1b;}(O1b["Cube3D"]);O1b["RasterCube3D"]=Z1b;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var b5b;b5b=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(N5b,P5b){N5b["__proto__"]=P5b;}||function(Q5b,q5b){for(var B5b in q5b)if(q5b["hasOwnProperty"](B5b))Q5b[B5b]=q5b[B5b];};return function(H6b,f5b){function k6b(){this["constructor"]=H6b;}b5b(H6b,f5b);H6b["prototype"]=f5b===null?Object["create"](f5b):(k6b["prototype"]=f5b["prototype"],new k6b());};}();(function(m6b){var V6b,E6b,y6b,s6b,L6b;V6b=function(){function Y6b(){this["materials"]=[];this["geometrys"]=[];this["meshes"]=[];}return Y6b;}();m6b["VectorCube3DData"]=V6b;E6b=function(){function l6b(){}return l6b;}();m6b["Cube3DMaterial"]=E6b;y6b=function(){function r6b(){}return r6b;}();m6b["Cube3DGeometry"]=y6b;s6b=function(){function F6b(){}return F6b;}();m6b["Cube3DMesh"]=s6b;L6b=function(U6b){__extends(W6b,U6b);W6b["prototype"]["dispose"]=function(){this["cubeData"]=null;U6b["prototype"]["dispose"]["call"](this);};W6b["prototype"]["clear"]=function(){};W6b["prototype"]["makeMesh1"]=function(D6b,A6b){return null;};W6b["prototype"]["makeMesh"]=function(n6b,R6b){var z6b;z6b=this["makeMesh1"](n6b,R6b);z6b["frustumCulled"]=false;return z6b;};W6b["prototype"]["scalePosition2World"]=function(g6b,X6b,T6b){return W6b["scalePosition2World"](this["cubeInfo"],g6b,X6b,T6b);};W6b["scalePosition2World"]=function(a6b,J6b,Z6b,x6b){var t6b,O6b,o6b;t6b=a6b["west"]+J6b*(a6b["east"]-a6b["west"]);O6b=a6b["south"]+Z6b*(a6b["north"]-a6b["south"]);o6b=a6b["bottomHeight"]+x6b*(a6b["topHeight"]-a6b["bottomHeight"]);return{x:t6b,y:O6b,z:o6b};};W6b["scalePosition2WorldEx"]=function(v6b,d6b,c6b,j6b,e6b,i6b,h6b,w6b,u6b){var I6b,S6b,p6b;I6b=e6b+v6b*(j6b-e6b);S6b=i6b+d6b*(h6b-i6b);p6b=w6b+c6b*(u6b-w6b);return{x:I6b,y:S6b,z:p6b};};W6b["prototype"]["makeData"]=function(Q6b,q6b,b6b){var B6b,K6b,f6b,P6b,H9b,k9b,m9b,N6b;if(b6b===void 0){b6b=false;}this["materialList"]=[];this["geometryList"]=[];this["subMeshes"]=[];b6b=true;if(b6b){B6b=m6b["CmWorld3"]["getInstance"]();K6b=B6b["workerManager"]["getCubeGroupWorker"]();if(K6b){f6b=this;K6b["onmessage"]=function(y9b){var L9b,E9b,V9b;L9b=y9b["data"];switch(L9b["state"]){case W6b["ID_MakeCubeDataProcess"]:E9b=f6b["makeCubeDataFromRefinedBuffer"](L9b["msgpackBuffer"]);V9b=Q6b;V9b["cubeData"]=E9b;V9b["dataComplete"]=true;K6b["isWorking"]=false;break;case W6b["ID_Finish"]:K6b["isWorking"]=false;break;}};P6b={state:W6b["ID_MakeCubeDataProcess"],cmworld3BaseRoot:m6b["GlobalOption"]["cmworld3BaseRoot"],cubeInfo_east:this["cubeInfo"]["east"],cubeInfo_west:this["cubeInfo"]["west"],cubeInfo_south:this["cubeInfo"]["south"],cubeInfo_north:this["cubeInfo"]["north"],cubeInfo_bottomHeight:this["cubeInfo"]["bottomHeight"],cubeInfo_topHeight:this["cubeInfo"]["topHeight"],centerposition_x:this["cubeInfo"]["centerposition"]["x"],centerposition_y:this["cubeInfo"]["centerposition"]["y"],centerposition_z:this["cubeInfo"]["centerposition"]["z"],dataBuffer:q6b};K6b["postMessage"](P6b,[P6b["dataBuffer"]]);}else{}}else{H9b={cubeInfo_east:this["cubeInfo"]["east"],cubeInfo_west:this["cubeInfo"]["west"],cubeInfo_south:this["cubeInfo"]["south"],cubeInfo_north:this["cubeInfo"]["north"],cubeInfo_bottomHeight:this["cubeInfo"]["bottomHeight"],cubeInfo_topHeight:this["cubeInfo"]["topHeight"],centerposition_x:this["cubeInfo"]["centerposition"]["x"],centerposition_y:this["cubeInfo"]["centerposition"]["y"],centerposition_z:this["cubeInfo"]["centerposition"]["z"],dataBuffer:q6b,number:123,number2:-0.129,text:"Abc with Üñıçôðé and ユニコード",flag:true,list:[1,2,3],obj:{a:1,b:"2",c:false,d:{a:0,b:-1}},time:Date["now"]()};k9b=W6b["makeCubeDataProcess"](H9b);m9b=this["makeCubeDataFromRefinedBuffer"](k9b["msgpackBuffer"]);N6b=Q6b;N6b["cubeData"]=m9b;N6b["dataComplete"]=true;}};W6b["prototype"]["makeCubeDataFromRefinedBuffer"]=function(o9b){var W9b,t9b,a9b,T9b,D9b,l9b,X9b,r9b,R9b,x9b,Z9b,A9b,z9b,J9b,O9b,g9b,i9b,C9b,Y9b,s9b,F9b,U9b,M9b;if(o9b){W9b=msgpack["decode"](new Uint8Array(o9b));t9b=W9b["cube3DMaterialList"];a9b=W9b["g_list"];T9b=W9b["cube3DMeshList"];for(var G9b in t9b){D9b=t9b[G9b];if(D9b){l9b=new m6b["Cube3DMaterial"]();l9b["matNumber"]=D9b["matNumber"];l9b["matType"]=D9b["matType"];if(l9b["matType"]==0){l9b["matColor"]=new THREE["Color"](D9b["color"]);l9b["material"]=new THREE["MeshPhongMaterial"]({color:l9b["matColor"]});}else{l9b["textureName"]=D9b["textureName"];for(var n9b=1;n9b<this["materialList"]["length"];n9b++){if(this["materialList"][n9b]["textureName"]==l9b["textureName"]){l9b["material"]=this["materialList"][n9b]["material"];break;}}if(!l9b["material"]){X9b=new THREE["TextureLoader"]();r9b=this["parentLayer"]["mapInfo"]["serverURL"];r9b=r9b["replace"](/\x7b\u007a\u007d/gi,this["level"]["toString"]());r9b=r9b["replace"](/\u007b\u0078\u007d/gi,this["col"]["toString"]());r9b=r9b["replace"](/\x7b\x79\x7d/gi,this["row"]["toString"]());r9b=r9b["replace"](/\x7b\x66\u007d/gi,this["floor"]["toString"]());R9b=r9b["split"]('/');x9b=R9b[R9b["length"]-1];r9b=r9b["substring"](0,r9b["length"]-x9b["length"]);X9b["setPath"](r9b);Z9b=X9b["load"](l9b["textureName"]);l9b["material"]=new THREE["MeshPhongMaterial"]({map:Z9b});}}this["materialList"][l9b["matNumber"]]=l9b;}}for(var G9b in a9b){A9b=a9b[G9b];z9b=new m6b["Cube3DGeometry"]();z9b["geoNumber"]=A9b["geoNumber"];J9b=A9b["vertices"];O9b=A9b["normals"];g9b=A9b["UVs"];i9b=A9b["indices"];C9b=new THREE["BufferGeometry"]();C9b["addAttribute"]('position',new THREE["BufferAttribute"](J9b,3));if(O9b){C9b["addAttribute"]('normal',new THREE["BufferAttribute"](O9b,3));}if(g9b){C9b["addAttribute"]('uv',new THREE["BufferAttribute"](g9b,2));}if(i9b!=null){}C9b["computeVertexNormals"]();C9b["computeBoundingSphere"]();z9b["geometry"]=C9b;this["geometryList"][z9b["geoNumber"]]=z9b;}for(var G9b in T9b){Y9b=T9b[G9b];if(Y9b==null)continue;s9b=new m6b["Cube3DMesh"]();s9b["subPart"]=Y9b["subPart"];s9b["layerID"]=Y9b["layerID"];s9b["ID"]=Y9b["ID"];s9b["meshType"]=Y9b["meshType"];s9b["matNumber"]=Y9b["matNumber"];s9b["geoNumber"]=Y9b["geoNumber"];s9b["position"]=new THREE["Vector3"]();s9b["position"]["x"]=Y9b["position_x"];s9b["position"]["y"]=Y9b["position_y"];s9b["position"]["z"]=Y9b["position_z"];s9b["scale"]=new THREE["Vector3"]();s9b["scale"]["x"]=Y9b["scale_x"];s9b["scale"]["y"]=Y9b["scale_y"];s9b["scale"]["z"]=Y9b["scale_z"];s9b["rotation"]=new THREE["Vector3"]();s9b["rotation"]["x"]=Y9b["rotation_x"];s9b["rotation"]["y"]=Y9b["rotation_y"];s9b["rotation"]["z"]=Y9b["rotation_z"];s9b["positionGeo"]=new THREE["Vector3"]();s9b["positionGeo"]["x"]=Y9b["positionGeo_x"];s9b["positionGeo"]["y"]=Y9b["positionGeo_y"];s9b["positionGeo"]["z"]=Y9b["positionGeo_z"];F9b=null;if(s9b["meshType"]==0){if(this["geometryList"][s9b["geoNumber"]]&&this["materialList"][s9b["matNumber"]]){F9b=new THREE["Mesh"](this["geometryList"][s9b["geoNumber"]]["geometry"],this["materialList"][s9b["matNumber"]]["material"]);}}else if(s9b["meshType"]<0){if(this["materialList"][s9b["matNumber"]]){U9b=null;if(s9b["meshType"]==-1){U9b=new THREE["SphereBufferGeometry"](1);}else if(s9b["meshType"]==-2){U9b=new THREE["BoxBufferGeometry"](1,1,1);}else if(s9b["meshType"]==-3){U9b=new THREE["ConeBufferGeometry"]();}else if(s9b["meshType"]==-4){U9b=new THREE["CylinderBufferGeometry"]();}else if(s9b["meshType"]==-5){U9b=new THREE["PlaneBufferGeometry"](1,1);}else if(s9b["meshType"]==-6){U9b=new THREE["PlaneBufferGeometry"](1,1);}if(U9b!=null){F9b=new THREE["Mesh"](U9b,this["materialList"][s9b["matNumber"]]);}}}else{if(this["parentLayer"]["applicationMesh"][s9b["meshType"]]){F9b=this["parentLayer"]["applicationMesh"][s9b["meshType"]]["clone"]();if(this["parentLayer"]["applicationMesh"][s9b["meshType"]]["needrotate4Earth"]){F9b["needrotate4Earth"]=this["parentLayer"]["applicationMesh"][s9b["meshType"]]["needrotate4Earth"];}}else{F9b=new THREE["Mesh"](new THREE["SphereBufferGeometry"](1),new THREE["MeshBasicMaterial"]({color:0xffffff}));}}if(F9b!=null){F9b["scale"]["set"](s9b["scale"]["x"],s9b["scale"]["y"],s9b["scale"]["z"]);s9b["mesh"]=F9b;this["subMeshes"]["push"](s9b);}}M9b=new V6b();M9b["vertsion"]=W9b["version"];M9b["level"]=W9b["level"];M9b["row"]=W9b["row"];M9b["col"]=W9b["col"];M9b["floor"]=W9b["floor"];return M9b;}};W6b["makeCubeDataProcess"]=function(e9b){var y0b,b9b,P9b,N9b,k0b,p9b,v9b,Q9b,f9b,H0b,K9b,h9b,m0b,j9b,c9b,w9b,L0b,u9b,B9b,q9b,V0b,d9b,I9b,s0b,Y0b,E0b;y0b=e9b["dataBuffer"];k0b=[];p9b=new m6b["BinaryReader"](y0b,false);v9b={};k0b=p9b["readBytes"](2);v9b['version']=p9b["bin2String"](k0b);if(v9b['version']!="V0"&&v9b['version']!="v0")return null;v9b['level']=p9b["readByte"]();v9b['row']=p9b["readInt32"]();v9b['col']=p9b["readInt32"]();v9b['floor']=p9b["readInt32"]();v9b['materialCount']=p9b["readByte"]();v9b['geometryCount']=p9b["readInt16"]();v9b['meshCount']=p9b["readInt32"]();Q9b=[];f9b=[];H0b=[];while(p9b["eof"]()==false){K9b=String["fromCharCode"](p9b["readByte"]());if(K9b==='T'){h9b={};h9b['matNumber']=p9b["readInt16"]();h9b['matType']=p9b["readByte"]();if(h9b['matType']==0){h9b['color']=p9b["readInt32"]();}else{h9b['textureName']=p9b["readLongString"]();h9b['color']=1;}Q9b[h9b['matNumber']]=h9b;}else if(K9b==='G'){m0b=p9b["readInt16"]();j9b=p9b["readInt32"]();c9b=new Float32Array(j9b*3);for(var S9b=0;S9b<j9b;S9b++){b9b=p9b["readSingle"]();P9b=p9b["readSingle"]();N9b=p9b["readSingle"]();w9b=m6b["VectorCube3D"]["scalePosition2WorldEx"](b9b+0.5,P9b+0.5,N9b+0.5,e9b["cubeInfo_east"],e9b["cubeInfo_west"],e9b["cubeInfo_south"],e9b["cubeInfo_north"],e9b["cubeInfo_bottomHeight"],e9b["cubeInfo_topHeight"]);w9b=m6b["CmMathEngine"]["Geo2Cartesian"](w9b["x"],w9b["y"],w9b["z"]);c9b[S9b*3+0]=w9b["x"]-e9b["centerposition_x"];c9b[S9b*3+1]=w9b["y"]-e9b["centerposition_y"];c9b[S9b*3+2]=w9b["z"]-e9b["centerposition_z"];}L0b=p9b["readByte"]();u9b=null;if(L0b==1){u9b=new Float32Array(j9b*3);for(var S9b=0;S9b<j9b;S9b++){u9b[S9b*3+0]=p9b["readSingle"]();u9b[S9b*3+1]=p9b["readSingle"]();u9b[S9b*3+2]=p9b["readSingle"]();}}B9b=p9b["readInt32"]();q9b=null;if(B9b>0){q9b=new Uint32Array(B9b);for(var S9b=0;S9b<B9b;S9b++){q9b[S9b]=p9b["readUInt32"]();}}V0b=p9b["readByte"]();d9b=null;if(V0b==1){d9b=new Float32Array(j9b*2);for(var S9b=0;S9b<j9b;S9b++){d9b[S9b*2+0]=p9b["readSingle"]();d9b[S9b*2+1]=p9b["readSingle"]();}}f9b["push"]({geoNumber:m0b,vertices:c9b,normals:u9b,UVs:d9b,indices:q9b});}else if(K9b==='M'){I9b={};I9b['subPart']=p9b["readByte"]();I9b['layerID']=p9b["readInt32"]();I9b['ID']=p9b["readInt32"]();I9b['meshType']=p9b["readInt32"]();I9b['matNumber']=p9b["readInt16"]();I9b['geoNumber']=p9b["readInt16"]();b9b=p9b["readSingle"]();P9b=p9b["readSingle"]();N9b=p9b["readSingle"]();I9b['scale_x']=p9b["readSingle"]();I9b['scale_y']=p9b["readSingle"]();I9b['scale_z']=p9b["readSingle"]();I9b['rotation_x']=p9b["readSingle"]();I9b['rotation_y']=p9b["readSingle"]();I9b['rotation_z']=p9b["readSingle"]();w9b=m6b["VectorCube3D"]["scalePosition2WorldEx"](b9b,P9b,N9b,e9b["cubeInfo_east"],e9b["cubeInfo_west"],e9b["cubeInfo_south"],e9b["cubeInfo_north"],e9b["cubeInfo_bottomHeight"],e9b["cubeInfo_topHeight"]);I9b['positionGeo_x']=w9b["x"];I9b['positionGeo_y']=w9b["y"];I9b['positionGeo_z']=w9b["z"];w9b=m6b["CmMathEngine"]["Geo2Cartesian"](w9b["x"],w9b["y"],w9b["z"]);I9b['position_x']=w9b["x"];I9b['position_y']=w9b["y"];I9b['position_z']=w9b["z"];H0b["push"](I9b);}}s0b={cube3DMaterialList:Q9b,g_list:f9b,cube3DMeshList:H0b};Y0b=msgpack["encode"](s0b);E0b={version:v9b['version'],level:v9b['level'],row:v9b['row'],col:v9b['col'],floor:v9b['floor'],msgpackBuffer:Y0b["buffer"]};return E0b;};W6b["prototype"]["renderchild"]=function(l0b){};W6b["prototype"]["update"]=function(){var r0b,F0b,W0b;U6b["prototype"]["update"]["call"](this);r0b=this["cmworld3"];this["lastUpdateTime"]=r0b["option"]["renderFrameTime"];if(this["initialize"]()==false)return false;F0b=this["cubeInfo"]["getClosestDistanceFromCamera"]();W0b=r0b["option"]["displayDist4Level"][this["cubeInfo"]["level"]+1];this["render"]();return true;};function W6b(M6b,C6b){var G6b;G6b=U6b["call"](this,M6b,C6b)||this;G6b["cubeData"]=null;G6b["materialList"]=[];G6b["geometryList"]=[];G6b["subMeshes"]=[];return G6b;}W6b["prototype"]["render"]=function(){var U0b,G0b,C0b;U6b["prototype"]["render"]["call"](this);for(var M0b in this["subMeshes"]){U0b=this["subMeshes"][M0b];if(U0b&&U0b["mesh"]){G0b=new THREE["Vector3"](U0b["position"]["x"],U0b["position"]["y"],U0b["position"]["z"]);G0b["x"]-=this["cmworld3"]["option"]["refCenter"]["x"];G0b["y"]-=this["cmworld3"]["option"]["refCenter"]["y"];G0b["z"]-=this["cmworld3"]["option"]["refCenter"]["z"];U0b["mesh"]["position"]["set"](G0b["x"],G0b["y"],G0b["z"]);if(U0b["mesh"]["needrotate4Earth"]&&U0b["mesh"]["needrotate4Earth"]==true){m6b["CmWorld3"]["setRotate4Earth"](U0b["mesh"],U0b["positionGeo"]);}U0b["mesh"]["updateMatrix"]();C0b=this["cmworld3"]["getCube3DScene"]();C0b["add"](U0b["mesh"]);}}};return W6b;}(m6b["Cube3D"]);L6b["ID_MakeCubeDataProcess"]=1234;L6b["ID_Finish"]=1235;m6b["VectorCube3D"]=L6b;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var D0b;D0b=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(A0b,z0b){A0b["__proto__"]=z0b;}||function(g0b,R0b){for(var n0b in R0b)if(R0b["hasOwnProperty"](n0b))g0b[n0b]=R0b[n0b];};return function(T0b,X0b){D0b(T0b,X0b);T0b["prototype"]=X0b===null?Object["create"](X0b):(a0b["prototype"]=X0b["prototype"],new a0b());function a0b(){this["constructor"]=T0b;}};}();(function(t0b){var O0b;O0b=function(J0b){__extends(o0b,J0b);o0b["prototype"]["dispose"]=function(){J0b["prototype"]["dispose"]["call"](this);};o0b["prototype"]["clear"]=function(){J0b["prototype"]["clear"]["call"](this);};function o0b(x0b,i0b){var Z0b;Z0b=J0b["call"](this,x0b,i0b)||this;Z0b["dataBuffer"]=null;Z0b["cmworld"]=t0b["CmWorld3"]["getInstance"]();return Z0b;}o0b["prototype"]["makeMesh"]=function(p0b,S0b){return null;};o0b["prototype"]["makeData"]=function(e0b,w0b,I0b){if(I0b===void 0){I0b=false;}this["dataBuffer"]=w0b;this["dataComplete"]=true;};o0b["prototype"]["renderchild"]=function(v0b){};o0b["prototype"]["update"]=function(){J0b["prototype"]["update"]["call"](this);if(this["initialize"]()==false)return false;this["render"]();return true;};o0b["prototype"]["render"]=function(){J0b["prototype"]["render"]["call"](this);};return o0b;}(t0b["Cube3D"]);t0b["UndergroundClipCube3D"]=O0b;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var h0b;h0b=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(j0b,u0b){j0b["__proto__"]=u0b;}||function(K0b,d0b){for(var c0b in d0b)if(d0b["hasOwnProperty"](c0b))K0b[c0b]=d0b[c0b];};return function(N0b,b0b){h0b(N0b,b0b);N0b["prototype"]=b0b===null?Object["create"](b0b):(P0b["prototype"]=b0b["prototype"],new P0b());function P0b(){this["constructor"]=N0b;}};}();(function(B0b){var q0b,Q0b;q0b=function(){f0b["prototype"]["clear"]=function(){this["dataBlock"]=[];};function f0b(){this["dataBlock"]=[];}return f0b;}();B0b["VirtualCube3DData"]=q0b;Q0b=function(k7x){__extends(H7x,k7x);H7x["prototype"]["dispose"]=function(){this["cubeData"]=null;k7x["prototype"]["dispose"]["call"](this);};H7x["prototype"]["loadData"]=function(){this["dataReady"]=true;this["processData"](this);return true;};H7x["prototype"]["processData"]=function(y7x){var E7x;if(y7x["dataReady"]==true){E7x=y7x;E7x["makeData"](E7x,null,false);}return;};H7x["prototype"]["clear"]=function(){k7x["prototype"]["clear"]["call"](this);for(var s7x=B0b["Cube3DPositionType"]["LBF"];s7x<=B0b["Cube3DPositionType"]["RTB"];s7x++){if(this["childMesh"][s7x]!=null){this["childMesh"][s7x]=null;}}this["childMesh"]=[];};H7x["prototype"]["makeData"]=function(o7x,x7x,g7x){var n7x,Y7x,Z7x,r7x,G7x,M7x,C7x,U7x,F7x,D7x,W7x,l7x,J7x,A7x,T7x,R7x,a7x,t7x,O7x,X7x,z7x;if(g7x===void 0){g7x=false;}n7x=o7x;Y7x=this["cubeInfo"];Z7x=this["cubeInfo"]["centerposition"]["clone"]();r7x=B0b["CmMathEngine"]["Geo2Cartesian"](Y7x["east"],Y7x["south"],Y7x["topHeight"]);G7x=B0b["CmMathEngine"]["Geo2Cartesian"](Y7x["east"],Y7x["north"],Y7x["topHeight"]);M7x=B0b["CmMathEngine"]["Geo2Cartesian"](Y7x["east"],Y7x["south"],Y7x["bottomHeight"]);C7x=B0b["CmMathEngine"]["Geo2Cartesian"](Y7x["east"],Y7x["north"],Y7x["bottomHeight"]);U7x=B0b["CmMathEngine"]["Geo2Cartesian"](Y7x["west"],Y7x["north"],Y7x["topHeight"]);F7x=B0b["CmMathEngine"]["Geo2Cartesian"](Y7x["west"],Y7x["south"],Y7x["topHeight"]);D7x=B0b["CmMathEngine"]["Geo2Cartesian"](Y7x["west"],Y7x["north"],Y7x["bottomHeight"]);W7x=B0b["CmMathEngine"]["Geo2Cartesian"](Y7x["west"],Y7x["south"],Y7x["bottomHeight"]);l7x=Y7x["centerposition"];r7x["x"]-=l7x["x"];r7x["y"]-=l7x["y"];r7x["z"]-=l7x["z"];G7x["x"]-=l7x["x"];G7x["y"]-=l7x["y"];G7x["z"]-=l7x["z"];M7x["x"]-=l7x["x"];M7x["y"]-=l7x["y"];M7x["z"]-=l7x["z"];C7x["x"]-=l7x["x"];C7x["y"]-=l7x["y"];C7x["z"]-=l7x["z"];U7x["x"]-=l7x["x"];U7x["y"]-=l7x["y"];U7x["z"]-=l7x["z"];F7x["x"]-=l7x["x"];F7x["y"]-=l7x["y"];F7x["z"]-=l7x["z"];D7x["x"]-=l7x["x"];D7x["y"]-=l7x["y"];D7x["z"]-=l7x["z"];W7x["x"]-=l7x["x"];W7x["y"]-=l7x["y"];W7x["z"]-=l7x["z"];J7x=new THREE["BoxBufferGeometry"](1,1,1);A7x=new THREE["BufferGeometry"]();T7x=new Float32Array([r7x["x"],r7x["y"],r7x["z"],G7x["x"],G7x["y"],G7x["z"],M7x["x"],M7x["y"],M7x["z"],C7x["x"],C7x["y"],C7x["z"],U7x["x"],U7x["y"],U7x["z"],F7x["x"],F7x["y"],F7x["z"],D7x["x"],D7x["y"],D7x["z"],W7x["x"],W7x["y"],W7x["z"],U7x["x"],U7x["y"],U7x["z"],G7x["x"],G7x["y"],G7x["z"],F7x["x"],F7x["y"],F7x["z"],r7x["x"],r7x["y"],r7x["z"],W7x["x"],W7x["y"],W7x["z"],M7x["x"],M7x["y"],M7x["z"],D7x["x"],D7x["y"],D7x["z"],C7x["x"],C7x["y"],C7x["z"],F7x["x"],F7x["y"],F7x["z"],r7x["x"],r7x["y"],r7x["z"],W7x["x"],W7x["y"],W7x["z"],M7x["x"],M7x["y"],M7x["z"],G7x["x"],G7x["y"],G7x["z"],U7x["x"],U7x["y"],U7x["z"],C7x["x"],C7x["y"],C7x["z"],D7x["x"],D7x["y"],D7x["z"]]);R7x=[0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21];a7x=new Uint16Array(R7x);t7x=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);O7x=new Float32Array([0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0]);A7x["addAttribute"]('position',new THREE["BufferAttribute"](T7x,3));A7x["addAttribute"]('normal',new THREE["BufferAttribute"](t7x,3));A7x["addAttribute"]('uv',new THREE["BufferAttribute"](O7x,2));A7x["setIndex"](new THREE["BufferAttribute"](a7x,1));X7x=new THREE["MeshBasicMaterial"]({color:0xff0000});z7x=new THREE["Mesh"](A7x,X7x);z7x["frustumCulled"]=false;n7x["cubeMesh"]=z7x;if(this["parentLayer"]["cubeBeforeUpdate"]!=null){this["parentLayer"]["cubeBeforeUpdate"](this,this["cubeMesh"]);}n7x["dataComplete"]=true;};H7x["prototype"]["renderCubeMesh"]=function(){var p7x,I7x,i7x,S7x;if(this["cubeMesh"]!=null){p7x=this["cubeMesh"];I7x=Date["now"]()*0.001;i7x=this["cubeInfo"]["centerposition"]["clone"]();i7x["x"]-=this["cmworld3"]["option"]["refCenter"]["x"];i7x["y"]-=this["cmworld3"]["option"]["refCenter"]["y"];i7x["z"]-=this["cmworld3"]["option"]["refCenter"]["z"];p7x["position"]["set"](i7x["x"],i7x["y"],i7x["z"]);p7x["updateMatrix"]();B0b["Material"]["addClippingAttri"](p7x["material"]);S7x=this["cmworld3"]["getCube3DScene"]();S7x["add"](p7x);}};H7x["prototype"]["update"]=function(){var w7x,e7x,v7x;k7x["prototype"]["update"]["call"](this);w7x=this["cmworld3"];this["lastUpdateTime"]=w7x["option"]["renderFrameTime"];if(this["initialize"]()==false)return false;e7x=this["cubeInfo"]["getClosestDistanceFromCamera"]();v7x=w7x["option"]["displayDist4Level"][this["cubeInfo"]["level"]+1];this["render"]();return true;};H7x["prototype"]["render"]=function(){k7x["prototype"]["render"]["call"](this);if(this["parentLayer"]["cubeBeforeCubeRender"]!=null){this["parentLayer"]["cubeBeforeCubeRender"](this,this["cubeMesh"]);}this["renderCubeMesh"]();if(this["parentLayer"]["cubeAfterCubeRender"]!=null){this["parentLayer"]["cubeAfterCubeRender"](this,this["cubeMesh"]);}};function H7x(L7x,V7x){var m7x;m7x=k7x["call"](this,L7x,V7x)||this;m7x["cubeMesh"]=null;m7x["cubeData"]=null;return m7x;}return H7x;}(B0b["Cube3D"]);B0b["VirtualCube3D"]=Q0b;}(CMWORLD||(CMWORLD={})));(function(h7x){var j7x;j7x=function(){u7x["prototype"]["add"]=function(V3x,Y3x,l3x,m3x,f7x,L3x,E3x,y3x,s3x,H3x,k3x){var Q7x;if(k3x===void 0){k3x=null;}if(f7x["length"]<1)return;H3x=h7x["TiledMapInfo"]["purifyFileFormat"](H3x);Q7x=new h7x["TiledMapInfo"]();Q7x["serverURL"]=Y3x;Q7x["MinLevel"]=f7x[0];Q7x["MaxLevel"]=m3x;Q7x["dataLevels"]=f7x;Q7x["North"]=L3x;Q7x["South"]=E3x;Q7x["West"]=y3x;Q7x["East"]=s3x;Q7x["fileFormat"]=H3x;Q7x["visible"]=true;Q7x["dataSetName"]=l3x;Q7x["subLayerVisibleState"]=[];Q7x["styles"]=k3x;this["mapInfos"][V3x]=Q7x;};u7x["prototype"]["downloadCMVInfo"]=function(F3x){var r3x;r3x="";r3x+=F3x["serverURL"];r3x=r3x["replace"]("CmWorldServlet","DataSetUploadServlet");$["ajax"]({url:r3x,type:"POST",data:F3x["dataSetName"],crossDomain:true,success:function(W3x,U3x,G3x){},error:function(M3x,C3x,D3x){}});};u7x["prototype"]["getLayerVisible"]=function(z3x){var A3x;A3x=this["mapInfos"][z3x];if(A3x){return A3x["visible"];}return false;};u7x["prototype"]["setLayerVisible"]=function(R3x,g3x){var n3x;n3x=this["mapInfos"][R3x];if(n3x)n3x["visible"]=g3x;};u7x["prototype"]["setSubLayerVisible"]=function(T3x,a3x,t3x){var X3x;X3x=this["mapInfos"][T3x];if(X3x){X3x["subLayerVisibleState"][a3x]=t3x;}};u7x["prototype"]["getSubLayerVisible"]=function(o3x,J3x){var O3x;O3x=this["mapInfos"][o3x];if(O3x){if(O3x["subLayerVisibleState"][J3x]==false){return false;}}return true;};u7x["prototype"]["remove"]=function(Z3x){delete this["mapInfos"][Z3x];};function u7x(){this["mapInfos"]=new Array();this["processDownload"]=false;this["downloadRequestQueue"]=[];this["starttime"]=0;this["downloadOK"]=false;this["currArgs"]=null;this["cmworld3"]=h7x["CmWorld3"]["getInstance"]();this["requestDownload"]=function(c7x){if(c7x["url"]){{this["downloadRequestQueue"]["push"](c7x);}return true;}return false;};this["removeRequest"]=function(K7x){if(K7x){for(var d7x=0;d7x<this["downloadRequestQueue"]["length"];d7x++){if(this["downloadRequestQueue"][d7x]["url"]===K7x){this["downloadRequestQueue"]["splice"](d7x,1);return;}}}};this["isRequested"]=function(N7x){for(var b7x=0;b7x<this["downloadRequestQueue"]["length"];b7x++){if(this["downloadRequestQueue"][b7x]["url"]===N7x)return true;}return false;};this["downloadData"]=function(B7x){var P7x;this["currArgs"]=B7x;P7x=h7x["NetWork"]["createCORSRequest"]("GET",B7x["url"],true);P7x["owner"]=this;if(P7x){P7x["onload"]=function(){var q7x;if(this["owner"]){if(this["owner"]["currArgs"]){if(this["owner"]["currArgs"]["owner"]){q7x=P7x["response"];this["owner"]["currArgs"]["owner"]["startTask"](this["owner"]["currArgs"]["owner"],q7x);this["owner"]["downloadOK"]=true;this["owner"]["processDownload"]=false;return;}}}this["owner"]["downloadOK"]=false;this["owner"]["processDownload"]=false;};P7x["onerror"]=function(){};P7x["send"]();}};}u7x["prototype"]["setLayerStyle"]=function(i3x,p3x){var x3x;x3x=this["mapInfos"][i3x];if(x3x){x3x["styles"]=p3x;}};u7x["prototype"]["getLayerStyle"]=function(w3x){var S3x,I3x;S3x=this["mapInfos"][w3x];if(S3x){if(S3x["styles"]){return S3x["styles"];}}I3x=this["cmworld3"]["styleManager"]["getStyle"](w3x);if(I3x)return I3x;return null;};u7x["prototype"]["getTileURL"]=function(q3x,v3x,u3x,c3x){var P3x,B3x,N3x,Q3x,e3x,h3x,K3x,b3x,d3x;P3x=0;B3x=0;N3x=0;Q3x=0;if(v3x==-1||u3x==-1||c3x==-1){return"";}e3x=this["mapInfos"][q3x];if(!e3x)return"";if(v3x>=e3x["MinLevel"]&&v3x<=e3x["MaxLevel"]){for(var j3x=e3x["dataLevels"]["length"]-1;j3x>=0;j3x--){if(e3x["dataLevels"][j3x]==v3x){break;}else{if(e3x["dataLevels"][j3x]<v3x){u3x=Math["floor"](u3x/Math["pow"](2,v3x-e3x["dataLevels"][j3x]));c3x=Math["floor"](c3x/Math["pow"](2,v3x-e3x["dataLevels"][j3x]));v3x=e3x["dataLevels"][j3x];break;}else{}}}h3x=h7x["CmMathEngine"]["getBoundFromRowCol"](v3x,u3x,c3x);if(h3x["West"]>=e3x["West"]&&h3x["West"]<=e3x["East"]&&(h3x["East"]>=e3x["West"]&&h3x["East"]<=e3x["East"])&&(h3x["South"]>=e3x["South"]&&h3x["South"]<=e3x["North"])&&(h3x["North"]>=e3x["South"]&&h3x["North"]<=e3x["North"])){if(e3x["fileFormat"]==h7x["FileFormat"]["_cmv"]){K3x=h7x["TiledMapInfo"]["generateUrlParam"](e3x["dataSetName"],v3x,u3x,c3x);b3x=e3x["serverURL"]+K3x;return b3x;}else if(e3x["fileFormat"]==h7x["FileFormat"]["_json"]){d3x=h7x["VectorTile"]["generateWFSURL"](e3x,v3x,u3x,c3x);return d3x;}}}return"";};u7x["prototype"]["update"]=function(){var f3x;if(this["processDownload"]===false){if(this["currArgs"]){this["starttime"]=0;if(this["downloadOK"]){if(this["currArgs"]["ResultFunc"]){this["currArgs"]["ResultFunc"](this["currArgs"]["owner"]);}this["currArgs"]=null;}}if(this["downloadRequestQueue"]["length"]>0){this["starttime"]=Date["now"]();this["downloadOK"]=false;this["processDownload"]=true;this["downloadData"](this["downloadRequestQueue"]["shift"]());}}else{if(this["downloadOK"]){if(this["downloadRequestQueue"]["length"]>0){this["starttime"]=Date["now"]();this["downloadOK"]=false;this["processDownload"]=true;this["downloadData"](this["downloadRequestQueue"]["shift"]());}}else{if(this["starttime"]>0){f3x=Date["now"]()-this["starttime"];if(f3x>10000){this["starttime"]=0;this["processDownload"]=false;this["downloadOK"]=false;}}}return;}};return u7x;}();h7x["VectorImageMapManager"]=j7x;}(CMWORLD||(CMWORLD={})));CmCMVStyle=function(){H8x["prototype"]["save"]=function(L8x){if(L8x){L8x["save"]();}};function H8x(k8x,m8x){this["visible"]=true;this["name"]=k8x;this["visible"]=true;this["contextstyle"]=m8x;}H8x["prototype"]["restore"]=function(V8x){if(V8x){V8x["restore"]();}};H8x["prototype"]["setVisible"]=function(E8x){this["visible"]=E8x;};H8x["prototype"]["setStyle"]=function(s8x){if(s8x){if(this["contextstyle"]){for(var y8x in this["contextstyle"]){s8x[y8x]=this["contextstyle"][y8x];}}}};return H8x;}();__extends=this&&this["__extends"]||function(){var Y8x;Y8x=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(l8x,r8x){l8x["__proto__"]=r8x;}||function(U8x,W8x){for(var F8x in W8x)if(W8x["hasOwnProperty"](F8x))U8x[F8x]=W8x[F8x];};return function(M8x,G8x){Y8x(M8x,G8x);M8x["prototype"]=G8x===null?Object["create"](G8x):(C8x["prototype"]=G8x["prototype"],new C8x());function C8x(){this["constructor"]=M8x;}};}();(function(D8x){var A8x,z8x;A8x=function(){n8x["prototype"]["start"]=function(){this["updating"]=true;this["starttime"]=Date["now"]();};function n8x(){this["updating"]=false;this["mesh"]=null;this["distance"]=0;this["material"]=null;this["starttime"]=0;this["url"]=null;}n8x["prototype"]["finish"]=function(){this["mesh"]=null;this["updating"]=false;this["starttime"]=0;this["url"]=null;};return n8x;}();D8x["UpdateCandidateInfo"]=A8x;z8x=function(g8x){__extends(R8x,g8x);R8x["prototype"]["dispose"]=function(){g8x["prototype"]["dispose"]["call"](this);this["clear"]();if(D8x["Util"]["isDefined"](this["scene"])){this["parentScene"]()["remove"](this["scene"]);this["scene"]=null;}};R8x["prototype"]["parentScene"]=function(){return this["cmworld"]["getGroundScene"]();};R8x["prototype"]["setUseImageBillboard4PointMesh"]=function(o8x,J8x,O8x){var t8x,a8x;this["biilboardBaseHeight"]=O8x*0.5;t8x=document["createElement"]("img");a8x=this;t8x["onload"]=function(){var Z8x,x8x;if(D8x["Util"]["isDefined"](a8x)){Z8x=new THREE["Texture"](t8x);Z8x["needsUpdate"]=true;x8x=new THREE["MeshPhongMaterial"]({map:Z8x,specular:0,shininess:0,side:THREE["DoubleSide"],transparent:true});D8x["Material"]["addClippingAttri"](x8x);a8x["billboardMaterial"]=x8x;a8x["billboardGeometry"]=new THREE["PlaneGeometry"](J8x,O8x,10,10);a8x["useUserBillboard4PointMesh"]=true;}};t8x["src"]=o8x;};R8x["prototype"]["clear"]=function(){this["clearAllTile"]();this["m_tiles"]=new Array();this["cmworld"]["option"]["temp_JobTile"]=null;};R8x["prototype"]["getScene"]=function(){return this["scene"];};R8x["prototype"]["completeJob"]=function(){this["cmworld"]["option"]["temp_JobTile"]=null;};R8x["prototype"]["getOgcProtocolType"]=function(){if(D8x["Util"]["isDefined"](this["mapInfo"])){return this["mapInfo"]["ogcProtocol"];}return D8x["OGC_ProtocolType"]["None"];};function R8x(T8x){var X8x;X8x=g8x["call"](this)||this;X8x["useUserBillboard4PointMesh"]=false;X8x["useDirectPath"]=false;X8x["billboardMaterial"]=null;X8x["billboardGeometry"]=null;X8x["biilboardBaseHeight"]=0;X8x["reqTileNum"]=0;X8x["cmworld"]=D8x["CmWorld3"]["getInstance"]();X8x["reqTile"]=document["getElementById"]('reqtile');X8x["scene"]=new THREE["Scene"]();X8x["addObjectEvent"]=new D8x["Event"](D8x["CmWorld3"]["getInstance"]());X8x["name"]=T8x;X8x["parentScene"]()["add"](X8x["scene"]);return X8x;}R8x["prototype"]["getTileURL"]=function(S8x,I8x,w8x){var p8x,i8x,e8x;if(D8x["Util"]["isDefined"](this["isAlive"]())){if(this["mapInfo"]["checkTileIndexBoundary"](S8x,I8x,w8x)==false){return null;}p8x={level:S8x,row:I8x,col:w8x};if(p8x==null){return null;}i8x=null;if(this["mapInfo"]["ogcProtocol"]==D8x["OGC_ProtocolType"]["None"]){if(this["useDirectPath"]==true){i8x=this["mapInfo"]["serverURL"];i8x=i8x["replace"]("{T}",this["mapInfo"]["dataSetName"]);i8x=i8x["replace"](/\u007b\u007a\x7d/gi,p8x["level"]["toString"]());i8x=i8x["replace"](/\u007b\u0079\u007d/gi,p8x["row"]["toString"]());i8x=i8x["replace"](/\x7b\u0078\x7d/gi,p8x["col"]["toString"]());}else{e8x=D8x["TiledMapInfo"]["generateUrlParam"](this["mapInfo"]["dataSetName"],p8x["level"],p8x["row"],p8x["col"]);i8x=this["mapInfo"]["serverURL"]+e8x;}}else if(this["mapInfo"]["ogcProtocol"]==D8x["OGC_ProtocolType"]["WFS"]){i8x=D8x["VectorTile"]["generateWFSURL"](this["mapInfo"],S8x,I8x,w8x);}return i8x;}return null;};R8x["prototype"]["createTile"]=function(j8x,u8x,c8x){var h8x,v8x;if(D8x["Util"]["isDefined"](this["isAlive"]())==false)return;h8x=this["getTile"](j8x,u8x,c8x);if(h8x){return h8x;}v8x=new D8x["VectorTile"](this,j8x,u8x,c8x);v8x["parentLayer"]=this;v8x["serverURL"]=this["getMapInfo"]()["serverURL"];v8x["resourceURL"]=this["getMapInfo"]()["getCmResourceURL"]();this["addTile"](v8x);return v8x;};R8x["prototype"]["generateTile"]=function(N8x,K8x,b8x){var k4x,B8x,P8x,d8x,f8x,H4x,q8x,Q8x,L4x,m4x;if(D8x["Util"]["isDefined"](this["isAlive"]())==false)return;k4x=this["getTile"](N8x,K8x,b8x);if(k4x!=null){return;}B8x=D8x["Tile"]["getKeyString"](N8x,K8x,b8x);if(this["emptyTiles"][B8x])return;P8x=this["getTileURL"](N8x,K8x,b8x);if(P8x==null){this["addEmptyTile"](B8x);return;}if(this["cmworld"]["downloadManager"]["isRequested"](P8x)){return;}{d8x=this;f8x=this["cmworld"];H4x=D8x["Tile"]["getBoundary"](N8x,K8x,b8x);q8x=H4x["getCenter"]();Q8x=D8x["CmMathEngine"]["Geo2Cartesian"](q8x["x"],q8x["y"],D8x["cm_const"]["EarthRadius"]);Q8x["sub"](f8x["getCamera"]()["getPositionWorld"]());L4x={level:N8x,row:K8x,col:b8x};m4x=this["getMapInfo"]()["fileFormat"];this["cmworld"]["downloadManager"]["requestDownload"](P8x,m4x,Q8x["length"](),L4x,function(V4x){var y4x,s4x,Y4x,E4x,l4x,r4x,F4x,W4x;if(V4x["response"]){y4x=V4x["tag"]["level"];s4x=V4x["tag"]["row"];Y4x=V4x["tag"]["col"];if(d8x["isAlive"]()){E4x=new D8x["VectorTile"](d8x,y4x,s4x,Y4x);E4x["parentLayer"]=d8x;E4x["serverURL"]=d8x["getMapInfo"]()["serverURL"];E4x["resourceURL"]=d8x["getMapInfo"]()["getCmResourceURL"]();if(E4x["load"](V4x["response"],V4x["format"])){d8x["addTile"](E4x);return;}}}l4x=V4x["tag"]["level"];r4x=V4x["tag"]["row"];F4x=V4x["tag"]["col"];W4x=D8x["Tile"]["getKeyString"](l4x,r4x,F4x);d8x["addEmptyTile"](W4x);});}};R8x["prototype"]["clearAllTile"]=function(){g8x["prototype"]["clearAllTile"]["call"](this);this["reqTileNum"]=0;if(this["reqTile"]!=null){this["reqTile"]["title"]=this["reqTileNum"]["toString"]();}};R8x["prototype"]["queryNearTiles"]=function(U4x,G4x){};R8x["prototype"]["isOutOfFarRange"]=function(){var M4x,C4x;M4x=this["cmworld"];C4x=M4x["getCamera"]()["getAltitude"]();if(C4x>M4x["option"]["getDislayDist4Level"](this["mapInfo"]["MinLevel"]-2)){return true;}return false;};R8x["prototype"]["update"]=function(){var z4x,O4x,t4x,R4x,D4x,X4x,a4x,T4x;if(D8x["Util"]["isDefined"](this["isAlive"]())==false)return;this["getScene"]()["visible"]=this["visible"];if(this["visible"]==false)return;z4x=this["cmworld"];O4x=z4x["getCamera"]()["getAltitude"]();if(this["isOutOfFarRange"]()){this["clearAllTile"]();return;}t4x=z4x["getCamera"]()["getPositionGeo"]()["clone"]();R4x=0;for(var A4x in this["m_tiles"]){for(var n4x in this["m_tiles"][A4x]){for(var g4x in this["m_tiles"][A4x][n4x]){D4x=this["m_tiles"][A4x][n4x][g4x];if(D4x!=null&&D4x["disposed"]==false){X4x=D4x["getWorldPos"]();a4x=z4x["getCamera"]()["getDistanceToWorldPos"](X4x);{T4x=D4x["level"]-2;if(a4x>z4x["option"]["getDislayDist4Level"](T4x)){D4x["dispose"]();delete this["m_tiles"][A4x][n4x][g4x];continue;}}R4x++;D4x["update"]();}}}}if(this["useUserBillboard4PointMesh"]==true){}else{this["reqTileNum"]=R4x;{if(D8x["VectorTileLayer"]["updateTextureCandidate"]["mesh"]!=null){D8x["VectorTileLayer"]["updateTextureCandidate"]["mesh"]["updateTexture"](D8x["VectorTileLayer"]["updateTextureCandidate"]["material"],D8x["VectorTileLayer"]["updateTextureCandidate"]["url"]);D8x["VectorTileLayer"]["updateTextureCandidate"]["mesh"]=null;}}}};R8x["requestUpdateMesh"]=function(J4x,Z4x){var o4x;o4x=D8x["CmWorld3"]["getInstance"]();o4x["modelLoadManager"]["requestGenMesh"](J4x,Z4x);};R8x["requestTextureUpdate"]=function(i4x,p4x,x4x,S4x){if(D8x["VectorTileLayer"]["updateTextureCandidate"]["mesh"]!=null){if(D8x["VectorTileLayer"]["updateTextureCandidate"]["distance"]>x4x){D8x["VectorTileLayer"]["updateTextureCandidate"]["mesh"]=i4x;D8x["VectorTileLayer"]["updateTextureCandidate"]["material"]=p4x;D8x["VectorTileLayer"]["updateTextureCandidate"]["distance"]=x4x;D8x["VectorTileLayer"]["updateTextureCandidate"]["url"]=S4x;}}else{D8x["VectorTileLayer"]["updateTextureCandidate"]["mesh"]=i4x;D8x["VectorTileLayer"]["updateTextureCandidate"]["material"]=p4x;D8x["VectorTileLayer"]["updateTextureCandidate"]["distance"]=x4x;D8x["VectorTileLayer"]["updateTextureCandidate"]["url"]=S4x;}};return R8x;}(D8x["TileLayer"]);z8x["updateTextureCandidate"]=new A8x();D8x["VectorTileLayer"]=z8x;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var I4x;I4x=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(w4x,e4x){w4x["__proto__"]=e4x;}||function(j4x,h4x){for(var v4x in h4x)if(h4x["hasOwnProperty"](v4x))j4x[v4x]=h4x[v4x];};return function(c4x,u4x){function d4x(){this["constructor"]=c4x;}I4x(c4x,u4x);c4x["prototype"]=u4x===null?Object["create"](u4x):(d4x["prototype"]=u4x["prototype"],new d4x());};}();(function(K4x){var b4x;b4x=function(P4x){__extends(N4x,P4x);N4x["prototype"]["init"]=function(Q4x){if(K4x["Util"]["isDefined"](Q4x)){this["mapInfo"]=Q4x;K4x["CmWorld3"]["getInstance"]()["option"]["vectorImageLayerManager"]["add"](Q4x["name"],Q4x["serverURL"],Q4x["dataSetName"],Q4x["MaxLevel"],Q4x["dataLevels"],Q4x["North"],Q4x["South"],Q4x["West"],Q4x["East"],Q4x["fileFormat"]);this["initPOILayer"]();}};function N4x(q4x){var B4x;B4x=P4x["call"](this)||this;B4x["name"]=q4x;return B4x;}N4x["prototype"]["initPOILayer"]=function(){};N4x["prototype"]["getTileURL"]=function(f4x,H2x,k2x){return K4x["CmWorld3"]["getInstance"]()["option"]["vectorImageLayerManager"]["getTileURL"](this["mapInfo"]["name"],f4x,H2x,k2x);};N4x["prototype"]["update"]=function(){};return N4x;}(K4x["TileLayer"]);K4x["VectorImageTileLayer"]=b4x;}(CMWORLD||(CMWORLD={})));cm_cmvGeometry=function(){m2x["prototype"]["draw"]=function(L2x){};function m2x(){this["uid"]=m2x["GeometryUniqID"]++;this["id"]=this["uid"];this["name"]=null;this["label"]=null;this["renderFrameID"]=-1;this["lastShowTime"]=-1;}return m2x;}();cm_cmvGeometry["GeometryUniqID"]=100;__extends=this&&this["__extends"]||function(){var V2x;V2x=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(E2x,y2x){E2x["__proto__"]=y2x;}||function(l2x,Y2x){for(var s2x in Y2x)if(Y2x["hasOwnProperty"](s2x))l2x[s2x]=Y2x[s2x];};return function(F2x,r2x){V2x(F2x,r2x);F2x["prototype"]=r2x===null?Object["create"](r2x):(W2x["prototype"]=r2x["prototype"],new W2x());function W2x(){this["constructor"]=F2x;}};}();cm_Line2D=function(U2x){function G2x(){var M2x;M2x=U2x["call"](this)||this;M2x["Points"]=[];return M2x;}__extends(G2x,U2x);return G2x;}(cm_cmvGeometry);__extends=this&&this["__extends"]||function(){var C2x;C2x=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(D2x,A2x){D2x["__proto__"]=A2x;}||function(R2x,n2x){for(var z2x in n2x)if(n2x["hasOwnProperty"](z2x))R2x[z2x]=n2x[z2x];};return function(X2x,g2x){C2x(X2x,g2x);X2x["prototype"]=g2x===null?Object["create"](g2x):(T2x["prototype"]=g2x["prototype"],new T2x());function T2x(){this["constructor"]=X2x;}};}();cm_Line3D=function(a2x){function t2x(){var O2x;O2x=a2x["call"](this)||this;O2x["LineWidth"]=0;O2x["Points"]=[];return O2x;}__extends(t2x,a2x);return t2x;}(cm_cmvGeometry);__extends=this&&this["__extends"]||function(){var o2x;o2x=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(J2x,Z2x){J2x["__proto__"]=Z2x;}||function(p2x,i2x){for(var x2x in i2x)if(i2x["hasOwnProperty"](x2x))p2x[x2x]=i2x[x2x];};return function(I2x,S2x){o2x(I2x,S2x);I2x["prototype"]=S2x===null?Object["create"](S2x):(w2x["prototype"]=S2x["prototype"],new w2x());function w2x(){this["constructor"]=I2x;}};}();(function(e2x){var h2x,j2x,v2x;h2x=function(){u2x["prototype"]["isShowTime"]=function(){var c2x;c2x=Math["ceil"](this["continueTime"]/this["flashTime"]);if(c2x%2){return true;}return false;};function u2x(){this["strokeStyle"]="#FF0000";this["lineWidth"]=5;this["continueTime"]=3000;this["flashTime"]=300;this["boundaryType"]=e2x["BoundaryType"]["rectangle"];}return u2x;}();e2x["FlashBoundary2D"]=h2x;j2x=function(d2x){function K2x(){var b2x;b2x=d2x["call"](this)||this;console["warn"]("FlashRect2D는 더이상 사용하지 않습니다. FlashBoundary2D 를 사용하세요");return b2x;}__extends(K2x,d2x);return K2x;}(h2x);e2x["FlashRect2D"]=j2x;v2x=function(P2x){__extends(N2x,P2x);N2x["prototype"]["dispose"]=function(){this["clear"]();};N2x["prototype"]["setFlashBoundary"]=function(f2x){var Q2x;Q2x=this;Q2x["flashBoundary"]=f2x;};N2x["prototype"]["setUserDraw"]=function(H1x){var k1x;if(H1x===void 0){H1x=null;}k1x=this;k1x["userDraw"]=H1x;};N2x["prototype"]["getUserDraw"]=function(){var m1x;m1x=this;return m1x["userDraw"];};N2x["prototype"]["setUpdateCallback"]=function(L1x){this["updateEvent"]["addEventListener"](L1x,null);};N2x["prototype"]["setPosition"]=function(V1x,E1x,y1x){this["position"]["x"]=V1x;this["position"]["y"]=E1x;this["position"]["z"]=y1x;this["position3d"]=e2x["CmMathEngine"]["Geo2Cartesian"](V1x,E1x,e2x["cm_const"]["EarthRadius"]+y1x);};N2x["prototype"]["clear"]=function(){this["Requested"]=false;};N2x["addImagebyURL"]=function(l1x,r1x,s1x){var Y1x;if(s1x===void 0){s1x=null;}Y1x=new THREE["ImageLoader"]();Y1x["load"](l1x,function(F1x){e2x["POI3D"]["addImage"](F1x,r1x);if(s1x){s1x({success:true});}},function(W1x){},function(U1x){console["log"]('An error happened');if(s1x){s1x({success:false});}});};N2x["addImage"]=function(G1x,M1x){if(G1x){if(typeof G1x=="string"){e2x["POI3D"]["addImagebyURL"](G1x,M1x);}else{e2x["POI3D"]["imageArray"][M1x]=G1x;}}};N2x["getImageKey"]=function(C1x){return Object["keys"](e2x["POI3D"]["imageArray"])[C1x];};N2x["getImage"]=function(D1x){return e2x["POI3D"]["imageArray"][D1x];};N2x["prototype"]["getWorldPos"]=function(){if(this["position3d"]==null){return;}return this["position3d"]["clone"]();};N2x["prototype"]["isShow"]=function(){var A1x,z1x,n1x,R1x;A1x=this["cmworld3Viewer"];z1x=this["getWorldPos"]();z1x["sub"](A1x["option"]["refCenter"]);n1x=20;R1x=new THREE["Sphere"](z1x,n1x);if(A1x["cameraFrustum"]["intersectsSphere"](R1x)){return true;}return false;};N2x["prototype"]["update"]=function(){var g1x,X1x;g1x=this["cmworld3Viewer"];if(this["updateEvent"]["numberOfListeners"]>0){this["updateEvent"]["raiseEvent"]({self:this,cmworld3Viewer:g1x});}X1x=g1x["getCamera"]()["getDistanceToWorldPos"](this["getWorldPos"]());if(X1x<this["limitedDistance"]){this["render"](X1x);}};N2x["prototype"]["makeColorMaterialFromColor"]=function(T1x){var a1x;if(!T1x){T1x=0x0f0f0f;}a1x=new THREE["MeshPhongMaterial"]({color:T1x,specular:0,shininess:1});e2x["Material"]["addClippingAttri"](a1x);return a1x;};N2x["prototype"]["render"]=function(O1x){var o1x,t1x;if(this["cmworld3Viewer"]["isRenderingFrame"]==false)return;if(this["renderFrameID"]==this["cmworld3Viewer"]["option"]["renderFrameID"])return;this["renderFrameID"]=this["cmworld3Viewer"]["option"]["renderFrameID"];this["drawnRect"]["makeEmpty"]();if(O1x>this["limitedDistance"]){return;}else{o1x=this["getWorldPos"]();{t1x=this["cmworld3Viewer"]["toScreenCoord"](o1x);if(t1x){this["screenPos"]=new THREE["Vector3"](Math["round"](t1x["x"]),Math["round"](t1x["y"]),O1x);this["lastShowTime"]=this["cmworld3Viewer"]["option"]["renderFrameTime"];this["cmworld3Viewer"]["requestRenderingPOI3D"](this);}}}};function N2x(q2x){var B2x;if(q2x===void 0){q2x=null;}B2x=P2x["call"](this)||this;B2x["parentLayer"]=null;B2x["imgKey"]=null;B2x["fontColor"]=null;B2x["position"]=new THREE["Vector3"]();B2x["position3d"]=null;B2x["limitedDistance"]=100000000;B2x["Requested"]=false;B2x["screenPos"]=new THREE["Vector3"](0,0,0);B2x["strokeText"]=false;B2x["cmworld3Viewer"]=e2x["CmWorld3"]["getInstance"]();B2x["drawnRect"]=new e2x["Rectangle"]();B2x["updateEvent"]=new e2x["Event"](null);B2x["rotateImage"]=0;B2x["name"]=B2x["uid"]["toString"]();B2x["label"]=q2x;return B2x;}N2x["prototype"]["innerRender"]=function(){var u1x,J1x,Z1x,x1x,i1x,p1x,h1x,v1x,I1x,w1x,e1x,S1x,c1x,j1x;u1x=this["cmworld3Viewer"];J1x=u1x["getScreenLayerCanvasContext"]();J1x["save"]();Z1x=this;try{if(Z1x["userDraw"]){Z1x["userDraw"](this,J1x,this["screenPos"]["x"],this["screenPos"]["y"]);}else{x1x=null;i1x=0;p1x=0;if(this["imgKey"]){x1x=e2x["POI3D"]["getImage"](this["imgKey"]);if(x1x){i1x=Math["round"](x1x["width"]/2);p1x=Math["round"](x1x["height"]/2);this["drawnRect"]["x"]=this["screenPos"]["x"]-i1x;this["drawnRect"]["y"]=this["screenPos"]["y"]-p1x;this["drawnRect"]["width"]=x1x["width"];this["drawnRect"]["height"]=x1x["height"];if(this["rotateImage"]==0){J1x["drawImage"](x1x,this["drawnRect"]["x"],this["drawnRect"]["y"]);if(e2x["Util"]["isDefined"](Z1x["flashBoundary"])){this["drawFlashBoundary"](J1x,Z1x["flashBoundary"],this["drawnRect"]);}}else{J1x["save"]();try{J1x["translate"](this["screenPos"]["x"],this["screenPos"]["y"]);J1x["rotate"](this["rotateImage"]*Math["PI"]/180);J1x["drawImage"](x1x,-i1x,-p1x);if(e2x["Util"]["isDefined"](Z1x["flashBoundary"])){h1x=new e2x["Rectangle"]();h1x["setRange"](-i1x,-p1x,i1x*2,p1x*2);this["drawFlashBoundary"](J1x,Z1x["flashBoundary"],h1x);}}catch(d1x){console["error"](d1x);}J1x["restore"]();}}}if(this["label"]){if(this["fontColor"]){J1x["fillStyle"]=this["fontColor"];}v1x=e2x["POITextPosition"]["right"];if(x1x){J1x["textAlign"]="left";if(e2x["Util"]["isDefined"](this['poiTextPosition'])){v1x=this['poiTextPosition'];}}else{J1x["textAlign"]="center";}e1x=parseInt(J1x["font"]);if(v1x==e2x["POITextPosition"]["top"]){I1x=this["screenPos"]["x"];w1x=this["screenPos"]["y"]-e1x;J1x["textAlign"]="center";}else if(v1x==e2x["POITextPosition"]["bottom"]){I1x=this["screenPos"]["x"];w1x=this["screenPos"]["y"]+e1x;J1x["textAlign"]="center";}else{I1x=this["screenPos"]["x"]+i1x+1;w1x=this["screenPos"]["y"];}S1x=new e2x["Rectangle"]();c1x=J1x["measureText"](this["label"]);S1x["x"]=I1x;S1x["y"]=w1x;S1x["width"]=c1x["width"];S1x["height"]=e1x;this["drawnRect"]=e2x["Rectangle"]["union"](this["drawnRect"],S1x);if(this["strokeText"]){J1x["strokeText"](this["label"],I1x,w1x);}else{J1x["fillText"](this["label"],I1x,w1x);}}}}catch(K1x){console["error"](K1x);}J1x["restore"]();if(e2x["Util"]["isDefined"](Z1x["flashBoundary"])){j1x=Z1x["flashBoundary"];j1x["continueTime"]-=this["cmworld3Viewer"]["getFrameElapsedTime"]();if(j1x["continueTime"]<0.01){Z1x["flashBoundary"]=null;}}};N2x["prototype"]["drawFlashBoundary"]=function(N1x,P1x,b1x){var B1x,q1x,Q1x;if(P1x["isShowTime"]()){N1x["strokeStyle"]=P1x["strokeStyle"];N1x["lineWidth"]=P1x["lineWidth"];if(P1x["boundaryType"]==e2x["BoundaryType"]["circle"]){B1x=Math["sqrt"](Math["pow"](b1x["width"]/2,2)+Math["pow"](b1x["width"]/2,2));q1x=b1x["x"]+b1x["width"]/2;Q1x=b1x["y"]+b1x["height"]/2;N1x["beginPath"]();N1x["arc"](q1x,Q1x,B1x,0,2*Math["PI"],false);N1x["stroke"]();}else{N1x["strokeRect"](b1x["x"],b1x["y"],b1x["width"],b1x["height"]);}}};return N2x;}(cm_cmvGeometry);v2x["deleteMeshTime"]=30*1000;v2x["imageArray"]=new Array();e2x["POI3D"]=v2x;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var f1x;f1x=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(H5x,k5x){H5x["__proto__"]=k5x;}||function(V5x,L5x){for(var m5x in L5x)if(L5x["hasOwnProperty"](m5x))V5x[m5x]=L5x[m5x];};return function(y5x,E5x){f1x(y5x,E5x);y5x["prototype"]=E5x===null?Object["create"](E5x):(s5x["prototype"]=E5x["prototype"],new s5x());function s5x(){this["constructor"]=y5x;}};}();cm_Surface2D=function(Y5x){function l5x(){var r5x;r5x=Y5x["call"](this)||this;r5x["LineWidth"]=0;r5x["HoleCount"]=0;r5x["Holes"]=[];r5x["Points"]=[];return r5x;}__extends(l5x,Y5x);return l5x;}(cm_cmvGeometry);__extends=this&&this["__extends"]||function(){var F5x;F5x=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(W5x,U5x){W5x["__proto__"]=U5x;}||function(C5x,M5x){for(var G5x in M5x)if(M5x["hasOwnProperty"](G5x))C5x[G5x]=M5x[G5x];};return function(A5x,D5x){F5x(A5x,D5x);A5x["prototype"]=D5x===null?Object["create"](D5x):(z5x["prototype"]=D5x["prototype"],new z5x());function z5x(){this["constructor"]=A5x;}};}();cm_Surface3D=function(n5x){function R5x(){var g5x;g5x=n5x["call"](this)||this;g5x["LineWidth"]=0;g5x["HoleCount"]=0;g5x["Holes"]=[];g5x["Points"]=[];return g5x;}__extends(R5x,n5x);return R5x;}(cm_cmvGeometry);__extends=this&&this["__extends"]||function(){var X5x;X5x=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(T5x,a5x){T5x["__proto__"]=a5x;}||function(o5x,O5x){for(var t5x in O5x)if(O5x["hasOwnProperty"](t5x))o5x[t5x]=O5x[t5x];};return function(Z5x,J5x){X5x(Z5x,J5x);Z5x["prototype"]=J5x===null?Object["create"](J5x):(x5x["prototype"]=J5x["prototype"],new x5x());function x5x(){this["constructor"]=Z5x;}};}();(function(i5x){var p5x;p5x=function(I5x){__extends(S5x,I5x);S5x["prototype"]["dispose"]=function(){this["releaseMesh"]();};S5x["prototype"]["setModelFileBuffer"]=function(e5x){if(i5x["Util"]["isDefined"](e5x)){if(e5x["byteLength"]>0){this["modelDataBuffer"]=e5x;}else{this["modelDataBuffer"]=null;this["modelFileNotExist"]=true;}}this["requestedFile"]=false;};S5x["getTexLevel"]=function(j5x,h5x){var v5x;v5x=j5x;if(h5x<40){if(v5x>100)return 0;if(v5x>60)return 1;if(v5x>30)return 2;if(v5x>20)return 3;if(v5x>10)return 4;if(v5x>5)return 5;return 6;}else if(h5x<80){if(v5x>200)return 0;if(v5x>140)return 1;if(v5x>100)return 2;if(v5x>70)return 3;if(v5x>40)return 4;if(v5x>20)return 5;return 6;}if(v5x>400)return 0;if(v5x>250)return 1;if(v5x>150)return 2;if(v5x>100)return 3;if(v5x>50)return 4;if(v5x>10)return 5;return 6;};S5x["prototype"]["setShowMesh"]=function(u5x){if(this["meshObject"]!=null){this["meshObject"]["visible"]=u5x;}};S5x["prototype"]["releaseMesh"]=function(){if(this["meshObject"]!=null){this["setShowMesh"](false);this["parentTile"]["removeAtScene"](this["meshObject"]);this["cmworld"]["requestDispose"](this["meshObject"]);this["meshObject"]=null;}this["completeModel"]=false;this["requestedFile"]=false;};S5x["prototype"]["getWorldPos"]=function(){if(this["worldPosition"]==null){this["worldPosition"]=i5x["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],i5x["cm_const"]["EarthRadius"]+this["positionGeo"]["z"]+this["userbaseHeight"]);}return this["worldPosition"]["clone"]();};S5x["prototype"]["isShow"]=function(){var c5x,K5x,d5x,b5x;c5x=this["getWorldPos"]();K5x=this["cmworld"]["getCamera"]()["getDistanceToWorldPos"](c5x);if(K5x>this["limitedDistance"]){return false;}c5x["sub"](this["cmworld"]["option"]["refCenter"]);d5x=10;if(this["meshObject"]!=null){d5x=this["meshObject"]["geometry"]["boundingSphere"]["radius"];}b5x=new THREE["Sphere"](c5x,d5x);if(this["cmworld"]["cameraFrustum"]["intersectsSphere"](b5x)){return true;}return false;};S5x["prototype"]["MakeBillboardMesh"]=function(B5x,q5x,Q5x){var P5x,N5x;P5x=new THREE["Mesh"](B5x,q5x);this["useUserModel"]=true;this["userbaseHeight"]=Q5x;N5x=[];N5x["push"](P5x);this["setMesh"](N5x);};S5x["prototype"]["checkSelfMemory"]=function(){if(i5x["Util"]["isDefined"](this["meshObject"])){if(this["cmworld"]["option"]["renderFrameTime"]-this["lastShowTime"]>S5x["deleteMeshTime"]){this["releaseMesh"]();}}};S5x["prototype"]["getModelUrl"]=function(){var f5x;if(i5x["Util"]["isDefined"](this["modelURL"]))return this["modelURL"];f5x=this["parentTile"]["resourceURL"]+"&FileName=";this["modelURL"]=f5x+this["resourceName"];return this["modelURL"];};S5x["prototype"]["update"]=function(){var m6x,H6x,k6x,L6x;this["setShowMesh"](false);if(this["isShow"]()){m6x=this["cmworld"];H6x=m6x["getCamera"]()["getDistanceToWorldPos"](this["getWorldPos"]());if(H6x<this["limitedDistance"]){if(this["meshObject"]==null){if(this["modelDataBuffer"]!=null){i5x["VectorTileLayer"]["requestUpdateMesh"](this,H6x);}else if(this["requestedFile"]==false){k6x=this;this["cmworld"]["downloadManager"]["requestModelDownload"](this["getModelUrl"](),i5x["FileFormat"]["_3ds"],H6x,function(V6x){if(V6x["response"]!=null){if(V6x["url"]==k6x["getModelUrl"]()){k6x["setModelFileBuffer"](V6x["response"]);}else{console["warn"]("warning:modelurl is "+V6x["url"]);}}else{k6x["modelFileNotExist"]=true;}});}}else{L6x=this["getWorldPos"]()["add"](this["meshObject"]["geometry"]["boundingSphere"]["center"]);H6x=m6x["getCamera"]()["getDistanceToWorldPos"](L6x);H6x-=this["meshObject"]["geometry"]["boundingSphere"]["radius"];this["render"](H6x);}}}};function S5x(){var w5x;w5x=I5x["call"](this)||this;w5x["positionGeo"]=new THREE["Vector3"](0,0,0);w5x["meshScale"]=null;w5x["direction"]=null;w5x["worldPosition"]=null;w5x["meshObject"]=null;w5x["limitedDistance"]=S5x["maxLimitedDistance"];w5x["updatingTexture"]=false;w5x["requestedTexture_time"]=0;w5x["textureChanged_time"]=0;w5x["imageFileNotExist"]=false;w5x["requestedFile"]=false;w5x["modelFileNotExist"]=false;w5x["modelDataBuffer"]=null;w5x["modelURL"]=null;w5x["completeModel"]=false;w5x["cmworld"]=i5x["CmWorld3"]["getInstance"]();w5x["userbaseHeight"]=0;w5x["useUserModel"]=false;w5x["lastShowTime"]=w5x["cmworld"]["option"]["renderFrameTime"];return w5x;}S5x["prototype"]["genWorkerParam"]=function(){var E6x,y6x,s6x;E6x=this["modelDataBuffer"];if(i5x["Util"]["isDefined"](E6x)==false){return null;}y6x=this["parentTile"]["resourceURL"]+"&FileName=";s6x={owner:this,url:this["modelURL"],fileName:this["resourceName"],fileFormat:i5x["FileFormat"]["_3ds"],resourceurl:y6x,arraybuffer:E6x};return s6x;};S5x["prototype"]["makeTextureMaterialFromImage"]=function(r6x){var Y6x,l6x;Y6x=new THREE["Texture"](r6x);Y6x["needsUpdate"]=true;l6x=new THREE["MeshPhongMaterial"]({map:Y6x,specular:0,shininess:0,shading:THREE["SmoothShading"],side:THREE["FrontSide"]});i5x["Material"]["addClippingAttri"](l6x);return l6x;};S5x["prototype"]["makeColorMaterialFromColor"]=function(F6x){var W6x;if(!F6x){F6x=0x0f0f0f;}W6x=new THREE["MeshPhongMaterial"]({color:F6x,specular:0,shininess:1,side:THREE["DoubleSide"]});i5x["Material"]["addClippingAttri"](W6x);return W6x;};S5x["prototype"]["setMesh"]=function(G6x){var U6x,M6x,D6x,C6x,R6x,A6x,z6x,n6x;if(i5x["Util"]["isDefined"](G6x)==false){return;}this["modelDataBuffer"]=null;U6x=null;if(G6x instanceof THREE["Mesh"])U6x=G6x;else{if(G6x["length"]<1)return;U6x=G6x[0];}if(U6x==null){return;}this["completeModel"]=false;M6x=this["cmworld"]["getGroundHeight"](this["positionGeo"]["x"],this["positionGeo"]["y"]);if(M6x<-9000){console["warn"]("PointMesh:getGroundHeight 에서 높이를 구하지 못했다.");M6x=0;}D6x=this["cmworld"];this["worldPosition"]=i5x["CmMathEngine"]["Geo2Cartesian"](this["positionGeo"]["x"],this["positionGeo"]["y"],i5x["cm_const"]["EarthRadius"]+this["positionGeo"]["z"]+M6x+this["userbaseHeight"]);C6x=this["worldPosition"]["clone"]();R6x=C6x["clone"]()["normalize"]();C6x["sub"](D6x["option"]["refCenter"]);U6x["position"]["copy"](C6x);U6x["scale"]["x"]=U6x["scale"]["y"]=U6x["scale"]["z"]=1;U6x["name"]=this["resourceName"];if(false){}else{A6x=new THREE["Quaternion"]();z6x=new THREE["Quaternion"]();z6x["setFromAxisAngle"](new THREE["Vector3"](0,1,0),-(180-this["positionGeo"]["x"])*i5x["CmMathEngine"]["Deg2Rad"]);A6x["setFromAxisAngle"](new THREE["Vector3"](1,0,0),-this["positionGeo"]["y"]*i5x["CmMathEngine"]["Deg2Rad"]);n6x=THREE["Quaternion"]["prototype"]["multiplyQuaternions"](z6x,A6x);U6x["quaternion"]["copy"](n6x);}if(U6x["geometry"]["boundingSphere"]==null)U6x["geometry"]["computeBoundingSphere"]();this["limitedDistance"]=i5x["PointMesh"]["adjustViewRange"](U6x["geometry"]["boundingSphere"]["radius"]);this["releaseMesh"]();this["lastShowTime"]=D6x["option"]["renderFrameTime"];U6x["visible"]=false;U6x["name"]="pointmesh";U6x["material"]['color']=new THREE["Color"](0xcccccc);U6x["material"]['specular']=new THREE["Color"](0x000000);this["meshObject"]=U6x;this["parentTile"]["addToScene"](this["meshObject"]);};S5x["getTileLevel"]=function(g6x){};S5x["adjustViewRange"]=function(T6x){var X6x;X6x=100;T6x=T6x*i5x["PointMesh"]["limitedDistanceScale"];if(T6x>=i5x["PointMesh"]["minDisplaySize"]){X6x=100+T6x/60*3000;if(X6x>S5x["maxLimitedDistance"]){X6x=S5x["maxLimitedDistance"];}}return X6x;};S5x["prototype"]["render"]=function(O6x){var a6x,t6x;if(this["meshObject"]==null)return;a6x=this["cmworld"];if(a6x["isRenderingFrame"]==false)return;if(this["renderFrameID"]==a6x["option"]["renderFrameID"])return;this["renderFrameID"]=a6x["option"]["renderFrameID"];if(O6x>this["limitedDistance"]){this["setShowMesh"](false);}else{a6x=this["cmworld"];if(this["useUserModel"]==false){this["checkTexture"](O6x);}if(this["completeModel"]){t6x=this["worldPosition"]["clone"]();t6x["sub"](a6x["option"]["refCenter"]);this["meshObject"]["position"]["copy"](t6x);this["meshObject"]["parent"]=null;this["setShowMesh"](true);if(this["useUserModel"]){this["meshObject"]["quaternion"]["copy"](a6x["getCamera"]()["getThreejsCamera"]()["quaternion"]);}this["lastShowTime"]=a6x["option"]["renderFrameTime"];}}};S5x["prototype"]["intersectObject"]=function(o6x){if(o6x==null||this["meshObject"]==null||this["meshObject"]["visible"]==false){return null;}return o6x["intersectObject"](this["meshObject"]);};S5x["prototype"]["getMesh"]=function(){return this["meshObject"];};S5x["prototype"]["setTexture"]=function(Z6x){var x6x,J6x;if(Z6x==null)return;if(this["meshObject"]!=null){x6x=this["meshObject"]["material"];if(x6x["type"]=='MultiMaterial'){J6x=this["meshObject"]["material"];for(var i6x in J6x["materials"]){J6x["materials"][i6x]["map"]=Z6x;break;}}else{J6x=this["meshObject"]["material"];J6x["map"]=Z6x;}return;}Z6x["dispose"]();};S5x["prototype"]["checkTexture"]=function(u6x){var v6x,e6x,j6x,p6x,c6x,S6x,I6x,h6x,w6x;if(this["updatingTexture"])return;if(this["meshObject"]==null)return;v6x=500;e6x=this["cmworld"];if(e6x["option"]["renderFrameTime"]-this["requestedTexture_time"]<v6x)return;if(e6x["option"]["renderFrameTime"]-this["textureChanged_time"]<v6x)return;if(e6x["option"]["renderFrameTime"]-this["textureChanged_time"]<v6x)return;j6x=true;if(j6x){p6x=this["meshObject"]["material"];if(p6x["map"]!=null){c6x=this["meshObject"]["geometry"]["boundingSphere"]["radius"]*2;S6x=S5x["getTexLevel"](u6x,c6x);if(p6x["map"]!=null){if(S6x!=p6x["map"]["level"]){if(S6x>=p6x["map"]["endlevel"]){S6x=p6x["map"]["endlevel"]-1;}if(S6x<0)S6x=0;if(S6x!=p6x["map"]["level"]){I6x=null;{h6x='/'+S6x;if(S6x==0)h6x='';w6x=this["parentTile"]["resourceURL"]+h6x+'&FileName=';I6x=w6x+p6x["map"]["imageName"];}if(I6x!=null){p6x["map"]["requestlevel"]=S6x;i5x["VectorTileLayer"]["requestTextureUpdate"](this,p6x,u6x,I6x);}}}}}else{I6x=null;{w6x=this["parentTile"]["resourceURL"]+'&FileName=';I6x=w6x+p6x["imageName"];}this["updateTexture"](this["meshObject"]["material"],I6x);}}else{}};S5x["prototype"]["updateTexture"]=function(P6x,N6x){var K6x,d6x,b6x;if(this["updatingTexture"])return;if(N6x!=null){this["updatingTexture"]=true;this["requestedTexture_time"]=Date["now"]();K6x=this;d6x=P6x;b6x=new THREE["TextureLoader"]();b6x["setCrossOrigin"]("Anonymous");b6x["load"](N6x,function(B6x){var q6x,Q6x;B6x["minFilter"]=THREE["LinearFilter"];if(d6x["map"]!=null){B6x["imageName"]=d6x["map"]["imageName"];B6x["level"]=d6x["map"]["requestlevel"];B6x["endlevel"]=d6x["map"]["endlevel"];B6x["needsUpdate"]=true;q6x=d6x["map"];Q6x=i5x["CmWorld3"]["getInstance"]();Q6x["requestDispose"](q6x);if(B6x["endlevel"]<=B6x["level"])B6x["endlevel"]=B6x["level"]+1;}else{B6x["minFilter"]=THREE["LinearFilter"];B6x["needUpdate"]=true;B6x["imageName"]=d6x["imageName"];B6x["level"]=0;B6x["endlevel"]=10;d6x["needsUpdate"]=true;}d6x["map"]=B6x;K6x["updatingTexture"]=false;if(K6x["meshObject"]){K6x["completeModel"]=true;}K6x["textureChanged_time"]=Date["now"]();});}else{}};return S5x;}(cm_cmvGeometry);p5x["deleteMeshTime"]=30*1000;p5x["maxLimitedDistance"]=5000;p5x["limitedDistanceScale"]=1.0;p5x["minDisplaySize"]=4;i5x["PointMesh"]=p5x;}(CMWORLD||(CMWORLD={})));(function(f6x){var H9x;H9x=function(){k9x["prototype"]["setRedraw"]=function(){this["preLayerIndex"]=-1;this["renderObjectCount"]=this["parentTile"]["renderObject"]["length"];this["currentObjectIndex"]=0;this["taskState"]=1;this["isDone"]=false;};k9x["prototype"]["tryTask"]=function(s9x){if(s9x===void 0){s9x=false;}if(this["isCorrect"]==false||this["isDone"]==true){return true;}if(this["taskState"]==0){this["readObject"](s9x);this["currentObjectIndex"]++;if(this["currentObjectIndex"]>=this["objectCount"]){if(s9x==false){this["currentObjectIndex"]=0;this["taskState"]=-1;this["isDone"]=true;return true;}else{this["preLayerIndex"]=-1;this["renderObjectCount"]=this["parentTile"]["renderObject"]["length"];this["currentObjectIndex"]=0;this["taskState"]=1;}}}else if(this["taskState"]==1){this["drawObject"](s9x);this["currentObjectIndex"]++;if(this["currentObjectIndex"]>=this["renderObjectCount"]){this["currentObjectIndex"]=0;this["taskState"]=-1;this["isDone"]=true;return true;}}return false;};function k9x(E9x,L9x,V9x){var m9x;this["parentTile"]=null;this["init"]=false;this["parentLayer"]=null;this["isCorrect"]=false;this["isDone"]=false;this["taskState"]=0;this["objectCount"]=0;this["drawObjectCount"]=0;this["currentObjectIndex"]=0;this["rawData"]=null;this["renderObjectCount"]=0;this["preLayerIndex"]=-1;this["cmvInfo"]=new f6x["CMVFileInfo"]();this["cmworld3Viewer"]=f6x["CmWorld3"]["getInstance"]();try{if(L9x==null||V9x==null){this["isCorrect"]=false;}else{this["parentTile"]=L9x;this["parentLayer"]=E9x;this["rawData"]=V9x["slice"](0);this["br"]=new f6x["BinaryReader"](this["rawData"],true);m9x=this["br"]["readString"]();if(m9x=='CMV1000'){this["isCorrect"]=false;}else if(m9x=='CMV2000'){this["isCorrect"]=true;this["objectCount"]=this["br"]["readInt32"]();if(this["objectCount"]<1){this["isCorrect"]=false;}else{this["taskState"]=0;this["currentObjectIndex"]=0;}}}}catch(y9x){}if(this["isCorrect"]==false){this["isDone"]=true;}}k9x["prototype"]["getStyle"]=function(Y9x){return this["cmworld3Viewer"]["styleManager"]["getStyle"](this["parentTile"]["layerName"],Y9x);};k9x["prototype"]["drawSurface2DObject"]=function(l9x){var D9x,A9x,G9x,W9x,U9x,F9x;if(l9x){D9x=true;{A9x=this["parentTile"];D9x=A9x["parentLayer"]["mapInfo"]["subLayerVisibleState"][l9x["layerIndex"]];}if(D9x==false){return;}G9x=null;if(this["preLayerIndex"]!=l9x["layerIndex"]){G9x=this["getStyle"](l9x["layerIndex"]);if(G9x){for(var C9x in G9x){this["parentTile"]["context"][C9x]=G9x[C9x];}}this["preLayerIndex"]=l9x["layerIndex"];}if(l9x["Points"]["length"]>2){this["parentTile"]["context"]["beginPath"]();W9x=this["parentTile"]["xf"]*(l9x["Points"][0]["x"]-this["parentTile"]["bound"]["West"]);U9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(l9x["Points"][0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](W9x,U9x);for(var r9x=1;r9x<l9x["Points"]["length"];r9x++){W9x=this["parentTile"]["xf"]*(l9x["Points"][r9x]["x"]-this["parentTile"]["bound"]["West"]);U9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(l9x["Points"][r9x]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](W9x,U9x);}this["parentTile"]["context"]["closePath"]();if(l9x["HoleCount"]>0){for(var M9x=0;M9x<l9x["HoleCount"];M9x++){F9x=l9x["Holes"][M9x];if(F9x){if(F9x["length"]>2){W9x=this["parentTile"]["xf"]*(F9x[0]["x"]-this["parentTile"]["bound"]["West"]);U9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(F9x[0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](W9x,U9x);for(var r9x=1;r9x<F9x["length"];r9x++){W9x=this["parentTile"]["xf"]*(F9x[r9x]["x"]-this["parentTile"]["bound"]["West"]);U9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(F9x[r9x]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](W9x,U9x);}this["parentTile"]["context"]["closePath"]();}}}}this["parentTile"]["context"]["fill"]();}}};k9x["prototype"]["drawSurface3DObject"]=function(z9x){var O9x,o9x,T9x,g9x,X9x,R9x;if(z9x){O9x=true;{o9x=this["parentTile"];O9x=o9x["parentLayer"]["mapInfo"]["subLayerVisibleState"][z9x["layerIndex"]];}if(O9x==false){return;}T9x=null;if(this["preLayerIndex"]!=z9x["layerIndex"]){T9x=this["getStyle"](z9x["layerIndex"]);if(T9x){for(var t9x in T9x){this["parentTile"]["context"][t9x]=T9x[t9x];}}this["preLayerIndex"]=z9x["layerIndex"];}if(z9x["Points"]["length"]>2){this["parentTile"]["context"]["beginPath"]();g9x=this["parentTile"]["xf"]*(z9x["Points"][0]["x"]-this["parentTile"]["bound"]["West"]);X9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(z9x["Points"][0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](g9x,X9x);for(var n9x=1;n9x<z9x["Points"]["length"];n9x++){g9x=this["parentTile"]["xf"]*(z9x["Points"][n9x]["x"]-this["parentTile"]["bound"]["West"]);X9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(z9x["Points"][n9x]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](g9x,X9x);}this["parentTile"]["context"]["closePath"]();if(z9x["HoleCount"]>0){for(var a9x=0;a9x<z9x["HoleCount"];a9x++){R9x=z9x["Holes"][a9x];if(R9x){if(R9x["length"]>2){g9x=this["parentTile"]["xf"]*(R9x[0]["x"]-this["parentTile"]["bound"]["West"]);X9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(R9x[0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](g9x,X9x);for(var n9x=1;n9x<R9x["length"];n9x++){g9x=this["parentTile"]["xf"]*(R9x[n9x]["x"]-this["parentTile"]["bound"]["West"]);X9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(R9x[n9x]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](g9x,X9x);}this["parentTile"]["context"]["closePath"]();}}}}this["parentTile"]["context"]["fill"]();}}};k9x["prototype"]["drawLine2DObject"]=function(J9x){var S9x,w9x,Z9x,i9x,p9x;if(J9x){S9x=true;{w9x=this["parentTile"];S9x=w9x["parentLayer"]["mapInfo"]["subLayerVisibleState"][J9x["layerIndex"]];}if(S9x==false){return;}Z9x=null;if(this["preLayerIndex"]!=J9x["layerIndex"]){Z9x=this["getStyle"](J9x["layerIndex"]);if(Z9x){for(var I9x in Z9x){this["parentTile"]["context"][I9x]=Z9x[I9x];}}this["preLayerIndex"]=J9x["layerIndex"];}if(J9x["Points"]["length"]>2){this["parentTile"]["context"]["beginPath"]();i9x=this["parentTile"]["xf"]*(J9x["Points"][0]["x"]-this["parentTile"]["bound"]["West"]);p9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(J9x["Points"][0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](i9x,p9x);for(var x9x=1;x9x<J9x["Points"]["length"];x9x++){i9x=this["parentTile"]["xf"]*(J9x["Points"][x9x]["x"]-this["parentTile"]["bound"]["West"]);p9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(J9x["Points"][x9x]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](i9x,p9x);}this["parentTile"]["context"]["stroke"]();}}};k9x["prototype"]["drawLine3DObject"]=function(e9x){var c9x,K9x,v9x,j9x,u9x;if(e9x){c9x=true;{K9x=this["parentTile"];c9x=K9x["getLayer"]()["mapInfo"]["subLayerVisibleState"][e9x["layerIndex"]];}if(c9x==false){return;}v9x=null;if(this["preLayerIndex"]!=e9x["layerIndex"]){v9x=this["getStyle"](e9x["layerIndex"]);if(v9x){for(var d9x in v9x){this["parentTile"]["context"][d9x]=v9x[d9x];}}this["preLayerIndex"]=e9x["layerIndex"];}if(e9x["Points"]["length"]>2){this["parentTile"]["context"]["beginPath"]();j9x=this["parentTile"]["xf"]*(e9x["Points"][0]["x"]-this["parentTile"]["bound"]["West"]);u9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(e9x["Points"][0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](j9x,u9x);for(var h9x=1;h9x<e9x["Points"]["length"];h9x++){j9x=this["parentTile"]["xf"]*(e9x["Points"][h9x]["x"]-this["parentTile"]["bound"]["West"]);u9x=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(e9x["Points"][h9x]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](j9x,u9x);}this["parentTile"]["context"]["stroke"]();}}};k9x["prototype"]["drawObject"]=function(N9x){var b9x;b9x=this["parentTile"]["renderObject"][this["currentObjectIndex"]];if(b9x){if(b9x instanceof cm_Surface2D){this["drawSurface2DObject"](b9x);}if(b9x instanceof cm_Surface3D){this["drawSurface3DObject"](b9x);}if(b9x instanceof cm_Line2D){this["drawLine2DObject"](b9x);}if(b9x instanceof cm_Line3D){this["drawLine3DObject"](b9x);}}};k9x["prototype"]["readObject"]=function(Q9x){var P9x,L0x,m0x,B9x,q9x,f9x,H0x,k0x;P9x=this["br"];m0x=1;B9x=0;B9x=P9x["readInt32"]();B9x=this["getVersionAndType"](B9x);P9x["readInt32"]();if(B9x>=0&&B9x<=f6x["VectorObjectType"]["Custom"]){switch(B9x){case f6x["VectorObjectType"]["PointMesh"]:{q9x=this["readPointMesh"](P9x,this["cmvInfo"]["version"]);if(Q9x==false){q9x["parentTile"]=this["parentTile"];if(this["parentLayer"]["useUserBillboard4PointMesh"]==true){q9x["MakeBillboardMesh"](this["parentLayer"]["billboardGeometry"],this["parentLayer"]["billboardMaterial"],this["parentLayer"]["biilboardBaseHeight"]);}this["parentTile"]["addPointMesh"](q9x);}}break;case f6x["VectorObjectType"]["Tree"]:{this["readTree"](P9x,this["cmvInfo"]["version"]);}break;case f6x["VectorObjectType"]["AdBoard"]:{this["readAdBoard"](P9x,this["cmvInfo"]["version"]);}break;case f6x["VectorObjectType"]["Pipe"]:{this["readPipe"](P9x,this["cmvInfo"]["version"]);}break;case f6x["VectorObjectType"]["Line"]:{f9x=this["readLine2D"](P9x,this["cmvInfo"]["version"]);if(Q9x==true){this["parentTile"]["renderObject"]["push"](f9x);}}break;case f6x["VectorObjectType"]["Surface"]:{H0x=this["readSurface2D"](P9x,this["cmvInfo"]["version"]);if(Q9x==true){this["parentTile"]["renderObject"]["push"](H0x);}}break;case f6x["VectorObjectType"]["Solid"]:{this["readSolid"](P9x,this["cmvInfo"]["version"]);}break;case f6x["VectorObjectType"]["ShpBuilding"]:{this["readShape2DBuilding"](P9x,this["cmvInfo"]["version"]);}break;case f6x["VectorObjectType"]["Mesh"]:{this["readMesh"](P9x,this["cmvInfo"]["version"]);}break;case f6x["VectorObjectType"]["Road"]:{this["readRoad"](P9x,this["cmvInfo"]["version"]);}break;case f6x["VectorObjectType"]["IconPoint"]:{k0x=this["readPOI3D"](P9x,this["cmvInfo"]["version"]);this["parentTile"]["poiObjects"]["push"](k0x);}break;case f6x["VectorObjectType"]["ElectricPole"]:{this["readElectricPole"](P9x,this["cmvInfo"]["version"]);}break;case f6x["VectorObjectType"]["Chart3D"]:{this["readChart3D"](P9x,this["cmvInfo"]["version"]);}break;default:break;}}};k9x["prototype"]["getVersionAndType"]=function(E0x){var y0x,V0x;y0x=1;V0x=E0x;if(V0x>f6x["VectorObjectType"]["Custom"]){V0x=E0x&0x0000FFFF;y0x=(E0x&0xFF000000)>>24;}this["cmvInfo"]["version"]=y0x;this["cmvInfo"]["type"]=V0x;return V0x;};k9x["prototype"]["readPointMesh"]=function(s0x,W0x){var Y0x,r0x,F0x,l0x;Y0x=new f6x["PointMesh"]();Y0x["Color"]=this["parentTile"]["Color"];Y0x["layerIndex"]=s0x["readInt32"]();Y0x["id"]=s0x["readInt32"]();if(this["cmvInfo"]["version"]>1){Y0x["name"]=s0x["readString"]();}Y0x["Value"]=s0x["readDouble"]();Y0x["label"]=s0x["readString"]();Y0x["positionGeo"]=new THREE["Vector3"](s0x["readDouble"](),s0x["readDouble"](),s0x["readDouble"]());if(this["cmvInfo"]["version"]>2){Y0x["baseHeight"]=s0x["readSingle"]();}r0x=s0x["readBoolean"]();F0x=s0x["readDouble"]();Y0x["meshScale"]=new THREE["Vector3"](s0x["readDouble"](),s0x["readDouble"](),s0x["readDouble"]());Y0x["diameter"]=s0x["readDouble"]();l0x=s0x["readBoolean"]();if(l0x){Y0x["direction"]=new THREE["Vector3"](s0x["readDouble"](),s0x["readDouble"](),s0x["readDouble"]());}else{s0x["readDouble"]();s0x["readDouble"]();s0x["readDouble"]();}Y0x["useResource"]=s0x["readBoolean"]();Y0x["resourceName"]=s0x["readString"]();return Y0x;};k9x["prototype"]["readTree"]=function(U0x,G0x){U0x["readInt32"]();U0x["readInt32"]();if(this["cmvInfo"]["version"]>1){U0x["readString"]();}U0x["readDouble"]();U0x["readString"]();U0x["readDouble"]();U0x["readDouble"]();U0x["readDouble"]();U0x["readBoolean"]();U0x["readDouble"]();U0x["readDouble"]();U0x["readDouble"]();U0x["readDouble"]();U0x["readString"]();};k9x["prototype"]["readAdBoard"]=function(M0x,C0x){M0x["readInt32"]();M0x["readInt32"]();if(this["cmvInfo"]["version"]>1){M0x["readString"]();}M0x["readDouble"]();M0x["readString"]();M0x["readDouble"]();M0x["readDouble"]();M0x["readDouble"]();M0x["readByte"]();M0x["readByte"]();M0x["readDouble"]();M0x["readDouble"]();M0x["readDouble"]();M0x["readDouble"]();M0x["readDouble"]();M0x["readDouble"]();M0x["readDouble"]();M0x["readString"]();};k9x["prototype"]["readPipe"]=function(D0x,A0x){D0x["readInt32"]();D0x["readInt32"]();if(this["cmvInfo"]["version"]>1){D0x["readString"]();}D0x["readDouble"]();D0x["readString"]();D0x["readDouble"]();D0x["readDouble"]();D0x["readDouble"]();D0x["readDouble"]();D0x["readDouble"]();D0x["readDouble"]();D0x["readDouble"]();D0x["readInt32"]();D0x["readDouble"]();D0x["readDouble"]();};k9x["prototype"]["readSolid"]=function(z0x,T0x){var R0x,g0x,X0x;z0x["readInt32"]();z0x["readInt32"]();if(this["cmvInfo"]["version"]>1){z0x["readString"]();}z0x["readDouble"]();z0x["readString"]();z0x["readDouble"]();z0x["readDouble"]();z0x["readDouble"]();z0x["readDouble"]();z0x["readDouble"]();z0x["readInt32"]();z0x["readInt32"]();R0x=z0x["readInt32"]();X0x=z0x["readInt32"]();g0x=z0x["readInt32"]();if(this["cmvInfo"]["version"]<3){for(var n0x=0;n0x<R0x;n0x++){z0x["readDouble"]();z0x["readDouble"]();z0x["readDouble"]();z0x["readSingle"]();z0x["readSingle"]();z0x["readSingle"]();z0x["readSingle"]();z0x["readSingle"]();}for(var n0x=0;n0x<X0x;n0x++){z0x["readInt32"]();}for(var n0x=0;n0x<g0x;n0x++){z0x["readDouble"]();z0x["readDouble"]();z0x["readDouble"]();z0x["readSingle"]();z0x["readSingle"]();z0x["readSingle"]();z0x["readSingle"]();z0x["readSingle"]();}}else{for(var n0x=0;n0x<R0x;n0x++){z0x["readDouble"]();z0x["readDouble"]();z0x["readDouble"]();z0x["readSingle"]();z0x["readSingle"]();}for(var n0x=0;n0x<X0x;n0x++){z0x["readInt32"]();}for(var n0x=0;n0x<g0x;n0x++){z0x["readDouble"]();z0x["readDouble"]();z0x["readDouble"]();z0x["readSingle"]();z0x["readSingle"]();}}};k9x["prototype"]["readShape2DBuilding"]=function(a0x,i0x){var O0x,o0x,J0x,Z0x,x0x;a0x["readInt32"]();a0x["readInt32"]();if(this["cmvInfo"]["version"]>1){a0x["readString"]();}a0x["readDouble"]();a0x["readString"]();a0x["readString"]();a0x["readString"]();a0x["readString"]();a0x["readString"]();if(this["cmvInfo"]["version"]>1){a0x["readString"]();}a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();O0x=a0x["readInt32"]();o0x=a0x["readInt32"]();J0x=a0x["readInt32"]();Z0x=a0x["readInt32"]();x0x=a0x["readInt32"]();if(this["cmvInfo"]["version"]==1){for(var t0x=0;t0x<O0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();}for(var t0x=0;t0x<o0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();}for(var t0x=0;t0x<J0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();}for(var t0x=0;t0x<Z0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();}for(var t0x=0;t0x<x0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();a0x["readSingle"]();}}else{for(var t0x=0;t0x<O0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();}for(var t0x=0;t0x<o0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();}for(var t0x=0;t0x<J0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();}for(var t0x=0;t0x<Z0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();}for(var t0x=0;t0x<x0x;t0x++){a0x["readDouble"]();a0x["readDouble"]();a0x["readDouble"]();a0x["readSingle"]();a0x["readSingle"]();}}};k9x["prototype"]["readMesh"]=function(p0x,S0x){p0x["readInt32"]();p0x["readInt32"]();if(this["cmvInfo"]["version"]>1){p0x["readString"]();}p0x["readDouble"]();p0x["readString"]();p0x["readDouble"]();p0x["readDouble"]();p0x["readDouble"]();p0x["readBoolean"]();p0x["readDouble"]();p0x["readDouble"]();p0x["readDouble"]();p0x["readString"]();p0x["readString"]();};k9x["prototype"]["readRoad"]=function(I0x,v0x){var e0x;I0x["readInt32"]();I0x["readInt32"]();if(this["cmvInfo"]["version"]>1){I0x["readString"]();}I0x["readDouble"]();I0x["readString"]();I0x["readDouble"]();I0x["readDouble"]();I0x["readDouble"]();I0x["readString"]();e0x=I0x["readInt32"]();for(var w0x=0;w0x<e0x;w0x++){I0x["readDouble"]();I0x["readDouble"]();I0x["readDouble"]();I0x["readSingle"]();I0x["readSingle"]();}};k9x["prototype"]["readElectricPole"]=function(h0x,j0x){h0x["readInt32"]();h0x["readInt32"]();if(this["cmvInfo"]["version"]>1){this["cmvInfo"]["name"]=h0x["readString"]();}h0x["readDouble"]();h0x["readString"]();h0x["readDouble"]();h0x["readDouble"]();h0x["readDouble"]();h0x["readInt32"]();h0x["readSingle"]();h0x["readString"]();h0x["readString"]();h0x["readString"]();h0x["readString"]();h0x["readString"]();h0x["readString"]();};k9x["prototype"]["readChart3D"]=function(u0x,P0x){var K0x,b0x,N0x;u0x["readInt32"]();u0x["readInt32"]();if(this["cmvInfo"]["version"]>3){u0x["readString"]();}u0x["readDouble"]();u0x["readString"]();u0x["readDouble"]();u0x["readDouble"]();u0x["readDouble"]();u0x["readString"]();K0x=u0x["readByte"]();for(var c0x=0;c0x<K0x;c0x++){u0x["readSingle"]();}u0x["readByte"]();b0x=u0x["readUInt16"]();for(var d0x=0;d0x<b0x;d0x++){N0x=u0x["readInt32"]();for(var c0x=0;c0x<N0x;c0x++){u0x["readSingle"]();u0x["readSingle"]();}}};k9x["prototype"]["readLine2D"]=function(B0x,L71){var q0x,f0x,H71,k71,m71;q0x=new cm_Line2D();q0x["layerIndex"]=B0x["readInt32"]();q0x["id"]=B0x["readInt32"]();if(L71>1){q0x["name"]=B0x["readString"]();}q0x["Value"]=B0x["readDouble"]();q0x["label"]=B0x["readString"]();B0x["readDouble"]();B0x["readDouble"]();B0x["readDouble"]();B0x["readDouble"]();q0x["LineColor"]=B0x["readInt32"]();f0x=B0x["readInt32"]();for(var Q0x=0;Q0x<f0x;Q0x++){H71=B0x["readDouble"]();k71=B0x["readDouble"]();;B0x["readDouble"]();m71=new THREE["Vector2"](H71,k71);q0x["Points"]["push"](m71);}return q0x;};k9x["prototype"]["readLine3D"]=function(V71,F71){var E71,s71,Y71,l71,r71;E71=new cm_Line3D();E71["layerIndex"]=V71["readInt32"]();E71["id"]=V71["readInt32"]();if(F71>1){E71["name"]=V71["readString"]();}E71["Value"]=V71["readDouble"]();E71["label"]=V71["readString"]();V71["readDouble"]();V71["readDouble"]();V71["readDouble"]();E71["LineWidth"]=V71["readDouble"]();E71["LineColor"]=V71["readInt32"]();s71=V71["readInt32"]();for(var y71=0;y71<s71;y71++){Y71=V71["readDouble"]();l71=V71["readDouble"]();;V71["readDouble"]();r71=new THREE["Vector2"](Y71,l71);E71["Points"]["push"](r71);}return E71;};k9x["prototype"]["readSurface2D"]=function(W71,g71){var U71,n71,M71,D71,C71,R71,A71;U71=new cm_Surface2D();U71["layerIndex"]=W71["readInt32"]();U71["id"]=W71["readInt32"]();if(g71>1){U71["name"]=W71["readString"]();}U71["Value"]=W71["readDouble"]();U71["label"]=W71["readString"]();W71["readDouble"]();W71["readDouble"]();W71["readDouble"]();n71=W71["readInt32"]();for(var G71=0;G71<n71;G71++){M71=W71["readDouble"]();D71=W71["readDouble"]();;W71["readDouble"]();C71=new THREE["Vector2"](M71,D71);U71["Points"]["push"](C71);}if(g71>2){U71["HoleCount"]=W71["readInt32"]();U71["Holes"]=new Array();for(var G71=0;G71<U71["HoleCount"];G71++){R71=W71["readInt32"]();A71=[];for(var z71=0;z71<R71;z71++){M71=W71["readDouble"]();D71=W71["readDouble"]();W71["readDouble"]();C71=new THREE["Vector2"](M71,D71);A71["push"](C71);}U71["Holes"]["push"](A71);}}return U71;};k9x["prototype"]["readSurface3D"]=function(X71,Z71){var T71,t71,O71,o71,J71;T71=new cm_Surface3D();T71["layerIndex"]=X71["readInt32"]();T71["id"]=X71["readInt32"]();if(Z71>1){T71["name"]=X71["readString"]();}T71["Value"]=X71["readDouble"]();T71["label"]=X71["readString"]();X71["readDouble"]();X71["readDouble"]();X71["readDouble"]();X71["readDouble"]();T71["LineColor"]=X71["readInt32"]();t71=X71["readInt32"]();for(var a71=0;a71<t71;a71++){O71=X71["readDouble"]();o71=X71["readDouble"]();;X71["readDouble"]();J71=new THREE["Vector2"](O71,o71);T71["Points"]["push"](J71);}return T71;};k9x["prototype"]["readPOI3D"]=function(i71,I71){var x71,p71,S71;x71=new f6x["POI3D"]();x71["layerIndex"]=i71["readInt32"]();x71["id"]=i71["readInt32"]();if(I71>1){x71["name"]=i71["readString"]();}x71["value"]=i71["readDouble"]();x71["label"]=i71["readString"]();p71=i71["readDouble"]();S71=i71["readDouble"]();;i71["readDouble"]();x71["setPosition"](p71,S71,0);x71["category"]=i71["readString"]();x71["imgKey"]=x71["category"];return x71;};return k9x;}();f6x["CMVReader"]=H9x;}(CMWORLD||(CMWORLD={})));(function(w71){var e71;e71=function(){v71["prototype"]["setRedraw"]=function(){this["preLayerIndex"]=-1;this["renderObjectCount"]=this["parentTile"]["renderObject"]["length"];this["currentObjectIndex"]=0;this["taskState"]=1;this["isDone"]=false;};v71["prototype"]["tryTask"]=function(b71){if(b71===void 0){b71=false;}if(this["isCorrect"]==false||this["isDone"]==true){return true;}for(var N71=0;N71<this["objectCount"];N71++){if(this["taskState"]==0){this["readObject"](b71,N71);this["currentObjectIndex"]++;if(this["currentObjectIndex"]>=this["objectCount"]){if(b71==false){this["currentObjectIndex"]=0;this["taskState"]=-1;this["isDone"]=true;return true;}else{this["preLayerIndex"]=-1;this["renderObjectCount"]=this["parentTile"]["renderObject"]["length"];this["currentObjectIndex"]=0;this["taskState"]=1;}}}else if(this["taskState"]==1){this["drawObject"](b71);this["currentObjectIndex"]++;if(this["currentObjectIndex"]>=this["renderObjectCount"]){this["currentObjectIndex"]=0;this["taskState"]=-1;this["isDone"]=true;return true;}}}return false;};v71["prototype"]["getStyle"]=function(P71){return this["cmworld3Viewer"]["styleManager"]["getStyle"](this["parentTile"]["layerName"],P71);};v71["prototype"]["drawSurface2DObject"]=function(B71){var V31,E31,k31,f71,H31,Q71;if(B71){V31=true;{E31=this["parentTile"];V31=E31["getLayer"]()["mapInfo"]["subLayerVisibleState"][B71["layerIndex"]];}if(V31==false){return;}k31=null;if(this["preLayerIndex"]!=B71["layerIndex"]){k31=this["getStyle"](B71["layerIndex"]);if(k31){for(var L31 in k31){this["parentTile"]["context"][L31]=k31[L31];}}this["preLayerIndex"]=B71["layerIndex"];}if(B71["Points"]["length"]>2){this["parentTile"]["context"]["beginPath"]();f71=this["parentTile"]["xf"]*(B71["Points"][0]["x"]-this["parentTile"]["bound"]["West"]);H31=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(B71["Points"][0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](f71,H31);for(var q71=1;q71<B71["Points"]["length"];q71++){f71=this["parentTile"]["xf"]*(B71["Points"][q71]["x"]-this["parentTile"]["bound"]["West"]);H31=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(B71["Points"][q71]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](f71,H31);}this["parentTile"]["context"]["stroke"]();this["parentTile"]["context"]["closePath"]();if(B71["HoleCount"]>0){for(var m31=0;m31<B71["HoleCount"];m31++){Q71=B71["Holes"][m31];if(Q71){if(Q71["length"]>2){f71=this["parentTile"]["xf"]*(Q71[0]["x"]-this["parentTile"]["bound"]["West"]);H31=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(Q71[0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](f71,H31);for(var q71=1;q71<Q71["length"];q71++){f71=this["parentTile"]["xf"]*(Q71[q71]["x"]-this["parentTile"]["bound"]["West"]);H31=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(Q71[q71]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](f71,H31);}this["parentTile"]["context"]["stroke"]();this["parentTile"]["context"]["closePath"]();}}}}this["parentTile"]["context"]["fill"]();}}};function v71(d71,u71,j71){var c71,h71;this["parentTile"]=null;this["init"]=false;this["parentLayer"]=null;this["isCorrect"]=false;this["isDone"]=false;this["taskState"]=0;this["objectCount"]=0;this["drawObjectCount"]=0;this["currentObjectIndex"]=0;this["rawData"]=null;this["renderObjectCount"]=0;this["preLayerIndex"]=-1;this["featureArray"]=null;this["cmworld3Viewer"]=w71["CmWorld3"]["getInstance"]();try{if(u71==null||j71==null){this["isCorrect"]=false;}else{this["parentTile"]=u71;this["parentLayer"]=d71;this["rawData"]=j71["slice"](0);this["br"]=new w71["BinaryReader"](this["rawData"],true);c71=this["br"]["readJSON"](j71["byteLength"]);h71=JSON["parse"](c71);this["geojsonType"]=h71["type"];this["objectCount"]=h71["totalFeatures"];this["featureArray"]=h71["features"];this["isCorrect"]=true;if(this["objectCount"]<1){this["isCorrect"]=false;}else{this["taskState"]=0;this["currentObjectIndex"]=0;}}}catch(K71){console["error"](K71);}if(this["isCorrect"]==false){this["isDone"]=true;}}v71["prototype"]["drawLine2DObject"]=function(y31){var F31,U31,s31,l31,r31;if(y31){F31=true;{U31=this["parentTile"];F31=U31["getLayer"]()["mapInfo"]["subLayerVisibleState"][y31["layerIndex"]];}if(F31==false){return;}s31=null;if(this["preLayerIndex"]!=y31["layerIndex"]){s31=this["getStyle"](y31["layerIndex"]);if(s31){for(var W31 in s31){this["parentTile"]["context"][W31]=s31[W31];}}this["preLayerIndex"]=y31["layerIndex"];}if(y31["Points"]["length"]>2){this["parentTile"]["context"]["beginPath"]();l31=this["parentTile"]["xf"]*(y31["Points"][0]["x"]-this["parentTile"]["bound"]["West"]);r31=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(y31["Points"][0]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["moveTo"](l31,r31);for(var Y31=1;Y31<y31["Points"]["length"];Y31++){l31=this["parentTile"]["xf"]*(y31["Points"][Y31]["x"]-this["parentTile"]["bound"]["West"]);r31=this["parentTile"]["imageHeight"]-this["parentTile"]["yf"]*(y31["Points"][Y31]["y"]-this["parentTile"]["bound"]["South"]);this["parentTile"]["context"]["lineTo"](l31,r31);}this["parentTile"]["context"]["stroke"]();}}};v71["prototype"]["drawObject"]=function(M31){var G31;G31=this["parentTile"]["renderObject"][this["currentObjectIndex"]];if(G31){if(G31 instanceof cm_Surface2D){try{this["drawSurface2DObject"](G31);}catch(C31){console["log"]("geojson 그리는 곳에서 죽어요");}}if(G31 instanceof cm_Line2D){this["drawLine2DObject"](G31);}}};v71["prototype"]["readObject"]=function(A31,X31){var D31,z31,n31,R31,g31;if(w71["Util"]["isDefined"](A31)==false)return;D31=this["featureArray"][X31];z31=this["getType"](D31["geometry"]["type"]);if(z31>=0&&z31<=w71["VectorObjectType"]["Custom"]){switch(z31){case w71["VectorObjectType"]["IconPoint"]:{n31=this["readPOI3D"](D31);if(A31==true){if(this["parentTile"]["poi3DLayer"]==null){this["parentTile"]["poi3DLayer"]=new w71["POI3DLayer"](w71["Tile"]["getKeyString"](this["parentTile"]["level"],this["parentTile"]["row"],this["parentTile"]["col"]));this["cmworld3Viewer"]["addLayer"](this["parentTile"]["poi3DLayer"]);}this["parentTile"]["poi3DLayer"]["add"](n31);}}break;case w71["VectorObjectType"]["Line"]:{R31=this["readLine2D"](D31);if(A31==true){this["parentTile"]["renderObject"]["push"](R31);}}break;case w71["VectorObjectType"]["Surface"]:{g31=this["readSurface2D"](D31);if(A31==true){this["parentTile"]["renderObject"]["push"](g31);}}break;default:break;}}};v71["getGeometryType"]=function(a31){var T31;T31=w71["GeometryType"]["point"];switch(a31){case'Point':T31=w71["GeometryType"]["point"];break;case'LineString':T31=w71["GeometryType"]["linestring"];break;case'Polygon':T31=w71["GeometryType"]["polygon"];break;case'MultiPoint':T31=w71["GeometryType"]["multipoint"];break;case'MultiLineString':T31=w71["GeometryType"]["multilinestring"];break;case'MultiPolygon':T31=w71["GeometryType"]["multipolygon"];break;default:T31=-1;}return T31;};v71["prototype"]["getType"]=function(o31){var t31,O31;t31=w71["VectorObjectType"]["PointMesh"];O31=w71["GeoJsonReader"]["getGeometryType"](o31);switch(O31){case w71["GeometryType"]["point"]:case w71["GeometryType"]["multipoint"]:t31=w71["VectorObjectType"]["IconPoint"];break;case w71["GeometryType"]["linestring"]:case w71["GeometryType"]["multilinestring"]:t31=w71["VectorObjectType"]["Line2D"];break;case w71["GeometryType"]["polygon"]:case w71["GeometryType"]["multipolygon"]:t31=w71["VectorObjectType"]["Surface"];break;default:t31=-1;}return t31;};v71["prototype"]["readPOI3D"]=function(x31){var J31,S31,I31,i31,p31,w31,e31;J31=new w71["POI3D"]();J31["layerIndex"]=0;J31["id"]=v71["idTemp"]++;J31["name"]=x31["id"];J31["label"]=x31["id"];S31=10000;I31=x31["geometry"]["coordinates"][0];i31=I31[0];for(var Z31=0;Z31<i31["length"];Z31++){p31=i31[Z31];w31=p31[0];e31=p31[1];J31["setPosition"](w31,e31,0);if(S31--<0){console["error"]("geojsonReader에서 읽어올 객체가 너무 많습니다. GeoJsonReader.readPOI3D");break;}}return J31;};v71["prototype"]["readLine2D"]=function(u31){var v31,K31,b31,j31,c31,N31,P31,d31;v31=new cm_Line2D();v31["layerIndex"]=0;v31["id"]=v71["idTemp"]++;v31["name"]=u31["id"];v31["label"]=u31["id"];K31=10000;b31=u31["geometry"]["coordinates"][0];j31=b31[0];for(var h31=0;h31<j31["length"];h31++){c31=j31[h31];N31=c31[0];P31=c31[1];d31=new THREE["Vector2"](N31,P31);if(K31--<0){console["error"]("geojsonReader에서 읽어올 객체가 너무 많습니다. GeoJsonReader.readLine2D");break;}v31["Points"]["push"](d31);}return v31;};v71["prototype"]["readSurface2D"]=function(q31){var B31,E81,V81,k81,m81,L81,s81,Y81,y81;if(w71["Util"]["isDefined"](q31)==false)return null;B31=new cm_Surface2D();B31["layerIndex"]=0;B31["id"]=v71["idTemp"]++;B31["name"]=q31["id"];B31["label"]=q31["id"];E81=100000;for(var f31=0;f31<q31["geometry"]["coordinates"]["length"];f31++){V81=q31["geometry"]["coordinates"][f31];k81=V81;for(var Q31=0;Q31<k81["length"];Q31++){m81=k81[Q31];for(var H81=0;H81<m81["length"];H81++){L81=m81[H81];s81=L81[0];Y81=L81[1];y81=new THREE["Vector2"](s81,Y81);if(E81--<0){console["error"]("geojsonReader에서 읽어올 객체가 너무 많습니다. GeoJsonReader.readSurface2D");break;}B31["Points"]["push"](y81);}}}return B31;};return v71;}();e71["idTemp"]=100;w71["GeoJsonReader"]=e71;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var l81;l81=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(r81,F81){r81["__proto__"]=F81;}||function(G81,U81){for(var W81 in U81)if(U81["hasOwnProperty"](W81))G81[W81]=U81[W81];};return function(C81,M81){l81(C81,M81);C81["prototype"]=M81===null?Object["create"](M81):(D81["prototype"]=M81["prototype"],new D81());function D81(){this["constructor"]=C81;}};}();(function(A81){var z81;z81=function(n81){function R81(X81){var g81;g81=n81["call"](this,X81)||this;g81["initialized"]=false;g81["streamReader"]=[];g81["Reqeusted"]=false;g81["cmworld3Viewer"]=A81["CmWorld3"]["getInstance"]();g81["activityChecker"]=new A81["ActivityChecker"](10*1000);g81["serverURL"]=null;g81["resourceURL"]=null;return g81;}__extends(R81,n81);return R81;}(A81["Tile"]);A81["VectorTileBase"]=z81;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var T81;T81=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(a81,t81){a81["__proto__"]=t81;}||function(J81,o81){for(var O81 in o81)if(o81["hasOwnProperty"](O81))J81[O81]=o81[O81];};return function(x81,Z81){T81(x81,Z81);x81["prototype"]=Z81===null?Object["create"](Z81):(i81["prototype"]=Z81["prototype"],new i81());function i81(){this["constructor"]=x81;}};}();(function(p81){var I81,S81;I81=function(){function w81(){}return w81;}();p81["CMVFileInfo"]=I81;S81=function(v81){__extends(e81,v81);e81["prototype"]["dispose"]=function(){var b81,N81;v81["prototype"]["dispose"]["call"](this);if(p81["Util"]["isDefined"](this["tileScene"])){b81=this["parentLayer"];N81=b81["getScene"]();N81["remove"](this["tileScene"]);this["tileScene"]=null;}this["clear"]();this["disposed"]=true;};e81["prototype"]["getScene"]=function(){return this["tileScene"];};e81["prototype"]["addPointMesh"]=function(P81){if(p81["Util"]["isDefined"](P81)){this["pointMeshs"]["push"](P81);}};e81["prototype"]["addGisObject"]=function(B81){if(p81["Util"]["isDefined"](B81)){this["gisObjects"]["push"](B81);}};e81["prototype"]["addUserObject"]=function(q81){var Q81;if(p81["Util"]["isDefined"](q81)){this["userObjects"]["push"](q81);this["addToScene"](q81["getMesh"]());q81["parentScene"]=this["tileScene"];Q81=this["parentLayer"];Q81["addObjectEvent"]["raiseEvent"]({obj:q81,tile:this});}};function e81(j81,c81,d81,K81){var h81,u81;h81=v81["call"](this,j81)||this;h81["tileScene"]=new THREE["Scene"]();h81["renderObject"]=new Array();h81["poi3DLayer"]=null;h81["poiObjects"]=new Array();h81["pointMeshs"]=new Array();h81["gisObjects"]=[];h81["userObjects"]=[];h81["centerWorldPos"]=null;h81["Color"]=THREE["Math"]["randFloat"](0,1);h81["minHeight"]=0;h81["maxHeight"]=10;if(p81["Util"]["isDefined"](j81)){u81=j81["getScene"]();if(p81["Util"]["isDefined"](u81)){u81["add"](h81["tileScene"]);}}h81["setTileInfo"](c81,d81,K81);return h81;}e81["prototype"]["addToScene"]=function(f81){var H41,k41;if(p81["Util"]["isDefined"](f81)){if(p81["Util"]["isDefined"](this["tileScene"])==false){this["tileScene"]=new THREE["Scene"]();H41=this["parentLayer"];k41=H41["getScene"]();k41["add"](this["tileScene"]);}this["tileScene"]["add"](f81);}};e81["prototype"]["removeAtScene"]=function(m41){if(p81["Util"]["isDefined"](m41)){if(p81["Util"]["isDefined"](this["tileScene"])){this["tileScene"]["remove"](m41);}}};e81["prototype"]["intersectBuildingObjects"]=function(y41,L41){var V41,E41;if(L41===void 0){L41=true;}if(y41==null){return null;}V41=[];for(var s41 in this["pointMeshs"]){E41=this["pointMeshs"][s41]["intersectObject"](y41);if(E41!=null){V41["push"](E41);if(L41==false){break;}}}return V41;};e81["prototype"]["clear"]=function(){this["streamReader"]=[];for(var Y41 in this["pointMeshs"]){this["pointMeshs"][Y41]["dispose"]();}this["renderObject"]=new Array();if(this["poi3DLayer"]!=null){this["poi3DLayer"]["dispose"]();this["cmworld3Viewer"]["removeLayerEx"](this["poi3DLayer"],p81["LayerType"]["vector"]);this["poi3DLayer"]=null;}this["pointMeshs"]=new Array();this["clearGisObjects"]();this["clearUserObjects"]();};e81["prototype"]["clearGisObjects"]=function(){var r41;for(var l41 in this["gisObjects"]){r41=this["gisObjects"][l41];r41["dispose"]();}this["gisObjects"]=[];};e81["prototype"]["clearUserObjects"]=function(){var W41;for(var F41 in this["userObjects"]){W41=this["userObjects"][F41];}this["userObjects"]=[];};e81["prototype"]["queryNearObjects"]=function(z41,n41){var M41,U41,A41,D41,G41;M41=999999;U41=null;A41=new THREE["Vector2"](z41,n41);for(var C41 in this["pointMeshs"]){D41=this["pointMeshs"][C41];G41=new THREE["Vector2"](D41["getMesh"]()["geometry"]["boundingSphere"]["center"]["x"],D41["getMesh"]()["geometry"]["boundingSphere"]["center"]["y"]);G41["sub"](A41);if(M41<G41["length"]()){U41=C41;M41=G41["length"]();}}if(U41){return this["pointMeshs"][U41];}return null;};e81["prototype"]["getWorldPos"]=function(){var R41;if(this["centerWorldPos"]==null){R41=this["getBoundary"]()["getCenter"]();this["centerWorldPos"]=p81["CmMathEngine"]["Geo2Cartesian"](R41["x"],R41["y"],p81["cm_const"]["EarthRadius"]);}return this["centerWorldPos"];};e81["prototype"]["getBoundingBox"]=function(){};e81["prototype"]["update"]=function(){var X41,T41,o41,g41,a41,t41,O41;if(this["disposed"])return;if(this["parentLayer"]!=null&&this["parentLayer"]["visible"]==false)return;this["tileScene"]["visible"]=false;X41=false;T41=this["cmworld3Viewer"]["getCamera"]()["getDistanceToWorldPos"](this["getWorldPos"]());if(T41>this["cmworld3Viewer"]["option"]["getDislayDist4Level"](this["level"]-2)){if(this["activityChecker"]["isActivity"](this["cmworld3Viewer"]["option"]["renderFrameTime"])==false){X41=true;}else{return;}}if(X41==false){o41=this["getBoundingBox"]();}this["activityChecker"]["activity"](this["cmworld3Viewer"]["option"]["renderFrameTime"]);g41=this["cmworld3Viewer"]["quadTileQuery"]["isShow"](this["level"],this["row"],this["col"]);if(T41<300){g41=true;}this["tileScene"]["visible"]=g41;if(p81["Util"]["isDefined"](this["streamReader"]["cmv"])){a41=this["streamReader"]["cmv"];if(a41["isDone"]==false){t41=window["performance"]["now"]();O41=t41;do{a41["tryTask"]();O41=window["performance"]["now"]();}while(O41-t41<this["cmworld3Viewer"]["option"]["CMVTaskInterval"]);}}else{}this["updateGisObjects"](g41);this["updatePointMeshs"](g41);this["updateUserObjects"](g41);};e81["prototype"]["load"]=function(S41,J41,I41){var Z41,x41,i41,p41;if(I41===void 0){I41=true;}Z41=this;if(p81["Util"]["isDefined"](J41)==false)J41=p81["FileFormat"]["_cmv"];x41=Z41["parentLayer"];if(J41==p81["FileFormat"]["_cmv"]){i41=new p81["CMVReader"](x41,Z41,S41);this["streamReader"]["cmv"]=i41;return i41["isCorrect"];}else if(J41==p81["FileFormat"]["_json"]){p41=new p81["GeoJsonReader"](x41,Z41,S41);this["processFeature"](p41["featureArray"]);return p41["isCorrect"];}else{console["warn"]("load:fileFormat을 처리할 수 없는 포맷입니다. ");}return false;};e81["prototype"]["processFeature"]=function(j41,v41,w41){var h41,u41;if(v41===void 0){v41=0;}if(w41===void 0){w41=0;}if(w41==0){w41=j41["length"];}for(var e41=v41;e41<w41;e41++){h41=j41[e41];u41=p81["GeoJsonReader"]["getGeometryType"](h41["geometry"]["type"]);switch(u41){case p81["GeometryType"]["linestring"]:this["addlineObjectTo"](h41);break;default:console["info"]("processFeature:아직 코드가 작성되지 않았습니다.");}}};e81["prototype"]["addlineObjectTo"]=function(Q41){var K41,b41,c41,N41,P41,B41,q41;K41=Q41["geometry"]["coordinates"];b41=[];for(var d41=0;d41<K41["length"];d41++){c41=K41[d41];N41=c41[0];P41=c41[1];B41=p81["Util"]["isDefined"](c41["2"])?c41["2"]:0;b41["push"](new THREE["Vector3"](N41,P41,B41));}q41=p81["UserObject"]["createWorldObject"]("이름없음",b41,true);this["addUserObject"](q41);};e81["prototype"]["startTask"]=function(f41){console["warn"]("startTask has been deprecated. Use load instead.");return this["load"](f41,null,true);};e81["prototype"]["updateGisObjects"]=function(m21){var H21;for(var k21 in this["gisObjects"]){H21=this["gisObjects"][k21];if(m21){if(H21["isShow"]()){H21["update"]();}else{}}}};e81["prototype"]["updateUserObjects"]=function(E21){var V21;for(var L21 in this["userObjects"]){V21=this["userObjects"][L21];{V21["update"]();}}};e81["prototype"]["updatePointMeshs"]=function(Y21){var y21;for(var s21 in this["pointMeshs"]){y21=this["pointMeshs"][s21];if(Y21){y21["update"]();}y21["checkSelfMemory"]();}};e81["getFileFormatName"]=function(l21){switch(l21){case p81["FileFormat"]["_3ds"]:return"3ds";case p81["FileFormat"]["_jpg"]:return"jpg";case p81["FileFormat"]["_json"]:return"application/json";}return null;};e81["generateWFSURL"]=function(F21,a21,X21,T21){var C21,M21,G21,W21,D21,A21,r21,z21,n21,R21,g21,U21;C21=F21["serverURL"];M21=F21["dataSetName"];G21="application/json";W21="EPSG:4326";D21="1.1.0";A21="GetFeature";if(p81["Util"]["isDefined"](F21["fileFormat"])){G21=e81["getFileFormatName"](F21["fileFormat"]);}r21=p81["CmMathEngine"]["getBoundFromRowCol"](a21,X21,T21);z21=r21["West"];n21=r21["East"];R21=r21["South"];g21=r21["North"];U21=C21+"?SERVICE=WFS"+"&VERSION="+D21+"&REQUEST="+A21+"&OUTPUTFORMAT="+G21+"&SRSNAME="+W21+"&BBOX="+z21+","+R21+","+n21+","+g21+","+W21;if(p81["Util"]["isDefined"](M21)){U21+="&TYPENAME="+M21;}return U21;};;return e81;}(p81["VectorTileBase"]);S81["maxUpdateElapsedTime"]=10*1000;p81["VectorTile"]=S81;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var t21;t21=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(O21,o21){O21["__proto__"]=o21;}||function(x21,Z21){for(var J21 in Z21)if(Z21["hasOwnProperty"](J21))x21[J21]=Z21[J21];};return function(p21,i21){function S21(){this["constructor"]=p21;}t21(p21,i21);p21["prototype"]=i21===null?Object["create"](i21):(S21["prototype"]=i21["prototype"],new S21());};}();(function(I21){var w21;w21=function(v21){function e21(j21,u21,c21,d21,K21){var h21;h21=v21["call"](this,K21)||this;h21["renderObject"]=new Array();h21["poiObjects"]=new Array();h21["pointMeshs"]=new Array();h21["cmvReader"]=null;h21["geojsonReader"]=null;h21["needsUpdate"]=false;h21["imageUsed"]=false;h21["layerName"]="";h21["url"]="";h21["imageWidth"]=256;h21["imageHeight"]=256;h21["image"]=null;h21["imageLoadOK"]=false;h21["context"]=null;h21["xf"]=0;h21["yf"]=0;h21["set"](j21,u21,c21,d21);I21["CmWorld"]["outputInfo"]('VectorImageTile is created '+h21["level"]+':'+h21["row"]+':'+h21["col"]);return h21;}__extends(e21,v21);e21["prototype"]["set"]=function(b21,N21,P21,B21){var q21;q21=this["cmworld3Viewer"];this["layerName"]=b21;this["level"]=N21;this["row"]=P21;this["col"]=B21;this["url"]=q21["option"]["vectorImageLayerManager"]["getTileURL"](b21,N21,P21,B21);};e21["prototype"]["dispose"]=function(){this["clear"]();this["disposed"]=true;};e21["prototype"]["clear"]=function(){for(var Q21 in this["pointMeshs"]){this["pointMeshs"][Q21]["dispose"]();}this["renderObject"]=new Array();this["poiObjects"]=new Array();this["pointMeshs"]=new Array();this["context"]=null;this["image"]=null;};e21["prototype"]["loadData"]=function(){};e21["prototype"]["update"]=function(){var k11,f21,H11;if(!this["initialized"]){k11=this["cmworld3Viewer"];if(this["Reqeusted"]==false){k11["option"]["vectorImageLayerManager"]["requestDownload"]({owner:this,url:this["url"],ResultFunc:function(L11){if(L11){}}});this["Reqeusted"]=true;}else{if(this["cmvReader"]!=null){f21=window["performance"]["now"]();H11=f21;do{if(this["cmvReader"]["tryTask"](true)==true){this["initialized"]=true;return;}if(this["cmvReader"]["isDone"]==true){this["initialized"]=true;return;}H11=window["performance"]["now"]();}while(H11-f21<k11["option"]["CMVTaskInterval"]);}else if(this["geojsonReader"]!=null){f21=window["performance"]["now"]();H11=f21;do{if(this["geojsonReader"]["tryTask"](true)==true){this["initialized"]=true;return;}if(this["geojsonReader"]["isDone"]==true){this["initialized"]=true;return;}H11=window["performance"]["now"]();}while(H11-f21<k11["option"]["CMVTaskInterval"]);}}}};e21["prototype"]["getImage"]=function(){var V11;if(this["initialized"]==false){this["update"]();return null;}V11=this["cmworld3Viewer"];if(V11["option"]["vectorImageLayerManager"]["getLayerVisible"](this["layerName"])==false){return null;}return this["image"];};e21["prototype"]["redraw"]=function(){var E11,y11;E11=this["parentLayer"]["mapInfo"];if(!E11){return;}if(this["cmvReader"]==null&&this["geojsonReader"]==null){return;}{y11=this["cmworld3Viewer"];if(I21["Util"]["isDefined"](this["image"])==false){this["image"]=document["createElement"]("canvas");this["image"]["transparent"]=true;this["image"]["width"]=this["imageWidth"];this["image"]["height"]=this["imageHeight"];this["context"]=this["image"]["getContext"]("2d");this["context"]["strokeStyle"]='yellow';this["context"]["lineWidth"]=2.0;}this["bound"]=I21["CmMathEngine"]["getBoundFromRowCol"](this["level"],this["row"],this["col"]);this["styles"]=y11["option"]["vectorImageLayerManager"]["getLayerStyle"](this["layerName"]);this["xf"]=this["imageWidth"]/(this["bound"]["East"]-this["bound"]["West"]);this["yf"]=this["imageHeight"]/(this["bound"]["North"]-this["bound"]["South"]);}if(this["cmvReader"]!=null){this["cmvReader"]["setRedraw"]();}else if(this["geojsonReader"]!=null){this["geojsonReader"]["setRedraw"]();}this["initialized"]=false;};e21["prototype"]["updateStyle"]=function(){var s11;s11=this["cmworld3Viewer"];this["styles"]=s11["option"]["vectorImageLayerManager"]["getLayerStyle"](this["layerName"]);};e21["prototype"]["startTask"]=function(Y11,F11){var r11,l11;r11=this["cmworld3Viewer"];l11=this["parentLayer"]["mapInfo"];if(!l11){this["initialized"]=true;return null;}if(l11["fileFormat"]==I21["FileFormat"]["_cmv"]){Y11["cmvReader"]=new I21["CMVReader"](null,Y11,F11);if(I21["Util"]["isDefined"](this["image"])==false){this["image"]=document["createElement"]("canvas");this["image"]["transparent"]=true;this["image"]["width"]=this["imageWidth"];this["image"]["height"]=this["imageHeight"];this["context"]=this["image"]["getContext"]("2d");this["context"]["strokeStyle"]='yellow';this["context"]["lineWidth"]=2.0;}this["bound"]=I21["CmMathEngine"]["getBoundFromRowCol"](this["level"],this["row"],this["col"]);this["styles"]=r11["option"]["vectorImageLayerManager"]["getLayerStyle"](this["layerName"]);this["xf"]=this["imageWidth"]/(this["bound"]["East"]-this["bound"]["West"]);this["yf"]=this["imageHeight"]/(this["bound"]["North"]-this["bound"]["South"]);return Y11["cmvReader"]["isCorrect"];}else if(l11["fileFormat"]==I21["FileFormat"]["_json"]){Y11["geojsonReader"]=new I21["GeoJsonReader"](null,Y11,F11);if(I21["Util"]["isDefined"](this["image"])==false){this["image"]=document["createElement"]("canvas");this["image"]["transparent"]=true;this["image"]["width"]=this["imageWidth"];this["image"]["height"]=this["imageHeight"];this["context"]=this["image"]["getContext"]("2d");this["context"]["strokeStyle"]='yellow';this["context"]["lineWidth"]=2.0;}this["bound"]=I21["CmMathEngine"]["getBoundFromRowCol"](this["level"],this["row"],this["col"]);this["styles"]=r11["option"]["vectorImageLayerManager"]["getLayerStyle"](this["layerName"]);this["xf"]=this["imageWidth"]/(this["bound"]["East"]-this["bound"]["West"]);this["yf"]=this["imageHeight"]/(this["bound"]["North"]-this["bound"]["South"]);return Y11["geojsonReader"]["isCorrect"];}};return e21;}(I21["VectorTileBase"]);I21["VectorImageTile"]=w21;}(CMWORLD||(CMWORLD={})));vw_Object=function(){function W11(){}return W11;}();__extends=this&&this["__extends"]||function(){var U11;U11=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(G11,M11){G11["__proto__"]=M11;}||function(A11,D11){for(var C11 in D11)if(D11["hasOwnProperty"](C11))A11[C11]=D11[C11];};return function(n11,z11){U11(n11,z11);n11["prototype"]=z11===null?Object["create"](z11):(R11["prototype"]=z11["prototype"],new R11());function R11(){this["constructor"]=n11;}};}();(function(g11){var X11;X11=function(a11){__extends(T11,a11);T11["prototype"]["clear"]=function(){a11["prototype"]["clear"]["call"](this);};T11["prototype"]["getTileURL"]=function(o11,Z11,x11){var J11,i11,p11,S11,I11,w11;if(this["mapInfo"]!=null){if(o11>this["mapInfo"]["MaxLevel"]||o11<this["mapInfo"]["MinLevel"]){return null;}J11=this["cmworld3"];i11=g11["CmMathEngine"]["getRowFromLatitude"](this["mapInfo"]["North"],J11["option"]["TileLevelRange"][o11]);p11=g11["CmMathEngine"]["getRowFromLatitude"](this["mapInfo"]["South"],J11["option"]["TileLevelRange"][o11]);if(Z11<p11||Z11>i11)return null;S11=g11["CmMathEngine"]["getColFromLongitude"](this["mapInfo"]["West"],J11["option"]["TileLevelRange"][o11]);I11=g11["CmMathEngine"]["getColFromLongitude"](this["mapInfo"]["East"],J11["option"]["TileLevelRange"][o11]);if(x11<S11||x11>I11)return null;w11=g11["TiledMapInfo"]["applyIndex"](this["mapInfo"]["serverURL"],o11,Z11,x11);return w11;}return null;};T11["prototype"]["addTile"]=function(e11){if(e11==null)return;if(this["m_tiles"][e11["level"]]==null)this["m_tiles"][e11["level"]]=new Array();if(this["m_tiles"][e11["level"]][e11["row"]]==null)this["m_tiles"][e11["level"]][e11["row"]]=new Array();e11["parentLayer"]=this;this["m_tiles"][e11["level"]][e11["row"]][e11["col"]]=e11;};function T11(O11){var t11;t11=a11["call"](this,O11)||this;t11["cmworld3"]=g11["CmWorld3"]["getInstance"]();return t11;}T11["prototype"]["generateTile"]=function(u11,h11,j11){var B11,d11,c11,v11,N11,P11,K11,b11,q11;B11=this["getTile"](u11,h11,j11);if(B11!=null){return;}d11=g11["Tile"]["getKeyString"](u11,h11,j11);if(this["emptyTiles"][d11])return;c11=this["getTileURL"](u11,h11,j11);if(c11==null){this["addEmptyTile"](d11);return;}if(this["cmworld3"]["downloadManager"]["isRequested"](c11)){return;}{v11=this;N11=this["cmworld"];P11=g11["Tile"]["getBoundary"](u11,h11,j11);K11=P11["getCenter"]();b11=g11["CmMathEngine"]["Geo2Cartesian"](K11["x"],K11["y"],g11["cm_const"]["EarthRadius"]);b11["sub"](N11["getCamera"]()["getPositionWorld"]());q11={level:u11,row:h11,col:j11};this["cmworld3"]["downloadManager"]["requestDownload"](c11,g11["FileFormat"]["_dat"],b11["length"](),q11,function(Q11){var H51,k51,m51,f11,L51,V51,E51,y51;if(Q11["response"]){H51=Q11["tag"]["level"];k51=Q11["tag"]["row"];m51=Q11["tag"]["col"];f11=new g11["vw_Real3DTile"](v11,H51,k51,m51);f11["parentLayer"]=v11;f11["serverURL"]=v11["getMapInfo"]()["serverURL"];f11["resourceURL"]=v11["getMapInfo"]()["getResourceURL"]();if(f11["loadFromStream"](Q11["response"])){v11["addTile"](f11);return;}}L51=Q11["tag"]["level"];V51=Q11["tag"]["row"];E51=Q11["tag"]["col"];y51=g11["Tile"]["getKeyString"](L51,V51,E51);v11["addEmptyTile"](y51);});}};T11["prototype"]["update"]=function(){var Y51,G51,A51,U51,s51,M51,C51,D51,F51;this["getScene"]()["visible"]=this["visible"];if(this["visible"]==false)return;Y51=this["cmworld3"];G51=Y51["getCamera"]()["getPositionGeo"]()["z"]-g11["cm_const"]["EarthRadius"];if(G51>Y51["option"]["getDislayDist4Level"](this["mapInfo"]["MinLevel"]-2)){this["clearAllTile"]();return;}A51=Y51["getCamera"]()["getPositionGeo"]();U51=0;for(var l51 in this["m_tiles"]){for(var r51 in this["m_tiles"][l51]){for(var W51 in this["m_tiles"][l51][r51]){s51=this["m_tiles"][l51][r51][W51];if(s51!=null&&s51["disposed"]==false){M51=s51["getWorldPos"]();C51=Y51["getCamera"]()["getDistanceToWorldPos"](M51);{D51=s51["level"]-2;if(C51>Y51["option"]["getDislayDist4Level"](D51)){s51["dispose"]();delete this["m_tiles"][l51][r51][W51];continue;}}U51++;s51["update"]();}}}}{if(T11["vw_UpdateTextureCandidate"]["candidate"]!=null){F51=T11["vw_UpdateTextureCandidate"]["candidate"];if(F51){F51["updateTexture"](T11["vw_UpdateTextureCandidate"]["material"],T11["vw_UpdateTextureCandidate"]["url"]);}T11["vw_UpdateTextureCandidate"]["candidate"]=null;}}};T11["requestModelFile"]=function(n51,R51,g51){var z51;z51=g11["CmWorld3"]["getInstance"]();return z51["downloadManager"]["requestModelDownload"](n51["getModelUrl"](),g11["FileFormat"]["_xdo"],R51,g51);};T11["vwRequestUpdateMesh"]=function(T51,a51){var X51;X51=g11["CmWorld3"]["getInstance"]();X51["modelLoadManager"]["requestGenMesh"](T51,a51);};T11["vwRequestTextureUpdate"]=function(O51,o51,t51,J51){if(T11["vw_UpdateTextureCandidate"]["candidate"]!=null){if(T11["vw_UpdateTextureCandidate"]["distance"]>t51){T11["vw_UpdateTextureCandidate"]["candidate"]=O51;T11["vw_UpdateTextureCandidate"]["material"]=o51;T11["vw_UpdateTextureCandidate"]["distance"]=t51;T11["vw_UpdateTextureCandidate"]["url"]=J51;}}else{T11["vw_UpdateTextureCandidate"]["candidate"]=O51;T11["vw_UpdateTextureCandidate"]["material"]=o51;T11["vw_UpdateTextureCandidate"]["distance"]=t51;T11["vw_UpdateTextureCandidate"]["url"]=J51;}};return T11;}(g11["VectorTileLayer"]);X11["vw_UpdateTextureCandidate"]=new g11["downloadCandidate"]();g11["vw_Real3DLayer"]=X11;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var Z51;Z51=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(x51,i51){x51["__proto__"]=i51;}||function(I51,S51){for(var p51 in S51)if(S51["hasOwnProperty"](p51))I51[p51]=S51[p51];};return function(e51,w51){function v51(){this["constructor"]=e51;}Z51(e51,w51);e51["prototype"]=w51===null?Object["create"](w51):(v51["prototype"]=w51["prototype"],new v51());};}();(function(h51){var j51;j51=function(c51){__extends(u51,c51);u51["prototype"]["dispose"]=function(){c51["prototype"]["dispose"]["call"](this);this["clear"]();this["disposed"]=true;};u51["prototype"]["clear"]=function(){c51["prototype"]["clear"]["call"](this);for(var B51 in this["buildingObjects"]){this["buildingObjects"][B51]["dispose"]();}this["buildingObjects"]=[];};u51["prototype"]["update"]=function(){var Q51,f51,k61,q51;if(this["tileScene"]){this["tileScene"]["visible"]=false;}if(this["parentLayer"]!=null&&this["parentLayer"]["visible"]==false)return;Q51=false;f51=this["cmworld3Viewer"]["getCamera"]()["getDistanceToWorldPos"](this["getWorldPos"]());if(f51>this["cmworld3Viewer"]["option"]["getDislayDist4Level"](this["level"]-4)){if(this["activityChecker"]["isActivity"](this["cmworld3Viewer"]["option"]["renderFrameTime"])==false){Q51=true;}else{return;}}if(Q51==false){k61=this["getBoundingBox"]();}this["activityChecker"]["activity"](this["cmworld3Viewer"]["option"]["renderFrameTime"]);if(this["tileScene"]){this["tileScene"]["visible"]=true;}for(var H61 in this["buildingObjects"]){q51=this["buildingObjects"][H61];if(this["cmworld3Viewer"]["option"]["renderFrameTime"]-q51["lastShowTime"]>h51["PointMesh"]["deleteMeshTime"]){{}q51["releaseMesh"]();}if(Q51==false){if(q51["isShow"]()){q51["update"]();}else{q51["setShowMesh"](false);}}}};u51["prototype"]["loadFromStream"]=function(L61){var m61;this["clear"]();m61=u51["parsingDataFromStream"](L61,this["parentLayer"]["mapInfo"]["fileFormat"],this["buildingObjects"],this);return m61;};u51["parsingDataFromStream"]=function(E61,Y61,y61,s61){var V61;V61=false;switch(Y61){case h51["FileFormat"]["_dat"]:V61=u51["loadDat"](E61,y61,s61);break;case h51["FileFormat"]["_spi"]:V61=u51["loadSPI"](E61,y61,s61);break;case h51["FileFormat"]["_pbuf"]:V61=u51["loadPBuf"](E61,y61,s61);break;case h51["FileFormat"]["_avro"]:V61=u51["loadAvro"](E61,y61,s61);break;case h51["FileFormat"]["_json"]:V61=u51["loadJson"](E61,y61,s61);break;}return V61;};u51["loadPBuf"]=function(z61,D61,C61){var W61,n61,R61,g61,F61,U61,G61,r61,A61,l61;if(h51["Util"]["isDefined"](z61)==false)return;W61=proto["spiBuildingsPBuf"]["deserializeBinary"](z61);n61=W61["getLevel"]();R61=W61["getIdx"]();g61=W61["getIdy"]();F61=W61["getObjarrayList"]();if(h51["Util"]["isDefined"](F61)==false||F61["length"]<1){return true;}U61=Number["MAX_VALUE"];G61=Number["MIN_VALUE"];for(var M61=0;M61<F61["length"];M61++){r61=F61[M61];A61=new h51["vw_Building"](C61);l61=new vw_Object();l61["version"]=0;l61["ObjectType"]=r61["getType"]();l61["Key"]=r61["getKey"]();h51["CmWorld"]["outputInfo"](l61["Key"]);l61["CenterPos"]=new THREE["Vector2"]();l61["CenterPos"]["x"]=r61["getCenterposx"]();l61["CenterPos"]["y"]=r61["getCenterposy"]();l61["Altitude"]=r61["getAltitude"]();l61["Box"]=new THREE["Box3"]();l61["Box"]["min"]["x"]=r61["getBoxminx"]();l61["Box"]["min"]["y"]=r61["getBoxminy"]();l61["Box"]["min"]["z"]=r61["getBoxminz"]();l61["Box"]["max"]["x"]=r61["getBoxmaxx"]();l61["Box"]["max"]["y"]=r61["getBoxmaxy"]();l61["Box"]["max"]["z"]=r61["getBoxmaxz"]();if(G61<l61["Box"]["max"]["z"]){G61=l61["Box"]["max"]["z"];}if(U61>l61["Box"]["min"]["z"]){U61=l61["Box"]["min"]["z"];}l61["dataFileName"]=r61["getDatafilename"]();A61["objInfo"]=l61;D61["push"](A61);}if(D61["length"]>0){D61["sort"](function(X61,T61){return X61["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"]-T61["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"];});}if(h51["Util"]["isDefined"](C61)){C61["minHeight"]=U61;C61["maxHeight"]=G61;}return true;};u51["loadAvro"]=function(p61,S61,i61){var w61,o61,e61,v61,h61,O61,J61,Z61,t61,I61,a61;if(h51["Util"]["isDefined"](p61)==false)return;if(h51["Util"]["isDefined"](u51["avroParsor"])==false){}w61=new CmAvro["Buffer"](p61,0,p61["byteLength"]);o61=u51["avroParsor"]["fromBuffer"](w61);e61=o61["level"];v61=o61["idx"];h61=o61["idy"];O61=o61["objArray"];if(h51["Util"]["isDefined"](O61)==false||O61["length"]<1){return true;}J61=Number["MAX_VALUE"];Z61=Number["MIN_VALUE"];for(var x61=0;x61<O61["length"];x61++){t61=O61[x61];I61=new h51["vw_Building"](i61);a61=new vw_Object();a61["version"]=t61["version"];a61["ObjectType"]=t61["type"];a61["Key"]=t61["key"];h51["CmWorld"]["outputInfo"](a61["Key"]);a61["CenterPos"]=new THREE["Vector2"]();a61["CenterPos"]["x"]=t61["x"];a61["CenterPos"]["y"]=t61["y"];a61["Altitude"]=t61["h"];a61["Box"]=new THREE["Box3"]();a61["Box"]["min"]["x"]=t61["boxminX"];a61["Box"]["min"]["y"]=t61["boxminY"];a61["Box"]["min"]["z"]=t61["boxminZ"];a61["Box"]["max"]["x"]=t61["boxmaxX"];a61["Box"]["max"]["y"]=t61["boxmaxY"];a61["Box"]["max"]["z"]=t61["boxmaxZ"];if(Z61<a61["Box"]["max"]["z"]){Z61=a61["Box"]["max"]["z"];}if(J61>a61["Box"]["min"]["z"]){J61=a61["Box"]["min"]["z"];}a61["ImgLevel"]=t61["imglevcount"];a61["dataFileName"]=t61["filename"];a61["imgFileName"]="";I61["objInfo"]=a61;S61["push"](I61);}if(S61["length"]>0){S61["sort"](function(j61,u61){return j61["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"]-u61["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"];});}if(h51["Util"]["isDefined"](i61)){i61["minHeight"]=J61;i61["maxHeight"]=Z61;}return true;};u51["loadJson"]=function(H91,Q61,q61){var b61,k91,m91,L91,K61,N61,P61,d61,f61,c61;if(h51["Util"]["isDefined"](H91)==false)return false;b61=JSON["parse"](H91);k91=b61["Lev"];m91=b61["TileX"];L91=b61["TileY"];K61=b61["ObjArray"];if(h51["Util"]["isDefined"](K61)==false||K61["length"]<1){return true;}N61=Number["MAX_VALUE"];P61=Number["MIN_VALUE"];for(var B61=0;B61<K61["length"];B61++){d61=K61[B61];f61=new h51["vw_Building"](q61);c61=new vw_Object();c61["version"]=0;c61["ObjectType"]=d61["FSType"];c61["Key"]=d61["ID"];h51["CmWorld"]["outputInfo"](c61["Key"]);c61["CenterPos"]=new THREE["Vector2"]();c61["CenterPos"]["x"]=d61["X"];c61["CenterPos"]["y"]=d61["Y"];c61["Altitude"]=d61["H"];c61["Box"]=new THREE["Box3"]();c61["Box"]["min"]["x"]=d61["BMinX"];c61["Box"]["min"]["y"]=d61["BMinY"];c61["Box"]["min"]["z"]=d61["BMinZ"];c61["Box"]["max"]["x"]=d61["BMaxX"];c61["Box"]["max"]["y"]=d61["BMaxY"];c61["Box"]["max"]["z"]=d61["BMaxZ"];if(P61<c61["Box"]["max"]["z"]){P61=c61["Box"]["max"]["z"];}if(N61>c61["Box"]["min"]["z"]){N61=c61["Box"]["min"]["z"];}c61["dataFileName"]=d61["FileName"];c61["imgFileName"]="";f61["objInfo"]=c61;Q61["push"](f61);}if(Q61["length"]>0){Q61["sort"](function(V91,E91){return V91["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"]-E91["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"];});}if(h51["Util"]["isDefined"](q61)){q61["minHeight"]=N61;q61["maxHeight"]=P61;}return true;};function u51(K51,b51,N51,P51){var d51;d51=c51["call"](this,K51,b51,N51,P51)||this;d51["buildingObjects"]=new Array();d51["parentLayer"]=null;d51["parentLayer"]=K51;return d51;}u51["loadDat"]=function(A91,M91,F91){var y91,l91,Y91,g91,n91,R91,G91,W91,U91,D91,s91,r91,z91;if(h51["Util"]["isDefined"](A91)==false)return;y91=new h51["BinaryReader"](A91,true);if(h51["vwUtility"]["isNotFoundFlag"](y91)){y91["dispose"]();return false;}Y91=[];y91["seek"](0);g91=y91["readUInt32"]();n91=y91["readUInt32"]();R91=y91["readUInt32"]();G91=y91["readUInt32"]();if(G91<1){y91["dispose"]();return true;}W91=Number["MAX_VALUE"];U91=Number["MIN_VALUE"];for(var C91=0;C91<G91;C91++){D91=new h51["vw_Building"](F91);s91=new vw_Object();r91=y91["readBytes"](4);z91=r91[0]["toString"]()+r91[1]["toString"]()+r91[2]["toString"]()+r91[3]["toString"]();s91["version"]=parseInt(z91);s91["ObjectType"]=y91["readUInt8"]();l91=y91["readUInt8"]();Y91=y91["readBytes"](l91);s91["Key"]=y91["bin2String"](Y91);h51["CmWorld"]["outputInfo"](s91["Key"]);s91["CenterPos"]=new THREE["Vector2"]();s91["CenterPos"]["x"]=y91["readDouble"]();s91["CenterPos"]["y"]=y91["readDouble"]();s91["Altitude"]=y91["readSingle"]();s91["Box"]=new THREE["Box3"]();s91["Box"]["min"]["x"]=y91["readDouble"]();s91["Box"]["min"]["y"]=y91["readDouble"]();s91["Box"]["min"]["z"]=y91["readDouble"]();s91["Box"]["max"]["x"]=y91["readDouble"]();s91["Box"]["max"]["y"]=y91["readDouble"]();s91["Box"]["max"]["z"]=y91["readDouble"]();if(U91<s91["Box"]["max"]["z"]){U91=s91["Box"]["max"]["z"];}if(W91>s91["Box"]["min"]["z"]){W91=s91["Box"]["min"]["z"];}s91["ImgLevel"]=y91["readUInt8"]();l91=y91["readUInt8"]();Y91=y91["readBytes"](l91);s91["dataFileName"]=y91["bin2String"](Y91);l91=y91["readUInt8"]();Y91=y91["readBytes"](l91);s91["imgFileName"]=y91["bin2String"](Y91);D91["objInfo"]=s91;M91["push"](D91);}if(M91["length"]>0){M91["sort"](function(X91,T91){return X91["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"]-T91["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"];});}y91["dispose"]();if(h51["Util"]["isDefined"](F91)){F91["minHeight"]=W91;F91["maxHeight"]=U91;}return true;};u51["loadSPI"]=function(S91,p91,o91){var J91,O91,x91,i91,a91,t91;if(h51["Util"]["isDefined"](S91)==false)return false;J91=h51["SPILoader"]["parseBinary"](S91);if(h51["Util"]["isDefined"](J91)==false)return false;O91=Number["MAX_VALUE"];x91=Number["MIN_VALUE"];for(var Z91=0;Z91<J91["objects"]["length"];Z91++){i91=new h51["vw_Building"](o91);a91=new vw_Object();t91=J91["objects"][Z91];a91["ObjectType"]=0;a91["version"]=0;a91["Key"]=t91["key"];a91["CenterPos"]=new THREE["Vector2"]();a91["CenterPos"]["x"]=t91["x"];a91["CenterPos"]["y"]=t91["y"];a91["Altitude"]=t91["h"];a91["Box"]=new THREE["Box3"]();a91["Box"]["min"]["x"]=t91["bboxMinx"];a91["Box"]["min"]["y"]=t91["bboxMiny"];a91["Box"]["min"]["z"]=t91["bboxMinz"];a91["Box"]["max"]["x"]=t91["bboxMaxx"];a91["Box"]["max"]["y"]=t91["bboxMaxy"];a91["Box"]["max"]["z"]=t91["bboxMaxz"];if(x91<a91["Box"]["max"]["z"]){x91=a91["Box"]["max"]["z"];}if(O91>a91["Box"]["min"]["z"]){O91=a91["Box"]["min"]["z"];}a91["dataFileName"]=t91["fileName"];i91["objInfo"]=a91;p91["push"](i91);}if(p91["length"]>0){p91["sort"](function(I91,w91){return I91["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"]-w91["objInfo"]["Box"]["getBoundingSphere"](new THREE["Sphere"]())["radius"];});}if(h51["Util"]["isDefined"](o91)){o91["minHeight"]=O91;o91["maxHeight"]=x91;}return true;};return u51;}(h51["VectorTile"]);h51["vw_Real3DTile"]=j51;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var e91;e91=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(v91,h91){v91["__proto__"]=h91;}||function(c91,u91){for(var j91 in u91)if(u91["hasOwnProperty"](j91))c91[j91]=u91[j91];};return function(K91,d91){e91(K91,d91);K91["prototype"]=d91===null?Object["create"](d91):(b91["prototype"]=d91["prototype"],new b91());function b91(){this["constructor"]=K91;}};}();(function(N91){var P91;P91=function(q91){__extends(B91,q91);B91["prototype"]["dispose"]=function(){this["modelFileBuffer"]=null;this["releaseMesh"]();};B91["prototype"]["setModelFileBuffer"]=function(H01){if(N91["Util"]["isDefined"](H01)){if(H01["byteLength"]>0){this["modelFileBuffer"]=H01;}else{this["modelFileBuffer"]=null;this["modelFileNotExist"]=true;}}this["requestedFile"]=false;};B91["getTexLevel"]=function(k01){if(k01>500)return 0;if(k01>400)return 1;if(k01>300)return 2;if(k01>200)return 3;if(k01>100)return 4;return 5;};B91["prototype"]["setShowMesh"]=function(m01){if(this["meshObject"]!=null){this["meshObject"]["visible"]=m01;}};B91["prototype"]["setFail"]=function(){this["modelFileNotExist"]=true;};function B91(f91){var Q91;Q91=q91["call"](this)||this;Q91["objInfo"]=null;Q91["height"]=0;Q91["meshScale"]=null;Q91["worldPosition"]=null;Q91["meshObject"]=null;Q91["limitedDistance"]=N91["PointMesh"]["maxLimitedDistance"];Q91["updatingTexture"]=false;Q91["requestedTexture_time"]=0;Q91["textureChanged_time"]=0;Q91["imageFileNotExist"]=false;Q91["completeModel"]=false;Q91["requestedFile"]=false;Q91["modelFileNotExist"]=false;Q91["modelFileBuffer"]=null;Q91["modelURL"]=null;Q91["textureUrl"]=null;Q91["cmworld"]=N91["CmWorld3"]["getInstance"]();Q91["xrotate"]=0;Q91["yrotate"]=0;Q91["zrotate"]=0;Q91["cmworld3"]=N91["CmWorld3"]["getInstance"]();Q91["parentTile"]=f91;return Q91;}B91["prototype"]["releaseMesh"]=function(){this["completeModel"]=false;if(this["meshObject"]!=null){N91["CmWorld"]["outputInfo"]("releaseMesh"+this["objInfo"]["Key"]);this["setShowMesh"](false);this["parentTile"]["removeAtScene"](this["meshObject"]);this["cmworld3"]["requestDispose"](this["meshObject"]);this["meshObject"]=null;}};B91["prototype"]["getWorldPos"]=function(){var L01;if(this["worldPosition"]==null){L01=this["cmworld3"];this["worldPosition"]=N91["CmMathEngine"]["Geo2Cartesian"](this["objInfo"]["CenterPos"]["x"],this["objInfo"]["CenterPos"]["y"],N91["cm_const"]["EarthRadius"]+(this["objInfo"]["Altitude"]+this["height"]*0.5)*L01["option"]["VerticalExaggeration"]);}return this["worldPosition"]["clone"]();};B91["prototype"]["isShow"]=function(){var V01,E01,y01,s01;V01=this["cmworld3"];E01=this["getWorldPos"]();E01["sub"](V01["option"]["refCenter"]);y01=20;if(this["meshObject"]!=null){y01=this["meshObject"]["geometry"]["boundingSphere"]["radius"];}s01=new THREE["Sphere"](E01,y01);if(V01["cameraFrustum"]["intersectsSphere"](s01)){return true;}return false;};B91["prototype"]["update"]=function(){var Y01,l01,r01;if(this["modelFileNotExist"]){return;}this["setShowMesh"](false);Y01=this["cmworld"]["getCamera"]()["getDistanceToWorldPos"](this["getWorldPos"]());if(Y01<this["limitedDistance"]){if(this["meshObject"]==null){if(this["modelFileBuffer"]!=null){N91["vw_Real3DLayer"]["vwRequestUpdateMesh"](this,Y01);}else if(this["requestedFile"]==false){l01=this;N91["vw_Real3DLayer"]["requestModelFile"](this,Y01,function(F01){if(F01["response"]!=null){if(F01["url"]==l01["getModelUrl"]()){l01["setModelFileBuffer"](F01["response"]);}else{}}else{l01["modelFileNotExist"]=true;}});}}else{r01=this["getWorldPos"]()["add"](this["meshObject"]["geometry"]["boundingSphere"]["center"]);Y01=this["cmworld"]["getCamera"]()["getDistanceToWorldPos"](r01);Y01-=this["meshObject"]["geometry"]["boundingSphere"]["radius"];this["render"](Y01);}}};B91["prototype"]["genWorkerParam"]=function(){var W01,G01,U01;W01=this["modelFileBuffer"];if(N91["Util"]["isDefined"](W01)==false){return null;}G01=this["parentTile"]["resourceURL"]+"&FileName=";U01={owner:this,uid:this["uid"],url:this["modelURL"],version:this["objInfo"]["version"],fileName:this["objInfo"]["dataFileName"],fileFormat:N91["FileFormat"]["_xdo"],dataAltitude:this["objInfo"]["Altitude"],resourceurl:this["textureUrl"],arraybuffer:W01,xorig:this["objInfo"]["CenterPos"]["x"],yorig:this["objInfo"]["CenterPos"]["y"],zorig:this["objInfo"]["Altitude"]};return U01;};B91["prototype"]["makeTextureMaterialFromImage"]=function(D01){var M01,C01;M01=new THREE["Texture"](D01);M01["anisotropy"]=this["cmworld3"]["renderer"]["capabilities"]["getMaxAnisotropy"]();;M01["needsUpdate"]=true;C01=new THREE["MeshPhongMaterial"]({map:M01,specular:0,shininess:30,side:THREE["DoubleSide"]});N91["Material"]["addClippingAttri"](C01);return C01;};B91["prototype"]["makeColorMaterialFromColor"]=function(z01){var A01;if(!z01){z01=0x0f0f0f;}A01=new THREE["MeshPhongMaterial"]({color:z01,specular:0,shininess:30,side:THREE["DoubleSide"]});A01["clipping"]=true;A01["clippingPlanes"]=this["cmworld"]["clipBox"]["localPlanes"];A01["clipIntersection"]=true;return A01;};B91["prototype"]["setMesh"]=function(X01){var n01,R01,T01,g01,a01;if(X01==null&&X01["length"]<1)return;n01=X01[0];R01=this["cmworld3"];this["modelFileBuffer"]=null;this["height"]=n01["userData"];T01=(this["objInfo"]["Altitude"]+this["height"]*0,5)*R01["option"]["VerticalExaggeration"];if(T01<-9000){console["warn"]("PointMesh:getGroundHeight 에서 높이를 구하지 못했다.");T01=0;}n01["key"]=this["objInfo"]["Key"];this["worldPosition"]=N91["CmMathEngine"]["Geo2Cartesian"](this["objInfo"]["CenterPos"]["x"],this["objInfo"]["CenterPos"]["y"],N91["cm_const"]["EarthRadius"]+(this["height"]*0.5+this["objInfo"]["Altitude"])*R01["option"]["VerticalExaggeration"]);g01=this["worldPosition"]["clone"]();a01=g01["clone"]()["normalize"]();g01["sub"](R01["option"]["refCenter"]);n01["position"]["copy"](g01);n01["scale"]["x"]=n01["scale"]["y"]=n01["scale"]["z"]=1;n01["material"]['color']=new THREE["Color"](0xffffff);n01["material"]['specular']=new THREE["Color"](0x000000);n01["castShadow"]=true;n01["receiveShadow"]=true;if(n01["geometry"]["boundingSphere"]==null)n01["geometry"]["computeBoundingSphere"]();this["limitedDistance"]=N91["PointMesh"]["adjustViewRange"](n01["geometry"]["boundingSphere"]["radius"]);this["releaseMesh"]();this["meshObject"]=n01;this["setShowMesh"](false);this["parentTile"]["addToScene"](this["meshObject"]);this["lastShowTime"]=R01["option"]["renderFrameTime"];};B91["prototype"]["makeInWorker"]=function(o01){var t01,O01;t01=this["cmworld3"];O01=t01["workerManager"]["rentModelWorker"]();if(O01==null)return false;return true;};B91["prototype"]["getModelUrl"]=function(){var x01,J01,Z01;if(N91["Util"]["isDefined"](this["modelURL"]))return this["modelURL"];x01=this["parentTile"]["resourceURL"];J01=x01;J01=J01["replace"](/\u007b\x7a\u007d/gi,this["parentTile"]["level"]["toString"]());J01=J01["replace"](/\u007b\u0078\x7d/gi,this["parentTile"]["col"]["toString"]());J01=J01["replace"](/\u007b\x79\u007d/gi,this["parentTile"]["row"]["toString"]());J01=J01["replace"](/\u007b\u0066\x7d/gi,this["objInfo"]["dataFileName"]);Z01=x01;Z01=Z01["replace"](/\u007b\u007a\x7d/gi,this["parentTile"]["level"]["toString"]());Z01=Z01["replace"](/\x7b\x78\x7d/gi,this["parentTile"]["col"]["toString"]());Z01=Z01["replace"](/\x7b\x79\u007d/gi,this["parentTile"]["row"]["toString"]());this["modelURL"]=J01;this["textureUrl"]=Z01;return this["modelURL"];};B91["prototype"]["render"]=function(p01){var i01,S01;if(this["meshObject"]==null)return;this["setShowMesh"](false);i01=this["cmworld3"];if(i01["isRenderingFrame"]==false)return;if(this["renderFrameID"]==i01["option"]["renderFrameID"])return;this["renderFrameID"]=i01["option"]["renderFrameID"];if(p01>this["limitedDistance"]){this["setShowMesh"](false);if(p01<this["limitedDistance"]*1.3){this["lastShowTime"]=i01["option"]["renderFrameTime"];}}else{S01=this["worldPosition"]["clone"]();S01["sub"](i01["option"]["refCenter"]);this["meshObject"]["position"]["copy"](S01);this["checkTexture"](p01);if(this["completeModel"]){this["meshObject"]["parent"]=null;this["setShowMesh"](true);this["lastShowTime"]=i01["option"]["renderFrameTime"];}}};B91["prototype"]["setTexture"]=function(w01){var I01,e01;if(w01==null)return;if(this["meshObject"]!=null){I01=this["meshObject"]["material"];if(I01["type"]=='MultiMaterial'){e01=I01;for(var v01 in e01["materials"]){e01["materials"][v01]["map"]=w01;break;}}else{I01["dispose"]();}return;}w01["dispose"]();};B91["prototype"]["splitFilename"]=function(h01){if(h01==undefined)return;h01=h01["split"]('/')["pop"]()["replace"](/\x23([^\n]{0,}?)$/,'')["replace"](/\x3f([^\n]{0,}?)$/,'');h01=h01["split"]('.');return{filename:h01[0]||'',ext:h01[1]||''};};B91["prototype"]["checkTexture"]=function(k7r){var B01,Q01,N01,q01,H7r,f01,u01,c01,K01,d01,b01,j01;if(this["imageFileNotExist"])return;if(this["meshObject"]==null)return;if(this["updatingTexture"])return;B01=300;Q01=this["cmworld3"];if(Q01["option"]["renderFrameTime"]-this["requestedTexture_time"]<B01)return;if(Q01["option"]["renderFrameTime"]-this["textureChanged_time"]<B01)return;N01=new Array();if(this["meshObject"]["material"]["type"]=='MultiMaterial'){q01=this["meshObject"]["material"];for(var P01 in q01["materials"]){N01["push"](q01["materials"][P01]);}}else{N01["push"](this["meshObject"]["material"]);}H7r=this["meshObject"]["geometry"]["boundingSphere"]["radius"]*2;f01=N91["PointMesh"]["getTexLevel"](k7r,H7r);for(var P01 in N01){u01=N01[P01];if(u01["map"]!=null){c01=u01["imageCount"]-f01-1;if(c01!=u01["map"]["level"]){if(c01>u01["imageCount"]-1){c01=u01["imageCount"]-1;}if(c01<0)c01=0;if(u01["map"]!=null){if(c01!=u01["map"]["level"]){K01=null;{d01=u01["imageURL"];b01=this["splitFilename"](d01);if(c01>0){d01=b01["filename"]+"_"+c01["toString"]()+"."+b01["ext"];}j01=this["parentTile"]["resourceURL"];j01=j01["replace"](/\x7b\x7a\x7d/gi,this["parentTile"]["level"]["toString"]());j01=j01["replace"](/\x7b\x78\u007d/gi,this["parentTile"]["col"]["toString"]());j01=j01["replace"](/\u007b\x79\u007d/gi,this["parentTile"]["row"]["toString"]());j01=j01["replace"](/\u007b\x66\u007d/gi,d01);"http://xdworld.vworld.kr:8080/XDServer/requestLayerObject?APIKey=767B7ADF-10BA-3D86-AB7E-02816B5B92E9&Layer=facility_build&Level={z}&IDX={x}&IDY={y}&DataFile={f}/5&FileName=";K01=j01;}if(K01!=null){u01["map"]["requestlevel"]=c01;N91["vw_Real3DLayer"]["vwRequestTextureUpdate"](this,u01,k7r,K01);}}}else{}}}else{K01=null;{d01=u01["imageURL"];b01=this["splitFilename"](d01);if(u01["imageCount"]>1){d01=b01["filename"]+"_"+(u01["imageCount"]-1)["toString"]()+"."+b01["ext"];}j01=this["parentTile"]["resourceURL"];j01=j01["replace"](/\x7b\u007a\u007d/gi,this["parentTile"]["level"]["toString"]());j01=j01["replace"](/\u007b\u0078\x7d/gi,this["parentTile"]["col"]["toString"]());j01=j01["replace"](/\u007b\x79\u007d/gi,this["parentTile"]["row"]["toString"]());;j01=j01["replace"](/\x7b\x66\u007d/gi,d01);;K01=j01;}this["updateTexture"](this["meshObject"]["material"],K01);}}};B91["prototype"]["updateTexture"]=function(y7r,E7r){var m7r,L7r,V7r;if(this["updatingTexture"])return;if(E7r!=null){this["updatingTexture"]=true;this["requestedTexture_time"]=Date["now"]();m7r=this;L7r=y7r;V7r=new THREE["TextureLoader"]();V7r["setCrossOrigin"]("Anonymous");V7r["load"](E7r,function(s7r){var Y7r,l7r;s7r["minFilter"]=THREE["LinearMipMapLinearFilter"];s7r["anisotropy"]=m7r["cmworld3"]["renderer"]["capabilities"]["getMaxAnisotropy"]();if(L7r["map"]){s7r["level"]=L7r["map"]["requestlevel"];s7r["needsUpdate"]=true;Y7r=L7r["map"];l7r=m7r["cmworld3"];l7r["requestDispose"](Y7r);}else{s7r["minFilter"]=THREE["LinearMipMapLinearFilter"];s7r["level"]=L7r["imageCount"]-1;if(s7r["level"]<0)s7r["level"]=0;s7r["needUpdate"]=true;L7r["needsUpdate"]=true;}L7r["map"]=s7r;m7r["updatingTexture"]=false;if(m7r["meshObject"]){m7r["completeModel"]=true;}m7r["textureChanged_time"]=Date["now"]();});}else{}};return B91;}(cm_cmvGeometry);P91["deleteMeshTime"]=30*1000;N91["vw_Building"]=P91;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var r7r;r7r=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(F7r,W7r){F7r["__proto__"]=W7r;}||function(M7r,G7r){for(var U7r in G7r)if(G7r["hasOwnProperty"](U7r))M7r[U7r]=G7r[U7r];};return function(D7r,C7r){function A7r(){this["constructor"]=D7r;}r7r(D7r,C7r);D7r["prototype"]=C7r===null?Object["create"](C7r):(A7r["prototype"]=C7r["prototype"],new A7r());};}();(function(z7r){var n7r;n7r=function(g7r){__extends(R7r,g7r);R7r["prototype"]["dispose"]=function(){g7r["prototype"]["dispose"]["call"](this);this["clear"]();};R7r["prototype"]["clear"]=function(){this["clearAllTile"]();this["m_tiles"]=new Array();this["mapViewer"]["option"]["temp_JobTile"]=null;};R7r["prototype"]["startJob"]=function(J7r){var T7r,a7r,t7r,O7r,o7r;T7r=this["getCurrentJobTile"]();if(T7r==null)return false;a7r=z7r["CmWorld3"]["getInstance"]();t7r=a7r["option"]["rentAmbiguousWorker"]();t7r["vectorlayer"]=this;O7r=this["getTileURL"](T7r["level"],T7r["row"],T7r["col"]);o7r=jQuery["cmworker"]({worker:t7r,args:{command:"start",EarthRadius:z7r["cm_const"]["EarthRadius"],VerticalExaggeration:a7r["option"]["VerticalExaggeration"],TileSize:a7r["option"]["TileLevelRange"][T7r["level"]],SceneMode:a7r["option"]["SceneMode"],Level:T7r["level"],Row:T7r["row"],Col:T7r["col"],vertexWidth:a7r["option"]["tileVertexWidth"],dataUrl:O7r,cmworld3BaseRoot:z7r["GlobalOption"]["cmworld3BaseRoot"]}});jQuery["when"](o7r)["done"](this["jobResultFunc"])["fail"](this["jobFailFunc"]);return true;};R7r["prototype"]["isBusy"]=function(){if(this["getCurrentJobTile"]()==null)return false;return true;};R7r["prototype"]["getCurrentJobTile"]=function(){var Z7r;Z7r=z7r["CmWorld3"]["getInstance"]();if(Z7r["option"]["temp_JobTile"]==null)return;if(Z7r["option"]["temp_JobTile"]["level"]<0){Z7r["option"]["temp_JobTile"]=null;}return Z7r["option"]["temp_JobTile"];};R7r["prototype"]["getCurrent"]=function(){var x7r;x7r=this["getCurrentJobTile"]();if(x7r==null)return null;return x7r["getKey"]();};R7r["prototype"]["completeJob"]=function(){var i7r;i7r=z7r["CmWorld3"]["getInstance"]();i7r["option"]["temp_JobTile"]=null;};R7r["prototype"]["jobFailFunc"]=function(v7r){var w7r,p7r,I7r,S7r,e7r;try{w7r=z7r["CmWorld3"]["getInstance"]();if(w7r["option"]["diagnosticLog"])z7r["CmWorld"]["outputInfo"]('vw_poilayer occur jobFailFunc.');p7r=v7r["target"]["vectorlayer"];I7r=p7r["getCurrentJobTile"]();S7r=new z7r["Tile"](p7r);S7r["setTileInfo"](I7r["level"],I7r["row"],I7r["col"]);e7r=z7r["Tile"]["getKeyString"](S7r["level"],S7r["row"],S7r["col"]);p7r["addEmptyTile"](e7r);p7r["completeJob"]();}catch(h7r){console["error"](h7r);}};R7r["prototype"]["jobResultFunc"]=function(d7r){var j7r,b7r,K7r,N7r,u7r,c7r;j7r=d7r["target"]["vectorlayer"];if(j7r==null)return;if(d7r["data"]["dataState"]==false){j7r["jobFailFunc"](d7r);return;}try{K7r=0;u7r=j7r["getCurrentJobTile"]();if(u7r==null){j7r["completeJob"]();return;}c7r=new z7r["vw_POITile"](u7r["level"],u7r["row"],u7r["col"],j7r);c7r["serverURL"]=j7r["getMapInfo"]()["serverURL"];c7r["resourceURL"]=j7r["getMapInfo"]()["resourceURL"];c7r["loadFromStream"](d7r["data"]["datastream"]);j7r["addTile"](c7r);}catch(P7r){console["error"](P7r);}j7r["completeJob"]();return;};R7r["prototype"]["generateTile"]=function(B7r,q7r,Q7r){var H3r,k3r,m3r,f7r;H3r=this["getTile"](B7r,q7r,Q7r);if(H3r!=null){return;}k3r=z7r["Tile"]["getKeyString"](B7r,q7r,Q7r);if(this["emptyTiles"][k3r])return;m3r=this["getTileURL"](B7r,q7r,Q7r);if(m3r==null)return;if(this["isOutOfFarRange"]())return;{if(this["getCurrentJobTile"]()!=null)return;f7r=this["mapViewer"];f7r["option"]["temp_JobTile"]=new z7r["Tile"](this);f7r["option"]["temp_JobTile"]["setTileInfo"](B7r,q7r,Q7r);f7r["option"]["jobManager"]["directJob"](this);}};R7r["prototype"]["isOutOfFarRange"]=function(){var L3r,V3r;L3r=this["mapViewer"];V3r=L3r["getCamera"]()["getAltitude"]();if(V3r>L3r["option"]["getDislayDist4Level"](this["mapInfo"]["MinLevel"]-1)){return true;}return false;};function R7r(){var X7r;X7r=g7r["call"](this)||this;X7r["mapViewer"]=z7r["CmWorld3"]["getInstance"]();return X7r;}R7r["prototype"]["update"]=function(){var Y3r,M3r,G3r,U3r,E3r,W3r,F3r,r3r;Y3r=this["mapViewer"];M3r=Y3r["getCamera"]()["getAltitude"]();if(this["isOutOfFarRange"]()){this["clearAllTile"]();return;}G3r=Y3r["getCamera"]()["getPositionGeo"]();U3r=0;for(var y3r in this["m_tiles"]){for(var s3r in this["m_tiles"][y3r]){for(var l3r in this["m_tiles"][y3r][s3r]){E3r=this["m_tiles"][y3r][s3r][l3r];if(z7r["Util"]["isDefined"](E3r)){if(E3r["disposed"]){delete this["m_tiles"][y3r][s3r][l3r];continue;}W3r=E3r["getWorldPos"]();F3r=Y3r["getCamera"]()["getDistanceToWorldPos"](W3r);{r3r=E3r["level"]-2;if(F3r>Y3r["option"]["getDislayDist4Level"](r3r)){E3r["dispose"]();delete this["m_tiles"][y3r][s3r][l3r];continue;}}U3r++;E3r["update"]();}}}}};R7r["prototype"]["render"]=function(){};return R7r;}(z7r["TileLayer"]);z7r["vw_POILayer"]=n7r;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var C3r;C3r=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(D3r,A3r){D3r["__proto__"]=A3r;}||function(R3r,n3r){for(var z3r in n3r)if(n3r["hasOwnProperty"](z3r))R3r[z3r]=n3r[z3r];};return function(X3r,g3r){function T3r(){this["constructor"]=X3r;}C3r(X3r,g3r);X3r["prototype"]=g3r===null?Object["create"](g3r):(T3r["prototype"]=g3r["prototype"],new T3r());};}();(function(a3r){var t3r;t3r=function(o3r){__extends(O3r,o3r);O3r["prototype"]["dispose"]=function(){this["clear"]();this["disposed"]=true;};function O3r(Z3r,x3r,i3r,p3r){var J3r;J3r=o3r["call"](this,p3r)||this;J3r["init"]=false;J3r["disposed"]=false;J3r["serverURL"]=null;J3r["resourceURL"]=null;J3r["centerWorldPos"]=null;J3r["Color"]=THREE["Math"]["randFloat"](0,1);J3r["lastUpdateTime"]=0;J3r["minHeight"]=0;J3r["maxHeight"]=10;J3r["poiObjects"]=new Array();J3r["DataLoadOK"]=false;J3r["ResourceMakeOK"]=false;J3r["maxTextLength"]=0;J3r["setTileInfo"](Z3r,x3r,i3r);return J3r;}O3r["prototype"]["clear"]=function(){for(var S3r in this["poiObjects"]){this["poiObjects"][S3r]["dispose"]();}this["poiObjects"]=[];if(this["Material"]){this["Material"]["dispose"]();this["Material"]=null;}};O3r["prototype"]["getWorldPos"]=function(){var w3r,I3r;if(this["centerWorldPos"]==null){w3r=a3r["CmWorld3"]["getInstance"]();I3r=this["getBoundary"]()["getCenter"]();this["centerWorldPos"]=a3r["CmMathEngine"]["Geo2Cartesian"](I3r["x"],I3r["y"],a3r["cm_const"]["EarthRadius"]);}return this["centerWorldPos"];};O3r["prototype"]["getBoundingBox"]=function(){};O3r["prototype"]["update"]=function(){var v3r,e3r,j3r,c3r,h3r;if(this["DataLoadOK"]==false){return;}v3r=false;e3r=a3r["CmWorld3"]["getInstance"]();j3r=e3r["getCamera"]()["getDistanceToWorldPos"](this["getWorldPos"]());if(j3r>e3r["option"]["getDislayDist4Level"](this["level"]-2)){if(e3r["option"]["renderFrameTime"]-this["lastUpdateTime"]>a3r["VectorTile"]["maxUpdateElapsedTime"]){v3r=true;}else{return;}}if(v3r==false){c3r=this["getBoundingBox"]();}this["lastUpdateTime"]=e3r["option"]["renderFrameTime"];for(var u3r in this["poiObjects"]){h3r=this["poiObjects"][u3r];if(v3r==false){if(h3r["isShow"]()){h3r["update"]();}}}};O3r["prototype"]["decode4vw"]=function(b3r){var d3r;if(b3r){try{d3r='';for(var K3r=0;K3r<b3r["length"];K3r++){d3r+='%'+b3r[K3r]["toString"](16);}d3r=decodeURIforEUCKR(d3r["toUpperCase"]());return d3r;}catch(N3r){console["log"](N3r["message"]);}}return"";};O3r["prototype"]["loadFromStream"]=function(V8r){var Q3r,q3r,P3r,f3r,m8r,L8r,H8r,B3r;this["clear"]();q3r=[];P3r=new a3r["BinaryReader"](V8r,true);if(a3r["vwUtility"]["isNotFoundFlag"](P3r)){P3r["dispose"]();return false;}P3r["seek"](0);f3r=P3r["readBytes"](4);m8r=f3r[0]["toString"]()+f3r[1]["toString"]()+f3r[2]["toString"]()+f3r[3]["toString"]();this["version"]=parseInt(m8r);if(this["version"]!=3002){P3r["dispose"]();return false;}L8r=P3r["readUInt32"]();this["maxTextLength"]=0;for(var k8r=0;k8r<L8r;k8r++){H8r=new a3r["vw_POI"]();B3r=new a3r["vw_POIInfo"]();B3r["Pos"]=new THREE["Vector2"]();B3r["Pos"]["x"]=P3r["readDouble"]();B3r["Pos"]["y"]=P3r["readDouble"]();B3r["Altitude"]=P3r["readSingle"]();Q3r=P3r["readInt16"]();q3r=P3r["readBytes"](Q3r);B3r["Key"]=P3r["bin2String"](q3r);Q3r=P3r["readInt16"]();q3r=P3r["readBytes"](Q3r);B3r["Text"]=this["decode4vw"](q3r);if(Q3r>this["maxTextLength"]){this["maxTextLength"]=Q3r;}Q3r=P3r["readInt16"]();q3r=P3r["readBytes"](Q3r);B3r["FontName"]=this["decode4vw"](q3r);B3r["FontSize"]=P3r["readUInt8"]();B3r["FontWeight"]=P3r["readUInt8"]();B3r["FontColor"]=P3r["readUInt32"]();B3r["FontOutColor"]=P3r["readUInt32"]();q3r=P3r["readBytes"](10);B3r["ImgKey"]=this["decode4vw"](q3r);H8r["objInfo"]=B3r;H8r["parentTile"]=this;this["poiObjects"]["push"](H8r);}this["DataLoadOK"]=true;P3r["dispose"]();return true;};return O3r;}(a3r["Tile"]);t3r["lastUpdateElapsedTime"]=30*1000;a3r["vw_POITile"]=t3r;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var E8r;E8r=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(y8r,s8r){y8r["__proto__"]=s8r;}||function(r8r,l8r){for(var Y8r in l8r)if(l8r["hasOwnProperty"](Y8r))r8r[Y8r]=l8r[Y8r];};return function(W8r,F8r){E8r(W8r,F8r);W8r["prototype"]=F8r===null?Object["create"](F8r):(U8r["prototype"]=F8r["prototype"],new U8r());function U8r(){this["constructor"]=W8r;}};}();(function(G8r){var C8r,M8r;C8r=function(){function D8r(){}return D8r;}();G8r["vw_POIInfo"]=C8r;M8r=function(z8r){__extends(A8r,z8r);A8r["prototype"]["dispose"]=function(){this["clear"]();};A8r["prototype"]["clear"]=function(){this["Requested"]=false;};A8r["prototype"]["getWorldPos"]=function(){var R8r;if(this["worldPosition"]==null){R8r=G8r["CmWorld3"]["getInstance"]();this["worldPosition"]=G8r["CmMathEngine"]["Geo2Cartesian"](this["objInfo"]["Pos"]["x"],this["objInfo"]["Pos"]["y"],G8r["cm_const"]["EarthRadius"]+this["objInfo"]["Altitude"]*R8r["option"]["VerticalExaggeration"]);}return this["worldPosition"]["clone"]();};A8r["prototype"]["isShow"]=function(){var g8r,X8r,T8r,a8r;g8r=G8r["CmWorld3"]["getInstance"]();X8r=this["getWorldPos"]();X8r["sub"](g8r["option"]["refCenter"]);T8r=20;a8r=new THREE["Sphere"](X8r,T8r);if(g8r["cameraFrustum"]["intersectsSphere"](a8r)){return true;}return false;};function A8r(){var n8r;n8r=z8r["call"](this)||this;n8r["height"]=0;n8r["worldPosition"]=null;n8r["LimitedDistance"]=2000;n8r["Requested"]=false;return n8r;}A8r["prototype"]["update"]=function(){var O8r,t8r;O8r=G8r["CmWorld3"]["getInstance"]();t8r=O8r["getCamera"]()["getDistanceToWorldPos"](this["getWorldPos"]());if(t8r<this["LimitedDistance"]){this["render"](t8r);}};A8r["prototype"]["makeColorMaterialFromColor"]=function(o8r){var J8r;if(!o8r){o8r=0x0f0f0f;}J8r=new THREE["MeshPhongMaterial"]({color:o8r,specular:0,shininess:1});G8r["Material"]["addClippingAttri"](J8r);return J8r;};A8r["prototype"]["render"]=function(S8r){var Z8r,p8r,i8r,x8r;Z8r=G8r["CmWorld3"]["getInstance"]();if(Z8r["isRenderingFrame"]==false)return;if(this["renderFrameID"]==Z8r["option"]["renderFrameID"])return;this["renderFrameID"]=Z8r["option"]["renderFrameID"];if(S8r>this["LimitedDistance"]){return;}else{p8r=this["worldPosition"]["clone"]();i8r=Z8r["toScreenCoord"](p8r);if(i8r){x8r=Z8r["getScreenLayerCanvasContext"]();x8r["fillStyle"]="white";x8r["textAlign"]="center";x8r["fillText"](this["objInfo"]["Text"],i8r["x"],i8r["y"]);x8r["lineWidth"]=1.0;this["lastShowTime"]=Z8r["option"]["renderFrameTime"];}}};return A8r;}(cm_cmvGeometry);M8r["deleteMeshTime"]=30*1000;G8r["vw_POI"]=M8r;}(CMWORLD||(CMWORLD={})));(function(w8r){var I8r;I8r=function(){e8r["isNotFoundFlag"]=function(h8r){var v8r;v8r=h8r["readBytes"](6);if(v8r){if(v8r[0]==60&&v8r[1]==63&&v8r[2]==120&&v8r[3]==109&&v8r[4]==108&&v8r[5]==32){h8r["seek"](0);return true;}}h8r["seek"](0);return false;};function e8r(){}return e8r;}();w8r["vwUtility"]=I8r;}(CMWORLD||(CMWORLD={})));(function(u8r){var j8r;j8r=function(){function c8r(){this["strokeStyle"]="red";this["lineWidth"]=2;this["fillStyle"]="rgba(255, 255, 0, 0.1)";this["styleArg"]="";}return c8r;}();u8r["StyleInfo"]=j8r;}(CMWORLD||(CMWORLD={})));(function(d8r){var K8r;;K8r=function(){b8r["prototype"]["dispose"]=function(){this["object"]=null;};b8r["prototype"]["isWorldObject"]=function(){if(this["geoPosition"]){return false;}return true;};b8r["prototype"]["getMesh"]=function(){return this["object"];};b8r["prototype"]["setColor"]=function(k4r){var H4r;H4r=this["object"];if(d8r["Util"]["isDefined"](H4r)){if(d8r["Util"]["isDefined"](H4r['material']['color']))H4r['material']['color']["setRGB"](k4r["r"],k4r["g"],k4r["b"]);}};b8r["prototype"]["setHighlightColor"]=function(m4r){this["setHighlightColorMesh"](this["getMesh"](),m4r);for(var L4r in this["getMesh"]()["children"]){this["setHighlightColorMesh"](this["getMesh"]()["children"][L4r],m4r);}};b8r["prototype"]["setHighlightColorMesh"]=function(E4r,y4r){var V4r;V4r=E4r;if(V4r["material"]==null){return;}if(y4r==null){if(V4r["currentHex"]!=null&&V4r["currentHex"]!=undefined){V4r["material"]["emissive"]["setHex"](V4r["currentHex"]);}V4r["currentHex"]=null;}else{V4r["currentHex"]=V4r["material"]["emissive"]["getHex"]();V4r["material"]["emissive"]["setHex"](0xff0000);}};b8r["prototype"]["moveObjectToRef"]=function(){var Y4r,s4r,r4r;if(this["object"]instanceof THREE["Mesh"]){Y4r=this["object"];if(Y4r){s4r=null;if(Y4r["geometry"]instanceof THREE["Geometry"]){s4r=Y4r["geometry"];}else{if(Y4r["geometry"]["geometry"]instanceof THREE["Geometry"]){s4r=Y4r["geometry"]["geometry"];}}if(s4r){r4r=new THREE["Vector3"](s4r["vertices"][0]["x"],s4r["vertices"][0]["y"],s4r["vertices"][0]["z"]);this["worldPosition"]=r4r;for(var l4r=0;l4r<s4r["vertices"]["length"];l4r++){s4r["vertices"][l4r]["x"]-=r4r["x"];s4r["vertices"][l4r]["y"]-=r4r["y"];s4r["vertices"][l4r]["z"]-=r4r["z"];}}}}};function b8r(f8r,P8r,N8r,B8r,q8r){if(N8r===void 0){N8r=null;}if(B8r===void 0){B8r=null;}if(q8r===void 0){q8r=null;}this["object"]=null;this["useBillboard"]=false;this["groundHeight"]=false;this["geoPosition"]=null;this["rotationQuaternion"]=null;this["worldPosition"]=new THREE["Vector3"](0,0,0);this["onUpdate"]=null;this["userTag"]=null;this["visible"]=true;this["internalUpdate"]=null;this["clipApply"]=true;this["parentScene"]=null;if(d8r["Util"]["isDefined"](P8r)){P8r["userObject"]=this;for(var Q8r in P8r["children"]){P8r["children"][Q8r]["userObject"]=this;}this["id"]=b8r["userObjectIDCounter"]++;this["name"]=f8r;this["object"]=P8r;this["onUpdate"]=B8r;this["onRender"]=q8r;}if(d8r["Util"]["isDefined"](N8r)){this["setPosition"](N8r["x"],N8r["y"],N8r["z"]);}else{this["moveObjectToRef"]();}}b8r["prototype"]["setFromAxisAngle"]=function(U4r,G4r,F4r){var W4r;if(F4r===void 0){F4r=d8r["RotateOp"]["Reset"];}if(F4r){if(F4r==d8r["RotateOp"]["Append"]){W4r=new THREE["Quaternion"]();W4r["setFromAxisAngle"](U4r,G4r);this["object"]["quaternion"]["multiply"](W4r);this["object"]["updateMatrix"]();return;}}this["object"]["quaternion"]["setFromAxisAngle"](U4r,G4r);};b8r["prototype"]["setRotateAll"]=function(M4r,C4r,D4r){this["object"]["quaternion"]["set"](0,0,0,1);this["object"]["rotateX"](M4r*d8r["cm_const"]["Deg2Rad"]);this["object"]["rotateY"](C4r*d8r["cm_const"]["Deg2Rad"]);this["object"]["rotateZ"](D4r*d8r["cm_const"]["Deg2Rad"]);this["rotationQuaternion"]=new THREE["Quaternion"](this["object"]["quaternion"]["x"],this["object"]["quaternion"]["y"],this["object"]["quaternion"]["z"],this["object"]["quaternion"]["w"]);this["object"]["quaternion"]["set"](0,0,0,1);};b8r["prototype"]["setRotate"]=function(z4r){var A4r;A4r=new THREE["Quaternion"]();A4r["setFromAxisAngle"](d8r["CmCameraGlobe"]["getZAxis"](),z4r*d8r["CmMathEngine"]["Deg2Rad"]);this["rotationQuaternion"]=A4r;};b8r["prototype"]["rotate4GlobeEarth"]=function(R4r){var g4r,X4r,n4r;if(R4r===void 0){R4r=d8r["RotateOp"]["Reset"];}if(this["object"]&&this["isWorldObject"]()==false){g4r=new THREE["Quaternion"]();X4r=new THREE["Quaternion"]();X4r["setFromAxisAngle"](d8r["CmCameraGlobe"]["getYAxis"](),-(180-this["geoPosition"]["x"])*d8r["CmMathEngine"]["Deg2Rad"]);g4r["setFromAxisAngle"](d8r["CmCameraGlobe"]["getXAxis"](),-this["geoPosition"]["y"]*d8r["CmMathEngine"]["Deg2Rad"]);n4r=THREE["Quaternion"]["prototype"]["multiplyQuaternions"](X4r,g4r);if(d8r["Util"]["isDefined"](this["rotationQuaternion"])){n4r=THREE["Quaternion"]["prototype"]["multiplyQuaternions"](n4r,this["rotationQuaternion"]);}if(d8r["Util"]["isDefined"](R4r)){if(R4r==d8r["RotateOp"]["Reset"]){this["object"]["quaternion"]["copy"](n4r);}else{this["object"]["quaternion"]["multiply"](n4r);}}else{this["object"]["quaternion"]["copy"](n4r);}}};b8r["prototype"]["setScale"]=function(T4r,a4r,t4r){this["object"]["scale"]["set"](T4r,a4r,t4r);};b8r["prototype"]["calcWorldPosition"]=function(){var O4r;if(this["isWorldObject"]())return;O4r=this["geoPosition"]["z"];if(this["groundHeight"]){}this["worldPosition"]=d8r["CmMathEngine"]["Geo2Cartesian"](this["geoPosition"]["x"],this["geoPosition"]["y"],O4r*d8r["CmWorld3"]["getInstance"]()["option"]["VerticalExaggeration"]+d8r["cm_const"]["EarthRadius"]);};b8r["prototype"]["getPosition"]=function(){return this["geoPosition"];};b8r["prototype"]["setPosition"]=function(o4r,J4r,Z4r){if(d8r["Util"]["isDefined"](this["geoPosition"])){this["geoPosition"]["set"](o4r,J4r,Z4r);}else{this["geoPosition"]=new THREE["Vector3"](o4r,J4r,Z4r);}this["calcWorldPosition"]();};b8r["prototype"]["updatePosition"]=function(){this["calcWorldPosition"]();};b8r["prototype"]["updateMaterial"]=function(){var x4r;if(d8r["Util"]["isDefined"](this["object"])){if(this["object"]instanceof THREE["Mesh"]){x4r=this["object"]["material"];if(x4r instanceof THREE["MeshBasicMaterial"]){x4r["map"]["needsUpdate"]=true;}else if(x4r instanceof THREE["MeshLambertMaterial"]){x4r["map"]["needsUpdate"]=true;}else if(x4r instanceof THREE["MeshPhongMaterial"]){x4r["map"]["needsUpdate"]=true;}else if(x4r instanceof THREE["PointsMaterial"]){x4r["map"]["needsUpdate"]=true;}else if(x4r instanceof THREE["SpriteMaterial"]){x4r["map"]["needsUpdate"]=true;}}}};b8r["prototype"]["intersect"]=function(){};b8r["prototype"]["update"]=function(){var i4r,p4r,S4r;if(this["object"]){if(this["visible"]==true){i4r=d8r["CmWorld3"]["getInstance"]();p4r=this["worldPosition"]["clone"]();p4r["sub"](i4r["option"]["refCenter"]);this["object"]["position"]["copy"](p4r);if(this["internalUpdate"]){this["internalUpdate"](this);}if(this["useBillboard"]){this["object"]["quaternion"]["copy"](i4r["getCamera"]()["getThreejsCamera"]()["quaternion"]);}if(d8r["Util"]["isDefined"](this["parentScene"])==false){S4r=i4r["getInstantScene"]();S4r["add"](this["object"]);}this["object"]["visible"]=true;if(this["onUpdate"]){this["onUpdate"](this,i4r["option"]["deltaTime"],null);}}}};b8r["prototype"]["render"]=function(){if(this["onRender"]){this["onRender"](this,d8r["CmWorld3"]["getInstance"]()["option"]["deltaTime"]);}};b8r["createBillboard"]=function(c4r,b4r,N4r,P4r,B4r,u4r,K4r,d4r){var v4r,I4r,h4r,w4r,j4r,e4r;v4r=new THREE["TextureLoader"]();I4r=v4r["load"](K4r);if(I4r){h4r=new THREE["PlaneGeometry"](B4r,u4r,10,10);I4r["needsUpdate"]=true;w4r=new THREE["MeshPhongMaterial"]({map:I4r,side:THREE["DoubleSide"]});w4r["transparent"]=true;d8r["Material"]["addClippingAttri"](w4r);j4r=new THREE["Mesh"](h4r,w4r);e4r=new b8r(c4r,j4r,new THREE["Vector3"](b4r,N4r,P4r),d4r,null);e4r["useBillboard"]=true;return e4r;}return null;};b8r["createPlane"]=function(A2r,F2r,W2r,m2r,C2r,D2r,y2r,R2r,n2r,z2r){var U2r,V2r,H2r,Q4r,r2r,Y2r,l2r,E2r,q4r,k2r,f4r,s2r,L2r,M2r,G2r;console["warn"]("createPlane 함수대신에, createBillboard 함수를 사용하십시요.");if(m2r>y2r){U2r=y2r;y2r=m2r;m2r=U2r;}V2r=d8r["CmWorld3"]["getInstance"]();H2r=new THREE["BufferGeometry"]();Q4r=new Float32Array(12);r2r=d8r["CmMathEngine"]["Geo2Cartesian"](F2r,W2r,m2r*V2r["option"]["VerticalExaggeration"]+d8r["cm_const"]["EarthRadius"]);Y2r=d8r["CmMathEngine"]["Geo2Cartesian"](C2r,D2r,m2r*V2r["option"]["VerticalExaggeration"]+d8r["cm_const"]["EarthRadius"]);l2r=d8r["CmMathEngine"]["Geo2Cartesian"](F2r,W2r,y2r*V2r["option"]["VerticalExaggeration"]+d8r["cm_const"]["EarthRadius"]);E2r=d8r["CmMathEngine"]["Geo2Cartesian"](C2r,D2r,y2r*V2r["option"]["VerticalExaggeration"]+d8r["cm_const"]["EarthRadius"]);Y2r["sub"](r2r);l2r["sub"](r2r);E2r["sub"](r2r);q4r=0;Q4r[q4r++]=0;Q4r[q4r++]=0;Q4r[q4r++]=0;Q4r[q4r++]=Y2r["x"];Q4r[q4r++]=Y2r["y"];Q4r[q4r++]=Y2r["z"];Q4r[q4r++]=l2r["x"];Q4r[q4r++]=l2r["y"];Q4r[q4r++]=l2r["z"];Q4r[q4r++]=E2r["x"];Q4r[q4r++]=E2r["y"];Q4r[q4r++]=E2r["z"];k2r=new Uint16Array(6);q4r=0;k2r[q4r++]=0;k2r[q4r++]=1;k2r[q4r++]=2;k2r[q4r++]=1;k2r[q4r++]=3;k2r[q4r++]=2;f4r=new Float32Array(8);q4r=0;f4r[q4r++]=0;f4r[q4r++]=0;f4r[q4r++]=1;f4r[q4r++]=0;f4r[q4r++]=0;f4r[q4r++]=1;f4r[q4r++]=1;f4r[q4r++]=1;H2r["addAttribute"]('position',new THREE["BufferAttribute"](Q4r,3));H2r["addAttribute"]('uv',new THREE["BufferAttribute"](f4r,2));H2r["setIndex"](new THREE["BufferAttribute"](k2r,1));H2r["computeVertexNormals"]();H2r["computeBoundingSphere"]();H2r["needUpdate"]=true;s2r=new THREE["Texture"](R2r);s2r["minFilter"]=THREE["LinearMipMapLinearFilter"];s2r["magFilter"]=THREE["LinearFilter"];s2r["needsUpdate"]=true;L2r=new THREE["MeshPhongMaterial"]({map:s2r});d8r["Material"]["addClippingAttri"](L2r);L2r["transparent"]=true;if(n2r==true){L2r["side"]=THREE["DoubleSide"];}L2r["needsUpdate"]=true;M2r=new THREE["Mesh"](H2r,L2r);G2r=new b8r(A2r,M2r,new THREE["Vector3"](F2r,W2r,m2r),z2r,null);return G2r;};b8r["createWorldObject"]=function(O2r,Z2r,X2r,T2r){var a2r,o2r,J2r,g2r,t2r;if(X2r===void 0){X2r=false;}if(T2r===void 0){T2r=null;}a2r=d8r["GeometryUtil"]["createWorldGeometry"](Z2r,X2r);if(X2r){o2r=new THREE["LineBasicMaterial"]({color:0xffffff,linewidth:3});J2r=new THREE["Line"](a2r,o2r);g2r=new d8r["UserObject"](O2r,J2r,null,T2r);return g2r;}t2r=new THREE["Mesh"](a2r,new THREE["MeshPhongMaterial"]({color:0xf08000,side:THREE["DoubleSide"]}));d8r["Material"]["addClippingAttri"](t2r["material"]);g2r=new d8r["UserObject"](O2r,t2r,null,T2r);return g2r;};return b8r;}();K8r["userObjectIDCounter"]=0;d8r["UserObject"]=K8r;}(CMWORLD||(CMWORLD={})));(function(x2r){var i2r,p2r;i2r=function(){function S2r(){this["fileUrl"]=null;this["distFromCamera"]=0;this["tag"]=null;this["fileFormat"]=null;this["callbackFn"]=null;}return S2r;}();p2r=function(){I2r["prototype"]["init"]=function(w2r){this["cmworld3"]=w2r;};I2r["prototype"]["isRequested"]=function(e2r){if(this["requestedUrl"][e2r]){return true;}return false;};function I2r(){this["maxVectorTileBufferCount"]=3;this["requestCountForModelDownload"]=0;this["downloadRequestedInfoArray"]=[];this["requestedInfoArrayForModel"]=[];this["requestedUrl"]=[];this["cmworld3"]=null;}I2r["prototype"]["requestDownload"]=function(j2r,K2r,u2r,b2r,N2r){var h2r,c2r,v2r;h2r=false;if(this["downloadRequestedInfoArray"]["length"]<this["maxVectorTileBufferCount"]){h2r=true;}else{if(u2r<this["downloadRequestedInfoArray"][this["downloadRequestedInfoArray"]["length"]-1]["distFromCamera"]){h2r=true;c2r=this["downloadRequestedInfoArray"]["pop"]();delete this["requestedUrl"][c2r["fileUrl"]];}}if(h2r){if(this["requestedUrl"][j2r]==null){v2r=new i2r();v2r["fileUrl"]=j2r;v2r["fileFormat"]=K2r;v2r["distFromCamera"]=u2r;v2r["callbackFn"]=N2r;v2r["tag"]=b2r;this["downloadRequestedInfoArray"]["push"](v2r);this["downloadRequestedInfoArray"]["sort"](function(P2r,B2r){return P2r["distFromCamera"]-B2r["distFromCamera"];});this["requestedUrl"][j2r]=this["cmworld3"]["getFrameTime"]();}}};I2r["prototype"]["getRequestMaxCountForModelDownload"]=function(){var Q2r,f2r,H1r,q2r;if(this["requestCountForModelDownload"]<1){Q2r=50;f2r=10;H1r=this["cmworld3"]["getFrameElapsedTime"]();q2r=f2r+H1r*0.1;if(q2r>Q2r)q2r=Q2r;this["requestCountForModelDownload"]=q2r;}return this["requestCountForModelDownload"];};I2r["prototype"]["requestModelDownload"]=function(L1r,Y1r,V1r,l1r){var m1r,E1r,y1r,s1r,k1r;if(x2r["Util"]["isDefined"](L1r)==false)return false;if(this["requestedUrl"][L1r]!=null)return false;m1r=false;E1r=this["getRequestMaxCountForModelDownload"]();if(this["requestedInfoArrayForModel"]["length"]>=E1r){y1r=this["requestedInfoArrayForModel"]["length"];if(V1r<this["requestedInfoArrayForModel"][y1r-1]["distFromCamera"]){s1r=this["requestedInfoArrayForModel"]["pop"]();delete this["requestedUrl"][s1r["fileUrl"]];m1r=true;}}else{m1r=true;}if(m1r){k1r=new i2r();k1r["fileUrl"]=L1r;k1r["fileFormat"]=Y1r;k1r["distFromCamera"]=V1r;k1r["callbackFn"]=l1r;this["requestedUrl"][L1r]=this["cmworld3"]["getFrameTime"]();this["requestedInfoArrayForModel"]["push"](k1r);this["requestedInfoArrayForModel"]["sort"](function(r1r,F1r){return r1r["distFromCamera"]-F1r["distFromCamera"];});}return m1r;};I2r["prototype"]["update"]=function(){var U1r,G1r,M1r,C1r,D1r;U1r=this;G1r=function(z1r){var A1r;A1r=M1r["downloadRequestedInfoArray"][z1r];if(A1r){x2r["NetWork"]["requestFile"](A1r["fileUrl"],function(n1r){n1r["tag"]=A1r["tag"];n1r["format"]=A1r["fileFormat"];A1r["callbackFn"](n1r);delete U1r["requestedUrl"][A1r["fileUrl"]];});}};M1r=this;for(var W1r=0;W1r<this["downloadRequestedInfoArray"]["length"];W1r++){G1r(W1r);}this["downloadRequestedInfoArray"]=[];C1r=function(g1r){var R1r;R1r=D1r["requestedInfoArrayForModel"][g1r];if(R1r){x2r["NetWork"]["requestFile"](R1r["fileUrl"],function(X1r){try{R1r["callbackFn"](X1r);}catch(T1r){}finally{delete U1r["requestedUrl"][X1r["url"]];}});}};D1r=this;for(var W1r=0;W1r<this["requestedInfoArrayForModel"]["length"];W1r++){C1r(W1r);}this["requestedInfoArrayForModel"]=[];this["checkZombie"]();this["requestCountForModelDownload"]=0;};I2r["prototype"]["checkZombie"]=function(){var t1r,O1r,o1r;t1r=10;O1r=5000;for(var a1r in this["requestedUrl"]){o1r=this["cmworld3"]["getFrameTime"]()-this["requestedUrl"][a1r];if(o1r>O1r)delete this["requestedUrl"][a1r];if(--t1r<1)break;}};return I2r;}();x2r["ObjectDownloadManager"]=p2r;}(CMWORLD||(CMWORLD={})));(function(J1r){var Z1r;Z1r=function(){x1r["createTileImageLayer"]=function(v1r,c1r,d1r,w1r,e1r,u1r,h1r,j1r,S1r,I1r){var i1r,p1r;if(I1r){J1r["CmWorld3"]["getInstance"]()["option"]["quadImageCompressed"]=I1r;}S1r=J1r["TiledMapInfo"]["purifyFileFormat"](S1r);i1r=new J1r["TiledMapInfo"]();{i1r["name"]=v1r;i1r["serverURL"]=c1r;i1r["MinLevel"]=d1r;i1r["MaxLevel"]=w1r;i1r["North"]=e1r;i1r["South"]=u1r;i1r["West"]=h1r;i1r["East"]=j1r;i1r["fileFormat"]=S1r;}p1r=new J1r["QuadImageLayer"]();p1r["name"]="quadImageLayer";p1r["mapInfo"]=i1r;return p1r;};x1r["createOverlayImageLayer"]=function(P1r,k5r,V5r,B1r,q1r,Q1r,f1r,H5r,N1r,m5r,L5r){var K1r,b1r;N1r=J1r["TiledMapInfo"]["purifyFileFormat"](N1r);K1r=new J1r["TiledMapInfo"]();{K1r["name"]=P1r;K1r["serverURL"]=k5r;K1r["MinLevel"]=V5r;K1r["MaxLevel"]=B1r;K1r["North"]=q1r;K1r["South"]=Q1r;K1r["West"]=f1r;K1r["East"]=H5r;K1r["fileFormat"]=N1r;K1r["opacity"]=m5r;K1r["progressive"]=L5r;}b1r=new J1r["OverlayImageTileLayer"](P1r);b1r["mapInfo"]=K1r;return b1r;};x1r["createTerrainLayer"]=function(F5r,M5r,Y5r,l5r,r5r,G5r,W5r,U5r,s5r){var E5r,y5r;s5r=J1r["TiledMapInfo"]["purifyFileFormat"](s5r);E5r=new J1r["TiledMapInfo"]();{E5r["name"]=F5r;E5r["serverURL"]=M5r;E5r["MinLevel"]=Y5r;E5r["MaxLevel"]=l5r;E5r["North"]=r5r;E5r["South"]=G5r;E5r["West"]=W5r;E5r["East"]=U5r;E5r["fileFormat"]=s5r;}y5r=new J1r["QuadTerrainLayer"]("quadTerrainLayer");{y5r["mapInfo"]=E5r;}return y5r;};x1r["createCubeGroupLayer"]=function(z5r,n5r,R5r,g5r,D5r){var C5r,A5r;D5r=J1r["TiledMapInfo"]["purifyFileFormat"](D5r);C5r=new J1r["TiledMapInfo"]();{C5r["name"]=z5r;C5r["serverURL"]=n5r;C5r["MinLevel"]=R5r;C5r["MaxLevel"]=g5r;C5r["fileFormat"]=D5r;}A5r=new J1r["CubeGroupLayer"](z5r);{A5r["mapInfo"]=C5r;}return A5r;};x1r["createCube3DLayer"]=function(O5r,x5r,i5r,p5r,o5r,J5r,Z5r,a5r,t5r){var X5r,T5r;t5r=J1r["TiledMapInfo"]["purifyFileFormat"](t5r);a5r=J1r["TiledMapInfo"]["purifyCube3DType"](a5r);X5r=new J1r["TiledMapInfo"]();{X5r["name"]=O5r;X5r["serverURL"]=x5r;X5r["MinLevel"]=i5r;X5r["MaxLevel"]=p5r;X5r["fileFormat"]=t5r;X5r["cubeType"]=a5r;X5r["MinFloorHeight"]=o5r;X5r["MaxFloorHeight"]=J5r;X5r["level0Height"]=Z5r;}T5r=new J1r["Cube3DLayer"](O5r);{T5r["mapInfo"]=X5r;}return T5r;};x1r["createVectorLayer"]=function(v5r,N5r,P5r,B5r,h5r,j5r,u5r,c5r,d5r,K5r,b5r,e5r,I5r){var S5r,w5r;if(I5r===void 0){I5r=[];}e5r=J1r["TiledMapInfo"]["purifyFileFormat"](e5r);S5r=new J1r["TiledMapInfo"]();{S5r["name"]=v5r;S5r["serverURL"]=N5r;S5r["resourceURL"]=P5r;S5r["dataSetName"]=B5r;S5r["MinLevel"]=h5r;S5r["MaxLevel"]=j5r;S5r["dataLevels"]=u5r;S5r["North"]=c5r;S5r["South"]=d5r;S5r["West"]=K5r;S5r["East"]=b5r;S5r["fileFormat"]=e5r;if(J1r["Util"]["isDefined"](I5r["wfs"])&&I5r["wfs"]==true)S5r["ogcProtocol"]=J1r["OGC_ProtocolType"]["WFS"];}w5r=new J1r["VectorTileLayer"](v5r);{w5r["setMapInfo"](S5r);if(J1r["Util"]["isDefined"](I5r["addfunc"]))w5r["addObjectEvent"]["addEventListener"](I5r["addfunc"],null);}return w5r;};x1r["createVectorLayer2"]=function(k6r,l6r,r6r,F6r,m6r,L6r,V6r,E6r,y6r,s6r,Y6r,H6r,Q5r){var q5r,f5r;if(Q5r===void 0){Q5r=[];}H6r=J1r["TiledMapInfo"]["purifyFileFormat"](H6r);q5r=new J1r["TiledMapInfo"]();{q5r["name"]=k6r;q5r["serverURL"]=l6r;q5r["resourceURL"]=r6r;q5r["dataSetName"]=F6r;q5r["MinLevel"]=m6r;q5r["MaxLevel"]=L6r;q5r["dataLevels"]=V6r;q5r["North"]=E6r;q5r["South"]=y6r;q5r["West"]=s6r;q5r["East"]=Y6r;q5r["fileFormat"]=H6r;if(J1r["Util"]["isDefined"](Q5r["wfs"])&&Q5r["wfs"]==true)q5r["ogcProtocol"]=J1r["OGC_ProtocolType"]["WFS"];}f5r=new J1r["VectorTileLayer"](k6r);{f5r["setMapInfo"](q5r);}return f5r;};x1r["createVectorImageTileLayer"]=function(M6r,X6r,T6r,a6r,D6r,A6r,z6r,n6r,R6r,g6r,U6r,C6r){var G6r,W6r;if(C6r===void 0){C6r=[];}U6r=J1r["TiledMapInfo"]["purifyFileFormat"](U6r);G6r=new J1r["VectorImageTileLayer"](M6r);{W6r=new J1r["TiledMapInfo"]();{W6r["name"]=M6r;W6r["serverURL"]=X6r;W6r["resourceURL"]=T6r;W6r["dataSetName"]=a6r;W6r["MaxLevel"]=D6r;W6r["dataLevels"]=A6r;W6r["North"]=z6r;W6r["South"]=n6r;W6r["West"]=R6r;W6r["East"]=g6r;W6r["fileFormat"]=U6r;}G6r["init"](W6r);}return G6r;};x1r["createReal3DLayer"]=function(J6r,e6r,v6r,Z6r,x6r,i6r,p6r,S6r,I6r,w6r,o6r){var t6r,O6r;o6r=J1r["TiledMapInfo"]["purifyFileFormat"](o6r);t6r=new J1r["TiledMapInfo"]();{t6r["name"]=J6r;t6r["serverURL"]=e6r;t6r["resourceURL"]=v6r;t6r["dataSetName"]=Z6r;t6r["MinLevel"]=x6r;t6r["MaxLevel"]=i6r;t6r["North"]=p6r;t6r["South"]=S6r;t6r["West"]=I6r;t6r["East"]=w6r;t6r["fileFormat"]=o6r;}O6r=new J1r["vw_Real3DLayer"](J6r);{O6r["setMapInfo"](t6r);}return O6r;};function x1r(){}x1r["createVWPOILayer"]=function(N6r,f6r,c6r,d6r,K6r,b6r,Q6r,P6r,B6r,q6r,u6r){var h6r,j6r;u6r=J1r["TiledMapInfo"]["purifyFileFormat"](u6r);h6r=new J1r["TiledMapInfo"]();{h6r["name"]=N6r;h6r["serverURL"]=f6r;h6r["resourceURL"]=c6r;h6r["dataSetName"]=d6r;h6r["MinLevel"]=K6r;h6r["MaxLevel"]=b6r;h6r["North"]=Q6r;h6r["South"]=P6r;h6r["West"]=B6r;h6r["East"]=q6r;h6r["fileFormat"]=u6r;}j6r=new J1r["vw_POILayer"]();{j6r["setMapInfo"](h6r);}return j6r;};x1r["createQuadImageLayer"]=function(y9r,r9r,L9r,V9r,E9r,l9r,s9r,Y9r,m9r,F9r){var H9r,k9r;m9r=J1r["TiledMapInfo"]["purifyFileFormat"](m9r);H9r=new J1r["TiledMapInfo"]();{H9r["name"]=y9r;H9r["serverURL"]=r9r;H9r["MinLevel"]=L9r;H9r["MaxLevel"]=V9r;H9r["North"]=E9r;H9r["South"]=l9r;H9r["West"]=s9r;H9r["East"]=Y9r;H9r["fileFormat"]=m9r;}k9r=new J1r["QuadImageLayer"]();k9r["name"]="quadImageLayer";k9r["mapInfo"]=H9r;return k9r;};return x1r;}();J1r["Map"]=Z1r;}(CMWORLD||(CMWORLD={})));(function(W9r){var U9r;U9r=function(){G9r["prototype"]["createPolarImageResource"]=function(){{this["arcticCanvas"]=document["createElement"]("canvas");this["arcticCanvas"]["width"]=this["polarImageSize"];this["arcticCanvas"]["height"]=this["polarImageSize"];this["arcticCanvas"]["transparent"]=true;this["arcticContext"]=this["arcticCanvas"]["getContext"]("2d");this["arcticContext"]["name"]="Artic";this["arcticTexture"]=new THREE["Texture"](this["arcticCanvas"]);this["arcticTexture"]["name"]="Artic";this["arcticTexture"]["needsUpdate"]=true;this["antarcticCanvas"]=document["createElement"]("canvas");this["antarcticCanvas"]["width"]=this["polarImageSize"];this["antarcticCanvas"]["height"]=this["polarImageSize"];this["antarcticCanvas"]["transparent"]=true;this["antarcticContext"]=this["antarcticCanvas"]["getContext"]("2d");this["antarcticContext"]["name"]="Antartic";this["antarcticTexture"]=new THREE["Texture"](this["antarcticCanvas"]);this["antarcticTexture"]["name"]="Antartic";this["antarcticTexture"]["needsUpdate"]=true;}};function G9r(){this["cmworld3Viewer"]=null;this["polarImageOverlayEnable"]=false;this["polarImageMaxRadius"]=20;this["polarImageSize"]=1024;this["polarImageCallback"]=null;this["arcticCanvas"]=null;this["arcticContext"]=null;this["arcticTexture"]=null;this["antarcticCanvas"]=null;this["antarcticContext"]=null;this["antarcticTexture"]=null;this["cmworld3Viewer"]=W9r["CmWorld3"]["getInstance"]();}G9r["prototype"]["setPolarImageRadius"]=function(M9r){this["polarImageMaxRadius"]=M9r;};G9r["prototype"]["enablePolarImageOverlay"]=function(C9r,D9r,A9r){this["polarImageOverlayEnable"]=true;this["polarImageMaxRadius"]=C9r;this["polarImageSize"]=D9r;this["polarImageCallback"]=A9r;this["cmworld3Viewer"]["quadTileLayer"]["traverse"](function(z9r){z9r["ResetMaterialSetting"]();});};G9r["prototype"]["disablePolarImageOverlay"]=function(){this["polarImageOverlayEnable"]=false;this["polarImageCallback"]=undefined;this["cmworld3Viewer"]["quadTileLayer"]["traverse"](function(n9r){n9r["ResetMaterialSetting"]();});};G9r["prototype"]["getPolarimageContext"]=function(R9r){if(this["polarImageOverlayEnable"]==true){if(R9r==true){return this["arcticContext"];}else{return this["antarcticContext"];}}return null;};G9r["prototype"]["getPolarImagePosition"]=function(O9r,X9r){var T9r,g9r,a9r,t9r;T9r=this["polarImageSize"]*0.5;g9r=new THREE["Vector2"](T9r,T9r);if(X9r==90.0){return g9r;}if(X9r==-90.0){return g9r;}a9r=0.0;if(X9r<0.0){if(X9r>-90.0+this["polarImageMaxRadius"]){g9r["x"]=-1.0;g9r["y"]=-1.0;return g9r;}a9r=T9r*(90.0+X9r)/this["polarImageMaxRadius"];}else{if(X9r<90.0-this["polarImageMaxRadius"]){g9r["x"]=-1.0;g9r["y"]=-1.0;return g9r;}a9r=T9r*(90.0-X9r)/this["polarImageMaxRadius"];}t9r=0.0;if(O9r<0.0){t9r=-O9r;}else{t9r=360.0-O9r;}g9r["x"]=T9r+a9r*Math["sin"](t9r*W9r["cm_const"]["Deg2Rad"]);g9r["y"]=T9r+a9r*Math["cos"](t9r*W9r["cm_const"]["Deg2Rad"]);return g9r;};G9r["prototype"]["updatePolarImage"]=function(){if(this["polarImageOverlayEnable"]==true){this["arcticTexture"]["needsUpdate"]=true;this["antarcticTexture"]["needsUpdate"]=true;this["cmworld3Viewer"]["option"]["earth"]["resetPolaimage"]();this["cmworld3Viewer"]["quadTileLayer"]["traverse"](function(o9r){o9r["resetPolaimage"]();});}};G9r["prototype"]["renderImage"]=function(){var J9r;if(this["polarImageOverlayEnable"]=true){if(this["polarImageCallback"]){J9r=false;if(this["polarImageCallback"](true,this["arcticContext"])==true){J9r=true;}if(this["polarImageCallback"](false,this["antarcticContext"])==true){J9r=true;}if(J9r==true){this["updatePolarImage"]();}}}};return G9r;}();W9r["Polar"]=U9r;}(CMWORLD||(CMWORLD={})));THREE["ShaderLib"]['mirror']={uniforms:{"mirrorColor":{type:"c",value:new THREE["Color"](0x7F7F7F)},"mirrorSampler":{type:"t",value:null},"textureMatrix":{type:"m4",value:new THREE["Matrix4"]()}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","mirrorCoord = textureMatrix * worldPosition;","gl_Position = projectionMatrix * mvPosition;","}"]["join"]("\n"),fragmentShader:["uniform vec3 mirrorColor;","uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","float blendOverlay(float base, float blend) {","return( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","void main() {","vec4 color = texture2DProj(mirrorSampler, mirrorCoord);","color = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);","gl_FragColor = color;","}"]["join"]("\n")};THREE["Mirror"]=function(u9r,w9r,Z9r){var i9r,p9r,I9r,e9r,v9r,x9r,j9r,S9r,h9r;THREE["Object3D"]["call"](this);this["name"]='mirror_'+this["id"];Z9r=Z9r||{};this["matrixNeedsUpdate"]=true;i9r=Z9r["textureWidth"]!==undefined?Z9r["textureWidth"]:512;p9r=Z9r["textureHeight"]!==undefined?Z9r["textureHeight"]:512;this["clipBias"]=Z9r["clipBias"]!==undefined?Z9r["clipBias"]:0.0;I9r=Z9r["color"]!==undefined?new THREE["Color"](Z9r["color"]):new THREE["Color"](0x7F7F7F);this["renderer"]=u9r;this["mirrorPlane"]=new THREE["Plane"]();this["normal"]=new THREE["Vector3"](0,0,1);this["mirrorWorldPosition"]=new THREE["Vector3"]();this["cameraWorldPosition"]=new THREE["Vector3"]();this["rotationMatrix"]=new THREE["Matrix4"]();this["lookAtPosition"]=new THREE["Vector3"](0,0,-1);this["clipPlane"]=new THREE["Vector4"]();e9r=Z9r["debugMode"]!==undefined?Z9r["debugMode"]:false;if(e9r){v9r=new THREE["ArrowHelper"](new THREE["Vector3"](0,0,1),new THREE["Vector3"](0,0,0),10,0xffff80);x9r=new THREE["Geometry"]();x9r["vertices"]["push"](new THREE["Vector3"](-10,-10,0));x9r["vertices"]["push"](new THREE["Vector3"](10,-10,0));x9r["vertices"]["push"](new THREE["Vector3"](10,10,0));x9r["vertices"]["push"](new THREE["Vector3"](-10,10,0));x9r["vertices"]["push"](x9r["vertices"][0]);j9r=new THREE["Line"](x9r,new THREE["LineBasicMaterial"]({color:0xffff80}));this["add"](v9r);this["add"](j9r);}if(w9r instanceof THREE["PerspectiveCamera"]){this["camera"]=w9r;}else{this["camera"]=new THREE["PerspectiveCamera"]();console["log"](this["name"]+': camera is not a Perspective Camera!');}this["textureMatrix"]=new THREE["Matrix4"]();this["mirrorCamera"]=this["camera"]["clone"]();this["mirrorCamera"]["matrixAutoUpdate"]=true;this["texture"]=new THREE["WebGLRenderTarget"](i9r,p9r);this["tempTexture"]=new THREE["WebGLRenderTarget"](i9r,p9r);S9r=THREE["ShaderLib"]["mirror"];h9r=THREE["UniformsUtils"]["clone"](S9r["uniforms"]);this["material"]=new THREE["ShaderMaterial"]({fragmentShader:S9r["fragmentShader"],vertexShader:S9r["vertexShader"],uniforms:h9r});this["material"]["uniforms"]["mirrorSampler"]["value"]=this["texture"];this["material"]["uniforms"]["mirrorColor"]["value"]=I9r;this["material"]["uniforms"]["textureMatrix"]["value"]=this["textureMatrix"];if(!THREE["Math"]["isPowerOfTwo"](i9r)||!THREE["Math"]["isPowerOfTwo"](p9r)){this["texture"]["generateMipmaps"]=false;this["tempTexture"]["generateMipmaps"]=false;}this["updateTextureMatrix"]();this["render"]();};THREE["Mirror"]["prototype"]=Object["create"](THREE["Object3D"]["prototype"]);THREE["Mirror"]["prototype"]["constructor"]=THREE["Mirror"];THREE["Mirror"]["prototype"]["renderWithMirror"]=function(c9r){var d9r;this["updateTextureMatrix"]();this["matrixNeedsUpdate"]=false;d9r=c9r["camera"];c9r["camera"]=this["mirrorCamera"];c9r["renderTemp"]();c9r["material"]["uniforms"]["mirrorSampler"]["value"]=c9r["tempTexture"];this["render"]();this["matrixNeedsUpdate"]=true;c9r["material"]["uniforms"]["mirrorSampler"]["value"]=c9r["texture"];c9r["camera"]=d9r;c9r["updateTextureMatrix"]();};THREE["Mirror"]["prototype"]["updateTextureMatrix"]=function(){var P9r,B9r,b9r,K9r,N9r;this["updateMatrixWorld"]();this["camera"]["updateMatrixWorld"]();this["mirrorWorldPosition"]["setFromMatrixPosition"](this["matrixWorld"]);this["cameraWorldPosition"]["setFromMatrixPosition"](this["camera"]["matrixWorld"]);this["rotationMatrix"]["extractRotation"](this["matrixWorld"]);this["normal"]["set"](0,0,1);this["normal"]["applyMatrix4"](this["rotationMatrix"]);P9r=this["mirrorWorldPosition"]["clone"]()["sub"](this["cameraWorldPosition"]);P9r["reflect"](this["normal"])["negate"]();P9r["add"](this["mirrorWorldPosition"]);this["rotationMatrix"]["extractRotation"](this["camera"]["matrixWorld"]);this["lookAtPosition"]["set"](0,0,-1);this["lookAtPosition"]["applyMatrix4"](this["rotationMatrix"]);this["lookAtPosition"]["add"](this["cameraWorldPosition"]);B9r=this["mirrorWorldPosition"]["clone"]()["sub"](this["lookAtPosition"]);B9r["reflect"](this["normal"])["negate"]();B9r["add"](this["mirrorWorldPosition"]);this["up"]["set"](0,-1,0);this["up"]["applyMatrix4"](this["rotationMatrix"]);this["up"]["reflect"](this["normal"])["negate"]();this["mirrorCamera"]["position"]["copy"](P9r);this["mirrorCamera"]["up"]=this["up"];this["mirrorCamera"]["lookAt"](B9r);this["mirrorCamera"]["updateProjectionMatrix"]();this["mirrorCamera"]["updateMatrixWorld"]();this["mirrorCamera"]["matrixWorldInverse"]["getInverse"](this["mirrorCamera"]["matrixWorld"]);this["textureMatrix"]["set"](0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);this["textureMatrix"]["multiply"](this["mirrorCamera"]["projectionMatrix"]);this["textureMatrix"]["multiply"](this["mirrorCamera"]["matrixWorldInverse"]);this["mirrorPlane"]["setFromNormalAndCoplanarPoint"](this["normal"],this["mirrorWorldPosition"]);this["mirrorPlane"]["applyMatrix4"](this["mirrorCamera"]["matrixWorldInverse"]);this["clipPlane"]["set"](this["mirrorPlane"]["normal"]["x"],this["mirrorPlane"]["normal"]["y"],this["mirrorPlane"]["normal"]["z"],this["mirrorPlane"]["constant"]);b9r=new THREE["Vector4"]();K9r=this["mirrorCamera"]["projectionMatrix"];b9r["x"]=(Math["sign"](this["clipPlane"]["x"])+K9r["elements"][8])/K9r["elements"][0];b9r["y"]=(Math["sign"](this["clipPlane"]["y"])+K9r["elements"][9])/K9r["elements"][5];b9r["z"]=-1.0;b9r["w"]=(1.0+K9r["elements"][10])/K9r["elements"][14];N9r=new THREE["Vector4"]();N9r=this["clipPlane"]["multiplyScalar"](2.0/this["clipPlane"]["dot"](b9r));K9r["elements"][2]=N9r["x"];K9r["elements"][6]=N9r["y"];K9r["elements"][10]=N9r["z"]+1.0-this["clipBias"];K9r["elements"][14]=N9r["w"];};THREE["Mirror"]["prototype"]["render"]=function(){var q9r;if(this["matrixNeedsUpdate"])this["updateTextureMatrix"]();this["matrixNeedsUpdate"]=true;q9r=this;while(q9r["parent"]!==undefined){q9r=q9r["parent"];}if(q9r!==undefined&&q9r instanceof THREE["Scene"]){this["renderer"]["render"](q9r,this["mirrorCamera"],this["texture"],true);}};THREE["Mirror"]["prototype"]["renderTemp"]=function(){var Q9r;if(this["matrixNeedsUpdate"])this["updateTextureMatrix"]();this["matrixNeedsUpdate"]=true;Q9r=this;while(Q9r["parent"]!==undefined){Q9r=Q9r["parent"];}if(Q9r!==undefined&&Q9r instanceof THREE["Scene"]){this["renderer"]["render"](Q9r,this["mirrorCamera"],this["tempTexture"],true);}};THREE["ShaderLib"]['water']={uniforms:{"normalSampler":{type:"t",value:null},"mirrorSampler":{type:"t",value:null},"alpha":{type:"f",value:1.0},"time":{type:"f",value:0.0},"distortionScale":{type:"f",value:20.0},"textureMatrix":{type:"m4",value:new THREE["Matrix4"]()},"sunColor":{type:"c",value:new THREE["Color"](0x7F7F7F)},"sunDirection":{type:"v3",value:new THREE["Vector3"](0.70707,0.70707,0)},"eye":{type:"v3",value:new THREE["Vector3"](0,0,0)},"waterColor":{type:"c",value:new THREE["Color"](0x555555)}},vertexShader:['uniform mat4 textureMatrix;','uniform float time;','varying vec4 mirrorCoord;','varying vec3 worldPosition;','void main()','{','	mirrorCoord = modelMatrix * vec4( position, 1.0 );','	worldPosition = mirrorCoord.xyz;','	mirrorCoord = textureMatrix * mirrorCoord;','	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','}']["join"]('\n'),fragmentShader:['precision highp float;','uniform sampler2D mirrorSampler;','uniform float alpha;','uniform float time;','uniform float distortionScale;','uniform sampler2D normalSampler;','uniform vec3 sunColor;','uniform vec3 sunDirection;','uniform vec3 eye;','uniform vec3 waterColor;','varying vec4 mirrorCoord;','varying vec3 worldPosition;','vec4 getNoise( vec2 uv )','{','	vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);','	vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );','	vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );','	vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );','	vec4 noise = ( texture2D( normalSampler, uv0 ) ) +','		( texture2D( normalSampler, uv1 ) ) +','		( texture2D( normalSampler, uv2 ) ) +','		( texture2D( normalSampler, uv3 ) );','	return noise * 0.5 - 1.0;','}','void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor )','{','	vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );','	float direction = max( 0.0, dot( eyeDirection, reflection ) );','	specularColor += pow( direction, shiny ) * sunColor * spec;','	diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;','}','void main()','{','	vec4 noise = getNoise( worldPosition.xz );','	vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );','	vec3 diffuseLight = vec3(0.0);','	vec3 specularLight = vec3(0.0);','	vec3 worldToEye = eye-worldPosition;','	vec3 eyeDirection = normalize( worldToEye );','	sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );','	float distance = length(worldToEye);','	vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;','	vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );','	float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );','	float rf0 = 0.3;','	float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );','	vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;','	vec3 albedo = mix( sunColor * diffuseLight * 0.3 + scatter, ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance );','	gl_FragColor = vec4( albedo, alpha );','}']["join"]('\n')};THREE["Water"]=function(y0r,V0r,s0r,f9r){var k0r,m0r,L0r,E0r;THREE["Object3D"]["call"](this);this["name"]='water_'+this["id"];;f9r=f9r||{};this["matrixNeedsUpdate"]=true;k0r=H0r(f9r["textureWidth"],512);m0r=H0r(f9r["textureHeight"],512);this["clipBias"]=H0r(f9r["clipBias"],0.0);this["alpha"]=H0r(f9r["alpha"],1.0);this["time"]=H0r(f9r["time"],0.0);this["normalSampler"]=H0r(f9r["waterNormals"],null);this["sunDirection"]=H0r(f9r["sunDirection"],new THREE["Vector3"](0.70707,0.70707,0.0));this["sunColor"]=new THREE["Color"](H0r(f9r["sunColor"],0xffffff));this["waterColor"]=new THREE["Color"](H0r(f9r["waterColor"],0x7F7F7F));this["eye"]=H0r(f9r["eye"],new THREE["Vector3"](0,0,0));this["distortionScale"]=H0r(f9r["distortionScale"],20.0);this["renderer"]=y0r;this["scene"]=s0r;this["mirrorPlane"]=new THREE["Plane"]();this["normal"]=new THREE["Vector3"](0,0,1);this["mirrorWorldPosition"]=new THREE["Vector3"]();this["cameraWorldPosition"]=new THREE["Vector3"]();function H0r(Y0r,l0r){return Y0r!==undefined?Y0r:l0r;}this["rotationMatrix"]=new THREE["Matrix4"]();this["lookAtPosition"]=new THREE["Vector3"](0,0,-1);this["clipPlane"]=new THREE["Vector4"]();if(V0r instanceof THREE["PerspectiveCamera"])this["camera"]=V0r;else{this["camera"]=new THREE["PerspectiveCamera"]();console["log"](this["name"]+': camera is not a Perspective Camera!');}this["textureMatrix"]=new THREE["Matrix4"]();this["mirrorCamera"]=this["camera"]["clone"]();this["texture"]=new THREE["WebGLRenderTarget"](k0r,m0r);this["tempTexture"]=new THREE["WebGLRenderTarget"](k0r,m0r);L0r=THREE["ShaderLib"]["water"];E0r=THREE["UniformsUtils"]["clone"](L0r["uniforms"]);this["material"]=new THREE["ShaderMaterial"]({fragmentShader:L0r["fragmentShader"],vertexShader:L0r["vertexShader"],uniforms:E0r,transparent:true});this["material"]["uniforms"]["mirrorSampler"]["value"]=this["texture"];this["material"]["uniforms"]["textureMatrix"]["value"]=this["textureMatrix"];this["material"]["uniforms"]["alpha"]["value"]=this["alpha"];this["material"]["uniforms"]["time"]["value"]=this["time"];this["material"]["uniforms"]["normalSampler"]["value"]=this["normalSampler"];this["material"]["uniforms"]["sunColor"]["value"]=this["sunColor"];this["material"]["uniforms"]["waterColor"]["value"]=this["waterColor"];this["material"]["uniforms"]["sunDirection"]["value"]=this["sunDirection"];this["material"]["uniforms"]["distortionScale"]["value"]=this["distortionScale"];this["material"]["uniforms"]["eye"]["value"]=this["eye"];if(!THREE["Math"]["isPowerOfTwo"](k0r)||!THREE["Math"]["isPowerOfTwo"](m0r)){this["texture"]["generateMipmaps"]=false;this["tempTexture"]["generateMipmaps"]=false;}this["updateTextureMatrix"]();this["render"]();};THREE["Water"]["prototype"]=Object["create"](THREE["Mirror"]["prototype"]);THREE["Water"]["prototype"]["constructor"]=THREE["Water"];THREE["Water"]["prototype"]["updateTextureMatrix"]=function(){var U0r,G0r,F0r,r0r,W0r,M0r;this["updateMatrixWorld"]();this["camera"]["updateMatrixWorld"]();this["mirrorWorldPosition"]["setFromMatrixPosition"](this["matrixWorld"]);this["cameraWorldPosition"]["setFromMatrixPosition"](this["camera"]["matrixWorld"]);this["rotationMatrix"]["extractRotation"](this["matrixWorld"]);this["normal"]["set"](0,0,1);this["normal"]["applyMatrix4"](this["rotationMatrix"]);U0r=this["mirrorWorldPosition"]["clone"]()["sub"](this["cameraWorldPosition"]);U0r["reflect"](this["normal"])["negate"]();U0r["add"](this["mirrorWorldPosition"]);this["rotationMatrix"]["extractRotation"](this["camera"]["matrixWorld"]);this["lookAtPosition"]["set"](0,0,-1);this["lookAtPosition"]["applyMatrix4"](this["rotationMatrix"]);this["lookAtPosition"]["add"](this["cameraWorldPosition"]);G0r=this["mirrorWorldPosition"]["clone"]()["sub"](this["lookAtPosition"]);G0r["reflect"](this["normal"])["negate"]();G0r["add"](this["mirrorWorldPosition"]);this["up"]["set"](0,-1,0);this["up"]["applyMatrix4"](this["rotationMatrix"]);this["up"]["reflect"](this["normal"])["negate"]();this["mirrorCamera"]["position"]["copy"](U0r);this["mirrorCamera"]["up"]=this["up"];this["mirrorCamera"]["lookAt"](G0r);this["mirrorCamera"]["aspect"]=this["camera"]["aspect"];this["mirrorCamera"]["updateProjectionMatrix"]();this["mirrorCamera"]["updateMatrixWorld"]();this["mirrorCamera"]["matrixWorldInverse"]["getInverse"](this["mirrorCamera"]["matrixWorld"]);this["textureMatrix"]["set"](0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);this["textureMatrix"]["multiply"](this["mirrorCamera"]["projectionMatrix"]);this["textureMatrix"]["multiply"](this["mirrorCamera"]["matrixWorldInverse"]);this["mirrorPlane"]["setFromNormalAndCoplanarPoint"](this["normal"],this["mirrorWorldPosition"]);this["mirrorPlane"]["applyMatrix4"](this["mirrorCamera"]["matrixWorldInverse"]);this["clipPlane"]["set"](this["mirrorPlane"]["normal"]["x"],this["mirrorPlane"]["normal"]["y"],this["mirrorPlane"]["normal"]["z"],this["mirrorPlane"]["constant"]);F0r=new THREE["Vector4"]();r0r=this["mirrorCamera"]["projectionMatrix"];F0r["x"]=(C0r(this["clipPlane"]["x"])+r0r["elements"][8])/r0r["elements"][0];F0r["y"]=(C0r(this["clipPlane"]["y"])+r0r["elements"][9])/r0r["elements"][5];F0r["z"]=-1.0;F0r["w"]=(1.0+r0r["elements"][10])/r0r["elements"][14];W0r=new THREE["Vector4"]();W0r=this["clipPlane"]["multiplyScalar"](2.0/this["clipPlane"]["dot"](F0r));r0r["elements"][2]=W0r["x"];function C0r(D0r){return D0r?D0r<0?-1:1:0;}r0r["elements"][6]=W0r["y"];r0r["elements"][10]=W0r["z"]+1.0-this["clipBias"];r0r["elements"][14]=W0r["w"];M0r=new THREE["Vector3"]();M0r["setFromMatrixPosition"](this["camera"]["matrixWorld"]);this["eye"]=M0r;this["material"]["uniforms"]["eye"]["value"]=this["eye"];};(function(A0r){var n0r,z0r,R0r,g0r,X0r;n0r=function(){T0r["prototype"]["isTrivial"]=function(){return!this["vertexBuffer"]||this["vertexBufferLength"]<3||!this["indexBuffer"]||this["indexBufferLength"]<3;};function T0r(){this["faceCount"]=0;this["name"]="";this["vertexBuffer"]=[];this["vertexBufferLength"]=0;this["indexBuffer"]=[];this["indexBufferLength"]=0;this["texCoordBuffer"]=[];this["texCoordBufferLength"]=0;this["normalBuffer"]=[];this["normalBufferLength"]=0;this["texCoordIndexBuffer"]=[];this["texCoordIndexBufferLength"]=0;this["material"]=null;this["isDoubleSided"]=true;};return T0r;}();A0r["_3dsMeshInfo"]=n0r;z0r=function(){function a0r(){this["textureFileName"]="";this["hasTexture"]=false;this["diffuseColor"]=0xffffff;this["ambientColor"]=0x111111;this["specularColor"]=0;this["bothSides"]=THREE["DoubleSide"];}return a0r;}();A0r["_3dsMaterial"]=z0r;R0r=function(){t0r["load3DS"]=function(o0r,x0r,J0r,p0r,O0r,Z0r){var i0r;if(O0r===void 0){O0r=null;}if(Z0r===void 0){Z0r=true;}i0r=p0r;A0r["NetWork"]["requestFile"](o0r,function(v0r){var I0r,j0r,b0r,h0r,S0r,c0r,d0r,K0r,e0r,u0r;if(v0r["response"]!=null){if(J0r!=null){I0r=new Array();j0r=false;if(j0r){b0r=o0r;h0r=new THREE["TDSLoader"]();S0r=h0r["parse"](v0r["response"],x0r);if(S0r!=null){for(var w0r=0;w0r<S0r["children"]["length"];w0r++){c0r=S0r["children"][w0r];I0r["push"](c0r);}}}else{d0r=new A0r["Max3DSLoader"]();K0r=d0r["parse3DS"](v0r["response"]);e0r=null;if(O0r!=null){e0r=O0r["movement"];}u0r=A0r["Max3DSLoader"]["packingToFloat32Data"](K0r,e0r);I0r=A0r["Max3DSLoader"]["makeMeshFromPackingData"](u0r);}if(J0r){J0r(o0r,x0r,I0r,i0r);}}}},null,Z0r);return true;};t0r["prototype"]["init"]=function(){this["_materials"]={};this["_unfinalized_objects"]={};this["_textures"]={};this["_cur_obj_end"]=0;this["_cur_obj"]=null;this["_cur_mat_end"]=0;this["_cur_mat"]=null;this["totalFaces"]=0;};t0r["prototype"]["parseMaterial"]=function(N0r,f0r){var P0r,q0r,Q0r,B0r;P0r=new z0r();while(N0r["tell"]()<f0r){q0r=N0r["readUInt16"]();Q0r=N0r["readUInt32"]();B0r=N0r["tell"]()+(Q0r-6);switch(q0r){case 0xA000:P0r["name"]=this["readNulTermString"](N0r);break;case 0xA010:P0r["ambientColor"]=this["readColor"](N0r);break;case 0xA020:P0r["diffuseColor"]=this["readColor"](N0r);break;case 0xA030:P0r["specularColor"]=this["readColor"](N0r);break;case 0xA050:P0r["transparency"]=this["readAmount"](N0r,B0r);break;case 0xA081:P0r["twoSided"]=true;break;case 0xA200:P0r["colorMap"]=this["parseTexture"](N0r,B0r);break;case 0xA204:P0r["specularMap"]=this["parseTexture"](N0r,B0r);break;default:N0r["seek"](B0r);break;}}return P0r;};t0r["prototype"]["readAmount"]=function(H7y,L7y){var k7y,m7y,V7y;k7y=0;m7y=H7y["readUInt16"]();V7y=H7y["readUInt32"]();switch(m7y){case 0x0030:k7y=H7y["readUInt16"]();break;default:break;}H7y["seek"](L7y);return k7y;};t0r["prototype"]["readColor"]=function(E7y){var y7y,s7y,Y7y,l7y,r7y;l7y=E7y["readUInt16"]();r7y=E7y["readUInt32"]();switch(l7y){case 0x0010:y7y=E7y["readSingle"]()*255;s7y=E7y["readSingle"]()*255;Y7y=E7y["readSingle"]()*255;break;case 0x0011:y7y=E7y["readUInt8"]();s7y=E7y["readUInt8"]();Y7y=E7y["readUInt8"]();break;default:E7y["skip"](r7y-6);break;}return y7y<<16|s7y<<8|Y7y;};t0r["prototype"]["parseTexture"]=function(F7y,M7y){var W7y,U7y,G7y;W7y={};while(F7y["tell"]()<M7y){U7y=F7y["readUInt16"]();G7y=F7y["readUInt32"]();switch(U7y){case 0xA300:W7y["url"]=this["readNulTermString"](F7y);break;default:F7y["skip"](G7y-6);break;}}this["_textures"][W7y["url"]]=W7y;return W7y;};t0r["prototype"]["readNulTermString"]=function(A7y){var D7y,C7y;C7y='';while((D7y=A7y["readUInt8"]())>0){C7y+=String["fromCharCode"](D7y);}return C7y;};t0r["prototype"]["parseVertexList"]=function(R7y){var z7y,g7y,n7y,X7y,T7y,a7y;n7y=R7y["readUInt16"]();if(this["_cur_obj"]["verts"]["length"]<n7y*3){if(n7y*3<this["initArrayCount"]){this["_cur_obj"]["verts"]=new Array(this["initArrayCount"]);}else{this["_cur_obj"]["verts"]=new Array(n7y*3);}}this["_cur_obj"]["vertsLength"]=n7y*3;z7y=0;g7y=this["_cur_obj"]["vertsLength"];while(z7y<g7y){X7y=R7y["readSingle"]();T7y=R7y["readSingle"]();a7y=R7y["readSingle"]();this["_cur_obj"]["verts"][z7y++]=X7y;this["_cur_obj"]["verts"][z7y++]=T7y;this["_cur_obj"]["verts"][z7y++]=a7y;}};t0r["prototype"]["parseFaceList"]=function(o7y){var O7y,i7y,t7y,J7y,Z7y,x7y;t7y=o7y["readUInt16"]();this["_cur_obj"]["facesCount"]=t7y;if(this["_cur_obj"]["indices"]["length"]<t7y*3){if(t7y*3<this["initArrayCount"]){this["_cur_obj"]["indices"]=new Array(this["initArrayCount"]);}else{this["_cur_obj"]["indices"]=new Array(t7y*3);}}this["_cur_obj"]["indicesLength"]=t7y*3;if(this["_cur_obj"]["uvsIndexes"]["length"]<t7y*3){this["_cur_obj"]["uvsIndexes"]=new Array(t7y*3);}this["_cur_obj"]["uvsIndexesLength"]=t7y*3;O7y=0;i7y=t7y*3;while(O7y<i7y){J7y=o7y["readUInt16"]();Z7y=o7y["readUInt16"]();x7y=o7y["readUInt16"]();this["_cur_obj"]["indices"][O7y+0]=J7y;this["_cur_obj"]["indices"][O7y+1]=Z7y;this["_cur_obj"]["indices"][O7y+2]=x7y;this["_cur_obj"]["uvsIndexes"][O7y+0]=J7y;this["_cur_obj"]["uvsIndexes"][O7y+1]=Z7y;this["_cur_obj"]["uvsIndexes"][O7y+2]=x7y;o7y["skip"](2);O7y+=3;}};t0r["prototype"]["parseUVList"]=function(S7y){var I7y,e7y,p7y,w7y;p7y=S7y["readUInt16"]();if(this["_cur_obj"]["uvs"]["length"]<p7y*2){if(p7y*2<this["initArrayCount"]){this["_cur_obj"]["uvs"]=new Array(this["initArrayCount"]);}else{this["_cur_obj"]["uvs"]=new Array(p7y*2);}}this["_cur_obj"]["uvsLength"]=p7y*2;I7y=0;e7y=p7y;w7y=0;while(I7y<e7y){this["_cur_obj"]["uvs"][w7y++]=S7y["readSingle"]();this["_cur_obj"]["uvs"][w7y++]=S7y["readSingle"]();I7y+=1;}};t0r["prototype"]["parseFaceMaterialList"]=function(j7y){var u7y,d7y,c7y,v7y;v7y=[];u7y=this["readNulTermString"](j7y);d7y=j7y["readUInt16"]();for(var h7y=0;h7y<d7y;h7y++){v7y[h7y]=0;}c7y=0;while(c7y<v7y["length"]){v7y[c7y++]=j7y["readUInt16"]();}this["_cur_obj"]["materials"]["push"](u7y);this["_cur_obj"]["materialFaces"][u7y]=v7y;};t0r["prototype"]["readTransform"]=function(b7y){var K7y;K7y=[];K7y[0]=b7y["readSingle"]();K7y[2]=b7y["readSingle"]();K7y[1]=b7y["readSingle"]();K7y[3]=0;K7y[8]=b7y["readSingle"]();K7y[10]=b7y["readSingle"]();K7y[9]=b7y["readSingle"]();K7y[11]=0;K7y[4]=b7y["readSingle"]();K7y[6]=b7y["readSingle"]();K7y[5]=b7y["readSingle"]();K7y[7]=0;K7y[12]=b7y["readSingle"]();K7y[14]=b7y["readSingle"]();K7y[13]=b7y["readSingle"]();K7y[15]=1;return K7y;};t0r["prototype"]["parseObjectAnimation"]=function(N7y,f7y){var H3y,k3y,B7y,P7y,m3y,q7y,Q7y;B7y={};while(N7y["tell"]()<f7y){q7y=N7y["readUInt16"]();Q7y=N7y["readUInt32"]();switch(q7y){case 0xb010:P7y=this["readNulTermString"](N7y);N7y["skip"](4);m3y=N7y["readUInt16"]();break;case 0xb013:B7y["x"]=N7y["readSingle"]();B7y["z"]=N7y["readSingle"]();B7y["y"]=N7y["readSingle"]();break;default:N7y["skip"](Q7y-6);break;}}if(P7y!='$$$DUMMY'&&this["_unfinalized_objects"]["hasOwnProperty"](P7y)){H3y=this["_unfinalized_objects"][P7y];k3y=null;delete this["_unfinalized_objects"][P7y];}};t0r["prototype"]["parseSmoothingGroups"]=function(E3y){var V3y,L3y;V3y=this["_cur_obj"]["facesCount"];L3y=0;while(L3y<V3y){E3y["readUInt32"]();L3y++;}};function t0r(){this["_materials"]={};this["_unfinalized_objects"]={};this["_textures"]={};this["_cur_obj_end"]=0;this["_cur_obj"]=null;this["_cur_mat_end"]=0;this["_cur_mat"]=null;this["totalFaces"]=0;this["totalVertex"]=0;this["meshInfoList"]=[];this["initArrayCount"]=6000;this["init"]();}t0r["prototype"]["finalizeCurrentMaterial"]=function(){var y3y;y3y=new z0r();if(this["_cur_mat"]["colorMap"]){y3y["textureFileName"]=this["_cur_mat"]["colorMap"]["url"];}else{y3y["diffuseColor"]=this["_cur_mat"]["diffuseColor"];}y3y["ambientColor"]=this["_cur_mat"]["ambientColor"];y3y["specularColor"]=this["_cur_mat"]["specularColor"];y3y["bothSides"]=this["_cur_mat"]["twoSided"];this["_materials"][this["_cur_mat"]["name"]]=this["_cur_mat"];this["_cur_mat"]["material"]=y3y;this["_cur_mat"]=null;};t0r["prototype"]["calcNormal"]=function(s3y){var r3y,F3y,W3y,A3y,M3y,D3y,l3y,C3y,z3y,n3y,R3y,G3y;A3y=new THREE["Vector3"](),M3y=new THREE["Vector3"](),D3y=new THREE["Vector3"](),l3y=new THREE["Vector3"](),C3y=new THREE["Vector3"]();if(s3y["normalBuffer"]["length"]<s3y["vertexBufferLength"]){if(s3y["vertexBufferLength"]>this["initArrayCount"]){s3y["normalBuffer"]=new Float32Array(this["initArrayCount"]);}else{s3y["normalBuffer"]=new Float32Array(s3y["vertexBufferLength"]);}}s3y["normalBufferLength"]=s3y["vertexBufferLength"];for(var Y3y=0,U3y=s3y["indexBufferLength"];Y3y<U3y;Y3y+=3){r3y=s3y["indexBuffer"][Y3y+0]*3;F3y=s3y["indexBuffer"][Y3y+1]*3;W3y=s3y["indexBuffer"][Y3y+2]*3;A3y["set"](s3y["vertexBuffer"][r3y+0],s3y["vertexBuffer"][r3y+1],s3y["vertexBuffer"][r3y+2]);M3y["set"](s3y["vertexBuffer"][F3y+0],s3y["vertexBuffer"][F3y+1],s3y["vertexBuffer"][F3y+2]);D3y["set"](s3y["vertexBuffer"][W3y+0],s3y["vertexBuffer"][W3y+1],s3y["vertexBuffer"][W3y+2]);l3y["subVectors"](D3y,M3y);C3y["subVectors"](A3y,M3y);l3y["cross"](C3y);s3y["normalBuffer"][r3y]+=l3y["x"];s3y["normalBuffer"][r3y+1]+=l3y["y"];s3y["normalBuffer"][r3y+2]+=l3y["z"];s3y["normalBuffer"][F3y]+=l3y["x"];s3y["normalBuffer"][F3y+1]+=l3y["y"];s3y["normalBuffer"][F3y+2]+=l3y["z"];s3y["normalBuffer"][W3y]+=l3y["x"];s3y["normalBuffer"][W3y+1]+=l3y["y"];s3y["normalBuffer"][W3y+2]+=l3y["z"];}for(var Y3y=0,U3y=s3y["normalBufferLength"];Y3y<U3y;Y3y+=3){z3y=s3y["normalBuffer"][Y3y];n3y=s3y["normalBuffer"][Y3y+1];R3y=s3y["normalBuffer"][Y3y+2];G3y=1.0/Math["sqrt"](z3y*z3y+n3y*n3y+R3y*R3y);s3y["normalBuffer"][Y3y]*=G3y;s3y["normalBuffer"][Y3y+1]*=G3y;s3y["normalBuffer"][Y3y+2]*=G3y;}};t0r["prototype"]["parse3DS"]=function(I3y){var d3y,X3y,j3y,h3y,w3y,a3y,O3y,g3y,J3y,p3y,v3y,u3y,S3y,x3y,e3y,c3y,o3y,t3y;if(I3y==undefined||I3y==null)return;X3y=new A0r["BinaryReader"](I3y,true);j3y=0;h3y=0;this["totalVertex"]=0;this["totalFaces"]=0;this["meshInfoList"]=[];while(!X3y["eof"]()){if(this["_cur_mat"]&&X3y["tell"]()>=this["_cur_mat_end"]){this["finalizeCurrentMaterial"]();}else if(this["_cur_obj"]&&X3y["tell"]()>=this["_cur_obj_end"]){w3y=this["_cur_obj"]["materialFaces"];a3y=null;for(var Z3y in w3y){a3y=this["_materials"][Z3y];O3y=w3y[Z3y];if(O3y==null||O3y["length"]<1)continue;g3y=new n0r();this["meshInfoList"]["push"](g3y);g3y["faceCount"]=O3y["length"];g3y["name"]=Z3y;J3y=g3y["faceCount"]*3;g3y["vertexBuffer"]=new Array(J3y*3);g3y["texCoordBuffer"]=new Array(J3y*2);p3y=0;v3y=0;for(var T3y=0;T3y<g3y["faceCount"];T3y++){u3y=O3y[T3y]*3;for(var i3y=0;i3y<3;i3y++){S3y=this["_cur_obj"]["indices"][u3y+i3y];x3y=S3y*3;e3y=S3y*2;g3y["vertexBuffer"][p3y++]=this["_cur_obj"]["verts"][x3y];g3y["vertexBuffer"][p3y++]=this["_cur_obj"]["verts"][x3y+1];g3y["vertexBuffer"][p3y++]=this["_cur_obj"]["verts"][x3y+2];g3y["texCoordBuffer"][v3y++]=this["_cur_obj"]["uvs"][e3y];g3y["texCoordBuffer"][v3y++]=this["_cur_obj"]["uvs"][e3y+1];}}g3y["vertexBufferLength"]=g3y["vertexBuffer"]["length"];g3y["texCoordBufferLength"]=g3y["texCoordBuffer"]["length"];g3y["indexBuffer"]=new Array(J3y);for(var T3y=0;T3y<g3y["indexBuffer"]["length"];T3y++){g3y["indexBuffer"][T3y]=T3y;}g3y["indexBufferLength"]=g3y["indexBuffer"]["length"];g3y["material"]=new z0r();if(a3y["colorMap"]){g3y["material"]["textureFileName"]=a3y["colorMap"]["url"];g3y["material"]["hasTexture"]=true;}else{g3y["material"]["diffuseColor"]=a3y["diffuseColor"];g3y["material"]["hasTexture"]=false;}g3y["isDoubleSided"]=true;g3y["material"]["transparency"]=a3y["transparency"]>0?a3y["transparency"]/100:0;if(!g3y["isTrivial"]()){j3y++;h3y++;this["calcNormal"](g3y);this["totalVertex"]+=g3y["vertexBufferLength"];this["totalFaces"]+=g3y["faceCount"];}}this["_unfinalized_objects"][this["_cur_obj"]["name"]]=this["_cur_obj"];this["_cur_obj_end"]=Number["MAX_VALUE"];}c3y=X3y["readUInt16"]();o3y=X3y["readUInt32"]();t3y=X3y["tell"]()+(o3y-6);switch(c3y){case 0x4D4D:case 0x3D3D:case 0xB000:continue;case 0xAFFF:this["_cur_mat_end"]=t3y;this["_cur_mat"]=this["parseMaterial"](X3y,t3y);break;case 0x4000:this["_cur_obj_end"]=t3y;if(this["_cur_obj"]==null){this["_cur_obj"]={};this["_cur_obj"]["verts"]=[];this["_cur_obj"]["vertsLength"]=0;this["_cur_obj"]["indices"]=[];this["_cur_obj"]["indicesLength"]=0;this["_cur_obj"]["uvsIndexes"]=[];this["_cur_obj"]["uvsIndexesLength"]=0;this["_cur_obj"]["uvs"]=[];this["_cur_obj"]["uvsLength"]=0;}this["_cur_obj"]["name"]=this["readNulTermString"](X3y);this["_cur_obj"]["materials"]=[];this["_cur_obj"]["materialFaces"]=[];break;case 0x4100:this["_cur_obj"]["type"]='mesh';break;case 0x4110:this["parseVertexList"](X3y);break;case 0x4120:this["parseFaceList"](X3y);break;case 0x4140:this["parseUVList"](X3y);break;case 0x4130:this["parseFaceMaterialList"](X3y);break;case 0x4160:this["_cur_obj"]["transform"]=this["readTransform"](X3y);break;case 0xB002:this["parseObjectAnimation"](X3y,t3y);break;case 0x4150:this["parseSmoothingGroups"](X3y);break;default:if(o3y-6==24){this["readTransform"](X3y);}else{X3y["skip"](o3y-6);}break;}}return this["meshInfoList"];};t0r["packingToFloat32Data"]=function(f3y,Q3y){var H8y,C8y,P3y,A8y,D8y,M8y,k8y,r8y,G8y,U8y,W8y,s8y,l8y,R8y,g8y,n8y,F8y,y8y,E8y,V8y,L8y,m8y,Y8y,X8y,b3y,B3y,q3y;H8y=0;C8y=0;for(var z8y in f3y){H8y+=f3y[z8y]["vertexBufferLength"];C8y+=f3y[z8y]["faceCount"];}P3y=new Float32Array(H8y);A8y=new Uint32Array(C8y*3);D8y=new Float32Array(H8y*2/3);M8y=new Float32Array(H8y);k8y=new Uint32Array(f3y["length"]);r8y=[];G8y=new Float32Array(f3y["length"]);U8y=new Uint8Array(f3y["length"]);W8y=new Uint8Array(f3y["length"]);s8y=new Uint32Array(f3y["length"]);l8y=0;R8y=0;g8y=0;n8y=0;F8y=0;y8y=Number["MAX_VALUE"];E8y=Number["MIN_VALUE"];V8y=Number["MAX_VALUE"];L8y=Number["MIN_VALUE"];m8y=Number["MAX_VALUE"];Y8y=Number["MIN_VALUE"];X8y=-1;for(var N3y=0;N3y<f3y["length"];N3y++){b3y=f3y[N3y];for(var K3y=0;K3y<b3y["vertexBufferLength"];K3y+=3){P3y[l8y++]=b3y["vertexBuffer"][K3y];P3y[l8y++]=b3y["vertexBuffer"][K3y+1];P3y[l8y++]=b3y["vertexBuffer"][K3y+2];{if(y8y>b3y["vertexBuffer"][K3y]){y8y=b3y["vertexBuffer"][K3y];}if(E8y<b3y["vertexBuffer"][K3y]){E8y=b3y["vertexBuffer"][K3y];}}{if(V8y>b3y["vertexBuffer"][K3y+1]){V8y=b3y["vertexBuffer"][K3y+1];}if(L8y<b3y["vertexBuffer"][K3y+1]){L8y=b3y["vertexBuffer"][K3y+1];}}{if(m8y>b3y["vertexBuffer"][K3y+2]){m8y=b3y["vertexBuffer"][K3y+2];}if(Y8y<b3y["vertexBuffer"][K3y+2]){Y8y=b3y["vertexBuffer"][K3y+2];}}}for(var K3y=0;K3y<b3y["normalBufferLength"];K3y++){M8y[R8y++]=b3y["normalBuffer"][K3y];}if(N3y==0){k8y[N3y]=0;}else{k8y[N3y]=k8y[N3y-1]+s8y[N3y-1];}s8y[N3y]=b3y["indexBufferLength"];for(var K3y=0;K3y<b3y["indexBufferLength"];K3y++){A8y[g8y++]=b3y["indexBuffer"][K3y]+F8y;}if(b3y["texCoordBuffer"]){for(var K3y=0;K3y<b3y["texCoordBufferLength"];K3y++){D8y[n8y++]=b3y["texCoordBuffer"][K3y];}}W8y[N3y]=b3y["material"]["hasTexture"];r8y[N3y]=b3y["material"]["textureFileName"];G8y[N3y]=b3y["material"]["diffuseColor"];U8y[N3y]=b3y["material"]["bothSides"];F8y=b3y["vertexBuffer"]["length"]/3;}if(Q3y==null){Q3y=new THREE["Vector3"]((y8y+E8y)*-0.5,(V8y+L8y)*-0.5,(m8y+Y8y)*-0.5);Q3y["z"]=-m8y;{B3y=0;for(var N3y=0;N3y<P3y["length"];N3y++){B3y=N3y*3;P3y[B3y]=P3y[B3y]+Q3y["x"];P3y[B3y+1]=P3y[B3y+1]+Q3y["y"];P3y[B3y+2]=P3y[B3y+2]+Q3y["z"];}}}else{Q3y["x"]=Q3y["x"]+(y8y+E8y)*-0.5;Q3y["y"]=Q3y["y"]+(V8y+L8y)*-0.5;for(var N3y=0,B3y=0;N3y<P3y["length"];N3y++){B3y=N3y*3;P3y[B3y]=P3y[B3y]+Q3y["x"];P3y[B3y+1]=P3y[B3y+1]+Q3y["y"];P3y[B3y+2]=P3y[B3y+2]+Q3y["z"];}}q3y=A0r["FuncForWorker"]["genWorkerMsgObject"]();q3y["success"]=true;q3y["groups"]=k8y;q3y["counts"]=s8y;q3y["vertices"]=P3y;q3y["indices"]=A8y;q3y["uv"]=D8y;q3y["normal"]=M8y;q3y["diffuseColors"]=G8y;q3y["bothSides"]=U8y;q3y["hasTextures"]=W8y;q3y["textures"]=r8y;q3y["dataState"]=true;return q3y;};t0r["makeMeshFromPackingData"]=function(a8y){var p8y,t8y,Z8y,K8y,J8y,w8y,x8y,i8y,I8y,d8y,e8y,c8y,j8y,u8y,O8y,S8y,h8y,v8y;if(a8y["dataState"]==false){}else{p8y=new Array();for(var o8y=0;o8y<a8y["groups"]["length"];o8y++){t8y=a8y["counts"][o8y];Z8y=a8y["groups"][o8y];K8y=Z8y+t8y;if(t8y<1)continue;J8y=t8y;w8y=new Float32Array(J8y*3);x8y=null;if(t8y<65500)x8y=new Uint16Array(t8y);else x8y=new Uint32Array(t8y);i8y=new Float32Array(J8y*2);I8y=new Float32Array(J8y*3);d8y=new Uint8Array(a8y["hasTextures"]["length"]);{e8y=Z8y*3;for(var T8y=0;T8y<J8y*3;T8y++){w8y[T8y]=a8y["vertices"][e8y++];}c8y=Z8y;for(var T8y=0;T8y<t8y;T8y++){x8y[T8y]=T8y;}j8y=Z8y*2;for(var T8y=0;T8y<J8y*2;T8y++){i8y[T8y]=a8y["uv"][j8y++];}u8y=Z8y*3;for(var T8y=0;T8y<J8y*3;T8y++){I8y[T8y]=a8y["normal"][u8y++];}}O8y=new THREE["BufferGeometry"]();O8y["addAttribute"]('position',new THREE["BufferAttribute"](w8y,3));O8y["addAttribute"]('uv',new THREE["BufferAttribute"](i8y,2));O8y["addAttribute"]('normal',new THREE["BufferAttribute"](I8y,3));O8y["setIndex"](new THREE["BufferAttribute"](x8y,1));O8y["clearGroups"]();O8y["addGroup"](0,t8y,0);S8y=null;if(a8y["hasTextures"][o8y]==1){S8y=a8y["textures"][o8y]["toLowerCase"]();}h8y=A0r["Max3DSLoader"]["genMaterial"](S8y);v8y=new THREE["Mesh"](O8y,h8y);p8y["push"](v8y);}return p8y;}return null;};t0r["genMaterial"]=function(P8y){var b8y,N8y;b8y=new THREE["MeshPhongMaterial"]({specular:0,shininess:0,color:0xffffff});A0r["Material"]["addClippingAttri"](b8y);N8y=b8y;N8y["imageName"]=P8y;N8y["needUpdate"]=true;return b8y;};return t0r;}();A0r["Max3DSLoader"]=R0r;g0r=[0x4D4D,0x3D3D,0x4100,0xAFFF,0xB000];X0r={0x4D4D:'Main Chunk',0x0002:'Version',0x0100:'Scale Factor',0x3D3D:'3D Editor Chunk',0x3D3E:'Editor Configuration',0x4000:'Object Block',0x4100:'Triangular Mesh',0x4110:'Vertex List',0x4120:'Face List',0x4130:'Faces Material',0x4150:'Smoothing Group List',0x4140:'Mapping Coordinates List',0x4160:'Local Coordinates System',0x4165:'Visibility',0x4600:'Light',0x4610:'Spotlight',0x4700:'Camera',0xAFFF:'Material Block',0xA000:'Material Name',0xA010:'Ambient Color',0xA020:'Diffuse Color',0xA030:'Specular Color',0xA040:'Shininess',0xA041:'Shininess Strength',0xA050:'Transparency',0xA052:'Transparency Falloff',0xA053:'Reflect Blur',0xA081:'Two Sided',0xA084:'Self Illumination',0xA087:'Wire Thickness',0xA08A:'Transparency Falloff IN',0xA100:'Material Type',0xA200:'Texture Map 1',0xA210:'Opacity',0xA230:'Bump Map',0xA220:'Reflection Map',0xA300:'Mapping Filename',0xA351:'Mapping Parameters',0xB000:'Keyframer Chunk',0xB002:'Mesh Information Block',0xB003:'Camera Information Block',0xB004:'Target Node Block',0xB005:'Light Node Block',0xB006:'Light Target Information Block',0xB007:'Spot Light Information Block',0xB008:'Frames (Start and End)',0xB009:'Keyframe Current Time',0xB00A:'Keyframes Header',0xB010:'Object Name',0xB013:'Object Pivot Point',0xB020:'Position Track',0xB021:'Rotation Track',0xB022:'Scale Track',0xB030:'Hierarchy Position'};}(CMWORLD||(CMWORLD={})));(function(B8y){var q8y,Q8y;q8y=function(){function f8y(){this["vertexBuffer"]=[];this["vertexBufferLength"]=0;this["indexBuffer"]=[];this["indexBufferLength"]=0;this["texCoordBuffer"]=[];this["texCoordBufferLength"]=0;this["normalBuffer"]=[];this["normalBufferLength"]=0;this["Color"]=0;this["imageLevelCount"]=0;this["imageName"]="";this["imageData"]=[];this["imageDataLength"]=0;this["imageWidth"]=0;this["imageHeight"]=0;}return f8y;}();Q8y=function(){H4y["prototype"]["init"]=function(){this["totalVertex"]=0;this["totalIndex"]=0;this["totalImageLength"]=0;};;H4y["prototype"]["getMesh"]=function(m4y){var k4y;if(this["meshs"]["length"]>m4y){return this["meshs"][m4y];}k4y=new q8y();this["meshs"]["push"](k4y);return k4y;};H4y["vwGeo2Cartesian"]=function(r4y,W4y,F4y){var s4y,E4y,Y4y,V4y,y4y,L4y,l4y;s4y=0;E4y=0;Y4y=0;V4y=W4y*B8y["CmMathEngine"]["Deg2Rad"];y4y=r4y*B8y["CmMathEngine"]["Deg2Rad"];L4y=F4y;s4y=L4y*Math["cos"](V4y)*Math["cos"](y4y);E4y=L4y*Math["cos"](V4y)*Math["sin"](y4y)*-1;Y4y=L4y*Math["sin"](V4y);l4y=new THREE["Vector3"](s4y,E4y,Y4y);return l4y;};;H4y["vwCartesian2Geo"]=function(z4y,G4y,U4y){var M4y,C4y,D4y,A4y,n4y,R4y;M4y=0;C4y=0;D4y=0;A4y=Math["sqrt"](z4y*z4y+G4y*G4y+U4y*U4y);n4y=Math["asin"](U4y/A4y)*B8y["CmMathEngine"]["Rad2Deg"];R4y=Math["atan2"](G4y,U4y)*B8y["CmMathEngine"]["Rad2Deg"];M4y=R4y;C4y=n4y;D4y=A4y;return new THREE["Vector3"](M4y,C4y,D4y);};H4y["prototype"]["calcHeight"]=function(o4y){var g4y,i4y,x4y,X4y,O4y,J4y,Z4y,t4y,a4y;g4y=new THREE["Vector3"]();i4y=new THREE["Vector3"]();x4y=new THREE["Vector3"]();X4y=H4y["vwGeo2Cartesian"](this["xorig"],this["yorig"],this["zorig"]+this["EarthRadius"]);O4y=new THREE["Vector3"]();J4y=new THREE["Vector3"]();Z4y=Number["MAX_VALUE"];t4y=Number["MIN_VALUE"];a4y=0;for(var T4y=0;T4y<o4y["vertexBufferLength"];T4y+=3){g4y["x"]=X4y["x"]+o4y["vertexBuffer"][T4y+0];g4y["y"]=X4y["y"]+o4y["vertexBuffer"][T4y+1];g4y["z"]=X4y["z"]+o4y["vertexBuffer"][T4y+2];g4y["x"]+=X4y["x"];g4y["y"]+=X4y["y"];g4y["z"]+=X4y["z"];g4y["projectOnVector"](X4y);a4y=g4y["length"]();if(a4y<Z4y){Z4y=a4y;O4y["x"]=g4y["x"];O4y["y"]=g4y["y"];O4y["z"]=g4y["z"];}if(a4y>t4y){t4y=a4y;J4y["x"]=g4y["x"];J4y["y"]=g4y["y"];J4y["z"]=g4y["z"];}}return t4y-Z4y;};H4y["prototype"]["calcNormal"]=function(p4y){var w4y,e4y,v4y,K4y,u4y,d4y,I4y,c4y,b4y,N4y,P4y,j4y;K4y=new THREE["Vector3"](),u4y=new THREE["Vector3"](),d4y=new THREE["Vector3"](),I4y=new THREE["Vector3"](),c4y=new THREE["Vector3"]();if(p4y["normalBuffer"]["length"]<p4y["vertexBufferLength"]){if(p4y["vertexBufferLength"]>this["initArrayCount"]){p4y["normalBuffer"]=new Float32Array(this["initArrayCount"]);}else{p4y["normalBuffer"]=new Float32Array(p4y["vertexBufferLength"]);}}p4y["normalBufferLength"]=p4y["vertexBufferLength"];for(var S4y=0,h4y=p4y["indexBufferLength"];S4y<h4y;S4y+=3){w4y=p4y["indexBuffer"][S4y+0]*3;e4y=p4y["indexBuffer"][S4y+1]*3;v4y=p4y["indexBuffer"][S4y+2]*3;K4y["set"](p4y["vertexBuffer"][w4y+0],p4y["vertexBuffer"][w4y+1],p4y["vertexBuffer"][w4y+2]);u4y["set"](p4y["vertexBuffer"][e4y+0],p4y["vertexBuffer"][e4y+1],p4y["vertexBuffer"][e4y+2]);d4y["set"](p4y["vertexBuffer"][v4y+0],p4y["vertexBuffer"][v4y+1],p4y["vertexBuffer"][v4y+2]);I4y["subVectors"](d4y,u4y);c4y["subVectors"](K4y,u4y);I4y["cross"](c4y);p4y["normalBuffer"][w4y]+=I4y["x"];p4y["normalBuffer"][w4y+1]+=I4y["y"];p4y["normalBuffer"][w4y+2]+=I4y["z"];p4y["normalBuffer"][e4y]+=I4y["x"];p4y["normalBuffer"][e4y+1]+=I4y["y"];p4y["normalBuffer"][e4y+2]+=I4y["z"];p4y["normalBuffer"][v4y]+=I4y["x"];p4y["normalBuffer"][v4y+1]+=I4y["y"];p4y["normalBuffer"][v4y+2]+=I4y["z"];}for(var S4y=0,h4y=p4y["normalBufferLength"];S4y<h4y;S4y+=3){b4y=p4y["normalBuffer"][S4y];N4y=p4y["normalBuffer"][S4y+1];P4y=p4y["normalBuffer"][S4y+2];j4y=1.0/Math["sqrt"](b4y*b4y+N4y*N4y+P4y*P4y);p4y["normalBuffer"][S4y]*=j4y;p4y["normalBuffer"][S4y+1]*=j4y;p4y["normalBuffer"][S4y+2]*=j4y;}};H4y["prototype"]["parseXDO3001"]=function(m2y){var B4y,q4y,k2y,H2y,Q4y,L2y,V2y,E2y;if(B8y["Util"]["isDefined"](m2y)==false)return;this["meshCount"]=0;if(m2y["byteLength"]<300){return;}B4y=this["getMesh"](0);q4y=new B8y["BinaryReader"](m2y,true);H2y=[];this["XDOType"]=q4y["readUInt8"]();this["OID"]=q4y["readUInt32"]();k2y=q4y["readUInt8"]();H2y=q4y["readBytes"](k2y);this["Key"]=q4y["bin2String"](H2y);this["boxMinX"]=q4y["readDouble"]();this["boxMinY"]=q4y["readDouble"]();this["boxMinZ"]=q4y["readDouble"]();this["boxMaxX"]=q4y["readDouble"]();this["boxMaxY"]=q4y["readDouble"]();this["boxMaxZ"]=q4y["readDouble"]();this["height"]=q4y["readSingle"]();Q4y=q4y["readUInt32"]();if(Q4y>1000000){return;}this["totalVertex"]+=Q4y;B4y["vertexBufferLength"]=Q4y*3;B4y["normalBufferLength"]=B4y["vertexBufferLength"];B4y["texCoordBufferLength"]=Q4y*2;if(B4y["vertexBuffer"]["length"]<Q4y*3){if(Q4y*3<this["initArrayCount"]){B4y["vertexBuffer"]=new Array(this["initArrayCount"]);}else{B4y["vertexBuffer"]=new Array(Q4y*3);}}B4y["vertexBufferLength"]=Q4y*3;if(B4y["normalBuffer"]["length"]<Q4y*3){if(Q4y*3<this["initArrayCount"]){B4y["normalBuffer"]=new Array(this["initArrayCount"]);}else{B4y["normalBuffer"]=new Array(Q4y*3);}}B4y["normalBufferLength"]=Q4y*3;if(B4y["texCoordBuffer"]["length"]<Q4y*2){if(Q4y*2<this["initArrayCount"]){B4y["texCoordBuffer"]=new Array(this["initArrayCount"]);}else{B4y["texCoordBuffer"]=new Array(Q4y*2);}}B4y["texCoordBufferLength"]=Q4y*2;for(var f4y=0;f4y<Q4y;f4y++){L2y=q4y["readSingle"]();V2y=q4y["readSingle"]();E2y=q4y["readSingle"]();B4y["vertexBuffer"][f4y*3+0]=V2y;B4y["vertexBuffer"][f4y*3+1]=E2y;B4y["vertexBuffer"][f4y*3+2]=-L2y;B4y["normalBuffer"][f4y*3+0]=0;B4y["normalBuffer"][f4y*3+1]=0;B4y["normalBuffer"][f4y*3+2]=0;q4y["readSingle"]();q4y["readSingle"]();q4y["readSingle"]();B4y["texCoordBuffer"][f4y*2+0]=q4y["readSingle"]();B4y["texCoordBuffer"][f4y*2+1]=1.0-q4y["readSingle"]();}Q4y=q4y["readUInt32"]();if(B4y["indexBuffer"]["length"]<Q4y){if(Q4y<this["initArrayCount"]){B4y["indexBuffer"]=new Array(this["initArrayCount"]);}else{B4y["indexBuffer"]=new Array(Q4y);}}B4y["indexBufferLength"]=Q4y;this["totalIndex"]+=Q4y;for(var f4y=0;f4y<Q4y;f4y+=3){B4y["indexBuffer"][f4y+0]=q4y["readUInt16"]();B4y["indexBuffer"][f4y+2]=q4y["readUInt16"]();B4y["indexBuffer"][f4y+1]=q4y["readUInt16"]();}B4y["Color"]=q4y["readUInt32"]();B4y["imageLevelCount"]=q4y["readUInt8"]();k2y=q4y["readUInt8"]();H2y=q4y["readBytes"](k2y);B4y["imageName"]=q4y["bin2String"](H2y);this["calcNormal"](B4y);this["height"]=Math["abs"](this["boxMaxZ"]-this["boxMinZ"]);this["meshCount"]=1;};;H4y["prototype"]["parseXDO3002"]=function(M2y){var F2y,s2y,W2y,U2y,z2y,y2y,l2y,C2y,D2y,A2y,r2y;F2y=false;if(B8y["Util"]["isDefined"](M2y)==false){return F2y;}this["meshCount"]=0;if(M2y["byteLength"]<300){return F2y;}s2y=new B8y["BinaryReader"](M2y,true);U2y=[];try{this["XDOType"]=s2y["readUInt8"]();this["OID"]=s2y["readUInt32"]();W2y=s2y["readUInt8"]();U2y=s2y["readBytes"](W2y);this["Key"]=s2y["bin2String"](U2y);this["boxMinX"]=s2y["readDouble"]();this["boxMinY"]=s2y["readDouble"]();this["boxMinZ"]=s2y["readDouble"]();this["boxMaxX"]=s2y["readDouble"]();this["boxMaxY"]=s2y["readDouble"]();this["boxMaxZ"]=s2y["readDouble"]();this["height"]=s2y["readSingle"]();z2y=s2y["readUInt8"]();for(var G2y=0;G2y<z2y;G2y++){y2y=this["getMesh"](G2y);l2y=s2y["readUInt32"]();if(l2y>1000000){console["warn"]("parseXDO3002:데이터가 이상한지 확인해야 한다.");return F2y;}this["totalVertex"]+=l2y;y2y["vertexBufferLength"]=l2y*3;y2y["normalBufferLength"]=y2y["vertexBufferLength"];y2y["texCoordBufferLength"]=l2y*2;if(y2y["vertexBuffer"]["length"]<l2y*3){if(l2y*3<this["initArrayCount"]){y2y["vertexBuffer"]=new Array(this["initArrayCount"]);}else{y2y["vertexBuffer"]=new Array(l2y*3);}}y2y["vertexBufferLength"]=l2y*3;if(y2y["normalBuffer"]["length"]<l2y*3){if(l2y*3<this["initArrayCount"]){y2y["normalBuffer"]=new Array(this["initArrayCount"]);}else{y2y["normalBuffer"]=new Array(l2y*3);}}y2y["normalBufferLength"]=l2y*3;if(y2y["texCoordBuffer"]["length"]<l2y*2){if(l2y*2<this["initArrayCount"]){y2y["texCoordBuffer"]=new Array(this["initArrayCount"]);}else{y2y["texCoordBuffer"]=new Array(l2y*2);}}y2y["texCoordBufferLength"]=l2y*2;for(var Y2y=0;Y2y<l2y;Y2y++){C2y=s2y["readSingle"]();D2y=s2y["readSingle"]();A2y=s2y["readSingle"]();y2y["vertexBuffer"][Y2y*3+0]=D2y;y2y["vertexBuffer"][Y2y*3+1]=A2y;y2y["vertexBuffer"][Y2y*3+2]=-C2y;y2y["normalBuffer"][Y2y*3+0]=0;y2y["normalBuffer"][Y2y*3+1]=0;y2y["normalBuffer"][Y2y*3+2]=0;s2y["readSingle"]();s2y["readSingle"]();s2y["readSingle"]();y2y["texCoordBuffer"][Y2y*2+0]=s2y["readSingle"]();y2y["texCoordBuffer"][Y2y*2+1]=1.0-s2y["readSingle"]();}r2y=s2y["readUInt32"]();this["totalIndex"]+=r2y;if(y2y["indexBuffer"]["length"]<r2y){if(r2y<this["initArrayCount"]){y2y["indexBuffer"]=new Array(this["initArrayCount"]);}else{y2y["indexBuffer"]=new Array(r2y);}}y2y["indexBufferLength"]=r2y;for(var Y2y=0;Y2y<r2y;Y2y+=3){y2y["indexBuffer"][Y2y+0]=s2y["readUInt16"]();y2y["indexBuffer"][Y2y+2]=s2y["readUInt16"]();y2y["indexBuffer"][Y2y+1]=s2y["readUInt16"]();}y2y["Color"]=s2y["readUInt32"]();y2y["imageLevelCount"]=s2y["readUInt8"]();W2y=s2y["readUInt8"]();U2y=s2y["readBytes"](W2y);y2y["imageName"]=s2y["bin2String"](U2y);W2y=s2y["readUInt32"]();for(var Y2y=0;Y2y<W2y;Y2y++){s2y["readUInt8"]();}this["calcNormal"](y2y);this["totalImageLength"]+=y2y["imageDataLength"];this["meshCount"]++;}this["height"]=Math["abs"](this["boxMaxZ"]-this["boxMinZ"]);F2y=true;}catch(n2y){console["error"](n2y);F2y=false;}return F2y;};function H4y(){this["argIndex"]=-1;this["initArrayCount"]=6000;this["XDOType"]=0;this["OID"]=0;this["Key"]="";this["boxMinX"]=0;this["boxMinY"]=0;this["boxMinZ"]=0;this["boxMaxX"]=0;this["boxMaxY"]=0;this["boxMaxZ"]=0;this["height"]=0;this["totlVertex"]=0;this["totalIndex"]=0;this["totalImageLength"]=0;this["EarthRadius"]=6378137.0;this["xorig"]=0;this["yorig"]=0;this["zorig"]=0;this["dataAltitude"]=0;this["meshCount"]=0;this["meshs"]=[];this["totalVertex"]=0;this["init"]();};H4y["prototype"]["sendFloat32Function"]=function(e2y){var S2y,a2y,J2y,x2y,t2y,p2y,I2y,O2y,Z2y,h2y,v2y,o2y,j2y,w2y,u2y,X2y,g2y,i2y;if(B8y["Util"]["isDefined"](e2y)==false)return false;if(this["meshCount"]<1)return false;S2y=new Float32Array(this["totalVertex"]*3);a2y=new Uint16Array(this["totalIndex"]);J2y=new Float32Array(this["totalVertex"]*2);x2y=new Float32Array(this["totalVertex"]*3);t2y=new Uint32Array(this["meshs"]["length"]);p2y=new Array(this["meshs"]["length"]);I2y=new Float32Array(this["meshs"]["length"]);O2y=new Uint32Array(this["meshs"]["length"]);Z2y=new Uint8Array(this["meshs"]["length"]);h2y=0;v2y=0;o2y=0;j2y=0;w2y=0;u2y=-1;for(var T2y=0;T2y<this["meshs"]["length"];T2y++){X2y=this["meshs"][T2y];for(var R2y=0;R2y<X2y["vertexBufferLength"];R2y++){if(isNaN(X2y["vertexBuffer"][R2y])){throw"xdo Vertex isNAN";}S2y[h2y++]=X2y["vertexBuffer"][R2y];}for(var R2y=0;R2y<X2y["normalBufferLength"];R2y++){x2y[v2y++]=X2y["normalBuffer"][R2y];}if(T2y==0){t2y[T2y]=0;}else{t2y[T2y]=t2y[T2y-1]+O2y[T2y-1];}O2y[T2y]=X2y["indexBufferLength"];for(var R2y=0;R2y<X2y["indexBufferLength"];R2y+=3){a2y[o2y++]=X2y["indexBuffer"][R2y+0];a2y[o2y++]=X2y["indexBuffer"][R2y+1];a2y[o2y++]=X2y["indexBuffer"][R2y+2];}for(var R2y=0;R2y<X2y["texCoordBufferLength"];R2y++){J2y[j2y++]=X2y["texCoordBuffer"][R2y];}p2y[T2y]=X2y["imageName"];I2y[T2y]=X2y["Color"];Z2y[T2y]=X2y["imageLevelCount"]-1;w2y=X2y["vertexBuffer"]["length"]/3;}g2y=B8y["FuncForWorker"]["genWorkerMsgObject"]();g2y["success"]=true;g2y["dataState"]=true;g2y["argIndex"]=this["argIndex"];g2y["height"]=this["height"];g2y["groups"]=t2y;g2y["counts"]=O2y;g2y["vertices"]=S2y;g2y["indices"]=a2y;g2y["uv"]=J2y;g2y["normal"]=x2y;g2y["diffuseColors"]=I2y;g2y["imagelevels"]=Z2y;g2y["textures"]=p2y;i2y=[];i2y["push"](g2y["vertices"]["buffer"],g2y["indices"]["buffer"],g2y["uv"]["buffer"],g2y["normal"]["buffer"],g2y["diffuseColors"]["buffer"],g2y["counts"]["buffer"],g2y["imagelevels"]["buffer"]);e2y["postMessage"](g2y,i2y);return true;};H4y["makeMeshFromPackingData"]=function(c2y){var P2y,d2y,f2y,B2y,q2y,y1y,E1y,Q2y,k1y,V1y,b2y,s1y,m1y,H1y,L1y;P2y=[];d2y=[];f2y=c2y["counts"]["length"];B2y=0;q2y=0;y1y=0;E1y=0;Q2y=c2y["height"];for(var K2y=0;K2y<f2y;K2y++){B2y=c2y["groups"][K2y];q2y=c2y["counts"][K2y];k1y=H4y["makeGeometry"](B2y,q2y,c2y["vertices"],c2y["normal"],c2y["uv"],c2y["indices"],c2y["diffuseColors"][K2y],c2y["imagelevels"][K2y],c2y["textures"][K2y]);d2y["push"](k1y);}V1y=[];b2y=new THREE["Mesh"]();if(d2y["length"]>0){m1y=H4y["makeMaterial"](d2y[0]["imageURL"],d2y[0]["imageLevel"]);b2y=new THREE["Mesh"](d2y[0],m1y);b2y["userData"]=Q2y;b2y["castShadow"]=true;b2y["receiveShadow"]=true;for(var N2y=1;N2y<d2y["length"];N2y++){H1y=H4y["makeMaterial"](d2y[N2y]["imageURL"],d2y[N2y]["imageLevel"]);L1y=new THREE["Mesh"](d2y[N2y],H1y);b2y["add"](L1y);}P2y["push"](b2y);}return P2y;};H4y["makeMaterial"]=function(l1y,r1y){var Y1y;Y1y=new THREE["MeshPhongMaterial"]({specular:0x222222,shininess:1});B8y["Material"]["addClippingAttri"](Y1y);Y1y["imageURL"]=l1y;Y1y["imageCount"]=r1y;Y1y["needUpdate"]=true;return Y1y;};H4y["makeGeometry"]=function(z1y,G1y,R1y,g1y,X1y,T1y,a1y,t1y,n1y){var M1y,C1y,D1y,A1y,U1y,W1y;M1y=new Float32Array(G1y*3);C1y=new Uint16Array(G1y);D1y=new Float32Array(G1y*2);A1y=new Float32Array(G1y*3);U1y=z1y*3;for(var F1y=0;F1y<M1y["length"];F1y++){M1y[F1y]=R1y[U1y+F1y];}for(var F1y=0;F1y<A1y["length"];F1y++){A1y[F1y]=g1y[U1y+F1y];}U1y=z1y*2;for(var F1y=0;F1y<D1y["length"];F1y++){D1y[F1y]=X1y[U1y+F1y];}U1y=z1y;for(var F1y=0;F1y<C1y["length"];F1y++){C1y[F1y]=T1y[U1y+F1y];}W1y=new THREE["BufferGeometry"]();W1y["addAttribute"]('position',new THREE["BufferAttribute"](M1y,3));W1y["addAttribute"]('uv',new THREE["BufferAttribute"](D1y,2));W1y["addAttribute"]('normal',new THREE["BufferAttribute"](A1y,3));W1y["setIndex"](new THREE["BufferAttribute"](C1y,1));W1y["diffuseColor"]=a1y;W1y["imageLevel"]=t1y;W1y["imageURL"]=n1y;return W1y;};return H4y;}();B8y["XDOLoader"]=Q8y;}(CMWORLD||(CMWORLD={})));(function(O1y){var S1y,Z1y,v1y,i1y,p1y,x1y,o1y,w1y,e1y,J1y,h1y,I1y;S1y=function(){function j1y(){this["x"]=0.0;this["y"]=0.0;}return j1y;}();Z1y=function(){function u1y(){this["x"]=0.0;this["y"]=0.0;this["z"]=0.0;}return u1y;}();v1y=function(){function c1y(){this["diffColor"]=[255,255,255,255];this["texFileName"]=null;this["texLev"]=1;}return c1y;}();i1y=function(){function d1y(){this["matIndex"]=0;this["vertices"]=null;this["uvs"]=null;this["normals"]=null;this["indexs"]=null;}return d1y;}();(function(K1y){K1y[K1y["default"]=1]="default";K1y[K1y["vworldXdo"]=2]="vworldXdo";}(p1y=O1y["SPIBBoxType"]||(O1y["SPIBBoxType"]={})));x1y=function(){function b1y(){this["key"]=null;this["x"]=0.0;this["y"]=0.0;this["h"]=0.0;this["bboxType"]=p1y["default"];this["bboxMinx"]=0.0;this["bboxMiny"]=0.0;this["bboxMinz"]=0.0;this["bboxMaxx"]=0.0;this["bboxMaxy"]=0.0;this["bboxMaxz"]=0.0;this["fileName"]=null;}return b1y;}();o1y=function(){function N1y(){this["ver"]=1;this["lev"]=0;this["tileX"]=0;this["tileY"]=0;this["objects"]=[];}return N1y;}();o1y["signature"]=[0x15,0xE0];O1y["SPIData"]=o1y;w1y=function(){function P1y(){this["object"]=null;this["eType"]=0;}return P1y;}();e1y=function(){function B1y(){this["type"]=0;this["fileName"]=null;}return B1y;}();J1y=function(){q1y["prototype"]["clear"]=function(){this["materials"]=[];this["meshs"]=[];this["subIndexs"]=[];this["attriFiles"]=[];};function q1y(){this["ver"]=1;this["key"]=null;this["x"]=0.0;this["y"]=0.0;this["h"]=0.0;this["bboxType"]=O1y["BBoxType"]["uprightModel"];this["bboxMinx"]=0.0;this["bboxMiny"]=0.0;this["bboxMinz"]=0.0;this["bboxMaxx"]=0.0;this["bboxMaxy"]=0.0;this["bboxMaxz"]=0.0;this["subIndexs"]=[];this["attriFiles"]=[];this["materials"]=[];this["meshs"]=[];}return q1y;}();J1y["signature"]=[0x15,0xE1];O1y["SPOData"]=J1y;h1y=function(){Q1y["parseBinary"]=function(m5y){var f1y,k5y,L5y,E5y,y5y,H5y;if(m5y==undefined||m5y==null)return null;if(typeof m5y=="string")return null;f1y=new O1y["BinaryReader"](m5y,true);if(f1y["getLength"]()<1){console["warn"]("byte의 사이즈가 0이다.");return;}k5y=null;L5y=f1y["readBytes"](2);if(L5y[0]==o1y["signature"][0]&&L5y[1]==o1y["signature"][1]){k5y=new o1y();k5y["ver"]=f1y["readByte"]();if(k5y["ver"]==1){k5y["lev"]=f1y["readByte"]();k5y["tileX"]=f1y["readUInt32"]();k5y["tileY"]=f1y["readUInt32"]();E5y=f1y["readUInt32"]();for(var V5y=0;V5y<E5y;V5y++){y5y=f1y["readByte"]();H5y=new x1y();H5y["key"]=f1y["readString"]();H5y["x"]=f1y["readDouble"]();H5y["y"]=f1y["readDouble"]();H5y["h"]=f1y["readSingle"]();H5y["bboxType"]=f1y["readByte"]();H5y["bboxMinx"]=f1y["readSingle"]();H5y["bboxMiny"]=f1y["readSingle"]();H5y["bboxMinz"]=f1y["readSingle"]();H5y["bboxMaxx"]=f1y["readSingle"]();H5y["bboxMaxy"]=f1y["readSingle"]();H5y["bboxMaxz"]=f1y["readSingle"]();H5y["fileName"]=f1y["readString"]();k5y["objects"]["push"](H5y);}}}return k5y;};function Q1y(){}return Q1y;}();O1y["SPILoader"]=h1y;I1y=function(){s5y["prototype"]["init"]=function(){};function s5y(){this["init"]();}s5y["prototype"]["clear"]=function(){};s5y["packToBuffer"]=function(Y5y){var l5y,r5y;l5y={ver:Y5y["ver"],meshs:Y5y["meshs"],materials:Y5y["materials"]};r5y=msgpack["encode"](l5y);return r5y["buffer"];};s5y["prototype"]["unpackFromBuffer"]=function(F5y){var W5y;W5y=msgpack["decode"](new Uint8Array(F5y));};s5y["parseBinary"]=function(M5y){var U5y,G5y,C5y;if(M5y==undefined||M5y==null)return null;if(typeof M5y=="string")return null;U5y=new O1y["BinaryReader"](M5y,true);if(U5y["getLength"]()<1){console["warn"]("byte의 사이즈가 0이다.");return null;}G5y=new J1y();C5y=U5y["readBytes"](2);if(C5y[0]==J1y["signature"][0]&&C5y[1]==J1y["signature"][1]){G5y["ver"]=U5y["readByte"]();s5y["parseSubIndexs"](U5y,G5y);s5y["parseAttriFiles"](U5y,G5y);s5y["parseMaterials"](U5y,G5y);s5y["parseMeshs"](U5y,G5y);}return G5y;};s5y["makeMeshFromData"]=function(a5y,O5y){var Z5y,J5y,p5y,o5y,X5y,z5y,R5y,n5y,I5y,x5y,A5y,t5y,S5y,g5y,w5y,i5y;if(O5y===void 0){O5y=false;}Z5y=[];J5y=new THREE["Color"]();for(var D5y=0;D5y<a5y["materials"]["length"];D5y++){J5y["setRGB"](1,1,1);p5y=s5y["makeMaterial"](J5y["getHex"](),a5y["materials"][D5y]["texFileName"]);Z5y["push"](p5y);}o5y=new Array();for(var T5y=0;T5y<a5y["meshs"]["length"];T5y++){X5y=a5y["meshs"][T5y];z5y=X5y["vertices"];R5y=X5y["indexs"];n5y=X5y["normals"];I5y=X5y["uvs"];x5y=z5y["length"]/3;if(O5y){for(var D5y=0;D5y<x5y;D5y++){A5y=D5y*3;t5y=z5y[A5y];z5y[A5y]=z5y[A5y+1];z5y[A5y+1]=z5y[A5y+2];z5y[A5y+2]=-t5y;t5y=n5y[A5y];n5y[A5y]=n5y[A5y+1];n5y[A5y+1]=n5y[A5y+2];n5y[A5y+2]=-t5y;}for(var D5y=0;D5y<R5y["length"];D5y+=3){S5y=R5y[D5y+1];R5y[D5y+1]=R5y[D5y+2];R5y[D5y+2]=S5y;}}g5y=new THREE["BufferGeometry"]();g5y["addAttribute"]('position',new THREE["BufferAttribute"](z5y,3));g5y["addAttribute"]('uv',new THREE["BufferAttribute"](I5y,2));g5y["addAttribute"]('normal',new THREE["BufferAttribute"](n5y,3));g5y["setIndex"](new THREE["BufferAttribute"](R5y,1));w5y=Z5y[X5y["matIndex"]];i5y=new THREE["Mesh"](g5y,w5y);o5y["push"](i5y);}return o5y;};s5y["makeMaterial"]=function(v5y,h5y){var e5y;e5y=new THREE["MeshPhongMaterial"]({specular:0,shininess:0,color:v5y});O1y["Material"]["addClippingAttri"](e5y);e5y['imageName']=h5y;e5y['needUpdate']=true;return e5y;};s5y["parseSubIndexs"]=function(j5y,b5y){var d5y,K5y,u5y;d5y=j5y["readUInt32"]();if(d5y>0){K5y=j5y["readUInt16"]();for(var c5y=0;c5y<K5y;c5y++){u5y=new w1y();u5y["object"]["key"]=j5y["readString"]();u5y["object"]["x"]=j5y["readDouble"]();u5y["object"]["y"]=j5y["readDouble"]();u5y["object"]["h"]=j5y["readSingle"]();u5y["object"]["bboxMinx"]=j5y["readSingle"]();u5y["object"]["bboxMiny"]=j5y["readSingle"]();u5y["object"]["bboxMinz"]=j5y["readSingle"]();u5y["object"]["bboxMaxx"]=j5y["readSingle"]();u5y["object"]["bboxMaxy"]=j5y["readSingle"]();u5y["object"]["bboxMaxz"]=j5y["readSingle"]();u5y["object"]["fileName"]=j5y["readString"]();u5y["eType"]=j5y["readByte"]();b5y["subIndexs"]["push"](u5y);}}};s5y["parseAttriFiles"]=function(P5y,Q5y){var q5y,N5y;q5y=P5y["readUInt16"]();for(var B5y=0;B5y<q5y;B5y++){N5y=new e1y();N5y["type"]=P5y["readByte"]();N5y["fileName"]=P5y["readString"]();Q5y["attriFiles"]["push"](N5y);}};s5y["parseMaterials"]=function(H6y,L6y){var m6y,f5y;m6y=H6y["readByte"]();for(var k6y=0;k6y<m6y;k6y++){f5y=new v1y();f5y["diffColor"]=H6y["readBytes"](4);f5y["texFileName"]=H6y["readString"]();f5y["texLev"]=H6y["readByte"]();L6y["materials"]["push"](f5y);}};s5y["parseMeshs"]=function(y6y,D6y){var M6y,V6y,Y6y,l6y,r6y,s6y,F6y,G6y,W6y,C6y;M6y=y6y["readUInt32"]();for(var U6y=0;U6y<M6y;U6y++){V6y=new i1y();V6y["matIndex"]=y6y["readByte"]();Y6y=y6y["readUInt32"]();V6y["vertices"]=new Float32Array(Y6y*3);V6y["normals"]=new Float32Array(Y6y*3);V6y["uvs"]=new Float32Array(Y6y*2);for(var E6y=0;E6y<Y6y;E6y++){l6y=new Z1y();r6y=new S1y();s6y=new Z1y();l6y["x"]=y6y["readSingle"]();l6y["y"]=y6y["readSingle"]();l6y["z"]=y6y["readSingle"]();r6y["x"]=y6y["readUInt16"]();r6y["y"]=y6y["readUInt16"]();s6y["x"]=y6y["readByte"]();s6y["y"]=y6y["readByte"]();s6y["z"]=y6y["readByte"]();y6y["readByte"]();r6y["x"]/=65535.0;r6y["y"]/=65535.0;s6y["x"]/=128.0;s6y["y"]/=128.0;s6y["z"]/=128.0;F6y=E6y*3;G6y=E6y*2;V6y["vertices"][F6y]=l6y["x"];V6y["vertices"][F6y+1]=l6y["y"];V6y["vertices"][F6y+2]=l6y["z"];V6y["normals"][F6y]=s6y["x"];V6y["normals"][F6y+1]=s6y["y"];V6y["normals"][F6y+2]=s6y["z"];V6y["uvs"][G6y]=r6y["x"];V6y["uvs"][G6y+1]=r6y["y"];}W6y=y6y["readUInt32"]();if(Y6y>65535)V6y["indexs"]=new Uint32Array(W6y);else V6y["indexs"]=new Uint16Array(W6y);for(var E6y=0;E6y<W6y;E6y++){C6y=y6y["readUInt16"]();V6y["indexs"][E6y]=C6y;}if(V6y["indexs"]["length"]<1){if(Y6y>65535)V6y["indexs"]=new Uint32Array(W6y);else V6y["indexs"]=new Uint16Array(W6y);for(var E6y=0;E6y<Y6y;E6y++)V6y["indexs"][E6y]=E6y;}D6y["meshs"]["push"](V6y);}};return s5y;}();O1y["SPOLoader"]=I1y;}(CMWORLD||(CMWORLD={})));(function(A6y){var z6y;z6y=function(){Object["defineProperty"](n6y["prototype"],"boundary",{get:function(){return this["geometry"]["boundary"];},enumerable:true,configurable:true});Object["defineProperty"](n6y["prototype"],"points",{get:function(){return this["geometry"]["points"];},enumerable:true,configurable:true});n6y["prototype"]["update"]=function(){};function n6y(){this["id"]=-1;this["type"]=A6y["GisObjectType"]["none"];this["drawStyle"]=null;this["color"]=0xcccccc;this["vectorRenderMode"]=A6y["VectorRenderMode"]["vector"];this["geometry"]=new A6y["Geometry"]();this["needsRedraw"]=true;this["id"]=n6y["gisObjectIDCounter"]++;}n6y["prototype"]["applyGeometryPoints"]=function(R6y){};n6y["prototype"]["dispose"]=function(){this["geometry"]["dispose"]();this["geometry"]=null;this["id"]=-1;};n6y["prototype"]["drawToCanvas"]=function(g6y,X6y,T6y,a6y){return false;};n6y["prototype"]["render"]=function(){};n6y["prototype"]["isShow"]=function(){return true;};return n6y;}();z6y["gisObjectIDCounter"]=0;A6y["GisObject"]=z6y;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var t6y;t6y=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(O6y,o6y){O6y["__proto__"]=o6y;}||function(x6y,Z6y){for(var J6y in Z6y)if(Z6y["hasOwnProperty"](J6y))x6y[J6y]=Z6y[J6y];};return function(p6y,i6y){t6y(p6y,i6y);p6y["prototype"]=i6y===null?Object["create"](i6y):(S6y["prototype"]=i6y["prototype"],new S6y());function S6y(){this["constructor"]=p6y;}};}();(function(I6y){var w6y;w6y=function(v6y){function e6y(){var h6y;h6y=v6y["call"](this)||this;h6y["type"]=I6y["GisObjectType"]["point"];return h6y;}__extends(e6y,v6y);e6y["prototype"]["draw"]=function(u6y,c6y,d6y,K6y,b6y,N6y){if(this["drawStyle"]){if(u6y){if(this["drawStyle"]){for(var j6y in this["drawStyle"]){u6y[j6y]=this["drawStyle"][j6y];}}}}};e6y["prototype"]["isContained"]=function(H9y,B6y,q6y,Q6y,f6y){var P6y;if(this["geometry"]){if(this["geometry"]["points"]["length"]>0){if(I6y["Util"]["isDefined"](this["geometry"]["boundary"])==false){this["geometry"]["updateBoundary"]();}P6y=this["geometry"]["points"][0];if(P6y["x"]<B6y)return false;if(P6y["x"]>Q6y)return false;if(P6y["y"]<q6y)return false;if(P6y["y"]>f6y)return false;return true;}}return false;};return e6y;}(I6y["GisObject"]);I6y["GisPoint"]=w6y;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var k9y;k9y=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(m9y,L9y){m9y["__proto__"]=L9y;}||function(y9y,E9y){for(var V9y in E9y)if(E9y["hasOwnProperty"](V9y))y9y[V9y]=E9y[V9y];};return function(Y9y,s9y){k9y(Y9y,s9y);Y9y["prototype"]=s9y===null?Object["create"](s9y):(l9y["prototype"]=s9y["prototype"],new l9y());function l9y(){this["constructor"]=Y9y;}};}();(function(r9y){var F9y;F9y=function(U9y){__extends(W9y,U9y);W9y["prototype"]["dispose"]=function(){if(this["lineObj3D"]){this["lineObj3D"]=null;}};W9y["prototype"]["updateBoundary"]=function(){this["geometry"]["updateBoundary"]();};W9y["prototype"]["makeGeometry"]=function(){var M9y,C9y;if(this["geometry"]["points"]["length"]>1){M9y=r9y["GeometryUtil"]["createWorldGeometry"](this["geometry"]["points"],true);C9y=new THREE["LineBasicMaterial"]({color:0xffffff});this["lineObj3D"]=new THREE["Line"](M9y,C9y);}};function W9y(){var G9y;G9y=U9y["call"](this)||this;G9y["lineObj3D"]=null;G9y["type"]=r9y["GisObjectType"]["linestring"];return G9y;}W9y["prototype"]["update"]=function(){var D9y;if(this["lineObj3D"]){D9y=r9y["CmWorld3"]["getInstance"]();D9y["getUserScene"]()["add"](this["lineObj3D"]);}};W9y["prototype"]["drawToCanvas"]=function(A9y,n9y,X9y,T9y){var R9y,g9y;if(r9y["Util"]["isDefined"](A9y)==false)return;if(this["geometry"]["points"]["length"]>1){A9y["beginPath"]();{R9y=(this["geometry"]["points"][0]["x"]-X9y)*n9y;g9y=(T9y-this["geometry"]["points"][0]["y"])*n9y;A9y["moveTo"](R9y,g9y);for(var z9y=1;z9y<this["geometry"]["points"]["length"];z9y++){R9y=(this["geometry"]["points"][z9y]["x"]-X9y)*n9y;g9y=(T9y-this["geometry"]["points"][z9y]["y"])*n9y;A9y["lineTo"](R9y,g9y);}}A9y["stroke"]();}};return W9y;}(r9y["GisObject"]);r9y["GisPolyline"]=F9y;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var a9y;a9y=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(t9y,O9y){t9y["__proto__"]=O9y;}||function(Z9y,J9y){for(var o9y in J9y)if(J9y["hasOwnProperty"](o9y))Z9y[o9y]=J9y[o9y];};return function(i9y,x9y){a9y(i9y,x9y);i9y["prototype"]=x9y===null?Object["create"](x9y):(p9y["prototype"]=x9y["prototype"],new p9y());function p9y(){this["constructor"]=i9y;}};}();(function(S9y){var I9y;I9y=function(e9y){__extends(w9y,e9y);w9y["prototype"]["updateBoundary"]=function(){this["geometry"]["updateBoundary"]();};w9y["prototype"]["draw"]=function(h9y,K9y,b9y,f9y,Q9y,H0y){var N9y,P9y,c9y,u9y,d9y;if(this["drawStyle"]){if(h9y){if(this["drawStyle"]){for(var q9y in this["drawStyle"]){h9y[q9y]=this["drawStyle"][q9y];}}}}N9y=h9y["canvas"]["width"]/(f9y-K9y);P9y=h9y["canvas"]["height"]/(Q9y-b9y);c9y=-1,u9y=-1;h9y["beginPath"]();c9y=N9y*(this["geometry"]["points"][0]["x"]-K9y);u9y=h9y["canvas"]["height"]-P9y*(this["geometry"]["points"][0]["y"]-b9y);h9y["moveTo"](c9y,u9y);for(var j9y=1;j9y<this["geometry"]["points"]["length"];j9y++){c9y=N9y*(this["geometry"]["points"][j9y]["x"]-K9y);u9y=h9y["canvas"]["height"]-P9y*(this["geometry"]["points"][j9y]["y"]-b9y);h9y["lineTo"](c9y,u9y);}h9y["closePath"]();if(this["holes"]["length"]>0){for(var B9y=0;B9y<this["holes"]["length"];B9y++){d9y=this["holes"][B9y];if(d9y){if(d9y["length"]>2){c9y=N9y*(d9y[0]["x"]-K9y);u9y=h9y["canvas"]["height"]-P9y*(d9y[0]["y"]-b9y);h9y["moveTo"](c9y,u9y);for(var j9y=1;j9y<d9y["length"];j9y++){c9y=N9y*(d9y[j9y]["x"]-K9y);u9y=h9y["canvas"]["height"]-P9y*(d9y[j9y]["y"]-b9y);h9y["lineTo"](c9y,u9y);}h9y["closePath"]();}}}}h9y["fill"]();h9y["stroke"]();};w9y["prototype"]["isContained"]=function(E0y,k0y,m0y,L0y,V0y){if(this["geometry"]["points"]){if(this["geometry"]["points"]["length"]>2){if(S9y["Util"]["isDefined"](this["geometry"]["boundary"])==false){this["geometry"]["updateBoundary"]();}if(this["geometry"]["boundary"]["x"]>L0y)return false;if(this["geometry"]["boundary"]["x2"]<k0y)return false;if(this["geometry"]["boundary"]["y"]>V0y)return false;if(this["geometry"]["boundary"]["y2"]<m0y)return false;return true;}}return false;};function w9y(){var v9y;v9y=e9y["call"](this)||this;v9y["holes"]=[];v9y["type"]=S9y["GisObjectType"]["polygon"];return v9y;}w9y["drawToCanvas"]=function(y0y,s0y,l0y,U0y,G0y){var r0y,F0y,W0y;if(S9y["Util"]["isDefined"](s0y)==false)return false;if(S9y["Util"]["isDefined"](y0y)==false)return false;if(y0y["length"]<2)return false;W0y=true;if(y0y["length"]==2)W0y=false;s0y["beginPath"]();{r0y=(y0y[0]["x"]-U0y)*l0y;F0y=(G0y-y0y[0]["y"])*l0y;s0y["moveTo"](r0y,F0y);for(var Y0y=1;Y0y<y0y["length"];Y0y++){r0y=(y0y[Y0y]["x"]-U0y)*l0y;F0y=(G0y-y0y[Y0y]["y"])*l0y;s0y["lineTo"](r0y,F0y);}}if(W0y){s0y["closePath"]();s0y["fill"]();}else{s0y["stroke"]();}return true;};w9y["prototype"]["drawToCanvas"]=function(M0y,C0y,D0y,A0y){return w9y["drawToCanvas"](this["geometry"]["points"],M0y,C0y,D0y,A0y);};return w9y;}(S9y["GisObject"]);S9y["GisPolygon"]=I9y;}(CMWORLD||(CMWORLD={})));(function(n0y){var z0y;z0y=function(){Object["defineProperty"](R0y["prototype"],"x2",{get:function(){return this["x"]+this["width"];},enumerable:true,configurable:true});Object["defineProperty"](R0y["prototype"],"y2",{get:function(){return this["y"]+this["height"];},enumerable:true,configurable:true});R0y["prototype"]["setRange"]=function(g0y,X0y,T0y,a0y){this["x"]=g0y;this["y"]=X0y;this["width"]=T0y;this["height"]=a0y;};R0y["prototype"]["setRectangle"]=function(t0y,O0y,o0y,J0y){this["setRange"](t0y,O0y,Math["abs"](o0y-t0y),Math["abs"](J0y-O0y));};R0y["prototype"]["getCenter"]=function(){return new THREE["Vector2"](this["x"]+this["width"]*0.5,this["y"]+this["height"]*0.5);};R0y["prototype"]["makeEmpty"]=function(){this["width"]=0;this["height"]=0;};R0y["prototype"]["isEmpty"]=function(){if(this["height"]<=0)return true;return false;};R0y["prototype"]["includePoint"]=function(Z0y,x0y){if(this["height"]<0)return false;if(Z0y<this["x"])return false;if(x0y<this["y"])return false;if(Z0y>this["x"]+this["width"])return false;if(x0y>this["y"]+this["height"])return false;return true;};function R0y(){this["x"]=0;this["y"]=0;this["width"]=0;this["height"]=0;}R0y["prototype"]["intersect"]=function(i0y){if(this["height"]<0)return false;if(i0y["x"]<this["x"]+this["width"]&&this["x"]<i0y["x"]+i0y["width"]&&i0y["y"]<this["y"]+this["height"]){return this["y"]<i0y["y"]+i0y["height"];}return false;};R0y["union"]=function(p0y,S0y){var I0y,w0y,e0y,v0y,h0y;I0y=new R0y();I0y["x"]=p0y["x"]<S0y["x"]?p0y["x"]:S0y["x"];I0y["y"]=p0y["y"]<S0y["y"]?p0y["y"]:S0y["y"];w0y=p0y["x"]+p0y["width"];e0y=S0y["x"]+S0y["width"];I0y["width"]=w0y>e0y?w0y:e0y;v0y=p0y["y"]+p0y["height"];h0y=S0y["y"]+S0y["height"];I0y["height"]=v0y>h0y?v0y:h0y;return I0y;};return R0y;}();n0y["Rectangle"]=z0y;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var j0y;j0y=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(u0y,c0y){u0y["__proto__"]=c0y;}||function(b0y,K0y){for(var d0y in K0y)if(K0y["hasOwnProperty"](d0y))b0y[d0y]=K0y[d0y];};return function(P0y,N0y){function B0y(){this["constructor"]=P0y;}j0y(P0y,N0y);P0y["prototype"]=N0y===null?Object["create"](N0y):(B0y["prototype"]=N0y["prototype"],new B0y());};}();(function(q0y){var Q0y;Q0y=function(H7I){__extends(f0y,H7I);Object["defineProperty"](f0y["prototype"],"radius",{get:function(){return this["_radius"];},set:function(m7I){if(m7I<0)return;this["_radius"]=m7I;},enumerable:true,configurable:true});function f0y(){var k7I;k7I=H7I["call"](this)||this;k7I["_radius"]=1;k7I["center"]=new THREE["Vector3"](0,0,0);k7I["type"]=q0y["GisObjectType"]["circle"];return k7I;}Object["defineProperty"](f0y["prototype"],"boundary",{get:function(){var L7I;L7I=new q0y["Rectangle"]();L7I["setRectangle"](this["center"]["x"]-this["radius"],this["center"]["y"]-this["radius"],this["center"]["x"]+this["radius"],this["center"]["y"]+this["radius"]);return L7I;},enumerable:true,configurable:true});f0y["prototype"]["setPoints"]=function(V7I,E7I){var y7I,s7I,Y7I,l7I,r7I;if(q0y["Util"]["isDefined"](V7I)==false)return;if(q0y["Util"]["isDefined"](E7I)==false)return;this["geometry"]["points"]=[];this["geometry"]["points"]["push"](V7I);this["geometry"]["points"]["push"](E7I);this["center"]=V7I;y7I=this["center"];s7I=E7I;Y7I=new THREE["Vector2"](y7I["x"],y7I["y"]);l7I=new THREE["Vector2"](s7I["x"],s7I["y"]);r7I=Y7I["sub"](l7I);this["radius"]=r7I["length"]();};f0y["prototype"]["applyGeometryPoints"]=function(F7I){if(q0y["Util"]["isDefined"](F7I)){if(F7I["length"]==2){this["setPoints"](F7I[0]["clone"](),F7I[1]["clone"]());}}};f0y["prototype"]["drawToCanvas"]=function(W7I,U7I,D7I,A7I){var M7I,C7I,G7I;if(q0y["Util"]["isDefined"](W7I)==false)return;if(this["radius"]<=0)return;M7I=(this["center"]["x"]-D7I)*U7I;C7I=(A7I-this["center"]["y"])*U7I;W7I["beginPath"]();W7I["arc"](M7I,C7I,this["radius"]*U7I,0,2*Math["PI"]);G7I=true;if(q0y["Util"]["isDefined"](this["drawStyle"])){if(q0y["Util"]["isDefined"](this["drawStyle"]["fill"]))G7I=this["drawStyle"]["fill"];}if(G7I){W7I["fill"]();}else{W7I["stroke"]();}};return f0y;}(q0y["GisObject"]);q0y["GisCircle"]=Q0y;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var z7I;z7I=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(n7I,R7I){n7I["__proto__"]=R7I;}||function(T7I,X7I){for(var g7I in X7I)if(X7I["hasOwnProperty"](g7I))T7I[g7I]=X7I[g7I];};return function(t7I,a7I){function O7I(){this["constructor"]=t7I;}z7I(t7I,a7I);t7I["prototype"]=a7I===null?Object["create"](a7I):(O7I["prototype"]=a7I["prototype"],new O7I());};}();(function(o7I){var J7I;J7I=function(x7I){__extends(Z7I,x7I);Object["defineProperty"](Z7I["prototype"],"radius",{get:function(){return this["_radius"];},set:function(p7I){if(p7I<0)return;this["_radius"]=p7I;},enumerable:true,configurable:true});Z7I["prototype"]["setPoints"]=function(w7I,e7I){var S7I,I7I,v7I,h7I;if(o7I["Util"]["isDefined"](w7I)==false)return;if(o7I["Util"]["isDefined"](e7I)==false)return;this["geometry"]["points"]=[];this["geometry"]["points"]["push"](w7I);this["geometry"]["points"]["push"](e7I);this["center"]=w7I;S7I=this["center"];I7I=e7I;S7I=o7I["CmMathEngine"]["Geo2CartesianEarth"](S7I["x"],S7I["y"],S7I["z"]);I7I=o7I["CmMathEngine"]["Geo2CartesianEarth"](I7I["x"],I7I["y"],I7I["z"]);v7I=S7I["sub"](I7I);this["radius"]=v7I["length"]();if(o7I["Util"]["isDefined"](this["userObject"])){h7I=this["userObject"]["getMesh"]();h7I["scale"]["set"](this["radius"],this["radius"],this["radius"]);}};Z7I["prototype"]["applyGeometryPoints"]=function(j7I){if(o7I["Util"]["isDefined"](j7I)){if(j7I["length"]==2){this["setPoints"](j7I[0]["clone"](),j7I[1]["clone"]());}}};Z7I["prototype"]["releaseMesh"]=function(){if(o7I["Util"]["isDefined"](this["userObject"])){this["userObject"]["dispose"]();this["userObject"]=null;}};Z7I["prototype"]["setUserSphereMesh"]=function(u7I){var c7I;if(o7I["Util"]["isDefined"](u7I)){this["releaseMesh"]();u7I["scale"]["set"](this["radius"],this["radius"],this["radius"]);c7I=new o7I["UserObject"]("sphere:"+this["id"],u7I,this["center"],null);c7I["rotate4GlobeEarth"]();this["userObject"]=c7I;}};function Z7I(){var i7I;i7I=x7I["call"](this)||this;i7I["_radius"]=10;i7I["center"]=new THREE["Vector3"](0,0,0);i7I["userObject"]=null;i7I["phiLength"]=Math["PI"]*2;i7I["type"]=o7I["GisObjectType"]["sphere"];i7I["vectorRenderMode"]=o7I["VectorRenderMode"]["vector"];return i7I;}Z7I["prototype"]["setDefaultSphereMesh"]=function(){var b7I,d7I,N7I,K7I;this["releaseMesh"]();b7I=new THREE["SphereBufferGeometry"](this["radius"],8,6,0,this["phiLength"],0,Math["PI"]);d7I=new THREE["MeshPhongMaterial"]({color:this["color"],side:THREE["DoubleSide"]});o7I["Material"]["addClippingAttri"](d7I);N7I=new THREE["Mesh"](b7I,d7I);K7I=new o7I["UserObject"]("sphere:"+this["id"],N7I,this["center"],null);K7I["rotate4GlobeEarth"]();this["userObject"]=K7I;};Z7I["prototype"]["update"]=function(){if(o7I["Util"]["isDefined"](this["userObject"])==false){this["setDefaultSphereMesh"]();}if(o7I["Util"]["isDefined"](this["userObject"])){this["userObject"]["update"]();}};Z7I["prototype"]["render"]=function(){if(this["userObject"]!=null){}};return Z7I;}(o7I["GisObject"]);o7I["Sphere"]=J7I;}(CMWORLD||(CMWORLD={})));__extends=this&&this["__extends"]||function(){var P7I;P7I=Object["setPrototypeOf"]||{__proto__:[]}instanceof Array&&function(B7I,q7I){B7I["__proto__"]=q7I;}||function(H3I,f7I){for(var Q7I in f7I)if(f7I["hasOwnProperty"](Q7I))H3I[Q7I]=f7I[Q7I];};return function(m3I,k3I){P7I(m3I,k3I);m3I["prototype"]=k3I===null?Object["create"](k3I):(L3I["prototype"]=k3I["prototype"],new L3I());function L3I(){this["constructor"]=m3I;}};}();(function(V3I){var E3I;E3I=function(s3I){function y3I(){var Y3I;Y3I=s3I["call"](this)||this;Y3I["minHeight"]=0;Y3I["maxHeight"]=10;Y3I["volume"]=0;Y3I["userObject"]=null;Y3I["type"]=V3I["GisObjectType"]["volumepolygon"];Y3I["vectorRenderMode"]=V3I["VectorRenderMode"]["vector"];return Y3I;}__extends(y3I,s3I);Object["defineProperty"](y3I["prototype"],"opacity",{get:function(){var l3I;if(V3I["Util"]["isDefined"](this["userObject"])){l3I=this["userObject"]["getMesh"]();if(V3I["Util"]["isDefined"](l3I['material'])){return l3I['material']["opacity"];}}return 1;},set:function(F3I){var r3I;if(V3I["Util"]["isDefined"](this["userObject"])==false)return;r3I=this["userObject"]["getMesh"]();if(V3I["Util"]["isDefined"](r3I['material'])){r3I['material']["opacity"]=F3I;if(F3I<1.0)r3I['material']["transparent"]=true;else r3I['material']["transparent"]=false;}},enumerable:true,configurable:true});y3I["prototype"]["releaseMesh"]=function(){if(V3I["Util"]["isDefined"](this["userObject"])){this["userObject"]["dispose"]();this["userObject"]=null;}};y3I["prototype"]["setHeight"]=function(W3I,U3I){this["minHeight"]=W3I;this["maxHeight"]=U3I;};y3I["genVolumeGeometry"]=function(A3I,G3I){var M3I,C3I,D3I;if(G3I===void 0){G3I=10;}M3I=new THREE["Shape"](A3I);C3I={amount:G3I,bevelEnabled:false,bevelSegments:2,steps:2,bevelSize:1,bevelThickness:1};D3I=new THREE["ExtrudeGeometry"](M3I,C3I);return D3I;};y3I["prototype"]["genVolumePolygonMesh"]=function(x3I){var i3I,o3I,T3I,a3I,t3I,O3I,z3I,g3I,S3I,n3I,Z3I,J3I,p3I;if(x3I===void 0){x3I=null;}i3I=this["opacity"];this["releaseMesh"]();o3I=[];if(true){T3I=this["geometry"]["points"];a3I=10000;t3I=this["minHeight"];O3I=this["maxHeight"];for(var X3I=0;X3I<T3I["length"];X3I++){o3I["push"](new THREE["Vector2"](T3I[X3I]["x"]*a3I,T3I[X3I]["y"]*a3I));}z3I=y3I["genVolumeGeometry"](o3I,O3I-t3I);for(var R3I in z3I["vertices"]){g3I=z3I["vertices"][R3I];g3I["x"]/=a3I;g3I["y"]/=a3I;S3I=V3I["CmMathEngine"]["Geo2Cartesian"](g3I["x"],g3I["y"],V3I["cm_const"]["EarthRadius"]+g3I["z"]+t3I);z3I["vertices"][R3I]=S3I;}z3I["computeBoundingBox"]();n3I=new THREE["Vector3"]();n3I=z3I["boundingBox"]["getCenter"](n3I);Z3I=V3I["CmMathEngine"]["Cartesian2Geo"](n3I["x"],n3I["y"],n3I["z"]);Z3I["z"]-=V3I["cm_const"]["EarthRadius"];for(var R3I in z3I["vertices"]){z3I["vertices"][R3I]["sub"](n3I);}z3I["computeBoundingBox"]();J3I=new THREE["Mesh"](z3I,new THREE["MeshPhongMaterial"]({color:0xf08000,side:THREE["DoubleSide"]}));V3I["Material"]["addClippingAttri"](J3I["material"]);p3I=new V3I["UserObject"]("volumepolygon:"+this["id"],J3I,Z3I["clone"]());this["userObject"]=p3I;this["opacity"]=i3I;this["volume"]=this["calcVolume"](T3I,t3I,O3I,x3I);}};y3I["prototype"]["calcVolume"]=function(b3I,Y8I,s8I,v3I){var Q3I,K3I,h3I,j3I,u3I,c3I,f3I,I3I,N3I,y8I,e3I,d3I,L8I,q3I,E8I,H8I,m8I,k8I,V8I;if(v3I===void 0){v3I=null;}Q3I=proj4["defs"]('EPSG:4326');K3I=proj4["defs"]('EPSG:3857');h3I=Number["MAX_VALUE"];j3I=Number["MIN_VALUE"];u3I=Number["MAX_VALUE"];c3I=Number["MIN_VALUE"];f3I=[];for(var w3I=0;w3I<b3I["length"];w3I++){I3I=proj4(Q3I,K3I,{x:b3I[w3I]["x"],y:b3I[w3I]["y"]});f3I["push"](new THREE["Vector2"](I3I["x"],I3I["y"]));h3I=I3I["x"]<h3I?I3I["x"]:h3I;j3I=I3I["x"]>j3I?I3I["x"]:j3I;u3I=I3I["y"]<u3I?I3I["y"]:u3I;c3I=I3I["y"]>c3I?I3I["y"]:c3I;}N3I=1;for(var P3I=u3I;P3I<c3I;P3I+=N3I){for(var B3I=h3I;B3I<j3I;B3I+=N3I){}}if(V3I["Util"]["isDefined"](v3I)){y8I=[];e3I=v3I["vertices"];for(var w3I=0;w3I<e3I["length"];w3I++){d3I=V3I["CmMathEngine"]["Cartesian2Geo"](e3I[w3I]["x"],e3I[w3I]["y"],e3I[w3I]["z"]);d3I["z"]-=V3I["cm_const"]["EarthRadius"];I3I=proj4(Q3I,K3I,{x:d3I["x"],y:d3I["y"]});e3I[w3I]["x"]=I3I["x"];e3I[w3I]["y"]=I3I["y"];e3I[w3I]["z"]=d3I["z"];}}L8I=0;q3I=y3I["genVolumeGeometry"](f3I,s8I-Y8I);if(V3I["Util"]["isDefined"](v3I)){E8I=new ThreeBSP(q3I);H8I=new ThreeBSP(v3I);m8I=E8I["intersect"](H8I);k8I=m8I["toGeometry"]();L8I=V3I["Geometry"]["volumeOfGeometry"](k8I);}V8I=V3I["Geometry"]["volumeOfGeometry"](q3I);return V8I;};y3I["prototype"]["getGeoCenter"]=function(){if(V3I["Util"]["isDefined"](this["userObject"])){return this["userObject"]["getPosition"]();}return null;};y3I["prototype"]["update"]=function(){if(V3I["Util"]["isDefined"](this["userObject"])==false){this["genVolumePolygonMesh"]();}if(V3I["Util"]["isDefined"](this["userObject"])){this["userObject"]["update"]();}};y3I["prototype"]["render"]=function(){if(V3I["Util"]["isDefined"](this["userObject"])){}};y3I["prototype"]["drawToCanvas"]=function(l8I,r8I,F8I,W8I){return V3I["GisPolygon"]["drawToCanvas"](this["geometry"]["points"],l8I,r8I,F8I,W8I);};return y3I;}(V3I["GisObject"]);V3I["VolumePolygon"]=E3I;}(CMWORLD||(CMWORLD={})));(function(U8I){var G8I,M8I;G8I=function(){C8I["prototype"]["clear"]=function(){this["objectType"]=U8I["GisObjectType"]["none"];this["pointList"]=new Array();this["gisObject"]=null;};function C8I(D8I){this["objectType"]=U8I["GisObjectType"]["none"];this["pointList"]=new Array();this["gisObject"]=null;this["objectType"]=D8I;}return C8I;}();U8I["UserDrawDataInfo"]=G8I;M8I=function(){A8I["prototype"]["dispose"]=function(){this["mapViewer"]["removeLayer"](this["userDrawingLayer"]);this["mapViewer"]["removeLayer"](this["userDrawnLayer"]);this["clear"]();};A8I["prototype"]["clear"]=function(){this["userDrawnLayer"]["clear"]();this["drawMode"]=U8I["MouseMode"]["normal"];this["endEditing"]();};A8I["prototype"]["endEditing"]=function(){this["userDrawingLayer"]["clear"]();this["editingDataInfo"]=null;this["editingMesh"]=null;this["editingObject"]=null;};A8I["prototype"]["setDisplayMeasurement"]=function(n8I){this["displayMeasurement"]=n8I;};A8I["prototype"]["setDrawMode"]=function(R8I){try{switch(R8I){case U8I["MouseMode"]["drawPoint"]:{this["editingDataInfo"]=new G8I(U8I["GisObjectType"]["point"]);}break;case U8I["MouseMode"]["drawPolyline"]:{this["editingDataInfo"]=new G8I(U8I["GisObjectType"]["linestring"]);}break;case U8I["MouseMode"]["drawPolygon"]:{this["editingDataInfo"]=new G8I(U8I["GisObjectType"]["polygon"]);}break;case U8I["MouseMode"]["drawCircle"]:{this["editingDataInfo"]=new G8I(U8I["GisObjectType"]["circle"]);}break;case U8I["MouseMode"]["drawSphere"]:{this["editingDataInfo"]=new G8I(U8I["GisObjectType"]["sphere"]);}break;case U8I["MouseMode"]["drawVolumePolygon"]:{this["editingDataInfo"]=new G8I(U8I["GisObjectType"]["volumepolygon"]);}break;default:{R8I=U8I["MouseMode"]["normal"];this["editingDataInfo"]=null;}break;}}catch(g8I){console["error"](g8I);R8I=U8I["MouseMode"]["normal"];}this["drawMode"]=R8I;};A8I["prototype"]["mouseDown"]=function(X8I){this["allowDrawUp"]=false;this["mouseMoved"]=false;if(this["drawMode"]==U8I["MouseMode"]["normal"]){return false;}return true;};A8I["prototype"]["mouseClick"]=function(j8I){var p8I,Z8I,u8I,a8I,T8I,c8I,h8I,w8I,e8I,S8I,i8I,I8I,v8I,J8I,x8I,t8I,O8I,o8I;if(this["drawMode"]==U8I["MouseMode"]["normal"])return false;p8I=this["mapViewer"];Z8I=p8I["convertPagePosToCanvasPos"](j8I["pageX"],j8I["pageY"]);if(p8I["mouse"]["isClick"](Z8I)==false)return;u8I=U8I["CmMouse"]["isEqualCoord"](this["lastClickCoord"],Z8I,3);if(u8I)return;this["lastClickCoord"]=Z8I;if(U8I["Util"]["isDefined"](this["allowDrawUp"])){this["allowDrawUp"]=false;a8I=p8I["getHitCoordinate"](Z8I["x"],Z8I["y"],null);if(a8I){T8I=this["editingDataInfo"]["pointList"];if(T8I["length"]<1){T8I["push"](a8I);}else{c8I=T8I[T8I["length"]-1];T8I[T8I["length"]-1]=a8I["clone"]();}T8I["push"](a8I["clone"]());if(this["drawMode"]==U8I["MouseMode"]["drawPolyline"]){if(U8I["Util"]["isDefined"](this["editingDataInfo"]["gisObject"])==false){h8I=new U8I["GisPolyline"]();h8I["vectorRenderMode"]=U8I["VectorRenderMode"]["image"];this["editingDataInfo"]["gisObject"]=h8I;}}else if(this["drawMode"]==U8I["MouseMode"]["drawPolygon"]){if(U8I["Util"]["isDefined"](this["editingDataInfo"]["gisObject"])==false){w8I=new U8I["GisPolygon"]();w8I["vectorRenderMode"]=U8I["VectorRenderMode"]["image"];this["editingDataInfo"]["gisObject"]=w8I;}}else if(this["drawMode"]==U8I["MouseMode"]["drawVolumePolygon"]){if(U8I["Util"]["isDefined"](this["editingDataInfo"]["gisObject"])==false){e8I=new U8I["VolumePolygon"]();e8I["vectorRenderMode"]=U8I["VectorRenderMode"]["image"];this["editingDataInfo"]["gisObject"]=e8I;}}else if(this["drawMode"]==U8I["MouseMode"]["drawCircle"]||this["drawMode"]==U8I["MouseMode"]["drawSphere"]){if(U8I["Util"]["isDefined"](this["editingDataInfo"]["gisObject"])==false){if(this["drawMode"]==U8I["MouseMode"]["drawCircle"]){S8I=new U8I["GisCircle"]();S8I["vectorRenderMode"]=U8I["VectorRenderMode"]["image"];S8I["applyGeometryPoints"](T8I);this["editingDataInfo"]["gisObject"]=S8I;}else if(this["drawMode"]==U8I["MouseMode"]["drawSphere"]){i8I=new U8I["Sphere"]();i8I["phiLength"]=Math["PI"];i8I["applyGeometryPoints"](T8I);i8I["setUserSphereMesh"](this["genHemiSphereMesh"]());this["editingDataInfo"]["gisObject"]=i8I;}}else{this["measureEnd"]();}}I8I=this["getEditingGisObject"]();if(U8I["Util"]["isDefined"](I8I)){I8I["geometry"]["points"]=T8I;}if(this["vectorRenderMode"]==U8I["VectorRenderMode"]["vector"]){if(U8I["Util"]["isDefined"](I8I)){if(this["drawMode"]==U8I["MouseMode"]["drawSimpleline"]){v8I=U8I["CmMathEngine"]["Geo2Cartesian"](a8I["x"],a8I["y"],U8I["cm_const"]["EarthRadius"]+a8I["z"]);J8I=U8I["GeometryUtil"]["createWorldGeometry"](T8I,true);x8I=new THREE["LineBasicMaterial"]({color:0xffffff,depthTest:false});t8I=J8I;{t8I["dynamic"]=true;t8I["verticesNeedUpdate"]=true;}O8I=new THREE["Line"](J8I,x8I);o8I=new U8I["UserObject"](name,O8I);this["editingMesh"]=O8I;this["editingObject"]=o8I;this["userDrawingLayer"]["clear"]();this["userDrawingLayer"]["add"](o8I);if(T8I["length"]>2){this["measureEnd"]();}}if(this["drawMode"]==U8I["MouseMode"]["drawPolyline"]||this["drawMode"]==U8I["MouseMode"]["drawPolygon"]){v8I=U8I["CmMathEngine"]["Geo2Cartesian"](a8I["x"],a8I["y"],U8I["cm_const"]["EarthRadius"]+a8I["z"]);J8I=U8I["GeometryUtil"]["createWorldGeometry"](T8I,true);x8I=new THREE["LineBasicMaterial"]({color:0xffffff,depthTest:false});t8I=J8I;{t8I["dynamic"]=true;if(this["drawMode"]==U8I["MouseMode"]["drawPolygon"]){t8I["vertices"]["push"](t8I["vertices"][0]["clone"]());}t8I["verticesNeedUpdate"]=true;}O8I=new THREE["Line"](J8I,x8I);o8I=new U8I["UserObject"](name,O8I);this["editingMesh"]=O8I;this["editingObject"]=o8I;this["userDrawingLayer"]["clear"]();this["userDrawingLayer"]["add"](o8I);}}}}}};A8I["prototype"]["mouseDbClick"]=function(K8I){var d8I;d8I=false;if(this["drawMode"]==U8I["MouseMode"]["normal"]){return false;}if(this["measureEndMethod"]==U8I["MouseClick"]["dbclick"]){d8I=this["measureEnd"]();}return d8I;};A8I["prototype"]["mouseUp"]=function(N8I){var b8I;if(this["drawMode"]==U8I["MouseMode"]["normal"]){return false;}if(this["editingDataInfo"]==null)return false;b8I=U8I["CmMouse"]["getMouseButton"](N8I);if(b8I==U8I["CmMouse"]["userLButton"]){this["allowDrawUp"]=true;}else if(b8I==U8I["CmMouse"]["userRButton"]){if(this["measureEndMethod"]==U8I["MouseClick"]["rclick"]){this["measureEnd"]();}}else{}return true;};A8I["prototype"]["mouseMove"]=function(V4I){var P8I,Q8I,f8I,E4I,q8I,m4I,L4I,k4I,B8I,H4I;this["mouseMoved"]=true;if(this["drawMode"]==U8I["MouseMode"]["normal"]){return false;}if(this["editingDataInfo"]==null){return false;}P8I=null;if(this["editingDataInfo"]!=null){P8I=this["editingDataInfo"]["pointList"];}if(P8I!=null&&P8I["length"]>0){Q8I=this["mapViewer"];f8I=Q8I["convertPagePosToCanvasPos"](V4I["pageX"],V4I["pageY"]);E4I=null;q8I=Q8I["getHitCoordinateOnGround"](f8I["x"],f8I["y"]);if(q8I){if(this["editingDataInfo"]["objectType"]==U8I["GisObjectType"]["circle"]){q8I["z"]=P8I[0]["z"];}m4I=this["editingDataInfo"]["gisObject"]["boundary"];Q8I["setReDrawMap"](U8I["MapLayerType"]["dynamicMap"],U8I["CoordBound"]["fromRectangle"](m4I));L4I=P8I["length"]-1;P8I[L4I]=q8I["clone"]();this["editingDataInfo"]["gisObject"]["applyGeometryPoints"](P8I);this["editingDataInfo"]["gisObject"]["geometry"]["updateBoundary"]();this["editingDataInfo"]["gisObject"]["needsRedraw"]=true;if(this["vectorRenderMode"]==U8I["VectorRenderMode"]["vector"]){k4I=U8I["CmMathEngine"]["Geo2Cartesian"](q8I["x"],q8I["y"],U8I["cm_const"]["EarthRadius"]+q8I["z"]);if(this["editingMesh"]instanceof THREE["Line"]){B8I=this["editingMesh"];if(this["drawMode"]==U8I["MouseMode"]["drawPolygon"]){H4I=B8I["geometry"]["vertices"]["length"];B8I["geometry"]["vertices"][H4I-2]=k4I;B8I["geometry"]["vertices"][H4I-1]=B8I["geometry"]["vertices"][0];}else if(this["drawMode"]==U8I["MouseMode"]["drawPolyline"]||this["drawMode"]==U8I["MouseMode"]["drawSimpleline"]){B8I["geometry"]["vertices"][B8I["geometry"]["vertices"]["length"]-1]=k4I;}B8I["geometry"]["verticesNeedUpdate"]=true;}}else{}}}return false;};A8I["prototype"]["adjustHeightAfter"]=function(Y4I,y4I){var s4I;if(Y4I==U8I["GisObjectType"]["circle"]){if(y4I["length"]>0){s4I=y4I[0]["z"];this["adjustHeight"](y4I,s4I);}}};A8I["prototype"]["adjustHeight"]=function(r4I,F4I){for(var l4I=0;l4I<r4I["length"];l4I++){r4I[l4I]["z"]=F4I;}};A8I["prototype"]["measureEnd"]=function(){var W4I,G4I,U4I;this["drawMode"]=U8I["MouseMode"]["normal"];W4I=this["editingDataInfo"];if(U8I["Util"]["isDefined"](W4I)==false)return false;G4I=this["editingObject"];this["endEditing"]();if(W4I["pointList"]["length"]>0){W4I["pointList"]["pop"]();this["adjustHeightAfter"](W4I["objectType"],W4I["pointList"]);U4I=true;if(this["callbackEndEditing"]!=null){U4I=this["callbackEndEditing"](W4I["pointList"],W4I["objectType"]);}if(U4I==true){this["addMeasureLayer"](W4I,G4I);return true;}}return false;};A8I["prototype"]["genHemiSphereMesh"]=function(){var C4I,D4I,M4I,A4I;C4I=1;D4I=new THREE["SphereBufferGeometry"](C4I,24,18,0,Math["PI"],0,Math["PI"]);M4I=new THREE["MeshPhongMaterial"]({color:0xf00000,side:THREE["DoubleSide"]});U8I["Material"]["addClippingAttri"](M4I);M4I["opacity"]=0.5;M4I["transparent"]=true;A4I=new THREE["Mesh"](D4I,M4I);return A4I;};function A8I(){this["drawMode"]=U8I["MouseMode"]["normal"];this["vectorRenderMode"]=U8I["VectorRenderMode"]["image"];this["displayMeasurement"]=true;this["editingDataInfo"]=null;this["editingMesh"]=null;this["editingObject"]=null;this["userDrawingLayer"]=new U8I["UserObjectLayer"]("사용자그리기레이어");this["userDrawnLayer"]=new U8I["UserObjectLayer"]("사용자그리기레이어2");this["renderFrameID"]=-1;this["measureEndMethod"]=U8I["MouseClick"]["dbclick"];this["allowDrawUp"]=false;this["mouseMoved"]=false;this["lastClickCoord"]=new THREE["Vector2"](0,0);this["measureFont"]="15px arial";this["measureFillStyle"]="white";this["measureUseStrokeText"]=false;this["mapViewer"]=null;this["mapViewer"]=U8I["CmWorld3"]["getInstance"]();try{this["mapViewer"]["addLayer"](this["userDrawingLayer"]);this["mapViewer"]["addLayer"](this["userDrawnLayer"]);}catch(z8I){console["error"](z8I);}}A8I["prototype"]["addMeasureLayer"]=function(z4I,o4I){var n4I,T4I,X4I,a4I,g4I,R4I,t4I,O4I;if(this["vectorRenderMode"]==U8I["VectorRenderMode"]["vector"]){this["userDrawnLayer"]["add"](o4I);}else{{n4I=null;if(z4I["gisObject"]["type"]==U8I["GisObjectType"]["linestring"]){T4I=new U8I["GisPolyline"]();T4I["vectorRenderMode"]=z4I["gisObject"]["vectorRenderMode"];T4I["geometry"]["points"]=z4I["pointList"];n4I=T4I;}else if(z4I["objectType"]==U8I["GisObjectType"]["polygon"]){X4I=new U8I["GisPolygon"]();X4I["vectorRenderMode"]=z4I["gisObject"]["vectorRenderMode"];X4I["geometry"]["points"]=z4I["pointList"];n4I=X4I;}else if(z4I["objectType"]==U8I["GisObjectType"]["circle"]){a4I=new U8I["GisCircle"]();a4I["vectorRenderMode"]=z4I["gisObject"]["vectorRenderMode"];a4I["applyGeometryPoints"](z4I["pointList"]);n4I=a4I;}else if(z4I["objectType"]==U8I["GisObjectType"]["sphere"]){g4I=new U8I["Sphere"]();g4I["phiLength"]=Math["PI"];g4I["applyGeometryPoints"](z4I["pointList"]);g4I["setUserSphereMesh"](this["genHemiSphereMesh"]());n4I=g4I;}else if(z4I["objectType"]==U8I["GisObjectType"]["volumepolygon"]){R4I=new U8I["VolumePolygon"]();R4I["geometry"]["points"]=z4I["pointList"];t4I=U8I["Geometry"]["calcMinMaxHeight"](R4I["geometry"]["points"]);R4I["setHeight"](t4I["x"],t4I["y"]);R4I["genVolumePolygonMesh"]();R4I["opacity"]=0.8;n4I=R4I;}if(U8I["Util"]["isDefined"](n4I)){O4I=n4I;O4I["geometry"]["updateBoundary"]();}this["mapViewer"]["measureLayer"]["addObject"](n4I);this["mapViewer"]["baseImageLayer"]["reDrawDynamicMap"]();}}};A8I["prototype"]["getEditingGisObject"]=function(){if(U8I["Util"]["isDefined"](this["editingDataInfo"])){return this["editingDataInfo"]["gisObject"];}return null;};A8I["prototype"]["update"]=function(){var J4I;if(U8I["Util"]["isDefined"](this["editingDataInfo"])){J4I=this["getEditingGisObject"]();if(U8I["Util"]["isDefined"](J4I)){if(J4I["vectorRenderMode"]==U8I["VectorRenderMode"]["vector"]){J4I["update"]();}else{}}}if(this["displayMeasurement"]){this["renderMeasurement"]();}};A8I["prototype"]["renderMeasurement"]=function(){var Z4I,S4I,x4I,p4I;Z4I=this["mapViewer"];if(Z4I["isRenderingFrame"]==false)return;if(this["renderFrameID"]==Z4I["option"]["renderFrameID"])return;this["renderFrameID"]=Z4I["option"]["renderFrameID"];if(Z4I["measureLayer"]["gisObjectArray"]["length"]>0){S4I=0;if(false){}else{x4I=Z4I["getScreenLayerCanvasContext"]();this["initMeasurementTextCanvas"](x4I);for(var i4I in Z4I["measureLayer"]["gisObjectArray"]){p4I=Z4I["measureLayer"]["gisObjectArray"][i4I];this["displayText"](p4I,Z4I,x4I,false);}}}if(this["editingDataInfo"]){x4I=Z4I["getScreenLayerCanvasContext"]();this["initMeasurementTextCanvas"](x4I);this["displayText"](this["editingDataInfo"]["gisObject"],Z4I,x4I,true);}};A8I["prototype"]["initMeasurementTextCanvas"]=function(I4I){I4I["font"]=this["measureFont"];I4I["fillStyle"]=this["measureFillStyle"];I4I["textAlign"]="end";};A8I["prototype"]["displayText"]=function(f4I,Q4I,j4I,L2I){var V2I,v4I,q4I,N4I,K4I,d4I,e4I,w4I,u4I,c4I,y2I,Y2I,P4I,H2I,k2I,F2I,s2I,h4I,r2I,l2I,B4I,W2I,E2I;if(L2I===void 0){L2I=false;}if(U8I["Util"]["isDefined"](f4I)==false)return;V2I=f4I["type"];v4I=f4I["points"];if(U8I["Util"]["isDefined"](V2I)==false)return;if(U8I["Util"]["isDefined"](v4I)==false)return;if(v4I["length"]<1)return;switch(V2I){case U8I["GisObjectType"]["linestring"]:{q4I=null;N4I=0;for(var b4I=0;b4I<v4I["length"];b4I++){K4I=v4I[b4I];d4I=U8I["CmMathEngine"]["Geo2Cartesian"](K4I["x"],K4I["y"],U8I["cm_const"]["EarthRadius"]+K4I["z"]);e4I=Q4I["toScreenCoord"](d4I);if(q4I){q4I["sub"](d4I);if(e4I){w4I=" m";u4I=q4I["length"]();N4I+=u4I;if(u4I>1000){w4I=" km";u4I/=1000;}c4I=u4I["toFixed"](1)["toString"]()+w4I;j4I["fillText"](c4I,e4I["x"],e4I["y"]);if(this["measureUseStrokeText"]){j4I["strokeText"](c4I,e4I["x"],e4I["y"]);}if(b4I==v4I["length"]-1){if(L2I){j4I["fillStyle"]="red";}w4I=" m";if(N4I>1000){w4I=" km";N4I/=1000;}c4I=N4I["toFixed"](1)["toString"]()+w4I;j4I["fillText"](c4I,e4I["x"],e4I["y"]-15);if(this["measureUseStrokeText"]){j4I["strokeText"](c4I,e4I["x"],e4I["y"]-15);}}}}q4I=d4I;}}break;case U8I["GisObjectType"]["polygon"]:{y2I=v4I["length"]-1;if(y2I>-1){Y2I=[];for(var m2I in v4I){Y2I["push"](new THREE["Vector2"](v4I[m2I]["x"],v4I[m2I]["y"]));}P4I=U8I["CmMathEngine"]["geodesicArea"](Y2I);K4I=v4I[y2I];d4I=U8I["CmMathEngine"]["Geo2Cartesian"](K4I["x"],K4I["y"],U8I["cm_const"]["EarthRadius"]+K4I["z"]);e4I=Q4I["toScreenCoord"](d4I);if(e4I){w4I=" m²";if(P4I>1000000){w4I=" km²";P4I/=1000000;}j4I["fillText"](P4I["toFixed"](1)["toString"]()+w4I,e4I["x"],e4I["y"]);if(this["measureUseStrokeText"]){j4I["strokeText"](P4I["toFixed"](1)["toString"]()+w4I,e4I["x"],e4I["y"]);}}}}break;case U8I["GisObjectType"]["circle"]:case U8I["GisObjectType"]["sphere"]:{if(v4I["length"]>1){H2I=v4I[0];k2I=v4I[1];F2I=U8I["CmMathEngine"]["Geo2Cartesian"](H2I["x"],H2I["y"],U8I["cm_const"]["EarthRadius"]+H2I["z"]);s2I=U8I["CmMathEngine"]["Geo2Cartesian"](k2I["x"],k2I["y"],U8I["cm_const"]["EarthRadius"]+k2I["z"]);h4I=Q4I["toScreenCoord"](s2I);if(h4I){r2I=F2I["sub"](s2I);w4I=" m";u4I=r2I["length"]();if(u4I>1000){w4I=" km";u4I/=1000;}c4I=u4I["toFixed"](1)["toString"]()+w4I;j4I["fillText"](c4I,h4I["x"],h4I["y"]);if(this["measureUseStrokeText"]){j4I["strokeText"](c4I,h4I["x"],h4I["y"]);}}}}break;case U8I["GisObjectType"]["volumepolygon"]:{l2I=f4I;B4I=l2I["getGeoCenter"]();if(U8I["Util"]["isDefined"](B4I)){d4I=U8I["CmMathEngine"]["Geo2Cartesian"](B4I["x"],B4I["y"],U8I["cm_const"]["EarthRadius"]+B4I["z"]);h4I=Q4I["toScreenCoord"](d4I);if(h4I){w4I=" m³";W2I=l2I["volume"];E2I=W2I["toFixed"](2)["toString"]()+w4I;j4I["fillText"](E2I,h4I["x"],h4I["y"]);if(this["measureUseStrokeText"]){j4I["strokeText"](E2I,h4I["x"],h4I["y"]);}}}}break;}};return A8I;}();U8I["UserDrawHandler"]=M8I;}(CMWORLD||(CMWORLD={})));(function(U2I){var G2I;G2I=function(){M2I["prototype"]["getTerrainWorker"]=function(){var D2I,A2I;D2I=null;A2I=M2I["TerrainWorkerCount"];if(this["_terrainWorker"]["length"]<A2I){for(var z2I=0;z2I<A2I;z2I++){D2I=new Worker(U2I["GlobalOption"]["workerLibraryURL"]+'cm_terrainworker.js');D2I["isWorking"]=false;D2I["startWaitingTime"]=1;D2I["addEventListener"]('message',function(R2I){var n2I;if(R2I["data"]["command"]==U2I["WorkerCommand"]["finish"]){R2I["data"]["command"]=U2I["WorkerCommand"]["none"];n2I=this;n2I["isWorking"]=false;n2I["startWaitingTime"]=Date["now"]();}},false);this["_terrainWorker"][z2I]=D2I;}}while(--A2I>-1){D2I=this["_terrainWorker"][A2I];if(D2I["isWorking"]==false){D2I["isWorking"]=true;D2I["rent_time"]=Date["now"]();return D2I;}}return null;};M2I["prototype"]["getCubeGroupWorker"]=function(t2I){var X2I,T2I,a2I,g2I;if(t2I===void 0){t2I=false;}T2I=null;if(this["_cubeGroupWorkers"]["length"]<M2I["numCubeGroupWorkers"]){for(X2I=this["_cubeGroupWorkers"]["length"];X2I<M2I["numCubeGroupWorkers"];++X2I){T2I=new Worker(U2I["GlobalOption"]["workerLibraryURL"]+'cubegroupworker.js');T2I["isWorking"]=false;this["_cubeGroupWorkers"][X2I]=T2I;}}if(!t2I){a2I=this["_cubeGroupWorkers"]["length"]-1;g2I=null;while(a2I>=0){g2I=this["_cubeGroupWorkers"][a2I];if(g2I["isWorking"]==false){g2I["isWorking"]=true;g2I["rent_time"]=Date["now"]();return g2I;}--a2I;}}return null;};function M2I(){var C2I;this["_terrainWorker"]=[];this["modelWorkers"]=[];this["_cubeGroupWorkers"]=[];this["_cube2ImageGroupWorkers"]=[];C2I=this["getTerrainWorker"]();C2I["isWorking"]=false;C2I=this["rentModelWorker"]();C2I["isWorking"]=false;}M2I["prototype"]["getCube2ImageGroupWorker"]=function(x2I){var o2I,J2I,Z2I,O2I;if(x2I===void 0){x2I=false;}J2I=null;if(this["_cube2ImageGroupWorkers"]["length"]<M2I["numCube2ImageGroupWorkers"]){for(o2I=this["_cubeGroupWorkers"]["length"];o2I<M2I["numCubeGroupWorkers"];++o2I){J2I=new Worker(U2I["GlobalOption"]["workerLibraryURL"]+'cube2imagegroupworker.js');J2I["isWorking"]=false;this["_cube2ImageGroupWorkers"][o2I]=J2I;}}if(!x2I){Z2I=this["_cube2ImageGroupWorkers"]["length"]-1;O2I=null;while(Z2I>=0){O2I=this["_cube2ImageGroupWorkers"][Z2I];if(O2I["isWorking"]==false){O2I["isWorking"]=true;O2I["rent_time"]=Date["now"]();return O2I;}--Z2I;}}return null;};M2I["prototype"]["getAvaiableTerrainWorker"]=function(){var p2I;for(var i2I=0;i2I<this["_terrainWorker"]["length"];i2I++){p2I=this["_terrainWorker"][i2I];if(p2I["isWorking"]==false){return true;}}return false;};M2I["prototype"]["createModelWorker"]=function(){var S2I,I2I;S2I=new Worker(U2I["GlobalOption"]["workerLibraryURL"]+'cm_modelworker.js');I2I=S2I;I2I["isWorking"]=false;S2I["postMessage"]=I2I["webkitPostMessage"]||S2I["postMessage"];I2I["startWaitingTime"]=1;S2I["addEventListener"]('message',function(e2I){var w2I;if(e2I["data"]["command"]==U2I["WorkerCommand"]["finish"]){e2I["data"]["command"]=U2I["WorkerCommand"]["none"];w2I=this;w2I["isWorking"]=false;w2I["startWaitingTime"]=Date["now"]();}},false);return S2I;};M2I["prototype"]["rentModelWorker"]=function(){var c2I,h2I,d2I,j2I,u2I;c2I=M2I["modelWorkerCount"];if(this["modelWorkers"]["length"]<c2I){for(var v2I=0;v2I<c2I;v2I++){this["modelWorkers"][v2I]=this["createModelWorker"]();}}h2I=-1;d2I=Date["now"]();for(var v2I=0;v2I<this["modelWorkers"]["length"];v2I++){j2I=this["modelWorkers"][v2I];if(j2I["isWorking"]==false){if(j2I["startWaitingTime"]<d2I){h2I=v2I;d2I=j2I["startWaitingTime"];}}}if(h2I<0){return null;}u2I=this["modelWorkers"][h2I];u2I["isWorking"]=true;u2I["rent_time"]=Date["now"]();return u2I;};M2I["prototype"]["isAvaiableModelWorker"]=function(){var b2I;for(var K2I=0;K2I<this["modelWorkers"]["length"];K2I++){b2I=this["modelWorkers"][K2I];if(b2I["isWorking"]==false){return true;}}return false;};M2I["prototype"]["update"]=function(){var B2I,q2I,H1I,Q2I,k1I,f2I,P2I,N2I;B2I=Date["now"]();q2I=5000;H1I=5000;Q2I=5000;k1I=5000;f2I=5000;if(U2I["CmWorld"]["debugMode"]){q2I=120000;H1I=120000;Q2I=120000;k1I=120000;f2I=120000;}N2I=null;for(P2I=0;P2I<this["_terrainWorker"]["length"];P2I++){N2I=this["_terrainWorker"][P2I];if(N2I["isWorking"]){if(B2I-N2I["rent_time"]>q2I){console["warn"]("TerrainWorker is timeout.");N2I["isWorking"]=false;}}}for(P2I=0;P2I<this["_cubeGroupWorkers"]["length"];++P2I){N2I=this["_cubeGroupWorkers"][P2I];if(N2I["isWorking"]){if(B2I-N2I["rent_time"]>Q2I){N2I["isWorking"]=false;console["warn"]("CubeWorker is timeout.");}}}for(P2I=0;P2I<this["modelWorkers"]["length"];P2I++){N2I=this["modelWorkers"][P2I];if(N2I["isWorking"]){if(B2I-N2I["rent_time"]>f2I){console["warn"]("Max3DSWorker is timeout.");N2I["isWorking"]=false;N2I["startWaitingTime"]=Date["now"]();}}}};return M2I;}();G2I["TerrainWorkerCount"]=3;G2I["modelWorkerCount"]=2;G2I["numCubeGroupWorkers"]=2;G2I["numCube2ImageGroupWorkers"]=2;U2I["CmWorkerManager"]=G2I;}(CMWORLD||(CMWORLD={})));(function(m1I){var L1I;L1I=function(){V1I["prototype"]["dispose"]=function(){if(this["earthMaterial"]){this["earthMaterial"]["dispose"]();this["earthMaterial"]=null;}};V1I["prototype"]["setGlobalOption"]=function(){var Y1I,s1I,y1I;Y1I=m1I["CmWorld3"]["getInstance"]()["option"]["refCenter"];for(var l1I in this["earthTileList"]){s1I=this["earthTileList"][l1I];y1I=s1I["origin"]["clone"]();y1I["sub"](Y1I);s1I["position"]["set"](y1I["x"],y1I["y"],y1I["z"]);}};V1I["prototype"]["showTopTile"]=function(F1I,W1I){var r1I;r1I=this["earthTileList"][F1I];if(r1I){r1I["visible"]=W1I;}};V1I["prototype"]["changeEarthOpacity"]=function(){};V1I["prototype"]["makeEarthTile"]=function(){var j1I,R1I,x1I,n1I,i1I,v1I,u1I,c1I,K1I,p1I,Z1I,A1I,t1I,O1I,J1I,o1I,G1I,I1I,z1I,T1I,D1I,b1I,d1I,e1I,C1I,g1I,M1I,U1I;j1I=m1I["CmWorld3"]["getInstance"]()["getEarthSurfaceScene"]();for(var h1I in this["earthTileList"]){j1I["remove"](this["earthTileList"][h1I]);this["earthTileList"][h1I]["geometry"]["dispose"]();}this["earthTileList"]=[];v1I=m1I["CmWorld3"]["getInstance"]();u1I=new THREE["TextureLoader"]();c1I=u1I["load"](m1I["GlobalOption"]["earthBaseImageURL"]);c1I["minFilter"]=THREE["LinearFilter"];K1I=u1I["load"](m1I["GlobalOption"]["texturesURL"]+"empty.png");{this["earthMaterial"]=m1I["CmShaderLib"]["getTerraintMaterial"]({map:c1I,polaimageenable:false,polamaxradius:20,polaimagesize:1024,arcticmap:v1I["polar"]["arcticTexture"],antarcticmap:v1I["polar"]["antarcticTexture"],diffuse:new THREE["Color"](0xffffff),specular:new THREE["Color"](0),emissive:new THREE["Color"](0),shininess:1,opacity:v1I["option"]["terrainOpacity"]});}p1I=m1I["cm_const"]["EarthRadius"];Z1I=v1I["option"]["TileLevelRange"][0];for(var S1I=-180.0;S1I<180.0;S1I+=Z1I){for(var w1I=-90.0;w1I<90.0;w1I+=Z1I){A1I=Z1I/4;t1I=S1I;O1I=w1I;J1I=S1I+Z1I;o1I=w1I+Z1I;G1I=m1I["CmMathEngine"]["Geo2Cartesian"]((t1I+J1I)*0.5,(O1I+o1I)*0.5,p1I);I1I=p1I;z1I=0;T1I=0;D1I=0;d1I="EarthTile_"+t1I+"_"+O1I;e1I=new THREE["BufferGeometry"]();C1I=new Float32Array(18*((J1I-t1I)/A1I+0)*((o1I-O1I)/A1I+0));g1I=new Float32Array(12*((J1I-t1I)/A1I+0)*((o1I-O1I)/A1I+0));M1I=new Float32Array(18*((J1I-t1I)/A1I+0)*((o1I-O1I)/A1I+0));for(var a1I=t1I;a1I<J1I;a1I+=A1I){for(var X1I=O1I;X1I<o1I;X1I+=A1I){R1I=m1I["CmMathEngine"]["Geo2Cartesian"](a1I,X1I,I1I);x1I=m1I["CmMathEngine"]["Geo2Cartesian"](a1I,X1I+A1I,I1I);n1I=m1I["CmMathEngine"]["Geo2Cartesian"](a1I+A1I,X1I+A1I,I1I);i1I=m1I["CmMathEngine"]["Geo2Cartesian"](a1I+A1I,X1I,I1I);C1I[z1I++]=R1I["x"]-G1I["x"];C1I[z1I++]=R1I["y"]-G1I["y"];C1I[z1I++]=R1I["z"]-G1I["z"];C1I[z1I++]=n1I["x"]-G1I["x"];C1I[z1I++]=n1I["y"]-G1I["y"];C1I[z1I++]=n1I["z"]-G1I["z"];C1I[z1I++]=x1I["x"]-G1I["x"];C1I[z1I++]=x1I["y"]-G1I["y"];C1I[z1I++]=x1I["z"]-G1I["z"];C1I[z1I++]=R1I["x"]-G1I["x"];C1I[z1I++]=R1I["y"]-G1I["y"];C1I[z1I++]=R1I["z"]-G1I["z"];C1I[z1I++]=i1I["x"]-G1I["x"];C1I[z1I++]=i1I["y"]-G1I["y"];C1I[z1I++]=i1I["z"]-G1I["z"];C1I[z1I++]=n1I["x"]-G1I["x"];C1I[z1I++]=n1I["y"]-G1I["y"];C1I[z1I++]=n1I["z"]-G1I["z"];R1I["normalize"]();x1I["normalize"]();n1I["normalize"]();i1I["normalize"]();M1I[D1I++]=R1I["x"];M1I[D1I++]=R1I["y"];M1I[D1I++]=R1I["z"];M1I[D1I++]=n1I["x"];M1I[D1I++]=n1I["y"];M1I[D1I++]=n1I["z"];M1I[D1I++]=x1I["x"];M1I[D1I++]=x1I["y"];M1I[D1I++]=x1I["z"];M1I[D1I++]=R1I["x"];M1I[D1I++]=R1I["y"];M1I[D1I++]=R1I["z"];M1I[D1I++]=i1I["x"];M1I[D1I++]=i1I["y"];M1I[D1I++]=i1I["z"];M1I[D1I++]=n1I["x"];M1I[D1I++]=n1I["y"];M1I[D1I++]=n1I["z"];g1I[T1I++]=(a1I+180.0)/360.0;g1I[T1I++]=(X1I+90.0)/180.0;g1I[T1I++]=(a1I+A1I+180.0)/360.0;g1I[T1I++]=(X1I+A1I+90.0)/180.0;g1I[T1I++]=(a1I+180.0)/360.0;g1I[T1I++]=(X1I+A1I+90.0)/180.0;g1I[T1I++]=(a1I+180.0)/360.0;g1I[T1I++]=(X1I+90.0)/180.0;g1I[T1I++]=(a1I+A1I+180.0)/360.0;g1I[T1I++]=(X1I+90.0)/180.0;g1I[T1I++]=(a1I+A1I+180.0)/360.0;g1I[T1I++]=(X1I+A1I+90.0)/180.0;}}e1I["addAttribute"]('position',new THREE["BufferAttribute"](C1I,3));e1I["addAttribute"]('uv',new THREE["BufferAttribute"](g1I,2));e1I["addAttribute"]('normal',new THREE["BufferAttribute"](M1I,3));U1I=new THREE["Mesh"](e1I,this["earthMaterial"]);U1I["castShadow"]=false;U1I["receiveShadow"]=true;U1I["origin"]=G1I["clone"]();U1I["lat"]=(O1I+o1I)*0.5;U1I["lon"]=(t1I+J1I)*0.5;U1I["row"]=m1I["CmMathEngine"]["getRowFromLatitude"](U1I["lat"],Z1I);U1I["col"]=m1I["CmMathEngine"]["getColFromLongitude"](U1I["lon"],Z1I);U1I["west"]=t1I;U1I["east"]=J1I;U1I["south"]=O1I;U1I["north"]=o1I;U1I["NWPos"]=m1I["CmMathEngine"]["Geo2Cartesian"](t1I,o1I,p1I);U1I["NEPos"]=m1I["CmMathEngine"]["Geo2Cartesian"](J1I,o1I,p1I);U1I["SWPos"]=m1I["CmMathEngine"]["Geo2Cartesian"](t1I,O1I,p1I);U1I["SEPos"]=m1I["CmMathEngine"]["Geo2Cartesian"](J1I,O1I,p1I);U1I["key"]=U1I["row"]*10000000+U1I["col"];U1I["castShadow"]=true;U1I["receiveShadow"]=true;U1I["Earth"]=this;U1I["ground"]=true;U1I["position"]["set"](0,0,0);U1I["onBeforeRender"]=this["beforeRender"];this["earthTileList"][U1I["key"]]=U1I;j1I["add"](U1I);if(this["octree"]){this["octree"]["add"](U1I);}}}};V1I["prototype"]["beforeRender"]=function(P1I,B1I,q1I,Q1I,f1I,H5I){var N1I;N1I=m1I["CmWorld3"]["getInstance"]();};V1I["prototype"]["addVectorLayer"]=function(){};function V1I(){this["earthTileList"]=null;this["earthMaterial"]=null;this["octree"]=null;this["earthTileList"]=new Array();this["earthMaterial"]=null;try{this["octree"]=new THREE["Octree"]({undeferred:true,depthMax:Infinity,objectsThreshold:8,overlapPct:0.15});}catch(E1I){console["warn"](E1I);}}V1I["prototype"]["init"]=function(){this["setGlobalOption"]();};V1I["prototype"]["resetPolaimage"]=function(){var k5I,m5I;k5I=m1I["CmWorld3"]["getInstance"]();if(k5I["polar"]["polarImageOverlayEnable"]==true){m5I=this["earthMaterial"];if(m1I["Util"]["isDefined"](m5I["uniforms"]["polaimageenable"])){m5I["uniforms"]["polaimageenable"]["value"]=k5I["polar"]["polarImageOverlayEnable"];m5I["uniforms"]["polamaxradius"]["value"]=k5I["polar"]["polarImageMaxRadius"];m5I["uniforms"]["arcticmap"]["value"]=k5I["polar"]["arcticTexture"];m5I["uniforms"]["antarcticmap"]["value"]=k5I["polar"]["antarcticTexture"];}}};V1I["prototype"]["update"]=function(){};return V1I;}();m1I["EarthSC"]=L1I;}(CMWORLD||(CMWORLD={})));(function(L5I){var V5I;V5I=function(){E5I["setUserMouseButton"]=function(y5I,s5I){E5I["userLButton"]=y5I;E5I["userMButton"]=s5I;};E5I["prototype"]["preUpdate"]=function(){};E5I["prototype"]["afterUpdate"]=function(l5I,Y5I){if(L5I["Util"]["isDefined"](Y5I)){if(Y5I["userDrawHandler"]){Y5I["userDrawHandler"]["update"]();}}};E5I["resetEvents"]=function(){L5I["CmWorld3"]["getInstance"]()["mouse"]["attachEvents"](L5I["CmWorld3"]["getInstance"]()["canvas"]);};E5I["prototype"]["removeEvent"]=function(F5I){var r5I;r5I=this["cmworld3Viewer"]["canvas"];if(r5I){if(r5I["addEventListener"]){switch(F5I){case L5I["MouseEventType"]["down"]:r5I["removeEventListener"]("mousedown",this["doMouseDown"]);break;case L5I["MouseEventType"]["move"]:r5I["removeEventListener"]("mousemove",this["doMouseMove"]);break;case L5I["MouseEventType"]["up"]:r5I["removeEventListener"]("mouseup",this["doMouseUp"]);break;case L5I["MouseEventType"]["click"]:r5I["removeEventListener"]("click",this["doMouseClick"]);break;case L5I["MouseEventType"]["dblclick"]:r5I["removeEventListener"]("dblclick",this["doMouseDbClick"]);break;case L5I["MouseEventType"]["wheel"]:r5I["removeEventListener"]("mousewheel",this["doMouseWheel"]);r5I["removeEventListener"]("DOMMouseScroll",this["doMouseWheel"]);break;}}else if(r5I["attachEvent"]){switch(F5I){case L5I["MouseEventType"]["down"]:r5I["detachEvent"]('onmousedown',this["doMouseDown"]);break;}}else{switch(F5I){case L5I["MouseEventType"]["down"]:r5I["removeAttr"]("onmousedown");break;}}}};E5I["prototype"]["initUserDrawHandler"]=function(){if(L5I["Util"]["isDefined"](this["userDrawHandler"])==false){this["userDrawHandler"]=new L5I["UserDrawHandler"]();}};E5I["prototype"]["attachEvents"]=function(W5I){var G5I,U5I;G5I=L5I["CmWorld3"]["getInstance"]();this["cmworld3Viewer"]=G5I;U5I=this;if(W5I){try{if(W5I["addEventListener"]){W5I["addEventListener"]("mousedown",this["doMouseDown"]);W5I["addEventListener"]('mousemove',this["doMouseMove"]);W5I["addEventListener"]('mouseup',this["doMouseUp"]);W5I["addEventListener"]('click',this["doMouseClick"]);W5I["addEventListener"]('dblclick',this["doMouseDbClick"]);W5I["addEventListener"]("mousewheel",this["doMouseWheel"],false);W5I["addEventListener"]("DOMMouseScroll",this["doMouseWheel"],false);W5I["addEventListener"]('contextmenu',function(M5I){M5I["preventDefault"]();},false);W5I["addEventListener"]("touchstart",E5I["touchStart"],false);W5I["addEventListener"]("touchmove",E5I["touchMove"],false);W5I["addEventListener"]("touchend",E5I["touchEnd"],false);}else if(W5I["attachEvent"]){console["warn"]("CmMouse:attachEvents 2");W5I["attachEvent"]("mousedown",this["doMouseDown"]);W5I["attachEvent"]('mousemove',this["doMouseMove"]);W5I["attachEvent"]('mouseup',this["doMouseUp"]);W5I["attachEvent"]('click',this["doMouseClick"]);W5I["attachEvent"]('dblclick',this["doMouseDbClick"]);W5I["attachEvent"]("onmousewheel",this["doMouseWheel"]);W5I["attachEvent"]('oncontextmenu',function(){window["event"]["returnValue"]=false;});}else{console["warn"]("CmMouse:attachEvents 3");W5I["onmousedown"]=this["doMouseDown"];W5I["onmousemove"]=this["doMouseMove"];W5I["onmouseup"]=this["doMouseUp"];W5I["onclick"]=this["doMouseClick"];W5I["ondblclick"]=this["doMouseDbClick"];W5I["onmousewheel"]=this["doMouseWheel"];}}catch(C5I){console["error"](C5I);}}U5I["initUserDrawHandler"]();G5I["postUpdateEvent"]["addEventListener"](U5I["afterUpdate"],U5I);};E5I["touchStart"]=function(z5I){var A5I;A5I=z5I["changedTouches"];for(var D5I=0;D5I<A5I["length"];D5I++){E5I["touchesInAction"]["$"+A5I[D5I]["identifier"]]={identifier:A5I[D5I]["identifier"],pageX:A5I[D5I]["pageX"],pageY:A5I[D5I]["pageY"]};}};E5I["touchMove"]=function(R5I){var n5I,g5I;n5I=R5I["changedTouches"][0];g5I=parseInt(n5I["clientX"]);};E5I["touchEnd"]=function(t5I){var T5I,a5I;T5I=t5I["changedTouches"];for(var X5I=0;X5I<T5I["length"];X5I++){a5I=E5I["touchesInAction"]["$"+T5I[X5I]["identifier"]];a5I["dx"]=T5I[X5I]["pageX"]-a5I["pageX"];a5I["dy"]=T5I[X5I]["pageY"]-a5I["pageY"];}};E5I["prototype"]["setMouseMode"]=function(O5I){var o5I;o5I=this["cmworld3Viewer"];switch(O5I){case L5I["MouseMode"]["drawPoint"]:case L5I["MouseMode"]["drawCircle"]:case L5I["MouseMode"]["drawPolygon"]:case L5I["MouseMode"]["drawPolyline"]:case L5I["MouseMode"]["drawRectangle"]:case L5I["MouseMode"]["drawSimpleline"]:case L5I["MouseMode"]["drawSphere"]:case L5I["MouseMode"]["drawVolumePolygon"]:{this["userDrawHandler"]["setDrawMode"](O5I);this["mode"]=O5I;}break;default:this["userDrawHandler"]["setDrawMode"](L5I["MouseMode"]["normal"]);this["mode"]=L5I["MouseMode"]["normal"];break;}};E5I["prototype"]["isClick"]=function(Z5I){var J5I;J5I=5;return E5I["isEqualCoord"](this["downPosition"],Z5I,J5I);};E5I["isEqualCoord"]=function(i5I,p5I,x5I){if(x5I===void 0){x5I=0;}if(Math["abs"](i5I["x"]-p5I["x"])>x5I)return false;if(Math["abs"](i5I["y"]-p5I["y"])>x5I)return false;return true;};function E5I(){this["cmworld3Viewer"]=null;this["mode"]=L5I["MouseMode"]["normal"];this["userDrawHandler"]=null;this["pressedButton"]=L5I["MouseButton"]["Unknown"];this["lastTime"]=Date["now"]();this["downPosition"]=new THREE["Vector2"]();this["lastPosition"]=new THREE["Vector2"]();this["mouseDownEvent"]=new L5I["Event"](null);this["mouseUpEvent"]=new L5I["Event"](null);}E5I["getMouseButton"]=function(I5I){var S5I;I5I=I5I||window["event"];S5I=I5I["button"];if(S5I==L5I["MouseButton"]["LButton"])return L5I["MouseButton"]["LButton"];if(S5I==L5I["MouseButton"]["MButton"])return L5I["MouseButton"]["MButton"];if(S5I==L5I["MouseButton"]["RButton"])return L5I["MouseButton"]["RButton"];return L5I["MouseButton"]["Unknown"];};E5I["prototype"]["doMouseDown"]=function(w5I){var e5I,v5I,h5I,j5I;e5I=L5I["CmWorld3"]["getInstance"]();v5I=e5I["mouse"];w5I=w5I||window["event"];h5I=E5I["getMouseButton"](w5I);j5I=e5I["convertPagePosToCanvasPos"](w5I["pageX"],w5I["pageY"]);v5I["mouseDown"](h5I,j5I,w5I);};E5I["prototype"]["mouseDown"]=function(c5I,d5I,b5I){var K5I,u5I,N5I;K5I=this["cmworld3Viewer"];u5I=this;if(c5I==L5I["MouseButton"]["RButton"]){c5I=L5I["MouseButton"]["MButton"];}u5I["downPosition"]["x"]=d5I["x"];u5I["downPosition"]["y"]=d5I["y"];u5I["lastPosition"]["x"]=d5I["x"];u5I["lastPosition"]["y"]=d5I["y"];if(K5I["option"]["isDragging"]){}u5I["pressedButton"]=c5I;N5I=false;if(u5I["userDrawHandler"]){u5I["userDrawHandler"]["mouseDown"](b5I);}if(N5I==false){if(c5I!=null||c5I!=undefined){if(c5I==E5I["userLButton"]||c5I==E5I["userMButton"]){K5I["option"]["isDragging"]=true;}}}u5I["mouseDownEvent"]["raiseEvent"]({mouse:this,button:c5I,event:b5I});};E5I["prototype"]["doMouseUp"]=function(P5I){var B5I,q5I,Q5I,f5I;B5I=L5I["CmWorld3"]["getInstance"]();q5I=B5I["mouse"];Q5I=E5I["getMouseButton"](P5I);f5I=B5I["convertPagePosToCanvasPos"](P5I["pageX"],P5I["pageY"]);q5I["mouseUp"](Q5I,f5I,P5I);};E5I["prototype"]["mouseUp"]=function(k6I,E6I,m6I){var L6I,H6I,V6I;L6I=this["cmworld3Viewer"];H6I=this;H6I["pressedButton"]=L5I["MouseButton"]["Unknown"];if(k6I==L5I["MouseButton"]["RButton"]){k6I=L5I["MouseButton"]["MButton"];}L6I["option"]["isDragging"]=false;V6I=false;if(H6I["userDrawHandler"]){H6I["userDrawHandler"]["mouseUp"](m6I);}this["mouseUpEvent"]["raiseEvent"]({mouse:this,button:k6I,event:m6I});};E5I["prototype"]["doMouseMove"]=function(y6I){var s6I,Y6I,l6I;y6I=y6I||window["event"];s6I=L5I["CmWorld3"]["getInstance"]();Y6I=s6I["mouse"];l6I=s6I["convertPagePosToCanvasPos"](y6I["pageX"],y6I["pageY"]);Y6I["mouseMove"](Y6I["pressedButton"],l6I,y6I);};E5I["prototype"]["mouseMove"]=function(G6I,F6I,M6I){var W6I,r6I,C6I,U6I;W6I=this["cmworld3Viewer"];r6I=this;C6I=false;if(r6I["userDrawHandler"]){r6I["userDrawHandler"]["mouseMove"](M6I);}if(C6I==false){if(W6I["option"]["isDragging"]){if(G6I==E5I["userLButton"]){W6I["getCamera"]()["pan"](r6I["lastPosition"]["x"],r6I["lastPosition"]["y"],F6I["x"],F6I["y"]);}else if(G6I==E5I["userMButton"]){U6I=W6I["getCamera"]();if(M6I["ctrlKey"]){U6I["firstpersonRotate"](r6I["lastPosition"]["x"],r6I["lastPosition"]["y"],F6I["x"],F6I["y"]);}else{U6I["moveRotation"](r6I["lastPosition"]["x"],r6I["lastPosition"]["y"],F6I["x"],F6I["y"]);}}}}r6I["lastPosition"]["x"]=F6I["x"];r6I["lastPosition"]["y"]=F6I["y"];};E5I["prototype"]["doMouseClick"]=function(D6I){var A6I,z6I,n6I,R6I;A6I=L5I["CmWorld3"]["getInstance"]();z6I=A6I["mouse"];L5I["CmWorld"]["outputInfo"]("doMouseClick=page="+D6I["pageX"]+","+D6I["pageY"]);n6I=A6I["convertPagePosToCanvasPos"](D6I["pageX"],D6I["pageY"]);R6I=E5I["getMouseButton"](D6I);z6I["mouseClick"](R6I,n6I,D6I);};E5I["prototype"]["mouseClick"]=function(X6I,T6I,t6I){var a6I,g6I;a6I=this["cmworld3Viewer"];g6I=this;a6I["option"]["isDragging"]=false;if(X6I==L5I["MouseButton"]["RButton"]){X6I=L5I["MouseButton"]["MButton"];}L5I["CmWorld"]["outputInfo"]("mouseClick=mouseCanvasPt="+T6I["x"]+","+T6I["y"]);if(g6I["userDrawHandler"]){g6I["userDrawHandler"]["mouseClick"](t6I);}};E5I["prototype"]["doMouseDbClick"]=function(O6I){var o6I,J6I,Z6I;o6I=L5I["CmWorld3"]["getInstance"]();J6I=o6I["mouse"];Z6I=o6I["convertPagePosToCanvasPos"](O6I["pageX"],O6I["pageY"]);J6I["mouseDbClick"](null,Z6I,O6I);};E5I["prototype"]["mouseDbClick"]=function(p6I,I6I,x6I){var S6I,i6I;S6I=this["cmworld3Viewer"];i6I=this;S6I["option"]["isDragging"]=false;if(p6I==L5I["MouseButton"]["RButton"]){p6I=L5I["MouseButton"]["MButton"];}if(i6I["userDrawHandler"]){i6I["userDrawHandler"]["mouseDbClick"](x6I);}else{i6I["zoom"](3);}x6I["preventDefault"]();x6I["stopPropagation"]();x6I["returnValue"]=false;};E5I["prototype"]["doMouseWheel"]=function(w6I){var e6I,v6I,w6I,h6I;e6I=L5I["CmWorld3"]["getInstance"]();v6I=e6I["mouse"];w6I=window["event"]||w6I;h6I=Math["max"](-1,Math["min"](1,w6I["wheelDelta"]||-w6I["detail"]));v6I["zoom"](h6I);};E5I["prototype"]["zoom"]=function(d6I){var j6I,u6I,c6I;j6I=L5I["CmWorld3"]["getInstance"]();u6I=0;c6I=j6I["getCamera"]()["getAltitude"]();u6I=c6I*(d6I*0.1);if(c6I<100*j6I["option"]["GlobalScale"]){u6I=100*j6I["option"]["GlobalScale"]*(d6I*0.1);}j6I["getCamera"]()["Zoom"](u6I);};return E5I;}();V5I["userLButton"]=L5I["MouseButton"]["LButton"];V5I["userMButton"]=L5I["MouseButton"]["MButton"];V5I["userRButton"]=L5I["MouseButton"]["RButton"];V5I["touchesInAction"]={};L5I["CmMouse"]=V5I;}(CMWORLD||(CMWORLD={})));(function(K6I){var b6I;b6I=function(){N6I["moveCamera"]=function(q6I){var B6I,f6I,Q6I,P6I;if(q6I==undefined||q6I==null)return;B6I=K6I["CmWorld3"]["getInstance"]();f6I=B6I["getCamera"]();Q6I=B6I["getCamera"]()["getAltitude"]();P6I=0;if(q6I["pressed"]("up")){if(q6I["pressed"]("shift+up")){f6I["headDown"](1);}else{P6I=Q6I;if(Q6I<10*B6I["option"]["GlobalScale"]){P6I=10*B6I["option"]["GlobalScale"];}P6I=P6I*K6I["CmMathEngine"]["Tan30"]*0.03;f6I["moveToward"](P6I);}}if(q6I["pressed"]("down")){if(q6I["pressed"]("shift+down")){f6I["headDown"](-1);}else{P6I=Q6I;if(Q6I<10*B6I["option"]["GlobalScale"]){P6I=10*B6I["option"]["GlobalScale"];}P6I=P6I*K6I["CmMathEngine"]["Tan30"]*0.03;f6I["moveToward"](-P6I);}}if(q6I["pressed"]("left")){if(q6I["pressed"]("shift+left")){}else{P6I=Q6I;if(Q6I<10*B6I["option"]["GlobalScale"]){P6I=10*B6I["option"]["GlobalScale"];}P6I=P6I*K6I["CmMathEngine"]["Tan30"]*0.03;f6I["moveRight"](-P6I);}}if(q6I["pressed"]("right")){if(q6I["pressed"]("shift+right")){}else{P6I=Q6I;if(Q6I<10*B6I["option"]["GlobalScale"]){P6I=10*B6I["option"]["GlobalScale"];}P6I=P6I*K6I["CmMathEngine"]["Tan30"]*0.03;f6I["moveRight"](P6I);}}if(q6I["pressed"]("plus")||q6I["pressed"]("numplus")){P6I=Q6I*0.1;if(Q6I<100*B6I["option"]["GlobalScale"]){P6I=100*B6I["option"]["GlobalScale"]*0.1;}f6I["Zoom"](P6I*0.1);}if(q6I["pressed"]("minus")||q6I["pressed"]("numminus")){P6I=Q6I*0.1;if(Q6I<100*B6I["option"]["GlobalScale"]){P6I=100*B6I["option"]["GlobalScale"]*0.1;}f6I["Zoom"](-P6I*0.1);}};function N6I(){}return N6I;}();K6I["CmKeyboard"]=b6I;}(CMWORLD||(CMWORLD={})));(function(H9I){var k9I;k9I=function(){m9I["prototype"]["checkFpsCounter"]=function(){return this["fpsCounter"]["isstarted"]==true;};m9I["prototype"]["updateFpsCounter"]=function(){this["fpsCounter"]["update"]();};m9I["prototype"]["getFpsCounterString"]=function(){return this["fpsCounter"]["fpsStr"];};m9I["prototype"]["writeFrameID"]=function(){++this["renderFrameID"];this["renderFrameTime"]=Date["now"]();};m9I["prototype"]["showFPS"]=function(L9I){if(L9I==true){if(this["fpsCounter"]["isstarted"]==false){this["fpsCounter"]["start"]();}}else{if(this["fpsCounter"]["isstarted"]==true){this["fpsCounter"]["stop"]();}}};m9I["prototype"]["init"]=function(){var V9I;V9I=new THREE["TextureLoader"]();this["waterNormals"]=V9I["load"](H9I["GlobalOption"]["texturesURL"]+'waternormals.jpg');this["waterNormals"]["wrapS"]=this["waterNormals"]["wrapT"]=THREE["RepeatWrapping"];V9I=new THREE["TextureLoader"]();this["emptyTex"]=V9I["load"](H9I["GlobalOption"]["texturesURL"]+"empty.png");this["emptyTex"]["minFilter"]=THREE["LinearFilter"];};m9I["prototype"]["initLight"]=function(s9I){var E9I,y9I;if(H9I["Util"]["isDefined"](this["sunLight"])==false){this["hemiLight"]=new THREE["AmbientLight"](0xffffff);this["hemiLight"]["intensity"]=0.15;this["sunLight"]=new THREE["DirectionalLight"](0xffffff,1);this["earthCenter"]=new THREE["Object3D"]();this["sunLight"]["target"]=this["earthCenter"];E9I=H9I["SunCalculator"]["getPosition"](new Date());E9I["sub"](this["refCenter"]);this["sunLight"]["position"]["set"](E9I["x"],E9I["y"],E9I["z"]);this["sunLight"]["position"]["normalize"]();this["sunLight"]["shadow"]["camera"]["visible"]=false;this["sunLight"]["castShadow"]=true;if(this["sunLight"]["shadow"]["camera"]instanceof THREE["PerspectiveCamera"]){this["sunLight"]["shadow"]["camera"]["near"]=1;this["sunLight"]["shadow"]["camera"]["far"]=H9I["cm_const"]["EarthRadius"]*3;this["sunLight"]["shadow"]["camera"]["fov"]=45;}if(this["sunLight"]["shadow"]["camera"]instanceof THREE["OrthographicCamera"]){y9I=1000;this["sunLight"]["shadow"]["camera"]["left"]=-y9I;this["sunLight"]["shadow"]["camera"]["right"]=y9I;this["sunLight"]["shadow"]["camera"]["top"]=y9I;this["sunLight"]["shadow"]["camera"]["bottom"]=-y9I;}this["sunLight"]["shadow"]["bias"]=-0.0001;this["sunLight"]["shadow"]["darkness"]=0.01;this["sunLight"]["shadow"]["mapSize"]["width"]=this["SHADOW_MAP_WIDTH"];this["sunLight"]["shadow"]["mapSize"]["height"]=this["SHADOW_MAP_HEIGHT"];if(this["_enableSunLight"]==true){}}s9I["add"](this["hemiLight"]);if(this["_enableSunLight"]==true){this["enableSunLight"](true,s9I);}};m9I["prototype"]["enableSunLight"]=function(r9I,Y9I){var l9I;if(H9I["Util"]["isDefined"](Y9I)==false)return;this["_enableSunLight"]=r9I;if(this["_enableSunLight"]==true){l9I=Y9I["children"]["indexOf"](this["sunLight"]);if(l9I<0){Y9I["add"](this["sunLight"]);Y9I["add"](this["sunLight"]["target"]);}}else{Y9I["remove"](this["sunLight"]);Y9I["remove"](this["sunLight"]["target"]);}};m9I["prototype"]["rentAmbiguousWorker"]=function(){if(this["ModelWorker"]!=null)return this["ModelWorker"];this["ModelWorker"]=new Worker(m9I["workerLibraryURL"]+"cm_ambiguousworker.js");return this["ModelWorker"];};m9I["prototype"]["getDXTImageWorker"]=function(){if(this["dxtImageWorker"]!=null)return this["dxtImageWorker"];this["dxtImageWorker"]=new Worker(m9I["workerLibraryURL"]+'DXTImageWorker.js');return this["dxtImageWorker"];};m9I["prototype"]["getDDSLoadWorker"]=function(){if(this["ddsLoadWorker"]!=null)return this["ddsLoadWorker"];this["ddsLoadWorker"]=new Worker(m9I["workerLibraryURL"]+'ddsloadworker.js');return this["ddsLoadWorker"];};m9I["prototype"]["getTextureDownloadWorker"]=function(){if(this["textureDownloadWorker"]!=null)return this["textureDownloadWorker"];this["textureDownloadWorker"]=new Worker(m9I["workerLibraryURL"]+"cm_texturedownloadworker.js");return this["textureDownloadWorker"];};m9I["prototype"]["getCMVImageWorker"]=function(){if(this["cmvImageWorker"]!=null)return this["cmvImageWorker"];this["cmvImageWorker"]=new Worker(m9I["workerLibraryURL"]+"cm_cmvimageworker.js");return this["cmvImageWorker"];};function m9I(){this["mapServiceType"]=H9I["MapServiceType"]["CMWORLD"];this["sunLight"]=null;this["sunLightHelper"]=null;this["sunLightCameraHelper"]=null;this["_enableSunLight"]=true;this["hemiLight"]=null;this["earth"]=null;this["GlobalScale"]=1.0;this["fpsCounter"]=new FPS();this["showCanvasArea"]=false;this["FPS"]=60;this["FPS_time"]=Date["now"]();this["EarthRadius"]=H9I["cm_const"]["EarthRadius"]*this["GlobalScale"];this["maxAltitude"]=this["EarthRadius"]*4.5;this["refCenter"]=new THREE["Vector3"](0,0,0);this["SceneMode"]=H9I["SceneModeType"]["SCENE_S3D"];this["startupPosition"]=new THREE["Vector3"](0,0,this["EarthRadius"]*2);this["startupHead"]=0;this["startupTilt"]=0;this["GUI"]=null;this["isDragging"]=false;this["tileVertexWidth"]=64;this["shadowMapEnabled"]=false;this["SHADOW_MAP_WIDTH"]=4096;this["SHADOW_MAP_HEIGHT"]=4096;this["enablePreciseTerrainCoordinate"]=false;this["waterNormals"]=null;this["useXY"]=false;this["tileCountOnScreen"]=2;this["MaxLevel"]=20;this["TileLevelRange"]=null;this["displayDist4Level"]=null;this["maxDisplayLevel"]=0;this["tileCountDrawn"]=0;this["quadImageCompressed"]=false;this["vectorImageLayerManager"]=new H9I["VectorImageMapManager"]();this["mainCamera"]=null;this["limitPolarUpdate"]=80;this["enableCameraMoveKey"]=true;this["deltaTime"]=0;this["lastTime"]=new Date()["getTime"]();this["ShaderLoaded"]=false;this["ShaderCount"]=0;this["UseWireFrame"]=false;this["Shader"]=[];this["emptyTex"]=null;this["useRefCameraMode"]=true;this["DrawTileNumber"]=false;this["Objects"]=[];this["atmosphereEnabled"]=false;this["Atmosphere"]=null;this["VerticalExaggeration"]=1.0;this["viewTileInfo"]=false;this["skyColor"]=0x739bb9;this["showUnderGround"]=false;this["waterNormal"]=null;this["anaglyphMode"]=false;this["basePass"]=null;this["skyPass"]=null;this["latLonGrid"]=new H9I["LatLonGridLine"]();this["diagnosticLog"]=true;this["worldUpAxis"]=new THREE["Vector3"](0,1,0);this["ModelWorker"]=null;this["dxtImageWorker"]=null;this["ddsLoadWorker"]=null;this["textureDownloadWorker"]=null;this["cmvImageWorker"]=null;this["jobManager"]=new H9I["JobManager"]();this["worldTimer"]=new H9I["CmWorldTimer"](2000,7,12,14,0,0,0);this["temp_JobTile"]=null;this["renderFrameID"]=0;this["renderFrameTime"]=Date["now"]();this["frameTime"]=Date["now"]();this["frameElapsedTime"]=0;this["CMVTaskInterval"]=10;this["terrainTransparency"]=false;this["terrainOpacity"]=1.0;}m9I["prototype"]["setMapSetting"]=function(D9I,M9I,G9I,C9I){var W9I,U9I;this["useXY"]=D9I;this["TileLevelRange"]=[];for(var F9I=0;F9I<M9I;F9I++){this["TileLevelRange"]["push"](G9I/Math["pow"](2.0,F9I));}this["displayDist4Level"]=[];W9I=0;if(this["useXY"]==true){W9I=G9I*C9I*0.5*H9I["CmMathEngine"]["Tan60"];}else{W9I=2.0*this["EarthRadius"]*H9I["CmMathEngine"]["PI"]*G9I/360.0*C9I*0.5*H9I["CmMathEngine"]["Tan60"];}U9I=0;for(var F9I=0;F9I<M9I;F9I++){if(F9I==0){this["displayDist4Level"]["push"](W9I*1.5);}else if(F9I<8){U9I=1.9+1.0/Math["pow"](2.0,F9I);this["displayDist4Level"]["push"](W9I/Math["pow"](U9I,F9I));}else{U9I=1.83;this["displayDist4Level"]["push"](W9I/Math["pow"](U9I,F9I));}}};m9I["prototype"]["getDislayDist4Level"]=function(A9I){if(A9I<0)A9I=0;return this["displayDist4Level"][A9I];};m9I["prototype"]["loadShaderScripts"]=function(){this["loadShaderScripts2"]([H9I["GlobalOption"]["shaderURL"]+"defaultvs.glsl","defaultvs",H9I["GlobalOption"]["shaderURL"]+"defaultfs.glsl","defaultfs",H9I["GlobalOption"]["shaderURL"]+"skyfs.glsl","skyfs",H9I["GlobalOption"]["shaderURL"]+"skyvs.glsl","skyvs",H9I["GlobalOption"]["shaderURL"]+"imageoverlayvb.glsl","imageoverlayvb",H9I["GlobalOption"]["shaderURL"]+"imageoverlayps.glsl","imageoverlayps",H9I["GlobalOption"]["shaderURL"]+"atmosphere_vertexsky.glsl","atmosphereskyvb",H9I["GlobalOption"]["shaderURL"]+"atmosphere_fragmentsky.glsl","atmosphereskyps",H9I["GlobalOption"]["shaderURL"]+"atmosphere_vertexground.glsl","atmospheregroundvb",H9I["GlobalOption"]["shaderURL"]+"atmosphere_fragmentground.glsl","atmospheregroundps"]);};m9I["prototype"]["loadShaderScripts2"]=function(R9I,g9I){var z9I;if(g9I===void 0){g9I=null;}this["ShaderCount"]=R9I["length"]/2;if(this["ShaderCount"]==0){this["ShaderLoaded"]=true;return;}for(var n9I=0;n9I<R9I["length"];n9I+=2){z9I=H9I["NetWork"]["createCORSRequest"]("GET",R9I[n9I],false,"text");if(z9I){z9I["send"]();if(z9I["readyState"]==H9I["xHttp_readyState"]["finished"]&&z9I["status"]==H9I["HttpStatusCode"]["OK"]){this["Shader"][R9I[n9I+1]]=z9I["responseText"];this["ShaderCount"]--;}}}if(this["ShaderCount"]==0){this["ShaderLoaded"]=true;}else{alert("CmWorld : Failure Shader Load");}};m9I["setResourceInfo"]=function(X9I){if(X9I===void 0){X9I=null;}if(X9I&&X9I["CmWorld3BaseURL"]){m9I["cmworld3BaseRoot"]=X9I["CmWorld3BaseURL"];}else{m9I["cmworld3BaseRoot"]=H9I["Compile"]["cmworld3BaseURL"];H9I["CmWorld"]["outputInfo"]("Cmworld3BaseRoot is "+m9I["cmworld3BaseRoot"]);}if(X9I&&X9I["earthBaseImageURL"]){m9I["earthBaseImageURL"]=X9I["earthBaseImageURL"];}else{m9I["earthBaseImageURL"]="textures/EarthMap.jpg";}if(X9I&&X9I["texturesURL"]){m9I["texturesURL"]=X9I["texturesURL"];}else{m9I["texturesURL"]="textures/";}if(X9I&&X9I["workerLibraryURL"]){m9I["workerLibraryURL"]=X9I["workerLibraryURL"];}else{m9I["workerLibraryURL"]="Worker/";}if(X9I&&X9I["shaderURL"]){m9I["shaderURL"]=X9I["shaderURL"];}else{m9I["shaderURL"]="shader/";}m9I["earthBaseImageURL"]=H9I["CmEtcUtil"]["relativePath2AbsolutePath"](m9I["cmworld3BaseRoot"],m9I["earthBaseImageURL"]);m9I["texturesURL"]=H9I["CmEtcUtil"]["relativePath2AbsolutePath"](m9I["cmworld3BaseRoot"],m9I["texturesURL"]);m9I["workerLibraryURL"]=H9I["CmEtcUtil"]["relativePath2AbsolutePath"](m9I["cmworld3BaseRoot"],m9I["workerLibraryURL"]);m9I["shaderURL"]=H9I["CmEtcUtil"]["relativePath2AbsolutePath"](m9I["cmworld3BaseRoot"],m9I["shaderURL"]);};return m9I;}();k9I["cmworld3BaseRoot"]=null;k9I["earthBaseImageURL"]="textures/EarthMap.jpg";k9I["texturesURL"]="textures/";k9I["workerLibraryURL"]="Worker/";k9I["shaderURL"]="shader/";k9I["userSetCameraNear"]=null;H9I["GlobalOption"]=k9I;}(CMWORLD||(CMWORLD={})));(function(T9I){var a9I;a9I=function(){t9I["prototype"]["dispose"]=function(){};Object["defineProperty"](t9I["prototype"],"baseImageLayer",{get:function(){return this["baseQuadImageLayer"];},enumerable:true,configurable:true});t9I["prototype"]["reDrawOverlayMap"]=function(){if(T9I["Util"]["isDefined"](this["baseImageLayer"])){this["baseImageLayer"]["reDrawOverlayMap"]();}};t9I["prototype"]["confirmBrowser"]=function(){if(T9I["Browser"]["isSafari"]()){}};t9I["getInstance"]=function(){{return T9I["CmWorld3"]["cmworld3Instance"];}};t9I["prototype"]["checkCanvasSize"]=function(){var b9I;if(this["windowResizeCallback"]!=null){b9I=this["windowResizeCallback"]();this["updateCanvasSize"](b9I["width"],b9I["height"]);}else{this["updateCanvasSize"](window["innerWidth"],window["innerHeight"]);}};t9I["prototype"]["enableCubeGroup"]=function(N9I){this["cubeGroupLayer"]["enableCubeGroup"](N9I);};t9I["prototype"]["getBaseQuadImageLayer"]=function(){return this["baseQuadImageLayer"];};t9I["prototype"]["getBaseQuadTerrainLayer"]=function(){for(var P9I in this["quadTerrainLayerList"]){return this["quadTerrainLayerList"][P9I];}return null;};t9I["prototype"]["getCubeGroupLayer"]=function(B9I){return this["cubeGroupLayerList"][B9I];};t9I["prototype"]["resetLayers"]=function(){for(var q9I in this["poi3DLayerArray"]){this["poi3DLayerArray"][q9I]["dispose"]();}this["poi3DLayerArray"]=[];for(var q9I in this["userObjectLayer"]){this["userObjectLayer"][q9I]["dispose"]();}this["userObjectLayer"]=[];for(var q9I in this["ovelayImageTileLayerList"]){this["ovelayImageTileLayerList"][q9I]["dispose"]();}this["ovelayImageTileLayerList"]=[];for(var q9I in this["vectorTileLayerList"]){this["vectorTileLayerList"][q9I]["dispose"]();}this["vectorTileLayerList"]=[];for(var q9I in this["vectorImageTileLayerList"]){this["vectorImageTileLayerList"][q9I]["dispose"]();}this["vectorImageTileLayerList"]=[];this["cubeGroupLayerList"]=[];for(var q9I in this["cube3DLayerList"]){this["cube3DLayerList"][q9I]["dispose"]();}for(var q9I in this["etcLayerList"]){this["etcLayerList"][q9I]["dispose"]();}this["etcLayerList"]=[];};t9I["prototype"]["addLayer"]=function(Q9I){if(Q9I instanceof T9I["POI3DLayer"]){this["poi3DLayerArray"][Q9I["name"]]=Q9I;}else if(Q9I instanceof T9I["UserObjectLayer"]){this["userObjectLayer"][Q9I["name"]]=Q9I;}else if(Q9I instanceof T9I["OverlayImageTileLayer"]){this["ovelayImageTileLayerList"][Q9I["name"]]=Q9I;}else if(Q9I instanceof T9I["QuadImageLayer"]){if(T9I["Util"]["isDefined"](this["baseQuadImageLayer"])){}this["baseQuadImageLayer"]=Q9I;}else if(Q9I instanceof T9I["VectorTileLayer"]){this["vectorTileLayerList"][Q9I["name"]]=Q9I;}else if(Q9I instanceof T9I["VectorImageTileLayer"]){this["vectorImageTileLayerList"][Q9I["name"]]=Q9I;}else if(Q9I instanceof T9I["QuadTerrainLayer"]){this["quadTerrainLayerList"][Q9I["name"]]=Q9I;}else if(Q9I instanceof T9I["CubeGroupLayer"]){this["cubeGroupLayerList"][Q9I["name"]]=Q9I;}else if(Q9I instanceof T9I["Cube3DLayer"]){this["cube3DLayerList"][Q9I["name"]]=Q9I;}else{this["etcLayerList"][Q9I["name"]]=Q9I;}};t9I["prototype"]["getVectorImageTileLayers"]=function(){return this["vectorImageTileLayerList"];};t9I["prototype"]["getLayer"]=function(H0I){var f9I;f9I=this["vectorTileLayerList"][H0I];if(T9I["Util"]["isDefined"](f9I))return f9I;f9I=this["userObjectLayer"][H0I];if(f9I)return f9I;f9I=this["poi3DLayerArray"][H0I];if(f9I)return f9I;f9I=this["vectorImageTileLayerList"][H0I];if(f9I)return f9I;f9I=this["ovelayImageTileLayerList"][H0I];if(f9I)return f9I;f9I=this["quadTerrainLayerList"][H0I];if(f9I)return f9I;f9I=this["cubeGroupLayerList"][H0I];if(f9I)return f9I;f9I=this["cube3DLayerList"][H0I];if(f9I)return f9I;f9I=this["etcLayerList"][H0I];if(f9I)return f9I;return null;};t9I["prototype"]["removeLayer"]=function(k0I){if(T9I["Util"]["isDefined"](k0I)==false)return;if(typeof k0I==='string'){k0I=this["getLayer"](k0I);}this["removeLayerEx"](k0I,null);};t9I["prototype"]["removeLayerEx"]=function(L0I,V0I){var m0I;if(T9I["Util"]["isDefined"](L0I)==false)return;m0I=this["etcLayerList"][L0I["name"]];if(m0I){if(T9I["Util"]["isFuncDefined"](m0I["dispose"]))m0I["dispose"]();delete this["etcLayerList"][L0I["name"]];return;}m0I=this["vectorTileLayerList"][L0I["name"]];if(m0I){if(T9I["Util"]["isFuncDefined"](m0I["dispose"]))m0I["dispose"]();delete this["vectorTileLayerList"][L0I["name"]];return;}m0I=this["vectorImageTileLayerList"][L0I["name"]];if(m0I){if(T9I["Util"]["isFuncDefined"](m0I["dispose"]))m0I["dispose"]();delete this["vectorImageTileLayerList"][L0I["name"]];return;}m0I=this["userObjectLayer"][L0I["name"]];if(m0I){if(T9I["Util"]["isFuncDefined"](m0I["dispose"]))m0I["dispose"]();delete this["userObjectLayer"][L0I["name"]];return;}m0I=this["poi3DLayerArray"][L0I["name"]];if(m0I){if(T9I["Util"]["isFuncDefined"](m0I["dispose"]))m0I["dispose"]();delete this["poi3DLayerArray"][L0I["name"]];return;}m0I=this["ovelayImageTileLayerList"][L0I["name"]];if(m0I){if(T9I["Util"]["isFuncDefined"](m0I["dispose"]))m0I["dispose"]();delete this["ovelayImageTileLayerList"][L0I["name"]];this["quadTileLayer"]["removeOverlayImageLayer"](null);return;}m0I=this["quadTerrainLayerList"][L0I["name"]];if(m0I){if(T9I["Util"]["isFuncDefined"](m0I["dispose"]))m0I["dispose"]();delete this["quadTerrainLayerList"][L0I["name"]];return;}m0I=this["cube3DLayerList"][L0I["name"]];if(m0I){if(T9I["Util"]["isFuncDefined"](m0I["dispose"]))m0I["dispose"]();delete this["cube3DLayerList"][L0I["name"]];return;}};t9I["prototype"]["makeColorMaterialFromColor"]=function(E0I){var y0I;if(!E0I){E0I=0x0f0f0f;}y0I=new THREE["MeshPhongMaterial"]({color:E0I,specular:0,shininess:1,side:THREE["FrontSide"]});T9I["Material"]["addClippingAttri"](y0I);return y0I;};t9I["prototype"]["initMap"]=function(){var s0I,F0I,r0I,Y0I,l0I;this["option"]["init"]();if(this["option"]["shadowMapEnabled"]==true){this["renderer"]["shadowMap"]["enabled"]=true;this["renderer"]["shadowMap"]["type"]=THREE["PCFShadowMap"];}this["option"]["initLight"](this["rootScene"]);this["getInternalCamera"]()["attachToScene"](this["rootScene"]);this["rootScene"]["add"](this["spaceScene"]);this["rootScene"]["add"](this["skyScene"]);this["rootScene"]["add"](this["earthSurfaceScene"]);this["rootScene"]["add"](this["terrainScene"]);this["rootScene"]["add"](this["userScene"]);this["rootScene"]["add"](this["instantScene"]);this["rootScene"]["add"](this["groundScene"]);this["rootScene"]["add"](this["cube3DScene"]);this["rootScene"]["add"](this["SystemScene"]);this["option"]["earth"]=new T9I["EarthSC"]();this["option"]["earth"]["makeEarthTile"]();s0I=this["camera"];s0I["initPosition"](this["option"]["startupPosition"]["x"],this["option"]["startupPosition"]["y"],T9I["cm_const"]["EarthRadius"],this["option"]["startupHead"],this["option"]["startupTilt"]);s0I["distanceFromLook"]=this["option"]["startupPosition"]["z"];F0I={minFilter:THREE["LinearMipMapLinearFilter"],magFilter:THREE["LinearFilter"],format:THREE["RGBAFormat"],stencilBuffer:true};this["composer"]=new THREE["EffectComposer"](this["renderer"]);{r0I=new T9I["CmSpacePass"]();this["composer"]["addPass"](r0I);Y0I=new T9I["CmBasePass"]();this["composer"]["addPass"](Y0I);l0I=new T9I["HUDPass"]();this["composer"]["addPass"](l0I);this["option"]["basePass"]=Y0I;this["hudPass"]=l0I;}s0I["commit"]();this["initializedMap"]=true;};t9I["prototype"]["getHUDPass"]=function(){return this["hudPass"];};t9I["prototype"]["getScreenLayerCanvasContext"]=function(){return this["hudPass"]["hudContext"];};t9I["prototype"]["getWorldScene"]=function(){return this["rootScene"];};t9I["prototype"]["getTerrainScene"]=function(){return this["terrainScene"];};t9I["prototype"]["getEarthSurfaceScene"]=function(){return this["earthSurfaceScene"];};t9I["prototype"]["getSkyScene"]=function(){return this["skyScene"];};t9I["prototype"]["getSpaceScene"]=function(){return this["spaceScene"];};t9I["prototype"]["getUserScene"]=function(){return this["userScene"];};t9I["prototype"]["getInstantScene"]=function(){return this["instantScene"];};t9I["prototype"]["getGroundScene"]=function(){return this["groundScene"];};t9I["prototype"]["getCube3DScene"]=function(){return this["cube3DScene"];};t9I["prototype"]["getSystemScene"]=function(){return this["SystemScene"];};t9I["prototype"]["gotoGeo"]=function(W0I,U0I,G0I){if(T9I["Util"]["isDefined"](this["camera"])){this["camera"]["gotoGeo"](W0I,U0I,G0I);}};t9I["prototype"]["gotoLookAt"]=function(C0I,D0I,A0I,z0I,n0I,R0I){var M0I;if(T9I["Util"]["isDefined"](this["camera"])){M0I=this["camera"];M0I["gotoTarget"](z0I,n0I,R0I,C0I,D0I,A0I);}};t9I["prototype"]["setSceneMode"]=function(O0I){var T0I,a0I,X0I,t0I,o0I,J0I,Z0I,x0I,g0I;if(this["initializedMap"]==false){return;}T0I=this["option"]["SceneMode"];if(T0I==O0I){return;}a0I=this["getTerrainScene"]();a0I["children"]["length"]=0;this["resumeRendering"]=true;X0I=this["camera"];t0I=this["camera"]["getPositionGeo"]()["y"];o0I=this["camera"]["getPositionGeo"]()["x"];J0I=this["camera"]["getPositionGeo"]()["z"];Z0I=X0I["head"];x0I=X0I["tilt"];T9I["CmMathEngine"]["setSceneMode"](O0I);if(T9I["Util"]["isDefined"](this["camera"])){this["camera"]["detachToScene"](this["rootScene"]);}if(this["option"]["SceneMode"]==T9I["SceneModeType"]["SCENE_S3D"]){this["option"]["mainCamera"]=new T9I["CmCameraGlobe"](this);}else if(this["option"]["SceneMode"]==T9I["SceneModeType"]["SCENE_P3D"]){this["option"]["mainCamera"]=new T9I["CmCameraFlat3D"]();}this["option"]["earth"]["makeEarthTile"]();X0I["initPosition"](o0I,t0I,J0I,Z0I,x0I);this["quadTileLayer"]["removeTopTiles"]();g0I=T9I["SunCalculator"]["getPosition"](this["option"]["worldTimer"]["now"]());g0I["sub"](this["option"]["refCenter"]);this["option"]["sunLight"]["position"]["set"](g0I["x"],g0I["y"],g0I["z"]);this["resumeRendering"]=false;};t9I["prototype"]["showAxis"]=function(i0I){if(i0I===void 0){i0I=true;}if(this["cmAxis3D"]==null){if(i0I===true){this["cmAxis3D"]=new CmAxis3D();this["cmAxis3D"]["init"](this["rootScene"]);}}};t9I["prototype"]["addBaseImageLayer"]=function(I0I,w0I,e0I,v0I,h0I,j0I,u0I,p0I,S0I){if(p0I===void 0){p0I=T9I["FileFormat"]["_jpg"];}if(S0I===void 0){S0I=false;}this["addTileImageLayer"]("baseImageLayer",I0I,w0I,e0I,v0I,h0I,j0I,u0I,p0I,S0I);};t9I["prototype"]["addTileImageLayer"]=function(B0I,K0I,b0I,N0I,P0I,H74,q0I,Q0I,f0I,c0I){var d0I;if(c0I){this["option"]["quadImageCompressed"]=c0I;}d0I=T9I["Map"]["createQuadImageLayer"](B0I,K0I,b0I,N0I,P0I,H74,q0I,Q0I,f0I,c0I);this["addLayer"](d0I);};t9I["prototype"]["addOverlayImageLayer"]=function(s74,L74,V74,E74,y74,W74,Y74,l74,r74,F74,k74){var m74;if(k74===void 0){k74=false;}m74=T9I["Map"]["createOverlayImageLayer"](s74,L74,V74,E74,y74,W74,Y74,l74,r74,F74,k74);this["addLayer"](m74);};t9I["prototype"]["addTerrainLayer"]=function(U74,G74,M74,C74,D74,A74,z74,n74,R74){this["addLayer"](T9I["Map"]["createTerrainLayer"](U74,G74,M74,C74,D74,A74,z74,n74,R74));};t9I["prototype"]["addCubeGroupLayer"]=function(X74,T74,a74,t74,O74){var g74;g74=T9I["Map"]["createCubeGroupLayer"](X74,T74,a74,t74,O74);this["cubeGroupLayer"]=g74;this["addLayer"](g74);return g74;};t9I["prototype"]["addCube3DLayer"]=function(p74,Z74,x74,i74,J74,S74,I74,w74,e74){var o74;o74=T9I["Map"]["createCube3DLayer"](p74,Z74,x74,i74,J74,S74,I74,w74,e74);this["addLayer"](o74);return o74;};t9I["prototype"]["addVectorLayer"]=function(b74,f74,u74,c74,d74,K74,Q74,N74,P74,B74,q74,h74,j74){var v74;if(h74===void 0){h74=null;}if(j74===void 0){j74=[];}v74=T9I["Map"]["createVectorLayer"](b74,f74,u74,c74,d74,K74,h74,Q74,N74,P74,B74,q74,j74);this["addLayer"](v74);return v74;};t9I["prototype"]["addVectorImageLayer"]=function(y34,m34,L34,V34,E34,k34,s34,Y34,l34,r34,F34){var H34;H34=T9I["Map"]["createVectorImageTileLayer"](y34,m34,L34,V34,E34,k34,s34,Y34,l34,r34,F34);this["addLayer"](H34);return H34;};t9I["prototype"]["getVectorImageLayerStyle"]=function(W34){return this["option"]["vectorImageLayerManager"]["getLayerStyle"](W34);};t9I["prototype"]["getVectorImageLayerVisible"]=function(U34){return this["option"]["vectorImageLayerManager"]["getLayerVisible"](U34);};t9I["prototype"]["setVectorImageLayerVisible"]=function(G34,M34){this["option"]["vectorImageLayerManager"]["setLayerVisible"](G34,M34);this["quadTileLayer"]["resetVectorImage"]();};t9I["prototype"]["setVectorImageSubLayerVisible"]=function(C34,D34,A34){this["option"]["vectorImageLayerManager"]["setSubLayerVisible"](C34,D34,A34);};t9I["prototype"]["getVectorImageSubLayerVisible"]=function(z34,n34){return this["option"]["vectorImageLayerManager"]["getSubLayerVisible"](z34,n34);};t9I["prototype"]["redrawVectorImageLayer"]=function(R34){this["quadTileLayer"]["redrawVectorImageLayer"]();};t9I["prototype"]["addReal3DLayer"]=function(o34,T34,a34,t34,O34,X34,J34,Z34,x34,i34,p34){var g34;g34=T9I["Map"]["createReal3DLayer"](o34,T34,a34,t34,O34,X34,J34,Z34,x34,i34,p34);this["addLayer"](g34);return g34;};t9I["prototype"]["addVWPOILayer"]=function(j34,w34,e34,v34,h34,I34,u34,c34,d34,K34,b34){var S34;S34=T9I["Map"]["createVWPOILayer"](j34,w34,e34,v34,h34,I34,u34,c34,d34,K34,b34);this["addLayer"](S34);return S34;};t9I["prototype"]["addOverlayImage"]=function(P34,B34,q34,Q34,f34,H84,k84,m84,L84){var N34;N34=new T9I["OverlayImage"](P34,B34,q34,Q34,f34,H84,k84,m84,L84);this["overlayImages"][P34]=N34;};t9I["prototype"]["getQuadTileLayer"]=function(){return this["quadTileLayer"];};t9I["prototype"]["genTerrainGeometry"]=function(r84,F84,W84,U84){var y84,l84,E84,Y84,G84;y84=null;l84=this["quadTileLayer"]["findHighestTileInBound"](r84,F84,W84,U84);for(var s84=0;s84<l84["length"];s84++){E84=l84[s84]["getMeshArray"]();for(var V84=0;V84<E84["length"];V84++){if(y84==null)y84=new THREE["Geometry"]();Y84=new THREE["Geometry"]();Y84=Y84["fromBufferGeometry"](E84[V84]["geometry"]);G84=E84[V84]["position"]["clone"]();E84[V84]["position"]["x"]+=this["option"]["refCenter"]["x"];E84[V84]["position"]["y"]+=this["option"]["refCenter"]["y"];E84[V84]["position"]["z"]+=this["option"]["refCenter"]["z"];E84[V84]["updateMatrix"]();y84["merge"](Y84,E84[V84]["matrix"]);break;}break;}return y84;};t9I["prototype"]["resetQuadTile"]=function(){this["quadTileLayer"]["resetLayer"]();};t9I["prototype"]["removeTopTiles"]=function(){var M84;M84=this["getTerrainScene"]();M84["children"]["length"]=0;this["quadTileLayer"]["removeTopTiles"]();};t9I["prototype"]["removeVectorImageLayer"]=function(C84){this["option"]["vectorImageLayerManager"]["remove"](C84);this["quadTileLayer"]["removeOverlayImageLayer"](C84);};t9I["prototype"]["removeOverlayImage"]=function(D84){delete this["overlayImages"][D84];this["quadTileLayer"]["removeOverlayImage"](D84);};t9I["prototype"]["getRenderer"]=function(){return this["renderer"];};t9I["prototype"]["setWindowResizeCallback"]=function(A84){if(A84!=null&&A84!=undefined){this["windowResizeCallback"]=A84;}else{this["windowResizeCallback"]=null;}};t9I["prototype"]["saveCanvasToPNG"]=function(z84){if(this["canvas"]!=null){this["canvas"]["toBlob"](function(n84){saveAs(n84,z84);});}};t9I["prototype"]["getHitInformationOnObject"]=function(R84,g84){return this["getHitObjectFromScreenCoordinate"](R84,g84);};t9I["prototype"]["getHitObjectFromScreenCoordinate"]=function(O84,o84){var a84,X84,t84,T84;if(this["getCamera"]()){a84=this["convertCoordinateToPixel"](O84,o84);X84=null;t84=this["getInternalCamera"]();X84=t84["getHitObjectFromScreenCoordinate"](a84);if(X84==null){X84=null;}else{T84=T9I["CmMathEngine"]["Cartesian2Geo"](X84["x"],X84["y"],X84["z"],this["option"]["SceneMode"]);T84["z"]=(X84["z"]-T9I["cm_const"]["EarthRadius"])/this["option"]["VerticalExaggeration"];if(Math["abs"](T84["z"])<0.00000001)T84["z"]=0;X84={pos:T84,key:X84["key"],object:X84["object"],userObject:X84["userObject"]};}return X84;}return null;};t9I["prototype"]["convertCoordinateToPixel"]=function(x84,i84){var J84,Z84;J84=this["renderer"]["getPixelRatio"]();Z84=new THREE["Vector2"](x84*J84,i84*J84);return Z84;};t9I["prototype"]["convertPagePosToCanvasPos"]=function(S84,I84){var p84;p84=this["canvas"]["offsetParent"];while(p84!=null&&p84!=undefined){S84-=p84["offsetLeft"];I84-=p84["offsetTop"];p84=p84["offsetParent"];}S84-=this["canvas"]["offsetLeft"];I84-=this["canvas"]["offsetTop"];return new THREE["Vector2"](S84,I84);};t9I["prototype"]["getHitCoordinate"]=function(h84,j84,u84){var e84,w84,v84;if(this["getCamera"]()){e84=this["convertCoordinateToPixel"](h84,j84);w84=null;v84=this["camera"];w84=v84["getHitPosition"](e84,u84);if(w84==null){w84=null;}else{w84=T9I["CmMathEngine"]["Cartesian2Geo"](w84["x"],w84["y"],w84["z"],this["option"]["SceneMode"]);w84["z"]=(w84["z"]-T9I["cm_const"]["EarthRadius"])/this["option"]["VerticalExaggeration"];if(Math["abs"](w84["z"])<0.00000001)w84["z"]=0;}return w84;}return null;};t9I["prototype"]["getHitCoordinateOnGround"]=function(K84,b84){var d84,c84;if(this["getCamera"]()){d84=this["convertCoordinateToPixel"](K84,b84);c84=null;c84=this["camera"]["getHitPositionOnGround"](d84,false);if(c84==null){c84=null;}else{c84=T9I["CmMathEngine"]["Cartesian2Geo"](c84["x"],c84["y"],c84["z"],this["option"]["SceneMode"]);c84["z"]=(c84["z"]-T9I["cm_const"]["EarthRadius"])/this["option"]["VerticalExaggeration"];if(Math["abs"](c84["z"])<0.00000001)c84["z"]=0;}return c84;}return null;};t9I["prototype"]["getIntersectObjectsFromGeoCoordinate"]=function(N84,P84){var B84,q84,Q84;if(this["getCamera"]()){B84=T9I["CmMathEngine"]["Geo2Cartesian"](N84,P84,T9I["cm_const"]["EarthRadius"]+2000);q84=T9I["CmMathEngine"]["Geo2Cartesian"](N84,P84,T9I["cm_const"]["EarthRadius"]);Q84=this["getCamera"]()["getIntersectObjectsFromRay"](B84,q84);return Q84;}return null;};t9I["prototype"]["updateCanvasSize"]=function(f84,H44){var k44;if(f84<1||H44<1){return;}k44=this["renderer"]["getSize"]();if(k44["width"]==f84&&k44["height"]==H44){return;}this["getInternalCamera"]()["setAspect"](f84,H44);this["renderer"]["setSize"](f84,H44);this["getHUDPass"]()["updateCanvasSize"](f84,H44);this["option"]["basePass"]["setSize"](f84,H44);this["composer"]["setSize"](f84,H44);};t9I["prototype"]["getLatLongLineVisible"]=function(){return this["option"]["latLonGrid"]["visible"];};t9I["prototype"]["showLatLonLine"]=function(m44){this["option"]["latLonGrid"]["show"](m44);};t9I["prototype"]["setPreciseTerrainCoordinate"]=function(L44){this["option"]["enablePreciseTerrainCoordinate"]=L44;};t9I["prototype"]["keyHandle"]=function(){if(this["option"]["enableCameraMoveKey"]){T9I["CmKeyboard"]["moveCamera"](this["keyboard"]);}};t9I["prototype"]["zoomIn"]=function(){var V44,E44;V44=this["getCamera"]()["getPositionGeo"]()["z"]-T9I["cm_const"]["EarthRadius"];E44=V44*0.1;if(V44<100*this["option"]["GlobalScale"]){E44=100*this["option"]["GlobalScale"]*0.1;}this["getCamera"]()["Zoom"](E44);};t9I["prototype"]["zoomOut"]=function(){var y44,s44;y44=this["getCamera"]()["getPositionGeo"]()["z"]-T9I["cm_const"]["EarthRadius"];s44=y44*0.1;if(y44<100*this["option"]["GlobalScale"]){s44=100*this["option"]["GlobalScale"]*0.1;}this["getCamera"]()["Zoom"](-s44);};t9I["prototype"]["isRenderTime"]=function(){var Y44,l44,r44;Y44=1000/this["option"]["FPS"];l44=Date["now"]();r44=l44-this["option"]["FPS_time"];if(r44>Y44){this["option"]["FPS_time"]=l44-r44%Y44;return true;}return false;};t9I["prototype"]["getFrameTime"]=function(){return this["option"]["frameTime"];};t9I["prototype"]["getFrameElapsedTime"]=function(){return this["option"]["frameElapsedTime"];};t9I["prototype"]["startRenderLoop"]=function(F44){var W44;F44["renderLoopRunning"]=true;W44=0;requestAnimationFrame(U44);function U44(D44){var G44,M44,C44;if(F44["useDefaultRenderLoop"]){try{G44=null;if(!T9I["Util"]["isDefined"](G44)){{F44["update"]();}requestAnimationFrame(U44);}else{M44=1000.0/G44;C44=D44-W44;if(C44>M44){{F44["update"]();}W44=D44-C44%M44;}requestAnimationFrame(U44);}}catch(z44){var A44;F44["useDefaultRenderLoop"]=false;F44["renderLoopRunning"]=false;A44='An error occurred while rendering.  Rendering has stopped.';console["error"](A44);console["error"](z44);}finally{}}else{F44["renderLoopRunning"]=false;}}};t9I["prototype"]["updateSunPosition"]=function(){var g44,n44,T44,R44,X44;if(this["option"]["_enableSunLight"]==true){g44=this["option"]["worldTimer"]["now"]();n44=T9I["SunCalculator"]["getPosition"](g44);n44["x"]*=2;n44["y"]*=2;n44["z"]*=2;n44["sub"](this["option"]["refCenter"]);T44=this["getCamera"]()["getThreejsCamera"]();R44=1000;R44=T44["position"]["length"]();X44=g44["getHours"]();if(X44<6||X44>18){R44=100000;}n44["setLength"](R44);this["option"]["sunLight"]["position"]["set"](n44["x"],n44["y"],n44["z"]);this["option"]["sunLight"]["updateMatrix"]();}};t9I["prototype"]["enableSunLight"]=function(a44){this["option"]["enableSunLight"](a44,this["rootScene"]);};t9I["prototype"]["update"]=function(){var o44,p44,J44,O44,x44,Z44;this["preUpdateEvent"]["raiseEvent"]();if(this["firstUpdate"]){this["firstUpdate"]=false;this["checkCanvasSize"]();}o44=Date["now"]();this["option"]["frameElapsedTime"]=o44-this["option"]["frameTime"];this["option"]["frameTime"]=o44;this["isRenderingFrame"]=this["isRenderTime"]();this["downloadManager"]["update"]();if(this["initializedMap"]==false){}if(this["option"]["ShaderLoaded"]==false){return;}t9I["cache"]["update"](this["option"]["renderFrameTime"]);this["quadTileQuery"]["update"]();this["workerManager"]["update"]();this["updateReferenceCenter"]();p44=this["clock"]["getDelta"]();this["clearDisposableScene"]();this["getCamera"]()["getThreejsCamera"]()["children"]["length"]=0;this["getHUDPass"]()["update"]();this["getCamera"]()["getThreejsCamera"]()["updateMatrix"]();this["keyHandle"]();this["updateSunPosition"]();this["option"]["deltaTime"]=new Date()["getTime"]()-this["option"]["lastTime"];this["cameraFrustum"]["setFromMatrix"](new THREE["Matrix4"]()["multiplyMatrices"](this["camera"]["getProjectionMatrix"](),this["camera"]["getViewMatrix"]()));J44=this["getCamera"]()["getAltitude"]();if(J44<100000*this["option"]["GlobalScale"]){O44=1-J44/(100000*this["option"]["GlobalScale"]);if(O44>1.0)O44=1.0;else if(O44<0.0)O44=0.0;x44=new THREE["Color"](0.45098*O44,0.60784*O44,0.72157*O44);this["renderer"]["setClearColor"](x44,1);}{}if(this["resumeRendering"]==false){this["quadTileLayer"]["update"]();for(var t44 in this["vectorImageTileLayerList"]){this["vectorImageTileLayerList"][t44]["update"]();}for(var t44 in this["etcLayerList"]){this["etcLayerList"][t44]["update"]();}for(var t44 in this["vectorTileLayerList"]){this["vectorTileLayerList"][t44]["update"]();}for(var t44 in this["cube3DLayerList"]){this["cube3DLayerList"][t44]["update"]();}for(var t44 in this["userObjectLayer"]){this["userObjectLayer"][t44]["update"]();}this["measureLayer"]["update"]();if(this["modelLoadManager"]){this["modelLoadManager"]["update"]();}if(this["option"]["vectorImageLayerManager"]){this["option"]["vectorImageLayerManager"]["update"]();}if(this["option"]["atmosphereEnabled"]==true){if(this["skyShader"]==null){this["skyShader"]=new T9I["SkyShader"]();}this["skyShader"]["update"]();}for(var i44 in this["option"]["Objects"]){Z44=this["option"]["Objects"][i44];if(Z44){Z44["update"](this);}}if(this["clipBox"]){this["clipBox"]["update"](this);}if(this["onupdate"]){this["onupdate"]();}}this["postUpdateEvent"]["raiseEvent"]();if(this["isRenderingFrame"]==true){this["render"]();}this["disposeManager"]["update"]();this["option"]["jobManager"]["update"]();};t9I["prototype"]["requestRenderingPOI3D"]=function(I44,S44){if(S44===void 0){S44=false;}if(S44)this["requestedPOI3DArray"]["push"](I44);else this["requestedPOI3DArray"]["push"](I44);};t9I["prototype"]["renderScreenPOI"]=function(){var v44,h44,j44,e44;this["requestedPOI3DArray"]["sort"](function(u44,c44){if(u44["screenPos"]["z"]==c44["screenPos"]["z"])return 0;if(u44["screenPos"]["z"]>c44["screenPos"]["z"])return-1;return 1;});v44=this["getScreenLayerCanvasContext"]();h44=[];j44=[];e44=null;try{v44["save"]();v44["textBaseline"]='middle';{}for(var w44=0;w44<this["requestedPOI3DArray"]["length"];w44++){if(T9I["Util"]["isDefined"](this["requestedPOI3DArray"][w44]["getUserDraw"]())){h44["push"](this["requestedPOI3DArray"][w44]);}else{if(e44!=this["requestedPOI3DArray"][w44]["parentLayer"]){e44=this["requestedPOI3DArray"][w44]["parentLayer"];if(e44){v44["font"]=e44["font"];if(e44["fontColor"]){v44["fillStyle"]=e44["fontColor"];}}}this["requestedPOI3DArray"][w44]["innerRender"]();}}for(var w44=0;w44<h44["length"];w44++){if(e44!=h44[w44]["parentLayer"]){e44=h44[w44]["parentLayer"];if(e44){v44["font"]=e44["font"];if(e44["fontColor"]){v44["fillStyle"]=e44["fontColor"];}}}h44[w44]["innerRender"]();}}catch(d44){console["error"](d44);}this["requestedPOI3DArray"]["length"]=0;v44["restore"]();};function t9I(o9I,e9I,S9I,I9I,O9I,Z9I,J9I){var x9I,i9I,p9I,w9I;if(O9I===void 0){O9I=null;}if(Z9I===void 0){Z9I=null;}if(J9I===void 0){J9I=1.0;}this["cmworld"]=new T9I["CmWorld"]();this["etcLayerList"]=[];this["poi3DLayerArray"]=[];this["requestedPOI3DArray"]=[];this["userObjectLayer"]=[];this["baseQuadImageLayer"]=null;this["quadTerrainLayerList"]=new Array();this["vectorTileLayerList"]=[];this["vectorImageTileLayerList"]=[];this["cubeGroupLayerList"]=new Array();this["cube3DLayerList"]=[];this["ovelayImageTileLayerList"]=new Array();this["cubeGroupLayer"]=null;this["quadTileLayer"]=null;this["measureLayer"]=new T9I["GisLayer"]("MeasureLayer",this);this["overlayImages"]=[];this["option"]=null;this["frameState"]=new T9I["FrameState"]();this["isRenderingFrame"]=true;this["renderLoopRunning"]=true;this["keyboard"]=new THREEx["KeyboardState"]();this["mouse"]=new T9I["CmMouse"]();this["clock"]=new THREE["Clock"]();this["initializedMap"]=false;this["useDefaultRenderLoop"]=true;this["firstUpdate"]=true;this["onupdate"]=null;this["cmAxis3D"]=null;this["downloadManager"]=new T9I["ObjectDownloadManager"]();this["shaderLib"]=new T9I["CmShaderLib"]();this["polar"]=null;this["styleManager"]=new T9I["StyleManager"]();this["quadTileQuery"]=new T9I["QuadTileQuery"]();this["cameraFrustum"]=new THREE["Frustum"]();this["rootScene"]=null;this["terrainScene"]=null;this["earthSurfaceScene"]=null;this["skyScene"]=null;this["spaceScene"]=null;this["userScene"]=null;this["instantScene"]=null;this["groundScene"]=null;this["SystemScene"]=null;this["cube3DScene"]=null;this["preUpdateEvent"]=new T9I["Event"](this);this["postUpdateEvent"]=new T9I["Event"](this);this["postRenderEvent"]=new T9I["Event"](this);this["hudPass"]=null;this["windowResizeCallback"]=null;this["canvas"]=null;this["disposeManager"]=null;this["workerManager"]=null;this["modelLoadManager"]=null;this["resumeRendering"]=false;this["gisObjects"]=[];this["drawmodeObject"]=[];this["renderer"]=null;this["composer"]=null;this["skyShader"]=null;this["clipBox"]=null;if(o9I==null){o9I=document["createElementNS"]('http://www.w3.org/1999/xhtml','canvas');console["warn"]("canvas must be set.");}T9I["GlobalOption"]["setResourceInfo"]();if(T9I["Util"]["isDefined"](O9I)&&O9I["width"]){o9I["width"]=O9I["width"];o9I["height"]=O9I["height"];}else{o9I["width"]=o9I["clientWidth"];o9I["height"]=o9I["clientHeight"];}x9I=20;i9I=20;p9I=T9I["SceneModeType"]["SCENE_S3D"];if(T9I["Util"]["isDefined"](O9I)){if(O9I["maxlevel"])x9I=O9I["maxlevel"];if(O9I["toptilespan"])i9I=O9I["toptilespan"];if(O9I["scenemode"])p9I=O9I["scenemode"];}T9I["ConfirmUtil"]["confirmFeatures"]();T9I["CmWorld3"]["cmworld3Instance"]=this;if(t9I["cache"]==null){t9I["cache"]=new T9I["Cache"]();}this["option"]=new T9I["GlobalOption"]();this["option"]["terrainOpacity"]=J9I;if(J9I>=1.0)this["option"]["terrainTransparency"]=false;else this["option"]["terrainTransparency"]=true;this["postRenderEvent"]["addEventListener"](this["frameState"]["endFrame"],null);this["polar"]=new T9I["Polar"]();$["cmworker"]=function(v9I){var h9I;h9I=$["Deferred"](function(u9I){var j9I;{j9I=v9I["worker"];j9I["onmessage"]=function(c9I){if(c9I["data"]["cm_notify"]==undefined){u9I["resolve"](c9I);}};j9I["onerror"]=function(d9I){u9I["reject"](d9I);};if(v9I["args"]["arraybuffer"]){j9I["postMessage"](v9I["args"],[v9I["args"]["arraybuffer"]]);}else{j9I["postMessage"](v9I["args"]);}}});return h9I["promise"]();};this["canvas"]=o9I;this["option"]["loadShaderScripts"]();this["rootScene"]=new THREE["Scene"]();if(typeof WebGLRenderingContext==='undefined'){throw'The browser does not support WebGL.  Visit http://get.webgl.org.';}else{this["renderer"]=new THREE["WebGLRenderer"]({canvas:this["canvas"],antialias:false,logarithmicDepthBuffer:true,preserveDrawingBuffer:true});}this["clipBox"]=new T9I["Clipbox"]();this["renderer"]["clippingPlanes"]=this["clipBox"]["globalPlanes"];this["renderer"]["localClippingEnabled"]=false;this["renderer"]["setPixelRatio"](window["devicePixelRatio"]);this["renderer"]["autoClear"]=false;this["renderer"]["sortObjects"]=false;this["renderer"]["setClearColor"](0x000000,1);this["renderer"]["gammaInput"]=true;this["renderer"]["gammaOutput"]=true;w9I=this["renderer"]["getContext"]();this["option"]["SceneMode"]=p9I;T9I["CmMathEngine"]["setSceneMode"](this["option"]["SceneMode"]);if(this["option"]["SceneMode"]==T9I["SceneModeType"]["SCENE_S3D"]){this["option"]["mainCamera"]=new T9I["CmCameraGlobe"](this);}else if(this["option"]["SceneMode"]==T9I["SceneModeType"]["SCENE_P3D"]){this["option"]["mainCamera"]=new T9I["CmCameraFlat3D"]();}this["option"]["startupPosition"]["x"]=e9I;this["option"]["startupPosition"]["y"]=S9I;this["option"]["startupPosition"]["z"]=I9I;this["isRenderingFrame"]=true;this["clock"]=new THREE["Clock"]();this["initializedMap"]=false;this["onupdate"]=Z9I;this["cmAxis3D"]=null;this["shaderLib"]=new T9I["CmShaderLib"]();{this["terrainScene"]=new THREE["Scene"]();this["terrainScene"]["name"]="SceneTerrain";this["earthSurfaceScene"]=new THREE["Scene"]();this["earthSurfaceScene"]["name"]="EarthSurfaceScene";this["skyScene"]=new THREE["Scene"]();this["skyScene"]["name"]="SceneSky";this["spaceScene"]=new THREE["Scene"]();this["spaceScene"]["name"]="spaceScene";this["userScene"]=new THREE["Scene"]();this["userScene"]["name"]="SceneUser";this["instantScene"]=new THREE["Scene"]();this["instantScene"]["name"]="SceneInstant";this["groundScene"]=new THREE["Scene"]();this["groundScene"]["name"]="groundScene";this["SystemScene"]=new THREE["Scene"]();this["SystemScene"]["name"]="SystemScene";this["cube3DScene"]=new THREE["Scene"]();this["cube3DScene"]["name"]="cube3DScene";}{window["addEventListener"]('resize',function(){var K9I;K9I=t9I["getInstance"]();K9I["checkCanvasSize"]();});}this["skyShader"]=null;this["polar"]["createPolarImageResource"]();this["mouse"]["attachEvents"](this["canvas"]);this["measureLayer"]["addObjectEvent"]=new T9I["Event"](this);this["disposeManager"]=new T9I["DisposeManager"]();this["workerManager"]=new T9I["CmWorkerManager"]();this["modelLoadManager"]=new T9I["ModelLoadManager"]();this["option"]["setMapSetting"](false,x9I,i9I,1);this["quadTileLayer"]=new T9I["QuadImageLayer"]();this["quadTileLayer"]["loadManager"]["Loader"]["init"]();this["resumeRendering"]=false;this["drawmodeObject"]=[];this["downloadManager"]["init"](this);if(T9I["Util"]["isFuncDefined"](this["confirmBrowser"]))this["confirmBrowser"]();if(T9I["Util"]["isFuncDefined"](this["initMap"]))this["initMap"]();if(T9I["Util"]["isDefined"](O9I)&&T9I["Util"]["isDefined"](O9I["disableAutoLoop"])&&O9I["disableAutoLoop"]==true){}else{if(T9I["Util"]["isFuncDefined"](this["startRenderLoop"]))this["startRenderLoop"](this);}}t9I["prototype"]["updateReferenceCenter"]=function(){var K44;{if(this["option"]["earth"]!=null)this["option"]["earth"]["setGlobalOption"]();for(var b44 in this["option"]["Objects"]){K44=this["option"]["Objects"][b44];if(K44){K44["setGlobalOption"]();}}}};t9I["prototype"]["checkMesh"]=function(N44){if(N44["geometry"]["vertices"]["length"]>0){return true;}else{console["log"](N44["name"]+" has zero faces and/or vertices so it is removed.");return false;}};t9I["prototype"]["checkChild"]=function(P44){if(P44 instanceof THREE["Mesh"]){this["checkMesh"](P44);}for(var B44 in P44["children"]){this["checkChild"](B44);}};t9I["prototype"]["setReDrawMap"]=function(f44,H24,q44,Q44){if(q44===void 0){q44=0;}if(Q44===void 0){Q44=20;}if(T9I["Util"]["isDefined"](this["quadTileLayer"])){this["quadTileLayer"]["setReDrawMap"](f44,H24,q44,Q44);}};t9I["prototype"]["drawCanvasArea"]=function(){var k24;k24=this["getInstantScene"]();k24["add"](this["option"]["sunLightHelper"]);T9I["CmEtcUtil"]["drawToConfirmCanvasArea"](this["getRenderer"](),k24);};t9I["prototype"]["displayFPS"]=function(){var m24;if(this["option"]["checkFpsCounter"]()){m24=this["getScreenLayerCanvasContext"]();m24["save"]();try{m24["font"]='8pt arial';m24["fillStyle"]="white";this["option"]["updateFpsCounter"]();m24["fillText"](this["option"]["getFpsCounterString"](),10,10);}catch(L24){console["error"](L24);}finally{m24["restore"]();}}};t9I["prototype"]["render"]=function(){var E24,y24,s24,Y24;if(this["initializedMap"]==false){return;}this["option"]["writeFrameID"]();this["displayFPS"]();if(this["option"]["showCanvasArea"]){this["drawCanvasArea"]();return;}if(this["option"]["latLonGrid"]){this["option"]["latLonGrid"]["update"]();}this["option"]["earth"]["update"]();this["polar"]["renderImage"]();this["renderPOI3DLayer"](this["poi3DLayerArray"]);T9I["POI3DLayer"]["drawnRectArray"]["length"]=0;this["renderScreenPOI"]();this["composer"]["render"]();E24=false;if(E24){y24=window["frames"][0];s24=y24["document"];Y24=s24["getElementById"]("debugimage");}for(var V24=0;V24<this["drawmodeObject"]["length"];V24++){this["drawmodeObject"][V24]["needsUpdate"]=false;}for(var V24=0;V24<this["gisObjects"]["length"];V24++){this["gisObjects"][V24]["needsUpdate"]=false;}this["option"]["lastTime"]=new Date()["getTime"]();this["postRenderEvent"]["raiseEvent"]();};t9I["prototype"]["renderPOI3DLayer"]=function(l24){if(T9I["Util"]["isDefined"](l24)==false)return;for(var r24 in l24){l24[r24]["update"]();l24[r24]["render"]();}};t9I["prototype"]["clearDisposableScene"]=function(){var F24,W24,U24;F24=this["getUserScene"]();F24["children"]["length"]=0;W24=this["getInstantScene"]();W24["children"]["length"]=0;U24=this["getSkyScene"]();U24["children"]["length"]=0;F24=this["getSystemScene"]();F24=this["getCube3DScene"]();F24["children"]["length"]=0;};t9I["prototype"]["notifyGenerateTile"]=function(M24,C24,D24){for(var G24 in this["etcLayerList"]){if(this["etcLayerList"][G24]instanceof T9I["TileLayer"]){this["etcLayerList"][G24]["generateTile"](M24,C24,D24);}}for(var G24 in this["vectorTileLayerList"]){this["vectorTileLayerList"][G24]["generateTile"](M24,C24,D24);}};t9I["prototype"]["notifyClearTile"]=function(z24,n24,R24){for(var A24 in this["etcLayerList"]){if(this["etcLayerList"][A24]instanceof T9I["TileLayer"]){this["etcLayerList"][A24]["clearTile"](z24,n24,R24);}}for(var A24 in this["vectorTileLayerList"]){this["vectorTileLayerList"][A24]["clearTile"](z24,n24,R24);}};t9I["prototype"]["getGroundHeight"]=function(X24,T24){var g24;g24=0;if(this["quadTileLayer"]!=null){g24=this["quadTileLayer"]["getGroundHeight"](X24,T24);}return g24;};t9I["prototype"]["NormalizeScreenCoord"]=function(t24,O24){var a24;a24=new THREE["Vector2"]();t24+=0.5;O24+=0.5;a24["x"]=t24/this["canvas"]["width"]*2.0-1.0;a24["y"]=-(O24/this["canvas"]["height"])*2.0+1.0;return a24;};t9I["prototype"]["requestDispose"]=function(o24){this["disposeManager"]["add"](o24);};t9I["prototype"]["setAmbientColor"]=function(J24){if(T9I["Util"]["isDefined"](this["option"]["hemiLight"])){this["option"]["hemiLight"]["color"]=new THREE["Color"](J24);}};t9I["prototype"]["IsWalkingMode"]=function(){if(this["getCamera"]()instanceof T9I["CmCameraGlobeFirstPerson"]){return true;}return false;};t9I["prototype"]["setWalkingMode"]=function(S24){var Z24,x24,i24,p24,I24;Z24=this["getCamera"]();if(S24==true){if(Z24 instanceof T9I["CmCameraGlobe"]){x24=Z24;x24["detachToScene"](this["rootScene"]);i24=new T9I["CmCameraGlobeFirstPerson"]();i24["CopyFromCamera"](x24);this["setCamera"](i24);i24["setWalkingMode"](S24);x24=null;}else if(Z24 instanceof T9I["CmCameraGlobeFirstPerson"]){p24=Z24;p24["detachToScene"](this["rootScene"]);I24=new T9I["CmCameraGlobe"](this);I24["distanceFromLook"]=p24["distanceFromLook"];}}else{if(Z24 instanceof T9I["CmCameraGlobe"]){}else if(Z24 instanceof T9I["CmCameraGlobeFirstPerson"]){}}};Object["defineProperty"](t9I["prototype"],"camera",{get:function(){return this["option"]["mainCamera"];},enumerable:true,configurable:true});t9I["prototype"]["getCamera"]=function(){return this["camera"];};t9I["prototype"]["getInternalCamera"]=function(){return this["getCamera"]();};t9I["prototype"]["setCamera"]=function(w24){this["option"]["mainCamera"]=w24;this["option"]["mainCamera"]["attachToScene"](this["rootScene"]);};t9I["prototype"]["addModel"]=function(v24,K24,Q24,b24,u24,c24,d24,f24,H14,L14,h24,N24,P24,q24,B24,k14,j24){var e24;if(b24=="dae"){e24=new THREE["ColladaLoader"]();e24["options"]["convertUpAxis"]=true;e24["load"](K24,function(s14){var V14,E14,y14;V14=s14["scene"];V14["traverse"](function(Y14){if(Y14 instanceof THREE["SkinnedMesh"]){}});V14["scale"]["x"]=h24;V14["scale"]["y"]=N24;V14["scale"]["z"]=P24;V14["updateMatrix"]();this["rootScene"]["add"](V14);E14=T9I["CmMathEngine"]["Geo2Cartesian"](u24,c24,d24,this["option"]["SceneMode"]);V14["position"]["set"](E14["x"],E14["y"],E14["z"]);V14["updateMatrixWorld"](true);y14=new T9I["VectorObject"](v24,V14,E14,T9I["VectorObjectType"]["MODEL"],j24);this["option"]["Objects"][v24]=y14;y14["setGlobalOption"]();});}else if(b24=="obj"){e24=new THREE["OBJMTLLoader"]();e24["load"](K24,Q24,function(l14){var r14,U14,F14,G14,W14;r14=T9I["CmMathEngine"]["Geo2Cartesian"](u24,c24,d24,this["option"]["SceneMode"]);l14["scale"]["set"](h24,N24,P24);l14["position"]["set"](r14["x"],r14["y"],r14["z"]);U14=false;if(U14){F14=new THREE["Vector3"]();F14["sub"](this["option"]["refCenter"]);l14["lookAt"](F14);l14["updateMatrixWorld"](true);}else{G14=r14["clone"]()["normalize"]();l14["quaternion"]["setFromUnitVectors"](this["option"]["WorldUpAxis"],G14);}W14=new T9I["VectorObject"](v24,l14,r14,T9I["VectorObjectType"]["MODEL"],j24);this["option"]["Objects"][v24]=W14;W14["setGlobalOption"]();this["rootScene"]["add"](l14);if(B24){B24(v24);}},q24,onerror);}};t9I["load3DS"]=function(A14,z14,n14,R14,M14,C14){var D14;if(M14===void 0){M14=null;}if(C14===void 0){C14=true;}D14=T9I["Max3DSLoader"]["load3DS"](A14,z14,n14,R14,M14,C14);return D14;};t9I["loadTexture"]=function(g14,T14,a14){var X14,t14;if(T14===void 0){T14=false;}if(a14===void 0){a14=null;}if(g14!=null&&g14!='undefined'){X14=new THREE["TextureLoader"]();X14["setCrossOrigin"]("Anonymous");t14=X14["load"](g14);return t14;}return null;};t9I["prototype"]["addSymbol"]=function(I14,Z14,h14,v14,e14){var x14,o14,J14,i14,O14,w14,p14,S14;x14=new THREE["Geometry"]();i14=[];for(O14=0;O14<Z14["length"];O14++){o14=T9I["CmMathEngine"]["Geo2Cartesian"](Z14[O14]["x"],Z14[O14]["y"],Z14[O14]["z"],this["option"]["SceneMode"]);if(O14==0){J14=o14["clone"]();}o14["x"]-=J14["x"];o14["y"]-=J14["y"];o14["z"]-=J14["z"];i14[O14]=new THREE["Color"](h14);x14["vertices"]["push"](o14);}x14["colors"]=i14;w14=new THREE["PointsMaterial"]({map:v14,size:10});p14=new THREE["Points"](x14,w14);this["rootScene"]["add"](p14);S14=new T9I["VectorObject"](I14,p14,J14,T9I["VectorObjectType"]["GEOMETRY"],e14);this["option"]["Objects"][I14]=S14;S14["setGlobalOption"]();};t9I["prototype"]["addPolyline"]=function(B14,d14,f14,Q14){var K14,u14,c14,N14,j14,q14,b14,P14;K14=new THREE["Geometry"]();N14=[];for(j14=0;j14<d14["length"];j14++){u14=T9I["CmMathEngine"]["Geo2Cartesian"](d14[j14]["x"],d14[j14]["y"],d14[j14]["z"],this["option"]["SceneMode"]);if(j14==0){c14=u14["clone"]();}u14["x"]-=c14["x"];u14["y"]-=c14["y"];u14["z"]-=c14["z"];N14[j14]=new THREE["Color"](f14);K14["vertices"]["push"](u14);}K14["colors"]=N14;q14=new THREE["LineBasicMaterial"]({color:0xffffff,opacity:1,linewidth:1,vertexColors:THREE["VertexColors"]});b14=new THREE["Line"](K14,q14);this["rootScene"]["add"](b14);P14=new T9I["VectorObject"](B14,b14,c14,T9I["VectorObjectType"]["GEOMETRY"],Q14);this["option"]["Objects"][B14]=P14;P14["setGlobalOption"]();};t9I["prototype"]["addExtrudePolyline"]=function(U54,L54,W54,G54,C54){var m54,k54,V54,M54,H54,E54,y54,s54,l54,Y54,F54,r54;m54=new THREE["Geometry"]();M54=[];H54=0;for(H54=0;H54<L54["length"];H54++){k54=T9I["CmMathEngine"]["Geo2Cartesian"](L54[H54]["x"],L54[H54]["y"],L54[H54]["z"],this["option"]["SceneMode"]);if(H54==0){V54=k54["clone"]();}k54["x"]-=V54["x"];k54["y"]-=V54["y"];k54["z"]-=V54["z"];m54["vertices"]["push"](k54);k54=T9I["CmMathEngine"]["Geo2Cartesian"](L54[H54]["x"],L54[H54]["y"],L54[H54]["z"]+W54,this["option"]["SceneMode"]);k54["x"]-=V54["x"];k54["y"]-=V54["y"];k54["z"]-=V54["z"];m54["vertices"]["push"](k54);}E54=1.0/(L54["length"]-1);y54=1;s54=0;if(W54>0){y54=0;s54=1;}for(H54=0;H54<L54["length"]-1;H54++){m54["faces"]["push"](new THREE["Face3"](H54*2+0,H54*2+1,H54*2+2));m54["faces"]["push"](new THREE["Face3"](H54*2+1,H54*2+3,H54*2+2));m54["faceVertexUvs"][0]["push"]([new THREE["Vector2"](H54*E54,s54),new THREE["Vector2"](H54*E54,y54),new THREE["Vector2"]((H54+1)*E54,s54)]);m54["faceVertexUvs"][0]["push"]([new THREE["Vector2"](H54*E54,y54),new THREE["Vector2"]((H54+1)*E54,y54),new THREE["Vector2"]((H54+1)*E54,s54)]);}m54["computeVertexNormals"]();l54=new THREE["Texture"](G54);l54["minFilter"]=THREE["LinearFilter"];l54["needsUpdate"]=true;Y54=new THREE["MeshPhongMaterial"]({map:l54,side:THREE["DoubleSide"]});T9I["Material"]["addClippingAttri"](Y54);Y54["transparent"]=true;F54=new THREE["Mesh"](m54,Y54);this["rootScene"]["add"](F54);r54=new T9I["VectorObject"](U54,F54,V54,T9I["VectorObjectType"]["GEOMETRY"],null);this["option"]["Objects"][U54]=r54;r54["setGlobalOption"]();};t9I["prototype"]["removeObject"]=function(A54){var D54;D54=this["option"]["Objects"][A54];if(D54){this["rootScene"]["remove"](D54["Object"]);D54["clear"]();D54=null;this["option"]["Objects"][A54]=null;}};t9I["prototype"]["SetObjectActionList"]=function(n54,R54){var z54;z54=this["option"]["Objects"][n54];if(z54){z54["stopAction"]();z54["actionlist"]=R54;}};t9I["prototype"]["GetObject"]=function(X54){var g54;g54=this["option"]["Objects"][X54];if(g54){return g54;}};t9I["prototype"]["startObjectAction"]=function(a54){var T54;T54=this["option"]["Objects"][a54];if(T54){T54["stopAction"]();T54["startAction"]();}};t9I["prototype"]["StopObjectAction"]=function(O54){var t54;t54=this["option"]["Objects"][O54];if(t54){t54["stopAction"]();}};t9I["prototype"]["setCubeGroupImageURL"]=function(o54){this["cubeGroupLayer"]["setCubeGroupURL"](o54);};t9I["prototype"]["setAnaglyphMode"]=function(J54){if(J54===void 0){J54=true;}this["option"]["basePass"]["EnableAnaglyph"]=J54;this["option"]["anaglyphMode"]=J54;if(J54){this["option"]["basePass"]["setupAnaglyph"]();}else{this["option"]["basePass"]["clearAnaglyph"]();}};t9I["prototype"]["isAnaglyphMode"]=function(){return this["option"]["anaglyphMode"];};t9I["prototype"]["SetTopTileDisplayDistance"]=function(Z54){this["option"]["displayDist4Level"][0]=Z54;};t9I["prototype"]["requestNotiGroundHeightChanged"]=function(x54,i54,p54){if(this["quadTileLayer"]){this["quadTileLayer"]["requestNotiGroundHeightChanged"](x54,i54,p54);}};t9I["prototype"]["toScreenCoord"]=function(u54){var I54,j54,e54,v54,h54,S54,w54;I54=u54["clone"]();I54["sub"](this["option"]["refCenter"]);j54=this["getCamera"]()["getThreejsCamera"]();e54=this["getScreenLayerCanvasContext"]()["canvas"];v54=0.5*e54["width"];h54=0.5*e54["height"];S54=new THREE["Vector3"]();S54["x"]=I54["x"];S54["y"]=I54["y"];S54["z"]=I54["z"];S54["project"](j54);if(S54["x"]<-1||S54["x"]>1){return null;}if(S54["y"]<-1||S54["y"]>1){return null;}if(S54["z"]<-1||S54["z"]>1){return null;}w54=new THREE["Vector3"]();w54["x"]=S54["x"]*v54+v54;w54["y"]=-(S54["y"]*h54)+h54;w54["z"]=S54["z"];return w54;};t9I["prototype"]["setTerrainTransparancy"]=function(c54){if(c54>=1.0)this["option"]["terrainTransparency"]=false;else this["option"]["terrainTransparency"]=true;this["option"]["terrainOpacity"]=c54;this["option"]["earth"]["changeEarthOpacity"]();this["quadTileLayer"]["updateOpacityAll"](c54);};t9I["prototype"]["removeTerrainScene"]=function(){this["rootScene"]["remove"](this["earthSurfaceScene"]);this["rootScene"]["remove"](this["terrainScene"]);};t9I["prototype"]["addTerrainScene"]=function(){this["rootScene"]["add"](this["earthSurfaceScene"]);this["rootScene"]["add"](this["terrainScene"]);};t9I["prototype"]["removeGroundScene"]=function(){this["rootScene"]["remove"](this["groundScene"]);};t9I["prototype"]["addGroundScene"]=function(){this["rootScene"]["add"](this["groundScene"]);};t9I["prototype"]["getCameraNear"]=function(){return T9I["GlobalOption"]["userSetCameraNear"];};t9I["prototype"]["setCameraNear"]=function(K54){var d54,b54;d54=this["getInternalCamera"]();if(d54){b54=d54["getThreejsCamera"]();if(b54){if(K54){T9I["GlobalOption"]["userSetCameraNear"]=K54;d54["update"]();}}}};t9I["setRotate4Earth"]=function(B54,N54){var P54;P54=T9I["CmMathEngineS3D"]["getRotateQuat"](N54["x"],N54["y"]);B54["quaternion"]["copy"](P54);};t9I["setPosition4Earth"]=function(H64,f54){var Q54,q54;Q54=T9I["CmWorld3"]["getInstance"]();q54=T9I["CmMathEngine"]["Geo2Cartesian"](f54["x"],f54["y"],f54["z"]);q54["x"]-=Q54["option"]["refCenter"]["x"];q54["y"]-=Q54["option"]["refCenter"]["y"];q54["z"]-=Q54["option"]["refCenter"]["z"];H64["position"]["set"](q54["x"],q54["y"],q54["z"]);H64["updateMatrix"]();};return t9I;}();a9I["cmworld3Instance"]=null;a9I["cache"]=null;T9I["CmWorld3"]=a9I;}(CMWORLD||(CMWORLD={})));(function(m64){var L64,k64;L64=function(){V64["isOpera"]=function(){var E64,y64;E64=window;y64=!!E64["opr"]&&!!opr["addons"]||!!E64["opera"]||navigator["userAgent"]["indexOf"](' OPR/')>=0;return y64;};function V64(){}V64["isFirefox"]=function(){var Y64,s64;Y64=window;s64=typeof InstallTrigger!=='undefined';return s64;};V64["isSafari"]=function(){var l64,r64;l64=window;r64=Object["prototype"]["toString"]["call"](l64["HTMLElement"])["indexOf"]('Constructor')>0;return r64;};V64["isIE"]=function(){var U64,F64,W64;U64=window;F64=document;W64=false||!!F64["documentMode"];return W64;};V64["isEdge"]=function(){var G64,M64;G64=window;M64=!V64["isIE"]()&&!!G64["StyleMedia"];return M64;};V64["isChrome"]=function(){var C64,D64;C64=window;D64=!!C64["chrome"]&&!!C64["chrome"]["webstore"];return D64;};V64["isBlink"]=function(){var A64,z64;A64=window;z64=(V64["isChrome"]()||V64["isOpera"]())&&!!A64["CSS"];return z64;};return V64;}();m64["Browser"]=L64;k64=function(){n64["outputInfo"]=function(R64){if(n64["debugMode"]){console["info"](R64);}};n64["outputWarn"]=function(g64){if(n64["debugMode"]){console["warn"](g64);}};n64["outputlog"]=function(X64){if(n64["debugMode"]){console["log"](X64);}};function n64(){}n64["outputerror"]=function(T64){console["error"](T64);};return n64;}();k64["debugMode"]=false;m64["CmWorld"]=k64;}(CMWORLD||(CMWORLD={})));